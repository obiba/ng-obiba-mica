<div>
  <div class="pull-left" ng-if="!loading && table.taxonomyHeaders.length">
    <span translate>search.coverage-group-by</span>
    <div class="btn-group" uib-dropdown is-open="status.isopen">
      <button type="button" class="btn btn-primary btn-sm" uib-dropdown-toggle ng-disabled="disabled">
        {{'search.coverage-buckets.' + bucket | translate}} <span class="caret"></span>
      </button>
      <ul uib-dropdown-menu role="menu">
        <li role="menuitem" ng-if="bucket !== BUCKET_TYPES.STUDY">
          <a href ng-click="selectBucket(BUCKET_TYPES.STUDY)" translate>search.coverage-buckets.study</a>
        </li>
        <li role="menuitem" ng-if="bucket !== BUCKET_TYPES.DCE">
          <a href ng-click="selectBucket(BUCKET_TYPES.DCE)" translate>search.coverage-buckets.dce</a>
        </li>
        <li role="menuitem" ng-if="bucket !== BUCKET_TYPES.DATASET">
          <a href ng-click="selectBucket(BUCKET_TYPES.DATASET)" translate>search.coverage-buckets.dataset</a>
        </li>
        <li role="menuitem" ng-if="bucket !== BUCKET_TYPES.NETWORK">
          <a href ng-click="selectBucket(BUCKET_TYPES.NETWORK)" translate>search.coverage-buckets.network</a>
        </li>
        <li role="menuitem" ng-if="bucket !== BUCKET_TYPES.DATASCHEMA">
          <a href ng-click="selectBucket(BUCKET_TYPES.DATASCHEMA)" translate>search.coverage-buckets.dataschema</a>
        </li>
      </ul>
    </div>
  </div>

  <div class="pull-right" ng-if="table.taxonomyHeaders.length > 0">
    <a href class="btn btn-info" translate ng-if="hasSelected()" ng-click="updateFilterCriteria()">search.filter</a>
    <a target="_self" class="btn btn-info btn-responsive" ng-href="{{downloadUrl()}}">
      <i class="fa fa-download"></i> {{'download' | translate}}
    </a>
    <!--<a href ng-click="toggleMissing(false)" ng-if="showMissing" translate>search.coverage-hide-missing</a>-->
    <!--<a href ng-click="toggleMissing(true)" ng-if="!showMissing" translate>search.coverage-show-missing</a>-->
  </div>

  <div class="clearfix"></div>

  <p class="help-block" ng-if="!loading && !table.taxonomyHeaders" translate>search.no-coverage</p>

  <div ng-if="loading" class="loading"></div>

  <div class="table-responsive" ng-if="table.taxonomyHeaders.length > 0">
    <table class="table table-bordered table-striped">
      <thead>
      <tr>
        <th rowspan="{{bucket === BUCKET_TYPES.DCE ? 1 : 2}}" colspan="{{table.cols.colSpan}}" translate>{{'search.coverage-buckets.' + bucket}}</th>
        <th ng-repeat="header in table.vocabularyHeaders" colspan="{{header.termsCount}}">
          <span
            uib-popover="{{header.entity.descriptions[0].value}}"
            popover-title="{{header.entity.titles[0].value}}"
            popover-placement="bottom"
            popover-trigger="mouseenter">
          {{header.entity.titles[0].value}}
            </span>
        </th>
        <th rowspan="2"></th>
      </tr>
      <tr>
        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.study</th>
        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.population</th>
        <th ng-if="bucket === BUCKET_TYPES.DCE" translate>search.coverage-dce-cols.dce</th>
        <th ng-repeat="header in table.termHeaders">
          <span
            uib-popover="{{header.entity.descriptions[0].value}}"
            popover-title="{{header.entity.titles[0].value}}"
            popover-placement="bottom"
            popover-trigger="mouseenter">
          {{header.entity.titles[0].value}}
            </span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="row in table.rows" ng-if="showMissing || table.termHeaders.length == keys(row.hits).length">
        <td ng-repeat="col in table.cols.ids[row.value]" rowspan="{{col.rowSpan}}" ng-if="col.rowSpan > 0">
          <a href="{{col.url ? col.url : ''}}"
            uib-popover-html="col.description === col.title ? null : col.description"
            popover-title="{{col.title}}"
            popover-placement="bottom"
            popover-trigger="mouseenter">{{col.title}}</a>
        </td>
        <td ng-repeat="h in table.termHeaders">
          <a href ng-click="updateCriteria(row.value, 'variables')"><span class="label label-info" ng-if="row.hits[$index]">{{row.hits[$index]}}</span></a>
          <span ng-if="!row.hits[$index]">0</span>
        </td>
        <td><input type="checkbox" ng-model="row.selected"></td>
      </tr>
      </tbody>
      <tfoot>
      <tr>
        <th colspan="{{table.cols.colSpan}}" translate>all</th>
        <th ng-repeat="header in table.termHeaders" title="{{header.entity.descriptions[0].value}}">
          <a href ng-click="updateDisplay()">{{header.hits}}</a>
        </th>
      </tr>
      </tfoot>
    </table>
  </div>

  <!--<pre>-->
  <!--{{table.cols | json}}-->
  <!--</pre>-->
</div>