/*!
 * ng-obiba-mica - v1.3.0
 * https://github.com/obiba/ng-obiba-mica

 * License: GNU Public License version 3
 * Date: 2017-09-08
 */
"use strict";function NgObibaMicaUrlProvider(){function a(a){var b=a;this.getUrl=function(a){return a in b?b[a]:null}}var b={DataAccessClientDetailPath:"",DataAccessClientListPath:"",DataAccessFormConfigResource:"ws/config/data-access-form",DataAccessRequestsResource:"ws/data-access-requests",DataAccessRequestsExportCsvResource:"ws/data-access-requests/csv?lang=:lang",DataAccessRequestResource:"ws/data-access-request/:id",DataAccessRequestAttachmentsUpdateResource:"/ws/data-access-request/:id/_attachments",DataAccessRequestAttachmentDownloadResource:"/ws/data-access-request/:id/attachments/:attachmentId/_download",SchemaFormAttachmentDownloadResource:"/ws/:path/form/attachments/:attachmentName/:attachmentId/_download",DataAccessRequestDownloadPdfResource:"/ws/data-access-request/:id/_pdf",DataAccessRequestCommentsResource:"ws/data-access-request/:id/comments",DataAccessRequestCommentResource:"ws/data-access-request/:id/comment/:commentId",DataAccessRequestStatusResource:"ws/data-access-request/:id/_status?to=:status",TempFileUploadResource:"ws/files/temp",TempFileResource:"ws/files/temp/:id",TaxonomiesSearchResource:"ws/taxonomies/_search",TaxonomiesResource:"ws/taxonomies/_filter",TaxonomyResource:"ws/taxonomy/:taxonomy/_filter",VocabularyResource:"ws/taxonomy/:taxonomy/vocabulary/:vocabulary/_filter",JoinQuerySearchResource:"ws/:type/_rql?query=:query",JoinQuerySearchCsvResource:"ws/:type/_rql_csv?query=:query",JoinQuerySearchCsvReportResource:"ws/:type/_report?query=:query",JoinQuerySearchCsvReportByNetworkResource:"ws/:type/_report_by_network?networkId=:networkId&locale=:locale",JoinQueryCoverageResource:"ws/variables/_coverage?query=:query",JoinQueryCoverageDownloadResource:"ws/variables/_coverage_download?query=:query",VariablePage:"",NetworkPage:"#/network/:network",StudyPage:"#/:type/:study",StudyPopulationsPage:"#/:type/:study",DatasetPage:"#/:type/:dataset",BaseUrl:"/",FileBrowserFileResource:"ws/file/:path/",FileBrowserSearchResource:"ws/files-search/:path",FileBrowserDownloadUrl:"ws/draft/file-dl/:path?inline=:inline",GraphicsSearchRootUrl:"#/search"};this.setUrl=function(a,c){a in b&&(b[a]=c)},this.$get=function(){return new a(b)}}function NgObibaMicaTemplateUrlFactory(){function a(a){var c=a;this.getHeaderUrl=function(a){return a in c?c[a].header:null},this.getFooterUrl=function(a){return a in c?c[a].footer:null},this.getTemplateUrl=function(a){return a in c?c[a].template?c[a].template:b[a]:null}}var b={searchStudiesResultTable:"search/views/list/studies-search-result-table-template.html",searchNetworksResultTable:"search/views/list/networks-search-result-table-template.html",searchResultList:"search/views/search-result-list-template.html",searchResultCoverage:"search/views/search-result-coverage-template.html",searchResultGraphics:"search/views/search-result-graphics-template.html"},c={registry:null};c.setTemplateUrl=function(a,b){a in this.registry&&(this.registry[a].template=b)},c.setHeaderUrl=function(a,b){a in this.registry&&(this.registry[a].header=b)},c.setFooterUrl=function(a,b){a in this.registry&&(this.registry[a].footer=b)},c.$get=function(){return new a(this.registry)},this.create=function(a){return c.registry=a,c}}function targetToType(a){switch(a.toLocaleString()){case QUERY_TARGETS.NETWORK:return QUERY_TYPES.NETWORKS;case QUERY_TARGETS.STUDY:return QUERY_TYPES.STUDIES;case QUERY_TARGETS.DATASET:return QUERY_TYPES.DATASETS;case QUERY_TARGETS.VARIABLE:return QUERY_TYPES.VARIABLES}throw new Error("Invalid target: "+a)}function typeToTarget(a){switch(a.toLocaleString()){case QUERY_TYPES.NETWORKS:return QUERY_TARGETS.NETWORK;case QUERY_TYPES.STUDIES:return QUERY_TARGETS.STUDY;case QUERY_TYPES.DATASETS:return QUERY_TARGETS.DATASET;case QUERY_TYPES.VARIABLES:return QUERY_TARGETS.VARIABLE}throw new Error("Invalid type: "+a)}function CriteriaItem(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]})}function RepeatableCriteriaItem(){CriteriaItem.call(this,{}),this.list=[]}function CriteriaItemBuilder(a,b){function c(){d.term?(d.itemTitle=a.forLocale(d.term.title,d.lang),d.itemDescription=a.forLocale(d.term.description,d.lang),d.itemParentTitle=a.forLocale(d.vocabulary.title,d.lang),d.itemParentDescription=a.forLocale(d.vocabulary.description,d.lang),d.itemTitle||(d.itemTitle=d.term.name),d.itemParentTitle||(d.itemParentTitle=d.vocabulary.name)):(d.itemTitle=a.forLocale(d.vocabulary.title,d.lang),d.itemDescription=a.forLocale(d.vocabulary.description,d.lang),d.itemParentTitle=a.forLocale(d.taxonomy.title,d.lang),d.itemParentDescription=a.forLocale(d.taxonomy.description,d.lang),d.itemTitle||(d.itemTitle=d.vocabulary.name),d.itemParentTitle||(d.itemParentTitle=d.taxonomy.name)),d.id=CriteriaIdGenerator.generate(d.taxonomy,d.vocabulary,d.term)}var d={type:null,rqlQuery:null,lang:b||"en",parent:null,children:[]};this.type=function(a){if(!RQL_NODE[a.toUpperCase()])throw new Error("Invalid node type:",a);return d.type=a,this},this.target=function(a){return d.target=a,this},this.parent=function(a){return d.parent=a,this},this.taxonomy=function(a){return d.taxonomy=a,this},this.vocabulary=function(a){return d.vocabulary=a,this},this.term=function(a){return d.term=a,this},this.rqlQuery=function(a){return d.rqlQuery=a,this},this.selectedTerm=function(a){return d.selectedTerms||(d.selectedTerms=[]),d.selectedTerms.push("string"==typeof a?a:a.name),this},this.selectedTerms=function(a){return d.selectedTerms=a.filter(function(a){return a}).map(function(a){return"string"==typeof a?a:a.name}),this},this.build=function(){return d.taxonomy&&d.vocabulary&&c(),new CriteriaItem(d)}}function CriteriaBuilder(a,b,c,d,e){this.newCriteriaItemBuilder=function(){return new CriteriaItemBuilder(d,e)},this.initialize=function(f){this.leafItemMap={},this.target=f,this.rootRql=a,this.taxonomies=c,this.LocalizedValues=d,this.lang=e,this.rootItem=this.newCriteriaItemBuilder().parent(b).type(this.target).rqlQuery(this.rootRql).target(this.target).build()},this.buildLeafItem=function(a,b,c,d,e){var f=this,g=new CriteriaItemBuilder(f.LocalizedValues,f.lang).type(d.name).target(f.target).taxonomy(a).vocabulary(b).rqlQuery(d).parent(e);return g.selectedTerms(c).build(),g.build()}}function CriterionState(){var a=[],b=[];this.dirty=!1,this.open=!1,this.loading=!0,this.addOnOpen=function(b){a.push(b)},this.addOnClose=function(a){b.push(a)},this.onOpen=function(){a.forEach(function(a){a()})},this.onClose=function(){b.forEach(function(a){a()})}}function BaseTaxonomiesController(a,b,c,d,e,f,g,h,i){b.options=g.getOptions(),b.RqlQueryUtils=h,b.metaTaxonomy=e.get({target:"taxonomy",taxonomy:"Mica_taxonomy"}),b.taxonomies={all:[],search:{text:null,active:!1},target:b.target||"variable",taxonomy:null,vocabulary:null},a.$on("$translateChangeSuccess",function(){b.taxonomies&&b.taxonomies.vocabulary&&h.sortVocabularyTerms(b.taxonomies.vocabulary,c.use())}),b.canNavigate=function(a){return!(b.options.hideNavigate.indexOf(a.name)>-1)&&0===(a.attributes||[]).filter(function(a){return"showNavigate"===a.key}).length},this.navigateTaxonomy=function(a,c,e){if(b.taxonomies.term=e,b.isHistoryEnabled){var f=d.search();f.taxonomy=a?a.name:null,c&&f.vocabulary!==c.name?(h.sortVocabularyTerms(c,b.lang),f.vocabulary=c.name):f.vocabulary=null,d.search(f)}else b.taxonomies.taxonomy=a,b.taxonomies.vocabulary&&b.taxonomies.vocabulary.name===c.name||h.sortVocabularyTerms(c,b.lang),b.taxonomies.vocabulary=c},this.updateStateFromLocation=function(){var a=d.search(),c=a.taxonomy,e=a.vocabulary,f=null,g=null;b.taxonomies.all&&(b.taxonomies.all.forEach(function(a){a.name===c&&(f=a,a.vocabularies.forEach(function(a){a.name===e&&(g=a)}))}),angular.equals(b.taxonomies.taxonomy,f)&&angular.equals(b.taxonomies.vocabulary,g)||(b.taxonomies.taxonomy=f,g&&h.sortVocabularyTerms(g,b.lang),b.taxonomies.vocabulary=g))},this.selectTerm=function(a,c,d,e){b.onSelectTerm(a,c,d,e)},this.clearCache=function(){var a=i.get("taxonomyResource");a&&a.removeAll()};var j=this;b.$on("$locationChangeSuccess",function(){b.isHistoryEnabled&&j.updateStateFromLocation()}),b.$watch("taxonomies.vocabulary",function(a){h&&a?(b.taxonomies.isNumericVocabulary=h.isNumericVocabulary(b.taxonomies.vocabulary),b.taxonomies.isMatchVocabulary=h.isMatchVocabulary(b.taxonomies.vocabulary)):(b.taxonomies.isNumericVocabulary=null,b.taxonomies.isMatchVocabulary=null)}),b.navigateTaxonomy=this.navigateTaxonomy,b.selectTerm=this.selectTerm,b.clearCache=this.clearCache}function TaxonomiesPanelController(a,b,c,d,e,f,g,h,i,j,k){function l(a,c){e.get({target:a,taxonomy:c},function(a){b.taxonomies.taxonomy=a,b.taxonomies.vocabulary=null,b.taxonomies.term=null,b.taxonomies.search.active=!1},function(a){b.taxonomies.search.active=!1,j.alert({id:"SearchController",type:"danger",msg:k.buildMessage(a),delay:5e3})})}BaseTaxonomiesController.call(this,a,b,c,d,e,f,g,h,i),b.$watchGroup(["taxonomyName","target"],function(a){a[0]&&a[1]&&(b.showTaxonomies&&b.showTaxonomies(),b.taxonomies.target=a[1],b.taxonomies.search.active=!0,b.taxonomies.all=null,b.taxonomies.taxonomy=null,b.taxonomies.vocabulary=null,b.taxonomies.term=null,l(a[1],a[0]))}),this.refreshTaxonomyCache=function(a,c){b.clearCache(),l(a,c)},b.refreshTaxonomyCache=this.refreshTaxonomyCache}function ClassificationPanelController(a,b,c,d,e,f,g,h,i,j){function k(){f.get({target:b.taxonomies.target},function(a){b.taxonomies.all=a,l(a,b.taxonomies.target),b.taxonomies.search.active=!1,m.updateStateFromLocation()})}BaseTaxonomiesController.call(this,a,b,c,d,e,f,g,h,i);var l=function(a,c){var d=a.reduce(function(a,b){if(c)return b.vocabularies=j.visibleVocabularies(b.vocabularies),a[b.name]=b,a},{});return b.metaTaxonomy.$promise.then(function(a){var e=a.vocabularies.filter(function(a){return a.name===c})[0];b.taxonomyGroups=e.terms.map(function(a){if(!a.terms){var c=d[a.name];return c?(c.title=a.title,c.description=a.description,{title:null,taxonomies:[c]}):null}var e=a.terms.map(function(a){var b=d[a.name];return b?(b.title=a.title,b.description=a.description,b):null}).filter(function(a){return a}),f=a.title.filter(function(a){return a.locale===b.lang})[0],g=a.description?a.description.filter(function(a){return a.locale===b.lang})[0]:void 0;return{title:f?f.text:null,description:g?g.text:null,taxonomies:e}}).filter(function(a){return a})})},m=this;b.$watch("target",function(a){a&&(b.taxonomies.target=a,b.taxonomies.search.active=!0,b.taxonomies.all=null,b.taxonomies.taxonomy=null,b.taxonomies.vocabulary=null,b.taxonomies.term=null,k())}),this.refreshTaxonomyCache=function(){b.clearCache(),k()},b.refreshTaxonomyCache=this.refreshTaxonomyCache}function GraphicChartsDataProvider(){function a(a){var b=a;this.getData=function(a){a&&b.$promise.then(a)}}this.$get=["$log","JoinQuerySearchResource","ServerErrorUtils","AlertService","GraphicChartsConfig","GraphicChartsQuery",function(b,c,d,e,f,g){var h=g.queryDtoBuilder(f.getOptions().entityIds,f.getOptions().entityType);return new a(c.studies({query:h},function(a){return a},function(a){b.error("Server error",a)}))}]}function NgObibaMicaFileBrowserOptionsProvider(){var a={locale:"en",downloadInline:!0,downloadKey:!1,folders:{excludes:["population"]}};this.addExcludeFolder=function(b){b&&a.folders.excludes.push(b)},this.$get=function(){return a}}angular.module("ngObibaMica",["schemaForm","ngCookies","obiba.mica.utils","obiba.mica.file","obiba.mica.attachment","obiba.mica.access","obiba.mica.search","obiba.mica.graphics","obiba.mica.localized","obiba.mica.fileBrowser","angularUtils.directives.dirPagination"]).constant("USER_ROLES",{all:"*",admin:"mica-administrator",reviewer:"mica-reviewer",editor:"mica-editor",user:"mica-user",dao:"mica-data-access-officer"}).config(["$provide","paginationTemplateProvider",function(a,b){a.provider("ngObibaMicaUrl",NgObibaMicaUrlProvider),b.setPath("views/pagination-template.html")}]),angular.module("obiba.mica.utils",["schemaForm"]).factory("urlEncode",function(){return function(a){return window.encodeURIComponent(a)}}).factory("UserProfileService",function(){var a=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};return{getAttribute:function(b,c){return a(b,c)},getFullName:function(b){return b?b.attributes?a(b.attributes,"firstName")+" "+a(b.attributes,"lastName"):b.username:null}}}).service("GraphicChartsConfigurations",function(){this.getClientConfig=function(){return!0},this.setClientConfig=function(){return!0}}).directive("fixedHeader",["$timeout","$window",function(a,b){return{restrict:"A",scope:{tableMaxHeight:"@",trigger:"=fixedHeader"},link:function(c,d){function e(a){return"none"!==b.getComputedStyle(a).display&&0!==a.offsetWidth}function f(){return e(h.querySelector("tbody"))&&null!==h.querySelector("tbody tr:first-child")}function g(){c.redraw||(angular.element(h.querySelectorAll("thead, tbody, tfoot")).css("display",""),a(function(){c.redraw=!0;var a=0;if(angular.forEach(h.querySelectorAll("tr:first-child th"),function(b,c){var d=h.querySelector("tbody tr:first-child td:nth-child("+(c+1)+")"),e=h.querySelector("tfoot tr:first-child td:nth-child("+(c+1)+")"),f=d?d.offsetWidth:b.offsetWidth;d&&(d.style.width=f+"px"),b&&(b.style.width=f+"px"),e&&(e.style.width=f+"px"),a+=f}),angular.element(h.querySelectorAll("thead, tfoot")).css("display","block"),angular.element(h.querySelectorAll("tbody")).css({display:"block","max-height":c.tableMaxHeight||"inherit",overflow:"auto"}),a<h.offsetWidth){var b=h.querySelector("tbody tr:first-child td:last-child");b&&(b.style.width=b.offsetWidth+h.offsetWidth-a+"px",b=h.querySelector("thead tr:first-child th:last-child"),b.style.width=b.offsetWidth+h.offsetWidth-a+"px")}var d=h.querySelector("tbody"),e=d.offsetWidth-d.clientWidth;if(e>0){var f=h.querySelector("tbody tr:first-child td:last-child");f.style.width=parseInt(f.style.width.replace("px",""))-e+"px"}c.redraw=!1}))}var h=d[0];c.redraw=!1,c.$watchGroup(["trigger",f],function(a){a[1]===!0&&g()}),c.$watch(function(){return h.offsetWidth},function(){g()})}}}]).directive("routeChecker",["$route",function(a){return{restrict:"A",scope:{routeCheckerHidesParent:"="},link:function(b,c,d){var e=d.ngHref.substr(1,d.ngHref.length-1);Object.keys(a.routes).filter(function(b){var c=a.routes[b].regexp;return!!c&&c.test(e)}).pop()||(b.routeCheckerHidesParent?c.parent().hide():c.hide())}}}]).factory("FormDirtyStateObserver",["$uibModal","$location",function(a,b){var c;return{observe:function(d){c&&c(),c=d.$on("$locationChangeStart",function(e,f){if(d.form.$dirty)return a.open({backdrop:"static",controller:["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}],templateUrl:"utils/views/unsaved-modal.html"}).result.then(function(a){a===!0&&(c(),b.path(angular.copy(b).url(f).hash()))}),void e.preventDefault();c()})},unobserve:function(){c&&c()}}}]).service("SfOptionsService",["$translate","$q",function(a,b){var c=["required","errors.does-not-validate","errors.localized.completed"];this.transform=function(){var d=b.defer();return a(c).then(function(a){d.resolve({validationMessage:{302:a.required,default:a["errors.does-not-validate"],completed:a["errors.localized.completed"]}})}),d.promise}}]).config(["schemaFormProvider",function(a){a.postProcess(function(a){return a.filter(function(a){return a.hasOwnProperty("wordLimit")}).forEach(function(a){a.$validators={wordLimitError:function(b){if(angular.isDefined(b)&&null!==b){if((b.match(/\S+/g)||[]).length>parseInt(a.wordLimit))return!1}return!0}}}),a})}]),angular.module("obiba.mica.file",["ngResource"]),angular.module("obiba.mica.file").filter("bytes",function(){return function(a){return null===a||void 0===a?"":filesize(a)}}),angular.module("obiba.mica.file").factory("TempFileResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TempFileResource"),{},{get:{method:"GET"},delete:{method:"DELETE"}})}]),angular.module("obiba.mica.attachment",["obiba.mica.file","ui","ui.bootstrap","ngFileUpload","templates-ngObibaMica"]),angular.module("obiba.mica.attachment").directive("attachmentList",[function(){return{restrict:"E",scope:{hrefBuilder:"=",files:"=",emptyMessage:"="},templateUrl:"attachment/attachment-list-template.html",link:function(a){a.attachments=[],a.hrefBuilder=a.hrefBuilder||function(a){return a.id},a.hasAttachments=!1,a.$watch("files",function(b){b&&(a.hasAttachments=b.length>0,a.attachments=b.map(function(b){var c=angular.copy(b);return c.href=a.hrefBuilder(b),c}))},!0)}}}]).directive("attachmentInput",[function(){return{restrict:"E",require:"^form",scope:{multiple:"=",accept:"@",files:"=",disabled:"=",onError:"="},templateUrl:"attachment/attachment-input-template.html",controller:"AttachmentCtrl"}}]).controller("AttachmentCtrl",["$scope","$timeout","$log","Upload","TempFileResource","ngObibaMicaUrl",function(a,b,c,d,e,f){var g=function(g){a.files=a.files||[];var h={showProgressBar:!0,lang:"en",progress:0,fileName:g.name,size:g.size};a.multiple?a.files.push(h):(a.files.splice(0,a.files.length),a.files.push(h)),a.upload=d.upload({url:f.getUrl("TempFileUploadResource"),method:"POST",file:g}).progress(function(a){h.progress=parseInt(100*a.loaded/a.total)}).success(function(a,d,f){var g=f().location.split("/"),i=g[g.length-1];e.get({id:i},function(a){c.debug("tempFile",a),h.id=a.id,h.md5=a.md5,h.justUploaded=!0,h.timestamps={created:new Date},b(function(){h.showProgressBar=!1},1e3)})}).error(function(b){c.error("File upload failed: ",JSON.stringify(b,null,2));var d=a.files.indexOf(h);d!==-1&&a.files.splice(d,1),a.onError&&a.onError(h)})};a.onFileSelect=function(b){a.uploadedFiles=b,a.uploadedFiles.forEach(function(a){g(a)})},a.deleteTempFile=function(b){e.delete({id:b},function(){for(var c=a.files.length;c--;){var d=a.files[c];d.justUploaded&&d.id===b&&a.files.splice(c,1)}})},a.deleteFile=function(b){for(var c=a.files.length;c--;)a.files[c].id===b&&a.files.splice(c,1)}}]),angular.module("obiba.mica.access",["pascalprecht.translate","obiba.alert","obiba.comments","obiba.mica.attachment","obiba.utils","angularMoment","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaAccessTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({list:{header:null,footer:null},view:{header:null,footer:null},form:{header:null,footer:null}}))}]),angular.module("obiba.mica.access").controller("DataAccessRequestListController",["$rootScope","$scope","$uibModal","DataAccessRequestsResource","DataAccessRequestResource","DataAccessRequestService","NOTIFICATION_EVENTS","SessionProxy","USER_ROLES","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig","ngObibaMicaUrl","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=function(a){for(var c=0;c<a.length;c++){var d=a[c];if("OPENED"!==d.status)for(var e=0;e<d.statusChangeHistory.length;e++){var f=d.statusChangeHistory[e];"OPENED"===f.from&&"SUBMITTED"===f.to&&(d.submissionDate=f.changedOn)}}b.requests=a,b.loading=!1},o=function(){b.loading=!1};f.getStatusFilterData(function(a){b.REQUEST_STATUS=a}),b.headerTemplateUrl=j.getHeaderUrl("list"),b.footerTemplateUrl=j.getFooterUrl("list"),b.config=k.getOptions(),b.searchStatus={},b.loading=!0,d.query({},n,o),b.actions=f.actions,b.showApplicant=h.roles().filter(function(a){return[i.dao,i.admin].indexOf(a)>-1}).length>0,b.deleteRequest=function(c){b.requestToDelete=c.id,a.$broadcast(g.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[c.title,c.applicant]},c.id)},b.userProfile=function(a){b.applicant=a,c.open({scope:b,templateUrl:"access/views/data-access-request-profile-user-modal.html"})};var p=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};b.getFullName=function(a){return a?a.attributes?p(a.attributes,"firstName")+" "+p(a.attributes,"lastName"):a.username:null},b.getProfileEmail=function(a){return a&&a.attributes?p(a.attributes,"email"):null},b.getCsvExportHref=function(){return l.getUrl("DataAccessRequestsExportCsvResource").replace(":lang",m.use())},b.getDataAccessRequestPageUrl=function(){return l.getUrl("DataAccessClientDetailPath")?l.getUrl("BaseUrl")+l.getUrl("DataAccessClientDetailPath"):null},b.$on(g.confirmDialogAccepted,function(a,c){b.requestToDelete===c&&(e.delete({id:b.requestToDelete},function(){b.loading=!0,d.query({},n,o)}),delete b.requestToDelete)})}]).controller("DataAccessRequestViewController",["$rootScope","$scope","$location","$uibModal","$routeParams","$filter","$translate","DataAccessRequestResource","DataAccessRequestService","DataAccessRequestStatusResource","DataAccessFormConfigResource","JsonUtils","DataAccessRequestAttachmentsUpdateResource","DataAccessRequestCommentsResource","DataAccessRequestCommentResource","ngObibaMicaUrl","ngObibaMicaAccessTemplateUrl","AlertService","ServerErrorUtils","NOTIFICATION_EVENTS","DataAccessRequestConfig","LocalizedSchemaFormService","SfOptionsService","moment","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(a){r.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"server.error.file.upload",msgArgs:[a.fileName]})}function A(){w.transform().then(function(a){b.sfOptions=a,b.sfOptions.pristine={errors:!0,success:!1}}),k.get(function(a){b.form.definition=v.translate(l.parseJsonSafely(a.definition,[])),b.form.schema=v.translate(l.parseJsonSafely(a.schema,{})),b.form.downloadTemplate="Template"===a.pdfDownloadType,0===b.form.definition.length&&(b.validForm=!1,b.form.definition=[],r.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(b.form.schema).length&&(b.validForm=!1,b.form.schema={readonly:!0},r.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),b.form.schema.readonly=!0,y(function(){b.form=angular.copy(b.form),b.$broadcast("schemaFormRedraw")},250)},C)}function B(){return(b.dataAccessRequest.statusChangeHistory||[]).filter(function(a){return a.to===i.status.SUBMITTED}).sort(function(a,b){return x(a).isBefore(b)?-1:x(a).isSame(b)?0:x(a).isAfter(b)?1:void 0}).pop()}var C=function(a){r.alert({id:"DataAccessRequestViewController",type:"danger",msg:s.buildMessage(a)})},D=function(){b.form.comments=n.query({id:e.id})},E=function(a){switch(b.selectedTab=a,a){case"form":break;case"comments":D()}},F=function(a){n.save({id:e.id},a.message,D,C)},G=function(a){o.update({id:e.id,commentId:a.id},a.message,D,C)},H=function(c){b.commentToDelete=c.id,a.$broadcast(t.showConfirmDialog,{titleKey:"comment.delete-dialog.title",messageKey:"comment.delete-dialog.message",messageArgs:[c.createdBy]},c.id)},I=function(a){a&&(b.attachments=angular.copy(b.dataAccessRequest.attachments)||[]),b.showAttachmentsForm=a},J=function(){var a=angular.copy(b.dataAccessRequest);a.attachments=b.attachments,m.save(a,function(){I(!1),b.dataAccessRequest=K()})};b.form={schema:null,definition:null,model:{},comments:null},b.$on(t.confirmDialogAccepted,function(a,c){b.commentToDelete===c&&o.delete({id:e.id,commentId:c},{},D,C)}),b.getDownloadHref=function(a){return p.getUrl("DataAccessRequestAttachmentDownloadResource").replace(":id",b.dataAccessRequest.id).replace(":attachmentId",a.id)},b.config=u.getOptions(),b.actions=i.actions,b.nextStatus=i.nextStatus,b.selectTab=E,b.submitComment=F,b.updateComment=G,b.deleteComment=H,b.showAttachmentsForm=!1,b.updateAttachments=J,b.cancelAttachments=function(){I(!1)},b.editAttachments=function(){I(!0)},b.onAttachmentError=z,b.headerTemplateUrl=q.getHeaderUrl("view"),b.footerTemplateUrl=q.getFooterUrl("view"),b.getStatusHistoryInfoId=i.getStatusHistoryInfoId,i.getStatusHistoryInfo(function(a){b.getStatusHistoryInfo=a}),b.validForm=!0;var K=function(){return h.get({id:e.id},function(a){try{b.form.model=a.content?JSON.parse(a.content):{};var c=p.getUrl("DataAccessRequestDownloadPdfResource").replace(":id",b.dataAccessRequest.id);b.requestDownloadUrl=c+(c.indexOf("?q=")!==-1?"&":"?")+"lang="+g.use(),b.attachments=angular.copy(a.attachments)||[]}catch(a){b.validForm=!1,b.form.model={},r.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.parse-error"})}return A(),a.attachments=a.attachments||[],b.lastSubmittedDate=B(),a})};b.dataAccessRequest=e.id?K():{},b.delete=function(){b.requestToDelete=b.dataAccessRequest.id,a.$broadcast(t.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[b.dataAccessRequest.title,b.dataAccessRequest.applicant]},b.requestToDelete)},b.$on(t.confirmDialogAccepted,function(a,d){b.requestToDelete===d&&(h.delete({id:b.requestToDelete},function(){c.path("/data-access-requests").replace()}),delete b.requestToDelete)});var L=function(){b.dataAccessRequest=K()},M=function(b,c,d){a.$broadcast(t.showConfirmDialog,{titleKey:"data-access-request.status-change-confirmation.title",messageKey:null!==c?c:"data-access-request.status-change-confirmation.message",messageArgs:null!==d?[f("translate")(d).toLowerCase()]:[]},b)},N=function(a,c){a===c&&j.update({id:b.dataAccessRequest.id,status:a},L,C)},O=function(){setTimeout(function(){window.print()},250)};b.submit=function(){b.$broadcast("schemaFormValidate"),b.forms.requestForm.$valid?j.update({id:b.dataAccessRequest.id,status:i.status.SUBMITTED},function(){L(),d.open({scope:b,templateUrl:"access/views/data-access-request-submitted-modal.html"})},C):r.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})},b.reopen=function(){M(i.status.OPENED,null,"reopen")},b.review=function(){M(i.status.REVIEWED,"data-access-request.status-change-confirmation.message-review",null)},b.approve=function(){M(i.status.APPROVED,null,"approve")},b.reject=function(){M(i.status.REJECTED,null,"reject")},b.conditionallyApprove=function(){M(i.status.CONDITIONALLY_APPROVED,null,"conditionallyApprove")},b.userProfile=function(a){b.applicant=a,d.open({scope:b,templateUrl:"access/views/data-access-request-profile-user-modal.html"})},b.getDataAccessListPageUrl=i.getListDataAccessRequestPageUrl();var P=function(a,b){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null};b.printForm=O,b.getFullName=function(a){return a?a.attributes?P(a.attributes,"firstName")+" "+P(a.attributes,"lastName"):a.username:null},b.getProfileEmail=function(a){return a&&a.attributes?P(a.attributes,"email"):null},b.$on(t.confirmDialogAccepted,function(a,b){N(i.status.OPENED,b)}),b.$on(t.confirmDialogAccepted,function(a,b){N(i.status.REVIEWED,b)}),b.$on(t.confirmDialogAccepted,function(a,b){N(i.status.CONDITIONALLY_APPROVED,b)}),b.$on(t.confirmDialogAccepted,function(a,b){N(i.status.APPROVED,b)}),b.$on(t.confirmDialogAccepted,function(a,b){N(i.status.REJECTED,b)}),a.$on("$translateChangeSuccess",function(){A()}),b.forms={}}]).controller("DataAccessRequestEditController",["$rootScope","$log","$scope","$routeParams","$location","$uibModal","LocalizedSchemaFormService","DataAccessRequestsResource","DataAccessRequestResource","DataAccessFormConfigResource","JsonUtils","AlertService","ServerErrorUtils","SessionProxy","DataAccessRequestService","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig","SfOptionsService","FormDirtyStateObserver","DataAccessRequestDirtyStateService","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a){l.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"server.error.file.upload",msgArgs:[a.fileName]})}function w(){r.transform().then(function(a){c.sfOptions=a,c.sfOptions.onError=v}),j.get(function(a){c.sfForm.definition=g.translate(k.parseJsonSafely(a.definition,[])),c.sfForm.schema=g.translate(k.parseJsonSafely(a.schema,{})),0===c.sfForm.definition.length&&(c.sfForm.definition=[],c.validForm=!1,l.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(c.sfForm.schema).length&&(c.sfForm.schema={},c.validForm=!1,l.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),c.validForm&&(c.dataAccessRequest=d.id?i.get({id:d.id},function(a){try{c.sfForm.model=a.content?JSON.parse(a.content):{}}catch(a){c.sfForm.model={},l.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-request.parse-error"})}return c.canEdit=o.actions.canEdit(a),c.sfForm.schema.readonly=!c.canEdit,c.$broadcast("schemaFormRedraw"),a.attachments=a.attachments||[],a}):{applicant:n.login(),status:o.status.OPENED,attachments:[]}),u(function(){c.sfForm=angular.copy(c.sfForm),c.loaded=!0},250)},y)}var x=function(a,b){s.unobserve();var c=b().location.split("/");e.path("/data-access-request/"+c[c.length-1]).replace()},y=function(a){l.alert({id:"DataAccessRequestEditController",type:"danger",msg:m.buildMessage(a)})};c.getDataAccessListPageUrl=o.getListDataAccessRequestPageUrl();var z=function(a){c.$broadcast("schemaFormValidate"),f.open({resolve:{isValid:a.$valid},templateUrl:"access/views/data-access-request-validation-modal.html",controller:["$scope","isValid",function(a,b){a.isValid=b}]})},A=function(){e.path("/data-access-request"+(d.id?"/"+d.id:"s")).replace()},B=function(){c.dataAccessRequest.content=angular.toJson(c.sfForm.model),c.newRequest?h.save(c.dataAccessRequest,x,y):i.save(c.dataAccessRequest,function(){s.unobserve(),e.path("/data-access-request"+(c.dataAccessRequest.id?"/"+c.dataAccessRequest.id:"s")).replace()},y)};a.$on("$translateChangeSuccess",function(){w()}),w(),c.loaded=!1,c.config=q.getOptions(),c.validForm=!0,c.requestId=d.id,c.newRequest=!d.id,c.cancel=A,c.save=B,c.editable=!0,c.validate=z,c.headerTemplateUrl=p.getHeaderUrl("form"),c.footerTemplateUrl=p.getFooterUrl("form"),c.sfForm={schema:null,definition:null,model:{}},s.observe(c),t.setForm(c.form),c.$on("$destroy",function(){t.setForm(null)})}]),angular.module("obiba.mica.access").config(["$routeProvider",function(a){a.when("/data-access-requests",{templateUrl:"access/views/data-access-request-list.html",controller:"DataAccessRequestListController"}).when("/data-access-request/new",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id/edit",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id",{templateUrl:"access/views/data-access-request-view.html",controller:"DataAccessRequestViewController"})}]),angular.module("obiba.mica.access").factory("DataAccessFormConfigResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessFormConfigResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("DataAccessRequestsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestsResource"),{},{save:{method:"POST",errorHandler:!0},get:{method:"GET"}})}]).factory("DataAccessRequestsExportCsvResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestsExportCsvResource"),{},{get:{method:"GET"}})}]).factory("DataAccessRequestResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0},get:{method:"GET"},delete:{method:"DELETE"}})}]).factory("DataAccessRequestAttachmentsUpdateResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestAttachmentsUpdateResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0}})}]).factory("DataAccessRequestCommentsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentsResource"),{},{save:{method:"POST",params:{id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0},get:{method:"GET",params:{id:"@id"},errorHandler:!0}})}]).factory("DataAccessRequestCommentResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentResource"),{},{delete:{method:"DELETE",params:{id:"@id",commentId:"@commentId"},errorHandler:!0},update:{method:"PUT",params:{id:"@id",commentId:"@commentId"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("DataAccessRequestStatusResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestStatusResource"),{},{update:{method:"PUT",params:{id:"@id",status:"@status"},errorHandler:!0}})}]).service("DataAccessRequestConfig",function(){var a={newRequestButtonCaption:null,documentsSectionTitle:null,documentsSectionHelpText:null,downloadButtonCaption:null,commentsEnabled:!0,userListPageTitle:null,newRequestButtonHelpText:null};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}).service("DataAccessRequestDirtyStateService",[function(){var a=null;this.setForm=function(b){a=b},this.isDirty=function(){return a&&a.$dirty}}]).service("DataAccessRequestService",["$translate","SessionProxy","USER_ROLES","ngObibaMicaUrl",function(a,b,c,d){var e={OPENED:"OPENED",SUBMITTED:"SUBMITTED",REVIEWED:"REVIEWED",CONDITIONALLY_APPROVED:"CONDITIONALLY_APPROVED",APPROVED:"APPROVED",REJECTED:"REJECTED"};this.status=e,this.getStatusFilterData=function(b){b&&a(Object.keys(e)).then(function(a){b(Object.keys(a).map(function(b){return{key:b,translation:a[b]}}))})};var f=function(a,b){return a.actions?a.actions.indexOf(b)!==-1:null};this.actions={canViewProfile:function(a){var d=!1,e=b.roles();return angular.forEach(e,function(b){b!==a&&b!==c.admin||(d=!0)}),d},canView:function(a){return f(a,"VIEW")},canEdit:function(a){return f(a,"EDIT")},canEditStatus:function(a){return f(a,"EDIT_STATUS")},canDelete:function(a){return f(a,"DELETE")},canEditAttachments:function(a){return f(a,"EDIT_ATTACHMENTS")}};var g=function(a,b){return a.nextStatus?a.nextStatus.indexOf(b)!==-1:null};return this.nextStatus={canSubmit:function(a){return g(a,"SUBMITTED")},canReopen:function(a){return g(a,"OPENED")},canReview:function(a){return g(a,"REVIEWED")},canConditionallyApprove:function(a){return g(a,"CONDITIONALLY_APPROVED")},canApprove:function(a){return g(a,"APPROVED")},canReject:function(a){return g(a,"REJECTED")}},this.getStatusHistoryInfo=function(b){if(b){var c={"data-access-request.histories.opened":"opened","data-access-request.histories.reopened":"reopened","data-access-request.histories.submitted":"submitted","data-access-request.histories.reviewed":"reviewed","data-access-request.histories.conditionallyApproved":"conditionallyApproved","data-access-request.histories.approved":"approved","data-access-request.histories.rejected":"rejected"},d={opened:{id:"opened",icon:"glyphicon glyphicon-saved"},reopened:{id:"reopened",icon:"glyphicon glyphicon-repeat"},submitted:{id:"submitted",icon:"glyphicon glyphicon-export"},reviewed:{id:"reviewed",icon:"glyphicon glyphicon-check"},conditionallyApproved:{id:"conditionallyApproved",icon:"glyphicon glyphicon-unchecked"},approved:{id:"approved",icon:"glyphicon glyphicon-ok"},rejected:{id:"rejected",icon:"glyphicon glyphicon-remove"}};a(Object.keys(c)).then(function(a){Object.keys(a).forEach(function(b){d[c[b]].msg=a[b]}),b(d)})}},this.getStatusHistoryInfoId=function(a){var b="opened";if("OPENED"!==a.from||a.from!==a.to)switch(a.to){case"OPENED":b="reopened";break;case"SUBMITTED":b="submitted";break;case"REVIEWED":b="reviewed";break;case"CONDITIONALLY_APPROVED":b="conditionallyApproved";break;case"APPROVED":b="approved";break;case"REJECTED":b="rejected"}return b},this.getListDataAccessRequestPageUrl=function(){return d.getUrl("DataAccessClientListPath")?d.getUrl("BaseUrl")+d.getUrl("DataAccessClientListPath"):null},this}]).filter("filterProfileAttributes",function(){return function(a){var b=["email","firstName","lastName","createdDate","lastLogin","username"];return a.filter(function(a){return b.indexOf(a.key)===-1})}}).filter("capitalizeFirstLetter",["StringUtils",function(a){return function(b){return a.capitaliseFirstLetter(b)}}]),angular.module("obiba.mica.access").directive("printFriendlyView",[function(){return{restrict:"EA",replace:!0,scope:!1,templateUrl:"access/views/data-access-request-print-preview.html"}}]);var DISPLAY_TYPES={LIST:"list",COVERAGE:"coverage",GRAPHICS:"graphics"};angular.module("obiba.mica.search",["obiba.alert","ui.bootstrap","pascalprecht.translate","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaSearchTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({search:{header:null,footer:null},searchStudiesResultTable:{template:null},searchNetworksResultTable:{template:null},searchResultList:{template:null},searchResultCoverage:{template:null},searchResultGraphics:{template:null},classifications:{header:null,footer:null}}))}]).config(["$provide","$injector",function(a){a.provider("ngObibaMicaSearch",function(){var a=["LocalizedValues",function(a){return a.getLocal()}],b={targetTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],searchTabsOrder:[DISPLAY_TYPES.LIST,DISPLAY_TYPES.COVERAGE,DISPLAY_TYPES.GRAPHICS],resultTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],showAllFacetedTaxonomies:!0,showSearchBox:!0,showSearchBrowser:!0,showSearchRefreshButton:!1,variableTaxonomiesOrder:[],studyTaxonomiesOrder:[],datasetTaxonomiesOrder:[],networkTaxonomiesOrder:[],hideNavigate:[],hideSearch:["studyId","dceId","datasetId","networkId"],variables:{showSearchTab:!0,variablesColumn:{showVariablesTypeColumn:!0,showVariablesStudiesColumn:!0,showVariablesDatasetsColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0}},datasets:{showSearchTab:!0,showDatasetsSearchFilter:!0,datasetsColumn:{showDatasetsAcronymColumn:!0,showDatasetsTypeColumn:!0,showDatasetsNetworkColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0}},studies:{showSearchTab:!0,showStudiesSearchFilter:!0,studiesColumn:{showStudiesDesignColumn:!0,showStudiesQuestionnaireColumn:!0,showStudiesPmColumn:!0,showStudiesBioColumn:!0,showStudiesOtherColumn:!0,showStudiesParticipantsColumn:!0,showStudiesNetworksColumn:!0,showStudiesStudyDatasetsColumn:!0,showStudiesHarmonizationDatasetsColumn:!0,showStudiesVariablesColumn:!1,showStudiesStudyVariablesColumn:!0,showStudiesDataschemaVariablesColumn:!0},fields:["acronym.*","name.*","model.methods.design","populations.dataCollectionEvents.model.dataSources","model.numberOfParticipants.participant"]},networks:{showSearchTab:!0,networksColumn:{showNetworksStudiesColumn:!0,showNetworksStudyDatasetColumn:!0,showNetworksHarmonizationDatasetColumn:!0,showNetworksVariablesColumn:!1,showNetworksStudyVariablesColumn:!0,showNetworksDataschemaVariablesColumn:!0},fields:["acronym.*","name.*","studyIds"]},coverage:{groupBy:{study:!0,dce:!0,dataset:!0}}};this.setLocaleResolver=function(b){a=b},this.setOptions=function(a){b=angular.merge(b,a),b.targetTabsOrder=a.targetTabsOrder||b.targetTabsOrder,b.searchTabsOrder=a.searchTabsOrder||b.searchTabsOrder,b.resultTabsOrder=a.resultTabsOrder||b.resultTabsOrder,b.variableTaxonomiesOrder=a.variableTaxonomiesOrder||b.variableTaxonomiesOrder,b.studyTaxonomiesOrder=a.studyTaxonomiesOrder||b.studyTaxonomiesOrder,b.datasetTaxonomiesOrder=a.datasetTaxonomiesOrder||b.datasetTaxonomiesOrder,b.networkTaxonomiesOrder=a.networkTaxonomiesOrder||b.networkTaxonomiesOrder,b.hideNavigate=a.hideNavigate||b.hideNavigate,b.hideSearch=a.hideSearch||b.hideSearch},this.$get=["$q","$injector",function(c,d){function e(){if(b.coverage.groupBy.dce=b.coverage.groupBy.study&&b.coverage.groupBy.dce,!(Object.keys(b.coverage.groupBy).filter(function(a){return b.coverage.groupBy[a]}).length>0)){var a=b.searchTabsOrder.indexOf(DISPLAY_TYPES.COVERAGE);a>-1&&b.searchTabsOrder.splice(a,1)}}return e(),{getLocale:function(b,e){return c.when(d.invoke(a),b,e)},getOptions:function(){return b},toggleHideSearchNavigate:function(a){var c=b.hideNavigate.indexOf(a.name);c>-1?b.hideNavigate.splice(c,1):b.hideNavigate.push(a.name)}}}]})}]).run(["GraphicChartsConfigurations",function(a){a.setClientConfig()}]),angular.module("obiba.mica.search").filter("regex",function(){return function(a,b,c,d){var e=[];try{var f=new RegExp(b,"i");e=a.filter(function(a){return c.some(function(b){var c=a[b];return angular.isArray(c)&&d?c.filter(function(a){return a.locale===d}).some(function(a){return f.test(a.text)}):f.test(c)})})}catch(a){}return e}}).filter("orderBySelection",function(){return function(a,b){if(!a)return[];var c=[],d=[];return a.forEach(function(a){b[a.key]?c.push(a):d.push(a)}),c.concat(d)}}).filter("visibleVocabularies",["TaxonomyUtils",function(a){return function(b){return a.visibleVocabularies(b)}}]).filter("dceDescription",function(){return function(a){return a.split(":<p>").map(function(a){return"<p>"+a})[2]}});var QUERY_TYPES={NETWORKS:"networks",STUDIES:"studies",DATASETS:"datasets",VARIABLES:"variables"},QUERY_TARGETS={NETWORK:"network",STUDY:"study",DATASET:"dataset",VARIABLE:"variable"},BUCKET_TYPES={NETWORK:"network",STUDY:"study",STUDY_INDIVIDUAL:"study-individual",STUDY_HARMONIZATION:"study-harmonization",DCE:"dce",DCE_INDIVIDUAL:"dce-individual",DCE_HARMONIZATION:"dce-harmonization",DATASET:"dataset",DATASET_COLLECTED:"dataset-collected",DATASET_HARMONIZED:"dataset-harmonized",DATASCHEMA:"dataschema"},RQL_NODE={VARIABLE:"variable",DATASET:"dataset",STUDY:"study",NETWORK:"network",LIMIT:"limit",SORT:"sort",AND:"and",NAND:"nand",OR:"or",NOR:"nor",NOT:"not",FACET:"facet",LOCALE:"locale",AGGREGATE:"aggregate",BUCKET:"bucket",FIELDS:"fields",CONTAINS:"contains",IN:"in",OUT:"out",EQ:"eq",GT:"gt",GE:"ge",LT:"lt",LE:"le",BETWEEN:"between",MATCH:"match",EXISTS:"exists",MISSING:"missing"},SORT_FIELDS={ACRONYM:"acronym",NAME:"name",CONTAINER_ID:"containerId",POPULATION_WEIGHT:"populationWeight",DATA_COLLECTION_EVENT_WEIGHT:"dataCollectionEventWeight",POPULATION_ID:"populationId",DATASET_ID:"datasetId",VARIABLE_TYPE:"variableType",INDEX:"index",STUDY_TABLE:{POPULATION_WEIGHT:"studyTable.populationWeight",DATA_COLLECTION_EVENT_WEIGHT:"studyTable.dataCollectionEventWeight",STUDY_ID:"studyTable.studyId",POPULATION_ID:"studyTable.populationId"}},VOCABULARY_TYPES={STRING:"string",INTEGER:"integer",DECIMAL:"decimal"},CriteriaIdGenerator={generate:function(a,b,c){return a&&b?a.name+"."+b.name+(c?"."+c.name:""):void 0}};CriteriaItem.prototype.isRepeatable=function(){return!1},CriteriaItem.prototype.getTarget=function(){return this.target||null},RepeatableCriteriaItem.prototype=Object.create(CriteriaItem.prototype),RepeatableCriteriaItem.prototype.isRepeatable=function(){return!0},RepeatableCriteriaItem.prototype.addItem=function(a){return this.list.push(a),this},RepeatableCriteriaItem.prototype.items=function(){return this.list},RepeatableCriteriaItem.prototype.first=function(){return this.list[0]},RepeatableCriteriaItem.prototype.getTarget=function(){return this.list.length>0?this.list[0].getTarget():null},CriteriaBuilder.prototype.fieldToVocabulary=function(a){var b={taxonomy:null,vocabulary:null},c=a;a.indexOf(".")<0&&(c="Mica_"+this.target+"."+a);var d=c.split(".",2),e=d[0],f=d[1],g=this.taxonomies.filter(function(a){return e===a.name});if(0===g.length)throw new Error("Could not find taxonomy:",e);b.taxonomy=g[0];var h=b.taxonomy.vocabularies.filter(function(a){return f===a.name});if(0===h.length)throw new Error("Could not find vocabulary:",f);return b.vocabulary=h[0],b},CriteriaBuilder.prototype.visitLeaf=function(a,b){var c=RQL_NODE.MATCH===a.name,d=a.args[c?1:0],e=a.args[c?0:1],f=this.fieldToVocabulary(d),g=this.buildLeafItem(f.taxonomy,f.vocabulary,e instanceof Array?e:[e],a,b),h=this.leafItemMap[g.id];h?h.isRepeatable()?h.addItem(g):(console.error("Non-repeatable criteria items must be unique,",h.id,"will be overwritten."),h=g):h=g.vocabulary.repeatable?(new RepeatableCriteriaItem).addItem(g):g,this.leafItemMap[g.id]=h,b.children.push(g)},CriteriaBuilder.prototype.getRootItem=function(){return this.rootItem},CriteriaBuilder.prototype.getLeafItemMap=function(){return this.leafItemMap},CriteriaBuilder.prototype.visitCondition=function(a,b){var c=this.newCriteriaItemBuilder().parent(b).rqlQuery(a).type(a.name).build();b.children.push(c),this.visit(a.args[0],c),this.visit(a.args[1],c)},CriteriaBuilder.prototype.visitNot=function(a,b){var c=this.newCriteriaItemBuilder().parent(b).rqlQuery(a).type(a.name).build();b.children.push(c),this.visit(a.args[0],c)},CriteriaBuilder.prototype.visit=function(a,b){switch(a.name){case RQL_NODE.NOT:this.visitNot(a,b);break;case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:this.visitCondition(a,b);break;case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.LE:case RQL_NODE.LT:case RQL_NODE.GE:case RQL_NODE.GT:case RQL_NODE.BETWEEN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:case RQL_NODE.MATCH:this.visitLeaf(a,b)}},CriteriaBuilder.prototype.build=function(){var a=this;this.rootRql.args.forEach(function(b){a.visit(b,a.rootItem)})},angular.module("obiba.mica.search").service("RqlQueryUtils",["LocalizedValues",function(a){function b(a){var b=a.args.filter(function(a){switch(a.name){case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:case RQL_NODE.NOT:case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.MATCH:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0}return!1}).pop();return b?a.args.findIndex(function(a){return a.name===b.name}):-1}function c(a,b,c){var d=c;return a.attributes&&a.attributes.some(function(a){return a.key===b&&(d=a.value,!0)}),d}var d=this;this.vocabularyTermNames=function(a){return a&&a.terms?a.terms.map(function(a){return a.name}):[]},this.hasTargetQuery=function(a,b){return a.args.filter(function(a){switch(a.name){case RQL_NODE.VARIABLE:case RQL_NODE.DATASET:case RQL_NODE.STUDY:case RQL_NODE.NETWORK:return!b||b===a.name;default:return!1}}).length>0},this.variableQuery=function(){return new RqlQuery(QUERY_TARGETS.VARIABLE)},this.eqQuery=function(a,b){var c=new RqlQuery(RQL_NODE.EQ);return c.args.push(b),c},this.orQuery=function(a,b){var c=new RqlQuery(RQL_NODE.OR);return c.args=[a,b],c},this.aggregate=function(a){var b=new RqlQuery(RQL_NODE.AGGREGATE);return a.forEach(function(a){b.args.push(a)}),b},this.fields=function(a){var b=new RqlQuery(RQL_NODE.FIELDS);return b.args.push(a),b},this.limit=function(a,b){var c=new RqlQuery(RQL_NODE.LIMIT);return c.args.push(a),c.args.push(b),c},this.fieldQuery=function(a,b,c){var d=new RqlQuery(a);return d.args.push(b),c&&c.length>0&&d.args.push(c),d},this.inQuery=function(a,b){var c=b&&b.length>0,d=c?RQL_NODE.IN:RQL_NODE.EXISTS;return this.fieldQuery(d,a,b)},this.matchQuery=function(a,b){var c=new RqlQuery(RQL_NODE.MATCH);return c.args.push(b||"*"),c.args.push(a),c},this.updateMatchQuery=function(a,b){return a.args[0]=b||"*",a},this.rangeQuery=function(a,b,c){var e=new RqlQuery(RQL_NODE.BETWEEN);return e.args.push(a),d.updateRangeQuery(e,b,c),e},this.updateQueryInternal=function(a,b){return b&&b.length>0?a.args[1]=b:a.args.splice(1,1),a},this.mergeInQueryArgValues=function(a,b,c){if(b&&b.length>0){var d=a.args[1];if(!d||c)a.args[1]=b;else{d instanceof Array||(d=[d]);var e=b.filter(function(a){return d.indexOf(a)===-1});a.args[1]=d.concat(e)}}else a.args.splice(1,1);return a},this.updateRangeQuery=function(a,b,c,d){d?(a.name=RQL_NODE.MISSING,a.args.splice(1,1)):angular.isDefined(b)&&null!==b&&angular.isDefined(c)&&null!==c?(a.name=RQL_NODE.BETWEEN,a.args[1]=[b,c]):angular.isDefined(b)&&null!==b?(a.name=RQL_NODE.GE,a.args[1]=b):angular.isDefined(c)&&null!==c?(a.name=RQL_NODE.LE,a.args[1]=c):(a.name=RQL_NODE.EXISTS,a.args.splice(1,1))},this.buildRqlQuery=function(a){return this.isNumericVocabulary(a.vocabulary)?this.rangeQuery(this.criteriaId(a.taxonomy,a.vocabulary),null,null):this.isMatchVocabulary(a.vocabulary)?this.matchQuery(this.criteriaId(a.taxonomy,a.vocabulary),null):this.inQuery(this.criteriaId(a.taxonomy,a.vocabulary),a.term?a.term.name:void 0)},this.addQuery=function(a,c,d){if(0===a.args.length)a.args.push(c);else{var e=b(a);if(e===-1)a.args.push(c);else{var f=a.args.splice(e,1).pop();if(!d&&c.args&&c.args.length>0){var g="Mica_"+a.name;d=("match"===c.name?c.args[1]:c.args[0]).startsWith(g+".")?RQL_NODE.AND:RQL_NODE.OR}var h=new RqlQuery(d||RQL_NODE.AND);h.args.push(f,c),a.args.push(h)}}return a},this.updateRepeatableQueryArgValues=function(a,b){var c=this;a.items().forEach(function(a){var d=a.rqlQuery;switch(d.name){case RQL_NODE.EXISTS:d.name=RQL_NODE.CONTAINS,c.mergeInQueryArgValues(d,b,!1);break;case RQL_NODE.CONTAINS:c.mergeInQueryArgValues(d,b,!1);break;case RQL_NODE.IN:var e=d.args[1]?[].concat(d.args[1]):[];if(1===e.length){d.name=RQL_NODE.CONTAINS,c.mergeInQueryArgValues(d,b,!1);break}var f,g=d.args[0],h=e.filter(function(a){return b.indexOf(a)<0}).map(function(a){return c.fieldQuery(RQL_NODE.CONTAINS,g,[].concat(a,b))});if(h.length>1){var i=h.splice(0,2);f=c.orQuery(i[0],i[1]),h.forEach(function(a){f=c.orQuery(a,f)}),d.name=f.name,d.args=f.args}else d.name=RQL_NODE.CONTAINS,d.args=h[0].args}})},this.updateQueryArgValues=function(a,b,c){switch(a.name){case RQL_NODE.EXISTS:case RQL_NODE.MISSING:a.name=RQL_NODE.IN,this.mergeInQueryArgValues(a,b,c);break;case RQL_NODE.CONTAINS:case RQL_NODE.IN:this.mergeInQueryArgValues(a,b,c);break;case RQL_NODE.BETWEEN:case RQL_NODE.GE:case RQL_NODE.LE:a.args[1]=b;break;case RQL_NODE.MATCH:a.args[0]=b}},this.updateQuery=function(a,b){switch(a.name){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:this.updateQueryInternal(a,b)}},this.addLocaleQuery=function(a,b){if(!a.args.filter(function(a){return a.name===RQL_NODE.LOCALE}).pop()){var c=new RqlQuery("locale");c.args.push(b),a.args.push(c)}},this.addFields=function(a,b){if(a&&a.args){var c=a.args.filter(function(a){return a.name===RQL_NODE.FIELDS}).pop();c?c.args=b.args:a.args.push(b)}},this.addLimit=function(a,b){if(a&&a.args){var c=a.args.filter(function(a){return a.name===RQL_NODE.LIMIT}).pop();c?c.args=b.args:a.args.push(b)}},this.addSort=function(a,b){var c=a.args.filter(function(a){return a.name===RQL_NODE.SORT}).pop();c||(c=new RqlQuery("sort"),a.args.push(c)),c.args=Array.isArray(b)?b:[b]},this.criteriaId=function(a,b){return a.name+"."+b.name},this.vocabularyType=function(a){return c(a,"type",VOCABULARY_TYPES.STRING)},this.vocabularyField=function(a){return c(a,"field",a.name)},this.vocabularyAlias=function(a){return c(a,"alias",a.name)},this.vocabularyTermsSortKey=function(a){return c(a,"termsSortKey",null)},this.isTermsVocabulary=function(a){return d.vocabularyType(a)===VOCABULARY_TYPES.STRING&&a.terms},this.isMatchVocabulary=function(a){return d.vocabularyType(a)===VOCABULARY_TYPES.STRING&&!a.terms},this.isNumericVocabulary=function(a){return!a.terms&&(d.vocabularyType(a)===VOCABULARY_TYPES.INTEGER||d.vocabularyType(a)===VOCABULARY_TYPES.DECIMAL)},this.isRangeVocabulary=function(a){return a.terms&&(d.vocabularyType(a)===VOCABULARY_TYPES.INTEGER||d.vocabularyType(a)===VOCABULARY_TYPES.DECIMAL)},this.sortVocabularyTerms=function(b,c){var e=d.vocabularyTermsSortKey(b);if(e&&b.terms&&b.terms.length>0)switch(e){case"name":b.terms.sort(function(a,b){return a[e].localeCompare(b[e])});break;case"title":b.terms.sort(function(b,d){var f=a.forLocale(b[e],c),g=a.forLocale(d[e],c);return f.localeCompare(g)})}}}]).service("RqlQueryService",["$q","$log","TaxonomiesResource","TaxonomyResource","LocalizedValues","RqlQueryUtils","ngObibaMicaSearch",function(a,b,c,d,e,f,g){function h(a,b){return b.children.filter(function(b){return b.target===a}).pop()}function i(a,b,c){var d=h(a,c),e={};return s.findItemNodeById(d,b,e)?e.item:null}function j(a,b){var c=h(a.target,b),d={};return s.findItemNode(c,a,d)?d.item:null}function k(a,b){return b.args.filter(function(b){return b.name===a}).pop()}function l(a,b){switch(a){case DISPLAY_TYPES.LIST:switch(b){case QUERY_TARGETS.STUDY:return f.fields(t.studies.fields);case QUERY_TARGETS.VARIABLE:return f.fields(["attributes.label.*","variableType","datasetId","datasetAcronym"]);case QUERY_TARGETS.DATASET:return f.fields(["acronym.*","name.*","variableType","studyTable.studyId","studyTable.project","studyTable.table","studyTable.populationId","studyTable.dataCollectionEventId","harmonizationTable.studyId","harmonizationTable.project","harmonizationTable.table","harmonizationTable.populationId"]);case QUERY_TARGETS.NETWORK:return f.fields(t.networks.fields)}}return null}function m(a){switch(a.type){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.MATCH:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0}return!1}function n(a){var b=a.parent,c=a.rqlQuery,d=c.args,e=a.parent.rqlQuery,f=e.args.indexOf(c),g=b.children.indexOf(a);if(f===-1||g===-1)throw new Error("Criteria node not found: "+a);b.children.splice(g,1),a.children.forEach(function(a){a.parent=b}),b.children.splice.apply(b.children,[g,0].concat(a.children)),e.args.splice(f,1),d&&(d instanceof Array?e.args.splice.apply(e.args,[f,0].concat(d)):e.args.splice(f,0,d)),null!==b.parent&&0===e.args.length&&n(b)}function o(a){var b=a.parent,c=a.rqlQuery,d=c.args,e=a.parent.rqlQuery,f=e.args.indexOf(c),g=b.children.indexOf(a);if(f===-1||g===-1)throw new Error("Criteria node not found: "+a);b.children.splice(g,1),a.children.forEach(function(a){a.parent=b}),b.children.splice.apply(b.children,[g,0].concat(a.children)),e.args.splice(f,1),d&&(d instanceof Array?e.args.splice.apply(e.args,[f,0].concat(d)):e.args.splice(f,0,d)),0===e.args.length&&n(b)}function p(a){var b=a.parent;if(!b)throw new Error("Cannot remove criteria when parent is NULL");var c=a.rqlQuery,d=a.parent.rqlQuery,e=d.args.indexOf(c);if(e===-1)throw new Error("Criteria node not found: "+a);d.args.splice(e,1),[RQL_NODE.OR,RQL_NODE.AND,RQL_NODE.NAND,RQL_NODE.NOR].indexOf(b.type)!==-1?o(b):0===d.args.length&&n(b)}function q(a,b,c,d,e,g,h){var i=angular.copy(c),j=typeToTarget(b);f.addLocaleQuery(i,e);var m=k(j,i);m||(m=new RqlQuery(j),i.args.push(m));var n=d[j]||{from:0,size:10};if(f.addLimit(m,f.limit(n.from,n.size)),h){var o=l(a,j);o&&f.addFields(m,o)}return g&&f.addSort(m,g),i}var r={variable:null,dataset:null,study:null,network:null},s=this,t=g.getOptions();this.findItemNodeById=function(a,b,c){return!!(a&&a.children&&c)&&a.children.some(function(a){return b.indexOf(a.id)>-1?(c.item=a,!0):s.findItemNodeById(a,b,c)})},this.findItemNode=function(a,b,c){return s.findItemNodeById(a,b.id,c)},this.findCriteriaItemFromTreeById=i,this.findCriteriaItemFromTree=j,this.findTargetCriteria=h,this.findTargetQuery=k,this.parseQuery=function(a){try{return(new RqlParser).parse(a)}catch(a){b.error(a.message)}return new RqlQuery},this.removeCriteriaItem=function(a){m(a)?p(a):n(a)},this.createCriteriaItem=function(a,b,c,g,h){function i(b,c,d){return new CriteriaItemBuilder(e,h).target(a).taxonomy(b).vocabulary(c).term(d)}return angular.isString(b)?d.get({target:a,taxonomy:b}).$promise.then(function(a){return c=a.vocabularies.filter(function(a){return a.name===c||f.vocabularyAlias(a)===c})[0],g=c&&c.terms?c.terms.filter(function(a){return a.name===g})[0]:null,i(a,c,g).build()}):i(b,c,g).build()},this.addCriteriaItem=function(a,b,c){var d=a.args.filter(function(a){return b.target===a.name}).pop();d||(d=new RqlQuery(RQL_NODE[b.target.toUpperCase()]),a.args.push(d));var e=b.rqlQuery?b.rqlQuery:f.buildRqlQuery(b);return f.addQuery(d,e,c)},this.updateCriteriaItem=function(a,b,c){var d,e=a.isRepeatable(),g=!e&&a.rqlQuery.name===RQL_NODE.MATCH;c&&b.rqlQuery&&(a.rqlQuery.name=b.rqlQuery.name),b.rqlQuery?d=b.rqlQuery.args[g?0:1]:b.term?d=[b.term.name]:(a=e?a.first():a,a.rqlQuery.name=RQL_NODE.EXISTS,a.rqlQuery.args.splice(1,1)),d&&(e?f.updateRepeatableQueryArgValues(a,d):f.updateQueryArgValues(a.rqlQuery,d,c))},this.getTaxonomyByTarget=function(b){var d=a.defer(),e=r[b];return e?d.resolve(e):c.get({target:b}).$promise.then(function(a){r[b]=a,d.resolve(a)}),d.promise},this.builders=function(b,c,d,f){function g(a,c){var d=new CriteriaBuilder(a,c,r[b],e,f);d.initialize(b),d.build(),h.resolve({root:d.getRootItem(),map:d.getLeafItemMap()})}var h=a.defer();return s.getTaxonomyByTarget(b).then(function(){g(c,d)}),h.promise},this.createCriteria=function(b,c){var d=a.defer(),e=(new CriteriaItemBuilder).type(RQL_NODE.AND).rqlQuery(b).build(),g={};if(!f.hasTargetQuery(b))return d.resolve({root:e,map:g}),d.promise;var h=[],i=this,j=0;return b.args.forEach(function(a){QUERY_TARGETS[a.name.toUpperCase()]&&h.push(a)}),h.forEach(function(a){i.builders(a.name,a,e,c).then(function(a){e.children.push(a.root),g=angular.extend(g,a.map),++j===h.length&&d.resolve({root:e,map:g})})}),d.promise},this.prepareCriteriaTermsQuery=function(a,b,c){function d(a,b,c){if(!a||!a.args)return null;if((a.name===RQL_NODE.IN||a.name===RQL_NODE.MISSING||a.name===RQL_NODE.CONTAINS)&&a.args[0]===b)return a;for(var e=a.args.length;e--;){d(a.args[e],b,c)&&(a.args[e]=c)}}var e=this.parseQuery(a),g=e.args.filter(function(a){return a.name===b.target}).pop();if(g){var h=new RqlQuery(RQL_NODE.EXISTS),i=f.criteriaId(b.taxonomy,b.vocabulary);h.args.push(i),d(g,i,h),g.args.push(f.aggregate([i])),g.args.push(f.limit(0,0))}return e.args.push(new RqlQuery(RQL_NODE.FACET)),c&&f.addLocaleQuery(e,c),e.serializeArgs(e.args)},this.getTargetQuerySort=function(a,b){var c=typeToTarget(a),d=k(c,b),e=null;return d&&(e=d.args.filter(function(a){return a.name===RQL_NODE.SORT}).pop()),e},this.prepareSearchQuery=function(a,b,c,d,e,f){return q(a,b,c,d,e,f,!0)},this.prepareSearchQueryNoFields=function(a,b,c,d,e,f){return q(a,b,c,d,e,f,!1)},this.prepareSearchQueryAndSerialize=function(a,b,c,d,e,f){return(new RqlQuery).serializeArgs(s.prepareSearchQuery(a,b,c,d,e,f).args)},this.prepareCoverageQuery=function(a,b){var c,d=this.parseQuery(a),e=new RqlQuery("aggregate"),f=b.split("-"),g=f[0],h=f.length>1?f[1]:void 0;switch(g){case BUCKET_TYPES.NETWORK:c="networkId";break;case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.STUDY_HARMONIZATION:c="studyId";break;case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:c="dceId";break;case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:case BUCKET_TYPES.DATASET_HARMONIZED:c="datasetId"}var i=new RqlQuery("bucket");i.args.push(c),e.args.push(i);var j;if(d.args.forEach(function(a){j||"variable"!==a.name||(j=a)}),j||(j=new RqlQuery("variable"),d.args.push(j)),j.args.length>0&&"limit"!==j.args[0].name){var k=new RqlQuery("in");k.args.push("Mica_variable.variableType"),void 0===h?b===BUCKET_TYPES.DATASET_HARMONIZED||b===BUCKET_TYPES.DATASCHEMA?k.args.push("Dataschema"):k.args.push(["Collected","Dataschema"]):["individual","collected"].indexOf(h)>-1?k.args.push("Collected"):["harmonization","harmonized"].indexOf(h)>-1&&k.args.push("Dataschema");var l=new RqlQuery("and");l.args.push(k),l.args.push(j.args[0]),j.args[0]=l}return j.args.push(e),d.serializeArgs(d.args)},this.prepareGraphicsQuery=function(a,b,c){var d=this.parseQuery(a),e=new RqlQuery(RQL_NODE.AGGREGATE);if(b.forEach(function(a){e.args.push(a)}),c&&c.length>0){var f=new RqlQuery(RQL_NODE.BUCKET);c.forEach(function(a){f.args.push(a)}),e.args.push(f)}var g,h=!1,i=!1;return d.args.forEach(function(a){if("study"===a.name){i=!0;var b=null;h=a.args.filter(function(a,c){return"limit"===a.name&&(b=c),["limit","sort","aggregate"].indexOf(a.name)<0}).length,null!==b&&a.args.splice(b,1),g=a}}),i||(g=new RqlQuery("study"),d.args.push(g)),h||g.args.push(new RqlQuery(RQL_NODE.MATCH)),g.args.push(e),d.args.push(new RqlQuery("facet")),d.serializeArgs(d.args)},this.getTargetAggregations=function(a,b,c){function d(a,b){var d=b.terms;if(d&&d.length>0){var f=a&&a.map(function(a){return a.key})||[];if(a){var g=[];return d.forEach(function(a){0!==f.length&&f.indexOf(a.name)!==-1||g.push({count:0,default:0,description:e.forLocale(a.description,c),key:a.name,title:e.forLocale(a.title,c)})}),a.concat(g)}return d.map(function(a){return{count:0,default:0,description:e.forLocale(a.description,c),key:a.name,title:e.forLocale(a.title,c)}})}return a}function g(a,b){if(a.children){var c=a.children.filter(function(a){return a.hasOwnProperty(b)}).pop();if(c)return c[b]}return null}var h=f.vocabularyAlias(b.vocabulary),i=a[b.target+"ResultDto"];if(i&&i.aggs){var j=b.taxonomy.name.startsWith("Mica_"),k=j?h:b.taxonomy.name,l=i.aggs.filter(function(a){return a.aggregation===k}).pop();if(l){if(j)return f.isNumericVocabulary(b.vocabulary)?l["obiba.mica.StatsAggregationResultDto.stats"]:f.isRangeVocabulary(b.vocabulary)?d(l["obiba.mica.RangeAggregationResultDto.ranges"],b.vocabulary):d(l["obiba.mica.TermsAggregationResultDto.terms"],b.vocabulary);if(l.children.filter(function(a){return a.aggregation===h}).pop())return f.isRangeVocabulary(b.vocabulary)?d(g(l,"obiba.mica.RangeAggregationResultDto.ranges"),b.vocabulary):d(g(l,"obiba.mica.TermsAggregationResultDto.terms"),b.vocabulary)}}return d([],b.vocabulary)},this.findCriterion=function(a,b){function c(a,b){var d;if(a.id===b)return a;for(var e=a.children.length;e--;)if(d=c(a.children[e],b))return d}return c(a,b)}}]);var STUDY_FILTER_CHOICES={ALL_STUDIES:"all",INDIVIDUAL_STUDIES:"individual",HARMONIZATION_STUDIES:"harmonization"};angular.module("obiba.mica.search").factory("TaxonomiesSearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomiesSearchResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}]).factory("TaxonomiesResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomiesResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}]).factory("TaxonomyResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(a,b,c){return a(b.getUrl("TaxonomyResource"),{},{get:{method:"GET",errorHandler:!0,cache:c("taxonomyResource")}})}]).factory("JoinQuerySearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQuerySearchResource"),{},{variables:{method:"GET",errorHandler:!0,params:{type:"variables"}},studies:{method:"GET",errorHandler:!0,params:{type:"studies"}},networks:{method:"GET",errorHandler:!0,params:{type:"networks"}},datasets:{method:"GET",errorHandler:!0,params:{type:"datasets"}}})}]).factory("JoinQueryCoverageResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQueryCoverageResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("VocabularyResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("VocabularyResource"),{},{get:{method:"GET",errorHandler:!0}})}]).service("StudyFilterShortcutService",["$q","$location","$translate","RqlQueryService",function(a,b,c,d){this.filter=function(a,c){d.createCriteria(d.parseQuery(b.search().query),c).then(function(c){var e,f=c.root.rqlQuery,g=d.findCriteriaItemFromTreeById("study","Mica_study.className",c.root);switch(e=g?g.rqlQuery:new RqlQuery("in"),e.args=["Mica_study.className"],a){case STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:e.args.push("Study");break;case STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES:e.args.push("HarmonizationStudy");break;case STUDY_FILTER_CHOICES.ALL_STUDIES:e.args.push(["Study","HarmonizationStudy"])}if(!g){var h=d.findTargetQuery(QUERY_TARGETS.STUDY,f);if(h||(h=new RqlQuery(QUERY_TARGETS.STUDY),f.args.push(h)),h.args.length>0){var i=new RqlQuery("and");h.args.forEach(function(a){i.args.push(a)}),i.args.push(e),h.args=[i]}else h.args=[e]}b.search("query",(new RqlQuery).serializeArgs(f.args))})},this.getStudyClassNameChoices=function(){return d.createCriteria(d.parseQuery(b.search().query),c.use()).then(function(a){var b=d.findCriteriaItemFromTreeById("study","Mica_study.className",a.root);return{choseAll:function(){return!b||b.type===RQL_NODE.EXISTS||b.selectedTerms.indexOf("Study")>-1&&b.selectedTerms.indexOf("HarmonizationStudy")>-1},choseIndividual:function(){return!b||b.selectedTerms.indexOf("Study")>-1},choseHarmonization:function(){return!b||b.selectedTerms.indexOf("HarmonizationStudy")>-1}}})}}]).service("SearchContext",function(){var a=null;this.setLocale=function(b){a=b},this.currentLocale=function(){return a}}).service("PageUrlService",["ngObibaMicaUrl","StringUtils","urlEncode",function(a,b,c){return this.studyPage=function(d,e){var f=("individual"===e.toLowerCase()?"individual":"harmonization")+"-study";return d?b.replaceAll(a.getUrl("StudyPage"),{":type":c(f),":study":c(d)}):""},this.studyPopulationPage=function(d,e,f){var g=("individual"===e.toLowerCase()?"individual":"harmonization")+"-study";return d?b.replaceAll(a.getUrl("StudyPopulationsPage"),{":type":c(g),":study":c(d),":population":c(f)}):""},this.networkPage=function(d){return d?b.replaceAll(a.getUrl("NetworkPage"),{":network":c(d)}):""},this.datasetPage=function(d,e){var f=("collected"===e.toLowerCase()?"collected":"harmonized")+"-dataset";return d?b.replaceAll(a.getUrl("DatasetPage"),{":type":c(f),":dataset":c(d)}):""},this.variablePage=function(d){return d?b.replaceAll(a.getUrl("VariablePage"),{":variable":c(d)}):""},this.downloadCoverage=function(c){return b.replaceAll(a.getUrl("JoinQueryCoverageDownloadResource"),{":query":c})},this}]).service("ObibaSearchConfig",function(){var a={networks:{showSearchTab:1},studies:{showSearchTab:1},datasets:{showSearchTab:1},variables:{showSearchTab:1}};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}).service("CoverageGroupByService",["ngObibaMicaSearch",function(a){var b=this,c=a.getOptions().coverage.groupBy;this.canShowStudy=function(){return c.study||c.dce},this.canShowDce=function(a){return(a.indexOf("study")>-1||a.indexOf("dce")>-1)&&c.study&&c.dce},this.canShowDataset=function(){return c.dataset},this.canShowVariableTypeFilter=function(a){var b=(a.indexOf("study")>-1||a.indexOf("dce")>-1)&&c.study,d=a.indexOf("dataset")>-1&&c.dataset;return b||d},this.studyTitle=function(){return"search.coverage-buckets.study"},this.studyBucket=function(){return BUCKET_TYPES.STUDY},this.dceBucket=function(){return c.study&&c.dce?BUCKET_TYPES.DCE:this.studyBucket()},this.datasetTitle=function(){return"search.coverage-buckets.dataset"},this.datasetBucket=function(){return BUCKET_TYPES.DATASET},this.canGroupBy=function(a){var b=!1;switch(a){case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.STUDY_HARMONIZATION:b=c.study;break;case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:case BUCKET_TYPES.DCE_HARMONIZATION:b=c.dce;break;case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET_HARMONIZED:b=c.dataset}return b},this.defaultBucket=function(){return c.study?b.studyBucket():c.dataset?b.datasetBucket():""}}]).service("TaxonomyUtils",[function(){function a(a){if(!a)return!1;var b=a.attributes?a.attributes.filter(function(a){return"hidden"===a.key}).pop():null;return!b||"false"===b.value}function b(b){return(b||[]).filter(a)}return this.visibleVocabulary=a,this.visibleVocabularies=b,this}]).factory("CriteriaNodeCompileService",["$templateCache","$compile",function(a,b){return{compile:function(c,d){var e="";e=c.item.type===RQL_NODE.OR||c.item.type===RQL_NODE.AND||c.item.type===RQL_NODE.NAND||c.item.type===RQL_NODE.NOR?angular.element(a.get("search/views/criteria/criteria-node-template.html")):angular.element('<criterion-dropdown criterion="item" query="query"></criterion-dropdown>'),b(e)(c,function(a){d.replaceWith(a)})}}}]),angular.module("obiba.mica.search").controller("SearchController",["$scope","$rootScope","$timeout","$routeParams","$location","$translate","$filter","$cookies","TaxonomiesSearchResource","TaxonomiesResource","TaxonomyResource","VocabularyResource","ngObibaMicaSearchTemplateUrl","ngObibaMicaSearch","JoinQuerySearchResource","JoinQueryCoverageResource","AlertService","ServerErrorUtils","LocalizedValues","RqlQueryService","RqlQueryUtils","SearchContext","CoverageGroupByService","TaxonomyUtils","LocaleStringUtils",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(){function b(a){var b=e.search()[a];return b&&b.split(",").filter(function(a){return a}).map(function(a){return a.trim()})}a.taxonomyNav=[];var c=b("targetTabsOrder");a.targetTabsOrder=(c||a.options.targetTabsOrder).filter(function(a){return P[a]});var d=b("searchTabsOrder");a.searchTabsOrder=d||a.options.searchTabsOrder;var f=b("resultTabsOrder");a.resultTabsOrder=(f||a.options.resultTabsOrder).filter(function(a){return P[a]}),e.search().target?a.target=e.search().target:a.target||(a.target=a.targetTabsOrder[0]),a.metaTaxonomy.$promise.then(function(b){var c=[];a.targetTabsOrder.forEach(function(d){var e=b.vocabularies.filter(function(a){if(a.name===d)return c.push(d),!0}).pop();e&&e.terms&&e.terms.forEach(function(b){b.target=d;var c=b.title.filter(function(b){return b.locale===a.lang})[0],e=b.description?b.description.filter(function(b){return b.locale===a.lang})[0]:void 0;b.locale={title:c,description:e},b.terms&&b.terms.forEach(function(b){var c=b.title.filter(function(b){return b.locale===a.lang})[0],d=b.description?b.description.filter(function(b){return b.locale===a.lang})[0]:void 0;b.locale={title:c,description:d}}),a.taxonomyNav.push(b)})}),a.targetTabsOrder=c})}function A(b){a.search.result={},a.search.loading=!1,q.alert({id:"SearchController",type:"danger",msg:r.buildMessage(b),delay:5e3})}function B(a){if(!a||!QUERY_TYPES[a.toUpperCase()])throw new Error("Invalid type: "+a)}function C(a){if(a&&(!BUCKET_TYPES[a.replace("-","_").toUpperCase()]||!w.canGroupBy(a)))throw new Error("Invalid bucket "+a)}function D(a){if(!a||!DISPLAY_TYPES[a.toUpperCase()])throw new Error("Invalid display: "+a)}function E(){return a.taxonomyTypeMap[a.resultTabsOrder[0]]}function F(){return a.searchTabsOrder[0]||DISPLAY_TYPES.LIST}function G(){try{var b=e.search(),c=a.resultTabsOrder.indexOf(Q[b.type])>-1?b.type:E(),d=b.bucket&&w.canGroupBy(b.bucket)?b.bucket:w.defaultBucket(),f=a.searchTabsOrder.indexOf(b.display)>-1?b.display:F(),g=b.query||"";return B(c),C(d),D(f),a.search.type=c,a.search.bucket=d,a.search.display=f,a.search.query=g,a.search.rqlQuery=t.parseQuery(g),!0}catch(a){q.alert({id:"SearchController",type:"danger",msg:a.message,delay:5e3})}return!1}function H(a){return a=a.trim(),a.match(/\s+/)?'"'+a.replace(/^"|"$/g,"").replace(/"/,'"')+'"':a}function I(a){a.sort(function(a,b){return"network"===a.target||"variable"===b.target?-1:"variable"===a.target||"network"===b.target?1:a.target<b.target?1:a.target>b.target?-1:0})}function J(){function b(){var b=t.getTargetQuerySort(a.search.type,a.search.rqlQuery),c=b&&b.args?b.args:null;return c||(c=a.search.type===QUERY_TYPES.VARIABLES?SORT_FIELDS.NAME:SORT_FIELDS.ACRONYM,a.search.type===QUERY_TYPES.VARIABLES?c=[SORT_FIELDS.VARIABLE_TYPE,SORT_FIELDS.CONTAINER_ID,SORT_FIELDS.POPULATION_WEIGHT,SORT_FIELDS.DATA_COLLECTION_EVENT_WEIGHT,SORT_FIELDS.DATASET_ID,SORT_FIELDS.INDEX,SORT_FIELDS.NAME]:a.search.type===QUERY_TYPES.DATASETS&&(c=[SORT_FIELDS.STUDY_TABLE.STUDY_ID,SORT_FIELDS.STUDY_TABLE.POPULATION_WEIGHT,SORT_FIELDS.STUDY_TABLE.DATA_COLLECTION_EVENT_WEIGHT,SORT_FIELDS.ACRONYM])),c}if("/search"===e.path()){var c=t.prepareSearchQueryAndSerialize(a.search.display,a.search.type,a.search.rqlQuery,a.search.pagination,a.lang,b());switch(a.search.display){case DISPLAY_TYPES.LIST:a.search.loading=!0,a.search.executedQuery=c,o[a.search.type]({query:c},function(b){a.search.result.list=b,a.search.loading=!1},A);break;case DISPLAY_TYPES.COVERAGE:Object.keys(a.search.criteriaItemMap).map(function(b){return a.search.criteriaItemMap[b]}).filter(function(a){return QUERY_TARGETS.VARIABLE===a.getTarget()&&"Mica_variable"!==a.taxonomy.name}).length>0?(a.search.loading=!0,a.search.executedQuery=t.prepareCoverageQuery(c,a.search.bucket),p.get({query:a.search.executedQuery},function(b){a.search.result.coverage=b,a.search.loading=!1},A)):a.search.result={};break;case DISPLAY_TYPES.GRAPHICS:a.search.loading=!0,a.search.executedQuery=t.prepareGraphicsQuery(c,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-design"]),o.studies({query:a.search.executedQuery},function(b){a.search.result.graphics=b,a.search.loading=!1},A)}}}function K(){G()&&t.createCriteria(a.search.rqlQuery,a.lang).then(function(b){a.search.criteria=b.root,a.search.criteria&&a.search.criteria.children&&I(a.search.criteria.children),a.search.criteriaItemMap=b.map,a.search.query&&J(),a.$broadcast("ngObibaMicaQueryUpdated",a.search.criteria)})}function L(a,b){if(a.type===RQL_NODE.OR){var c=a.parent,d=c.children.indexOf(a);c.children[d]=b;var e=a.rqlQuery,f=c.rqlQuery,g=f.args.indexOf(e);f.args[g]=b.rqlQuery,c.type!==QUERY_TARGETS.VARIABLE&&L(c,b)}else b.type!==RQL_NODE.VARIABLE&&a.type===RQL_NODE.AND&&L(a.parent,a)}function M(){a.lang=f.use(),v.setLocale(a.lang),z(),K()}a.options=n.getOptions();var N="micaHideSearchHelpText",O="micaHideClassificationHelpBox";f(["search.help","search.coverage-help"]).then(function(b){a.options.SearchHelpText||h.get(N)||(a.options.SearchHelpText=b["search.help"]),a.options.ClassificationHelpText||h.get(O)||(a.options.ClassificationHelpText=b["classifications.help"])}),a.closeHelpBox=function(){h.put(N,!0),a.options.SearchHelpText=null},a.closeClassificationHelpBox=function(){h.put(O,!0),a.options.ClassificationHelpText=null},h.get(N)&&(a.options.SearchHelpText=null),h.get(O)&&(a.options.ClassificationHelpText=null),a.taxonomyTypeMap={variable:"variables",study:"studies",network:"networks",dataset:"datasets"},f(["search.classifications-title","search.classifications-link","search.faceted-navigation-help"]).then(function(b){a.hasClassificationsTitle=b["search.classifications-title"],a.hasClassificationsLinkLabel=b["search.classifications-link"],a.hasFacetedNavigationHelp=b["search.faceted-navigation-help"]});var P={variable:a.options.variables.showSearchTab,dataset:a.options.datasets.showSearchTab,study:a.options.studies.showSearchTab,network:a.options.networks.showSearchTab},Q=Object.keys(a.taxonomyTypeMap).reduce(function(b,c){return b[a.taxonomyTypeMap[c]]=c,b},{});a.targets=[],a.lang=s.getLocal(),a.metaTaxonomy=k.get({target:"taxonomy",taxonomy:"Mica_taxonomy"},function(b){function c(a){function b(a,c){return angular.forEach(c,function(c){if(!c.terms)return void a.push(c);b(a,c.terms)}),a}return b([],a)}var d=b.vocabularies.map(function(a){return a.name});a.targets=d.filter(function(a){return P[a]}),a.hasFacetedTaxonomies=!1,a.facetedTaxonomies=b.vocabularies.reduce(function(b,d){function e(a){return g.filter(function(b){return b.name===a})[0]}function f(a){return null!==a&&void 0!==a}var g=c(d.terms);return a.options.showAllFacetedTaxonomies?b[d.name]=g.filter(function(a){return a.attributes&&a.attributes.some(function(a){return"showFacetedNavigation"===a.key&&"true"===a.value.toString()})}):b[d.name]=(a.options[d.name+"TaxonomiesOrder"]||[]).map(e).filter(f),a.hasFacetedTaxonomies=a.hasFacetedTaxonomies||b[d.name].length,b},{})});var R=function(){var a=e.search();delete a.query,e.search(a)},S=function(){a.search.advanced=!a.search.advanced},T=function(){for(var b=a.search.criteria.children||[],c=b.length;c--;)for(var d=b[c].children||[],e=d.length;e--;)if(d[e].type===RQL_NODE.OR||d[e].type===RQL_NODE.AND)return!0};a.translateTaxonomyNav=function(a,b){var c=a[b]&&a[b].filter(function(a){return a.locale===f.use()}).pop();return c?c.text:b},b.$on("$translateChangeSuccess",function(b,c){c.language!==v.currentLocale()&&(a.lang=f.use(),v.setLocale(a.lang),K())});var U=function(b,c){if(a.target===b&&a.taxonomyName===c&&a.taxonomiesShown)return void(a.taxonomiesShown=!1);a.taxonomiesShown=!0,a.target=b,a.taxonomyName=c},V=function(){a.target=null,a.taxonomyName=null},W=function(){var b=(new RqlQuery).serializeArgs(a.search.rqlQuery.args),c=e.search();""===b?delete c.query:c.query=b,e.search(c)},X=function(){a.documents.search.text=null,a.documents.search.active=!1},Y=function(b){function c(a){var c=0,d=new RegExp(b,"ig");return a.itemTitle.match(d)?c=10:a.itemDescription&&a.itemDescription.match(d)?c=8:a.itemParentTitle.match(d)?c=6:a.itemParentDescription&&a.itemParentDescription.match(d)&&(c=4),c}function d(a,b){return!((b||[]).indexOf(a.name)>-1)&&0===(a.attributes||[]).filter(function(a){return"showSearch"===a.key}).length}function e(b){var e=[],f=0,g=b.target,h=b.taxonomy;return h.vocabularies&&h.vocabularies.filter(function(b){return x.visibleVocabulary(b)&&d(b,a.options.hideSearch)}).forEach(function(b){if(b.terms)b.terms.filter(function(b){return d(b,a.options.hideSearch)}).forEach(function(d){var i=t.createCriteriaItem(g,h,b,d,a.lang);e.push({score:c(i),item:i}),f++});else{var i=t.createCriteriaItem(g,h,b,null,a.lang);e.push({score:c(i),item:i}),f++}}),{results:e,total:f}}return i.get({query:H(b),locale:a.lang,target:a.documents.search.target}).$promise.then(function(a){if(a){var c=[],d=0,f=10;if(a.forEach(function(a){var b=e(a);c.push.apply(c,b.results),d+=b.total}),c.sort(function(a,b){return b.score-a.score}),c=c.splice(0,f),d>c.length){var g={query:b,total:d,size:f,message:y.translate("search.showing",[f,d]),status:"has-warning"};c.push({score:-1,item:g})}return c.map(function(a){return a.item})}return[]},function(a){q.alert({id:"SearchController",type:"danger",msg:r.buildMessage(a),delay:5e3})})},Z=function(a){t.removeCriteriaItem(a),W()},$=function(b,c,d,e,f){if(angular.isUndefined(e)&&(e=!0),b.id){var h,i=CriteriaIdGenerator.generate(b.taxonomy,b.vocabulary),j=t.findCriteriaItemFromTree(b,a.search.criteria);j&&i.indexOf("dceId")!==-1&&f?(Z(j),h="search.criterion.updated",t.addCriteriaItem(a.search.rqlQuery,b,c)):j?(h="search.criterion.updated",t.updateCriteriaItem(j,b,d)):(h="search.criterion.created",t.addCriteriaItem(a.search.rqlQuery,b,c)),e&&q.growl({id:"SearchControllerGrowl",type:"info",msgKey:h,msgArgs:[s.forLocale(b.vocabulary.title,a.lang),g("translate")("taxonomy.target."+b.target)],delay:3e3}),W(),a.selectedCriteria=null}else a.selectedCriteria=b.query},_=function(b){switch(b.keyCode){case 27:a.documents.search.active&&X();break;default:a.documents.search.text&&Y(a.documents.search.text)}},aa=function(a){if(a){B(a);var b=e.search();b.type=a,e.search(b)}},ba=function(a){if(a){C(a);var b=e.search();b.bucket=a,e.search(b)}},ca=function(b,c,d){a.search.pagination[b]={from:c,size:d},K()},da=function(a){if(a){D(a);var b=e.search();b.display=a,e.search(b)}},ea=function(b,c,d,e,f,g){if(c&&aa(c),e){var h=t.findCriteriaItemFromTree(b,a.search.criteria);h&&L(h.parent,h)}da(d&&a.search.display?a.search.display:DISPLAY_TYPES.LIST),$(b,RQL_NODE.AND,!0,f,g)},fa=function(b){var c=t.findCriterion(a.search.criteria,b.id);Z(c)},ga=function(b,c,d,e){if(e=e||{},e.text&&(e.text=e.text.replace(/[^a-zA-Z0-9 _-]/g,"")),angular.isString(e)&&(e={term:e}),d){var f;if(u.isNumericVocabulary(d))return f=t.createCriteriaItem(b,c,d,null,a.lang),f.rqlQuery=u.buildRqlQuery(f),u.updateRangeQuery(f.rqlQuery,e.from,e.to),void $(f,null,!0);if(u.isMatchVocabulary(d))return f=t.createCriteriaItem(b,c,d,null,a.lang),f.rqlQuery=u.buildRqlQuery(f),u.updateMatchQuery(f.rqlQuery,e.text),void $(f,null,!0)}$(t.createCriteriaItem(b,c,d,e&&e.term,a.lang))},ha=function(b){a.documents.search.target=b},ia={SEARCH:"search",CLASSIFICATION:"classification"};a.goToSearch=function(){a.viewMode=ia.SEARCH,e.search("taxonomy",null),e.search("vocabulary",null),e.search("target",null),e.path("/search")},a.goToClassifications=function(){a.viewMode=ia.CLASSIFICATION,e.path("/classifications"),e.search("target",a.targetTabsOrder[0])},a.navigateToTarget=function(b){e.search("target",b),e.search("taxonomy",null),e.search("vocabulary",null),a.target=b},a.QUERY_TYPES=QUERY_TYPES,a.BUCKET_TYPES=BUCKET_TYPES,a.search={pagination:{},query:null,advanced:!1,rqlQuery:new RqlQuery,executedQuery:null,type:null,bucket:null,result:{list:null,coverage:null,graphics:null},criteria:[],criteriaItemMap:{},loading:!1},a.viewMode=ia.SEARCH,a.documents={search:{text:null,active:!1,target:null}},a.searchHeaderTemplateUrl=m.getHeaderUrl("search"),a.classificationsHeaderTemplateUrl=m.getHeaderUrl("classifications"),a.selectSearchTarget=ha,a.selectDisplay=da,a.searchCriteria=Y,a.selectCriteria=$,a.searchKeyUp=_,a.showTaxonomy=U,a.clearTaxonomy=V,a.removeCriteriaItem=Z,a.refreshQuery=W,a.clearSearchQuery=R,a.toggleSearchQuery=S,a.showAdvanced=T,a.onTypeChanged=aa,a.onBucketChanged=ba,a.onDisplayChanged=da,a.onUpdateCriteria=ea,a.onRemoveCriteria=fa,a.onSelectTerm=ga,a.QUERY_TARGETS=QUERY_TARGETS,a.onPaginate=ca,a.inSearchMode=function(){return a.viewMode===ia.SEARCH},a.toggleFullscreen=function(){a.isFullscreen=!a.isFullscreen},a.$on("$locationChangeSuccess",function(a,b,c){if(z(),b!==c)try{C(e.search().bucket),K()}catch(a){var d=w.defaultBucket();e.search("bucket",d).replace()}}),b.$on("ngObibaMicaSearch.fullscreenChange",function(b,c){a.isFullscreen=c}),b.$on("ngObibaMicaSearch.sortChange",function(b,c){a.search.rqlQuery=t.prepareSearchQueryNoFields(a.search.display,a.search.type,a.search.rqlQuery,a.search.pagination,a.lang,c.order+c.sort),W()}),b.$on("ngObibaMicaSearch.searchChange",function(b,c){var d,e=["objectives","name"];t.getTaxonomyByTarget(a.target).then(function(b){var f=b[0],g=[];f.vocabularies&&(g=f.vocabularies.filter(function(a){return e.indexOf(a.name)>-1})),g.forEach(function(b){d=t.createCriteriaItem(a.target,f,b,null,a.lang),d.rqlQuery=u.buildRqlQuery(d),u.updateMatchQuery(d.rqlQuery,c),$(d,null,!0)})})}),M()}]).controller("NumericVocabularyPanelController",["$scope",function(a){a.$watch("taxonomies",function(){a.from=null,a.to=null},!0)}]).controller("MatchVocabularyPanelController",["$scope",function(a){a.$watch("taxonomies",function(){a.text=null},!0)}]).controller("NumericVocabularyFacetController",["$scope","JoinQuerySearchResource","RqlQueryService","RqlQueryUtils",function(a,b,c,d){function e(e,f){function g(a,b){var e=angular.copy(a.rqlQuery);return b.rqlQuery=d.buildRqlQuery(b),c.addCriteriaItem(e,b),e}var h=c.findCriterion(e,CriteriaIdGenerator.generate(a.$parent.taxonomy,f));h||(h=c.createCriteriaItem(a.target,a.$parent.taxonomy,a.vocabulary)),h.rqlQuery&&h.rqlQuery.args[1]?angular.isArray(h.rqlQuery.args[1])?(a.from=h.rqlQuery.args[1][0],a.to=h.rqlQuery.args[1][1]):h.rqlQuery.name===RQL_NODE.GE?a.from=h.rqlQuery.args[1]:a.to=h.rqlQuery.args[1]:(a.from=null,a.to=null,a.min=null,a.max=null);var i=d.hasTargetQuery(e.rqlQuery,h.target)?angular.copy(e.rqlQuery):g(e,h),j=c.prepareCriteriaTermsQuery(i,h);b[targetToType(a.target)]({query:j}).$promise.then(function(b){var d=c.getTargetAggregations(b,h,a.lang);d&&d.default&&(a.min=d.default.min,a.max=d.default.max)})}function f(){a.$parent.selectTerm(a.$parent.target,a.$parent.taxonomy,a.vocabulary,{from:a.from,to:a.to})}a.onKeypress=function(a){13===a.keyCode&&f()},a.$on("ngObibaMicaQueryUpdated",function(b,c){a.vocabulary.isNumeric&&a.vocabulary.isOpen&&e(c,a.vocabulary)}),a.$on("ngObibaMicaLoadVocabulary",function(b,c,d){a.vocabulary.isNumeric&&d.name===a.vocabulary.name&&!d.isOpen&&e(a.criteria,d)})}]).controller("MatchVocabularyFacetController",["$scope","RqlQueryService",function(a,b){function c(c,d){var e=b.findCriterion(c,CriteriaIdGenerator.generate(a.$parent.taxonomy,d));e&&e.rqlQuery&&e.rqlQuery.args[1]?a.text=e.rqlQuery.args[0]:a.text=null}function d(){a.$parent.selectTerm(a.$parent.target,a.$parent.taxonomy,a.vocabulary,{text:a.text||"*"})}a.onKeypress=function(a){13===a.keyCode&&d()},a.$on("ngObibaMicaQueryUpdated",function(b,d){a.vocabulary.isMatch&&a.vocabulary.isOpen&&c(d,a.vocabulary)}),a.$on("ngObibaMicaLoadVocabulary",function(b,d,e){e.name!==a.vocabulary.name||e.isOpen||c(a.criteria,e)})}]).controller("TermsVocabularyFacetController",["$scope","$filter","JoinQuerySearchResource","RqlQueryService","RqlQueryUtils",function(a,b,c,d,e){function f(a,b){return a.selectedTerms&&(a.rqlQuery.name===RQL_NODE.EXISTS||a.selectedTerms.indexOf(b.key)!==-1)}function g(b,g){function h(a,b){var c=angular.copy(a.rqlQuery);return b.rqlQuery=e.buildRqlQuery(b),d.addCriteriaItem(c,b),c}var i=null,j=!1,k=d.findCriterion(b,CriteriaIdGenerator.generate(a.$parent.taxonomy,g));k?j=!0:k=d.createCriteriaItem(a.target,a.$parent.taxonomy,a.vocabulary),e.hasTargetQuery(b.rqlQuery,k.target)?(i=angular.copy(b.rqlQuery),j||d.addCriteriaItem(i,k,RQL_NODE.OR)):i=h(b,k);var l=d.prepareCriteriaTermsQuery(i,k,k.lang);c[targetToType(a.target)]({query:l}).$promise.then(function(b){d.getTargetAggregations(b,k,k.lang).forEach(function(b){a.vocabulary.terms.some(function(a){if(a.name===b.key)return a.selected=f(k,b),a.count=b.count,!0})})})}a.selectTerm=function(b,c,f,g){var h=f.terms.filter(function(a){return a.selected}).map(function(a){return a.name}),i=d.findCriterion(a.criteria,CriteriaIdGenerator.generate(c,f));i?(0===h.length?d.removeCriteriaItem(i):(i.rqlQuery.name=RQL_NODE.IN,e.updateQuery(i.rqlQuery,h)),a.onRefresh()):a.onSelectTerm(b,c,f,g)},a.$on("ngObibaMicaQueryUpdated",function(b,c){a.vocabulary.isNumeric||a.vocabulary.isMatch||!a.vocabulary.isOpen||g(c,a.vocabulary)}),a.$on("ngObibaMicaLoadVocabulary",function(b,c,d){d.name!==a.vocabulary.name||a.vocabulary.isNumeric||a.vocabulary.isMatch||d.isOpen||g(a.criteria,d)})}]).controller("TaxonomiesPanelController",["$rootScope","$scope","$translate","$location","TaxonomyResource","TaxonomiesResource","ngObibaMicaSearch","RqlQueryUtils","$cacheFactory","AlertService","ServerErrorUtils",TaxonomiesPanelController]).controller("ClassificationPanelController",["$rootScope","$scope","$translate","$location","TaxonomyResource","TaxonomiesResource","ngObibaMicaSearch","RqlQueryUtils","$cacheFactory","TaxonomyUtils",ClassificationPanelController]).controller("TaxonomiesFacetsController",["$scope","$timeout","TaxonomyResource","TaxonomiesResource","LocalizedValues","ngObibaMicaSearch","RqlQueryUtils",function(a,b,c,d,e,f,g){function h(b){a.taxonomies[b]||d.get({target:b},function(c){a.taxonomies[b]=a.facetedTaxonomies[b].map(function(a){return c.filter(function(b){return a.name===b.name})[0]}).filter(function(a){return a}).map(function(a){return a.vocabularies.map(function(a){a.limit=10,a.isMatch=g.isMatchVocabulary(a),a.isNumeric=g.isNumericVocabulary(a)}),a}),1===a.taxonomies[b].length&&(a.taxonomies[b][0].isOpen=1)})}a.options=f.getOptions(),a.taxonomies={},a.targets=[],a.RqlQueryUtils=g,a.$watch("facetedTaxonomies",function(b){b&&(a.targets=a.options.targetTabsOrder.filter(function(a){if(b[a])return b[a].length}),a.target=a.targets[0],h(a.target))}),a.selectTerm=function(b,c,d,e){a.onSelectTerm(b,c,d,e)},a.setTarget=function(c){a.target=c,h(c),a.criteria&&b(function(){a.$broadcast("ngObibaMicaQueryUpdated",a.criteria)})},a.loadVocabulary=function(b,c){a.$broadcast("ngObibaMicaLoadVocabulary",b,c)},a.localize=function(b){return e.forLocale(b,a.lang)},a.$on("ngObibaMicaQueryUpdated",function(b,c){a.criteria=c})}]).controller("SearchResultController",["$scope","ngObibaMicaSearch","ngObibaMicaUrl","RqlQueryService","RqlQueryUtils","ngObibaMicaSearchTemplateUrl",function(a,b,c,d,e,f){function g(b){Object.keys(a.activeTarget).forEach(function(c){a.activeTarget[c].active=b===c})}a.targetTypeMap=a.$parent.taxonomyTypeMap,a.QUERY_TARGETS=QUERY_TARGETS,a.QUERY_TYPES=QUERY_TYPES,a.options=b.getOptions(),a.activeTarget={},a.activeTarget[QUERY_TYPES.VARIABLES]={active:!1,name:QUERY_TARGETS.VARIABLE,totalHits:0},a.activeTarget[QUERY_TYPES.DATASETS]={active:!1,name:QUERY_TARGETS.DATASET,totalHits:0},a.activeTarget[QUERY_TYPES.STUDIES]={active:!1,name:QUERY_TARGETS.STUDY,totalHits:0},a.activeTarget[QUERY_TYPES.NETWORKS]={active:!1,name:QUERY_TARGETS.NETWORK,totalHits:0},a.getUrlTemplate=function(a){switch(a){case"list":return f.getTemplateUrl("searchResultList");case"coverage":return f.getTemplateUrl("searchResultCoverage");case"graphics":return f.getTemplateUrl("searchResultGraphics")}},a.selectTarget=function(b){g(b),a.type=b,a.$parent.onTypeChanged(b)},a.getTotalHits=function(b){return a.result.list&&a.result.list[b+"ResultDto"]?a.result.list[b+"ResultDto"].totalHits:"..."},a.getReportUrl=function(){if(null===a.query)return a.query;var b=d.parseQuery(a.query),f=typeToTarget(a.type),g=b.args.filter(function(a){return a.name===f}).pop();e.addLimit(g,e.limit(0,1e5));var h=(new RqlQuery).serializeArgs(b.args);return c.getUrl("JoinQuerySearchCsvResource").replace(":type",a.type).replace(":query",h)},a.getStudySpecificReportUrl=function(){if(null===a.query)return a.query;var b=d.parseQuery(a.query),f=typeToTarget(a.type),g=b.args.filter(function(a){return a.name===f}).pop();e.addLimit(g,e.limit(0,1e5));var h=(new RqlQuery).serializeArgs(b.args);return c.getUrl("JoinQuerySearchCsvReportResource").replace(":type",a.type).replace(":query",h)},a.$watchCollection("result",function(){a.result.list&&(a.activeTarget[QUERY_TYPES.VARIABLES].totalHits=a.result.list.variableResultDto.totalHits,a.activeTarget[QUERY_TYPES.DATASETS].totalHits=a.result.list.datasetResultDto.totalHits,a.activeTarget[QUERY_TYPES.STUDIES].totalHits=a.result.list.studyResultDto.totalHits,a.activeTarget[QUERY_TYPES.NETWORKS].totalHits=a.result.list.networkResultDto.totalHits)}),a.$watch("type",function(a){g(a)}),a.DISPLAY_TYPES=DISPLAY_TYPES}]).controller("CriterionLogicalController",["$scope",function(a){a.updateLogical=function(b){a.item.rqlQuery.name=b,a.$emit(CRITERIA_ITEM_EVENT.refresh)}}]).controller("CriterionDropdownController",["$scope","$filter","LocalizedValues","RqlQueryUtils","StringUtils",function(a,b,c,d,e){var f=function(){if(a.state.open){a.state.onClose();var b=a.state.dirty;a.state.open=!1,a.state.dirty=!1,b&&a.$emit(CRITERIA_ITEM_EVENT.refresh)}},g=function(){if(a.state.open)return void f();a.state.open=!0,a.state.onOpen()},h=function(){a.$emit(CRITERIA_ITEM_EVENT.deleted,a.criterion)},i=function(a){13===a.keyCode&&f()};a.state=new CriterionState,a.timestamp=(new Date).getTime(),a.localize=function(b){return c.forLocale(b,a.criterion.lang)},a.localizeCriterion=function(){var d=a.criterion.rqlQuery;if((d.name===RQL_NODE.IN||d.name===RQL_NODE.CONTAINS)&&a.criterion.selectedTerms&&a.criterion.selectedTerms.length>0){var e=d.name===RQL_NODE.IN?" | ":" + ";return a.criterion.selectedTerms.map(function(b){if(!a.criterion.vocabulary.terms)return b;var d=a.criterion.vocabulary.terms.filter(function(a){return a.name===b}).pop();return d?c.forLocale(d.title,a.criterion.lang):b}).join(e)}var f=d.name;switch(d.name){case RQL_NODE.EXISTS:f=":"+b("translate")("any");break;case RQL_NODE.MISSING:f=":"+b("translate")("none");break;case RQL_NODE.EQ:f="="+d.args[1];break;case RQL_NODE.GE:f=">"+d.args[1];break;case RQL_NODE.LE:f="<"+d.args[1];break;case RQL_NODE.BETWEEN:f=":["+d.args[1]+")";break;case RQL_NODE.IN:case RQL_NODE.CONTAINS:f="";break;case RQL_NODE.MATCH:f=":match("+d.args[0]+")"}return c.forLocale(a.criterion.vocabulary.title,a.criterion.lang)+f},a.vocabularyType=function(a){return d.vocabularyType(a)},a.onKeyup=i,a.truncate=e.truncate,a.remove=h,a.openDropdown=g,a.closeDropdown=f,a.RqlQueryUtils=d}]).controller("MatchCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(a,b,c,d,e,f){a.lang=f.currentLocale();var g=function(){a.state.dirty=!0,e.updateMatchQuery(a.criterion.rqlQuery,a.match)},h=a.criterion.rqlQuery.args[0];a.match="*"===h?"":h,a.update=g,a.localize=function(b){return c.forLocale(b,a.criterion.lang)}}]).controller("NumericCriterionController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(a,b,c,d,e,f){a.lang=f.currentLocale();var g=a.criterion.rqlQuery.args[1];angular.isArray(g)?(a.from=a.criterion.rqlQuery.args[1][0],a.to=a.criterion.rqlQuery.args[1][1]):(a.from=a.criterion.rqlQuery.name===RQL_NODE.GE?g:null,a.to=a.criterion.rqlQuery.name===RQL_NODE.LE?g:null);var h=function(){var c=a.criterion.target,e=b.prepareCriteriaTermsQuery(a.query,a.criterion);d[targetToType(c)]({query:e}).$promise.then(function(c){var d=b.getTargetAggregations(c,a.criterion,a.lang);d&&d.default&&(a.min=d.default.min,a.max=d.default.max)})},i=function(){h()},j=function(){a.updateSelection()};a.updateSelection=function(){e.updateRangeQuery(a.criterion.rqlQuery,a.from,a.to,a.selectMissing),a.state.dirty=!0},a.selectMissing=a.criterion.rqlQuery.name===RQL_NODE.MISSING,a.state.addOnClose(j),a.state.addOnOpen(i),a.localize=function(b){return c.forLocale(b,a.criterion.lang)}}]).controller("StringCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","StringUtils","JoinQuerySearchResource","RqlQueryUtils","SearchContext","$filter",function(a,b,c,d,e,f,g,h){a.lang=g.currentLocale();var i=function(b){return a.checkboxTerms.indexOf(b)!==-1},j=function(){a.state.dirty=!0,a.criterion.rqlQuery.name=a.selectedFilter;var b=[];a.selectedFilter!==RQL_NODE.MISSING&&a.selectedFilter!==RQL_NODE.EXISTS&&Object.keys(a.checkboxTerms).forEach(function(c){a.checkboxTerms[c]&&b.push(c)}),0===b.length&&a.selectedFilter!==RQL_NODE.MISSING&&(a.criterion.rqlQuery.name=RQL_NODE.EXISTS),f.updateQuery(a.criterion.rqlQuery,b)},k=function(){j()},l=function(){return a.selectedFilter===RQL_NODE.IN},m=function(){return a.selectedFilter===RQL_NODE.CONTAINS},n=function(){a.state.loading=!0;var c=a.criterion.target,d=b.prepareCriteriaTermsQuery(a.query,a.criterion,a.lang);e[targetToType(c)]({query:d}).$promise.then(function(c){a.state.loading=!1,a.terms=b.getTargetAggregations(c,a.criterion,a.lang),a.terms&&(a.terms.forEach(function(b){a.checkboxTerms[b.key]=a.isSelectedTerm(b)}),a.terms=h("orderBySelection")(a.terms,a.checkboxTerms))})};a.isSelectedTerm=function(b){return a.criterion.selectedTerms&&a.criterion.selectedTerms.indexOf(b.key)!==-1},a.state.addOnOpen(n),a.checkboxTerms={},a.RQL_NODE=RQL_NODE,a.selectedFilter=a.criterion.type,a.isSelected=i,a.updateFilter=k,a.localize=function(b){return c.forLocale(b,a.criterion.lang)},a.truncate=d.truncate,a.isInFilter=l,a.isContainsFilter=m,a.updateSelection=j}]).controller("CoverageResultTableController",["$scope","$location","$q","PageUrlService","RqlQueryUtils","RqlQueryService","CoverageGroupByService","StudyFilterShortcutService",function(a,b,c,d,e,f,g,h){function i(a,b){for(var c=0,d=0,e=0;e<b.length;e++)c>=a[d].termsCount&&(d++,c=0),c+=b[e].termsCount,b[e].taxonomyName=a[d].entity.name}function j(a,b,c){var d=0;return a.reduce(function(a,e){return a[e.entity.name]=b.slice(d,d+e.termsCount).map(function(a){return e.termsCount>1&&"vocabularyName"===c&&(a.canRemove=!0),a[c]=e.entity.name,a}),d+=e.termsCount,a},{})}function k(b){b?a.selectBucket(BUCKET_TYPES.DCE):a.bucket.startsWith("dce")&&a.selectBucket(BUCKET_TYPES.STUDY)}function l(a,b){a!==b&&k(a)}function m(){h.getStudyClassNameChoices().then(function(b){b.choseAll()?a.bucketSelection._studySelection=STUDY_FILTER_CHOICES.ALL_STUDIES:b.choseIndividual()?a.bucketSelection._studySelection=STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:b.choseHarmonization()&&(a.bucketSelection._studySelection=STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES),angular.extend(a,b)});var c=b.search().bucket;c!==BUCKET_TYPES.STUDY&&c!==BUCKET_TYPES.DCE||(a.bucketSelection._dceBucketSelected=c===BUCKET_TYPES.DCE)}function n(){var c=b.search();c.display&&c.display===DISPLAY_TYPES.COVERAGE&&(a.bucket=c.bucket?c.bucket:g.defaultBucket(),m())}function o(b){a.groupByOptions.canShowVariableTypeFilter(b)?a.selectBucket(b):BUCKET_TYPES.STUDY!==b&&a.selectBucket(BUCKET_TYPES.DCE)}function p(b){a.selectBucket(b)}function q(){return a.bucket.indexOf("study")>-1||a.bucket.indexOf("dce")>-1}function r(){return a.bucket.indexOf("dataset")>-1}function s(b){b===BUCKET_TYPES.STUDY?o(a.bucketSelection.dceBucketSelected?BUCKET_TYPES.DCE:BUCKET_TYPES.STUDY):b===BUCKET_TYPES.DATASET&&p(BUCKET_TYPES.DATASET)}function t(a,b){switch(a){case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:return d.studyPage(b,"individual");case BUCKET_TYPES.STUDY_HARMONIZATION:case BUCKET_TYPES.DCE_HARMONIZATION:return d.studyPage(b,"harmonization");case BUCKET_TYPES.NETWORK:return d.networkPage(b);case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET_HARMONIZED:return d.datasetPage(b,"harmonized");case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:return d.datasetPage(b,"collected")}return""}function u(b,d){var g=a.bucket.startsWith("dce")?"dceId":"id";c.all(b.map(function(b){return f.createCriteriaItem(z[a.bucket],"Mica_"+z[a.bucket],g,b.value)})).then(function(b){if(b.length){var c=b.reduce(function(a,b){return a?(f.updateCriteriaItem(a,b),a):(b.rqlQuery=e.buildRqlQuery(b),b)},null);a.onUpdateCriteria(c,"variables",!0,void 0,void 0,d)}})}function v(){function b(a){var b;return i[a]?(b=0,i[a]=i[a]+1):(b=1,i[a]=1),b}function c(a,b,c){j[a]?(b<j[a][0]&&(j[a][0]=b),c>j[a][1]&&(j[a][1]=c)):j[a]=[b,c]}function e(a,b){var c;if(a)if(a.indexOf("-")>0){var d=a.split("-");if(!b){var e=parseInt(d[1]);e<12?d[1]=e+1:(d[0]=parseInt(d[0])+1,d[1]=1)}var f=d[0]+"/"+d[1]+"/01";c=Date.parse(f)}else c=b?Date.parse(a+"/01/01"):Date.parse(a+"/12/31");return c}function f(a,b){var c=e(a,!0),d=b?e(b,!1):n,f=d<n?d:n;return d===c?100:Math.round(a?100*(f-c)/(d-c):0)}var g,h={colSpan:a.bucket.startsWith("dce")?3:1,ids:{}},i={},j={},k=(new Date).getFullYear(),l=(new Date).getMonth()+1,m=k+"-"+l,n=e(m,!0),o=!0;return a.result.rows.forEach(function(e){if(h.ids[e.value]=[],a.bucket.startsWith("dce")){var i,j,l=e.value.split(":"),n=e.className.indexOf("Harmonization")>-1||"."===l[2],p=e.title.split(":"),q=e.description.split(":");j=l[0],g?j!==g&&(o=!o,g=j):g=j,i=b(j),c(j,e.start||m,e.end||m),h.ids[e.value].push({id:j,url:d.studyPage(j,n?"harmonization":"individual"),title:p[0],description:q[0],rowSpan:i}),j=l[0]+":"+l[1],i=b(j),h.ids[e.value].push({id:j,url:d.studyPopulationPage(l[0],n?"harmonization":"individual",l[1]),title:p[1],description:q[1],rowSpan:i}),h.ids[e.value].push({id:n?"-":e.value,title:p[2],description:q[2],start:e.start,current:m,end:e.end,progressClass:o?"info":"warning",url:d.studyPopulationPage(l[0],n?"harmonization":"individual",l[1]),rowSpan:1})}else{var r=a.bucket.split("-"),s=r[0];s+=s===BUCKET_TYPES.DATASET?e.className.indexOf("Harmonization")>-1?"-harmonized":"-collected":e.className.indexOf("Harmonization")>-1?"-harmonization":"-individual",h.ids[e.value].push({id:e.value,url:t(s,e.value),title:e.title,description:e.description,min:e.start,start:e.start,current:k,end:e.end,max:e.end,progressStart:0,progress:f(e.start?e.start+"-01":m,e.end?e.end+"-12":m),progressClass:o?"info":"warning",rowSpan:1}),o=!o}}),a.bucket.startsWith("dce")&&a.result.rows.forEach(function(a){h.ids[a.value][0].rowSpan>0&&(h.ids[a.value][0].rowSpan=i[h.ids[a.value][0].id]),h.ids[a.value][1].rowSpan>0&&(h.ids[a.value][1].rowSpan=i[h.ids[a.value][1].id]);var b=a.value.split(":");if(j[b[0]]){var c=j[b[0]][0],d=j[b[0]][1],f=h.ids[a.value][2].start||m,g=h.ids[a.value][2].end||m,k=e(d,!1)-e(c,!0);h.ids[a.value][2].min=c,h.ids[a.value][2].max=d,h.ids[a.value][2].progressStart=100*(e(f,!0)-e(c,!0))/k,h.ids[a.value][2].progress=100*(e(g,!1)-e(f,!0))/k}}),h}function w(a){return a.reduce(function(a,b){return a?(f.updateCriteriaItem(a,b),a):(b.rqlQuery=e.buildRqlQuery(b),b)},null)}function x(b){h.filter(b,a.lang)}function y(){n()}var z={},A={};z[BUCKET_TYPES.NETWORK]=QUERY_TARGETS.NETWORK,z[BUCKET_TYPES.STUDY]=QUERY_TARGETS.STUDY,z[BUCKET_TYPES.STUDY_INDIVIDUAL]=QUERY_TARGETS.STUDY,z[BUCKET_TYPES.STUDY_HARMONIZATION]=QUERY_TARGETS.STUDY,z[BUCKET_TYPES.DCE]=QUERY_TARGETS.VARIABLE,z[BUCKET_TYPES.DCE_INDIVIDUAL]=QUERY_TARGETS.VARIABLE,z[BUCKET_TYPES.DCE_HARMONIZATION]=QUERY_TARGETS.VARIABLE,z[BUCKET_TYPES.DATASCHEMA]=QUERY_TARGETS.DATASET,z[BUCKET_TYPES.DATASET]=QUERY_TARGETS.DATASET,z[BUCKET_TYPES.DATASET_COLLECTED]=QUERY_TARGETS.DATASET,z[BUCKET_TYPES.DATASET_HARMONIZED]=QUERY_TARGETS.DATASET,a.showMissing=!0,a.toggleMissing=function(b){a.showMissing=b},a.groupByOptions=g,a.bucketSelection={get studySelection(){return this._studySelection},set studySelection(b){this._studySelection=b,!a.bucket||a.bucket&&(a.bucket.indexOf(BUCKET_TYPES.STUDY)>-1||a.bucket.indexOf(BUCKET_TYPES.DCE)>-1)?o(a.bucket.split("-")[0]):a.bucket&&a.bucket.indexOf(BUCKET_TYPES.DATASET)>-1&&p(a.bucket.split("-")[0]),x(b)},get dceBucketSelected(){return this._dceBucketSelected},set dceBucketSelected(a){var b=this._dceBucketSelected;this._dceBucketSelected=a,l(a,b)}},a.isStudyBucket=q,a.isDatasetBucket=r,a.selectTab=s,a.selectBucket=function(b){a.bucket=b,a.$parent.onBucketChanged(b)},a.$on("$locationChangeSuccess",n),a.rowspans={},a.getSpan=function(b,c){var d=0;if(c){var e=b+":"+c;return d=a.result.rows.filter(function(a){return a.title.startsWith(e+":")}).length,a.rowspans[e]=d,d}return d=a.result.rows.filter(function(a){return a.title.startsWith(b+":")}).length,a.rowspans[b]=d,d},a.hasSpan=function(b,c){return c?a.rowspans[b+":"+c]>0:a.rowspans[b]>0},a.hasVariableTarget=function(){var a=b.search().query;return a&&e.hasTargetQuery(f.parseQuery(a),RQL_NODE.VARIABLE)},a.hasSelected=function(){return a.table&&a.table.rows&&a.table.rows.filter(function(a){return a.selected}).length},a.selectAll=function(){a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.selected=!0})},a.selectNone=function(){a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.selected=!1})},a.selectFull=function(){a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.hits?a.selected=0===a.hits.filter(function(a){return 0===a}).length:a.selected=!1})},a.BUCKET_TYPES=BUCKET_TYPES,a.downloadUrl=function(){return d.downloadCoverage(a.query)},a.$watch("result",function(){if(a.table={cols:[]},A={},a.result&&a.result.rows){var b=a.result;b.cols=v(),a.table=b,A=j(a.table.vocabularyHeaders,a.table.termHeaders,"vocabularyName"),j(a.table.taxonomyHeaders,a.table.termHeaders,"taxonomyName"),i(a.table.taxonomyHeaders,a.table.vocabularyHeaders)}}),a.updateCriteria=function(b,d,e,g){var h=a.bucket.startsWith("dce")?"dceId":"id",i={varItem:f.createCriteriaItem(QUERY_TARGETS.VARIABLE,d.taxonomyName,d.vocabularyName,d.entity.name)};if(b){var j=a.bucket.split("-")[0];if("dce"===j&&b.endsWith(":.")){j="study";var k=b.split(":")[0];i.item=f.createCriteriaItem(z[j],"Mica_"+z[j],"id",k)}else i.item=f.createCriteriaItem(z[j],"Mica_"+z[j],h,b)}else a.bucket.endsWith("individual")?i.item=f.createCriteriaItem(QUERY_TARGETS.STUDY,"Mica_"+QUERY_TARGETS.STUDY,"className","Study"):a.bucket.endsWith("harmonization")?i.item=f.createCriteriaItem(QUERY_TARGETS.STUDY,"Mica_"+QUERY_TARGETS.STUDY,"className","HarmonizationStudy"):a.bucket.endsWith("collected")?i.item=f.createCriteriaItem(QUERY_TARGETS.DATASET,"Mica_"+QUERY_TARGETS.DATASET,"className","StudyDataset"):a.bucket.endsWith("harmonized")&&(i.item=f.createCriteriaItem(QUERY_TARGETS.DATASET,"Mica_"+QUERY_TARGETS.DATASET,"className","HarmonizationDataset"));c.all(i).then(function(b){a.onUpdateCriteria(b.varItem,g,!1,!0),b.item&&a.onUpdateCriteria(b.item,g),b.bucketItem&&a.onUpdateCriteria(b.bucketItem,g)})},a.isFullCoverageImpossibleOrCoverageAlreadyFull=function(){var b=a.table?a.table.rows||[]:[],c=0;return 0===b.length||(b.forEach(function(a){a.hits&&a.hits.filter(function(a){return 0===a}).length>0&&c++}),0===c||b.length===c)},a.selectFullAndFilter=function(){var b=[];a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.hits&&0===a.hits.filter(function(a){return 0===a}).length&&b.push(a)}),u(b,!0)},a.updateFilterCriteria=function(){u(a.table.rows.filter(function(a){return a.selected}))},a.removeTerm=function(b){var d=A[b.vocabularyName].filter(function(a){return a.entity.name!==b.entity.name}).map(function(a){return f.createCriteriaItem(QUERY_TARGETS.VARIABLE,a.taxonomyName,a.vocabularyName,a.entity.name)});c.all(d).then(function(b){a.onUpdateCriteria(w(b),null,!0,!1,!1)})},a.removeVocabulary=function(b){f.createCriteriaItem(QUERY_TARGETS.VARIABLE,b.taxonomyName,b.entity.name).then(function(b){a.onRemoveCriteria(b)})},y()}]).controller("GraphicsResultController",["GraphicChartsConfig","GraphicChartsUtils","RqlQueryService","$filter","$scope","D3GeoConfig","D3ChartConfig",function(a,b,c,d,e,f,g){e.hasChartObjects=function(){return e.chartObjects&&Object.keys(e.chartObjects).length>0};var h=function(a,c,d,e,f,g){return b.getArrayByAggregation(a,c).then(function(b){var c=b.map(function(a){return a.participantsNbr&&g?[a.title,a.value,a.participantsNbr]:[a.title,a.value]});if(c.length>0)return c.unshift(d),angular.extend(f,{title:e}),{data:c,entries:b,options:f,vocabulary:a}})},i=a.getOptions().ChartsOptions;e.updateCriteria=function(a,b){c.createCriteriaItem("study","Mica_study",b,a).then(function(a){e.onUpdateCriteria(a,"studies")})},e.$watch("result",function(a){e.chartObjects={},e.noResults=!0,a&&a.studyResultDto.totalHits&&(e.noResults=!1,h("populations-model-selectionCriteria-countriesIso",a.studyResultDto,[d("translate")(i.geoChartOptions.header[0]),d("translate")(i.geoChartOptions.header[1])],d("translate")(i.geoChartOptions.title)+" (N="+a.studyResultDto.totalHits+")",i.geoChartOptions.options).then(function(b){if(b){var c={geoChartOptions:{directiveTitle:b.options.title,headerTitle:d("translate")("graphics.geo-charts"),chartObject:{geoTitle:b.options.title,options:b.options,type:"GeoChart",vocabulary:b.vocabulary,data:b.data,entries:b.entries,d3Config:(new f).withData(b.entries).withTitle(d("translate")(i.geoChartOptions.title)+" (N="+a.studyResultDto.totalHits+")")}}};c.geoChartOptions.getTable=function(){return c.geoChartOptions.chartObject},angular.extend(e.chartObjects,c)}}),h("model-methods-design",a.studyResultDto,[d("translate")(i.studiesDesigns.header[0]),d("translate")(i.studiesDesigns.header[1])],d("translate")(i.studiesDesigns.title)+" (N="+a.studyResultDto.totalHits+")",i.studiesDesigns.options).then(function(b){if(b){var c=new g(b.vocabulary).withType("multiBarHorizontalChart").withTitle(d("translate")(i.studiesDesigns.title)+" (N="+a.studyResultDto.totalHits+")").withData(angular.copy(b.entries),!1,d("translate")("graphics.nbr-studies"));c.options.chart.showLegend=!1,c.options.chart.color=i.numberParticipants.options.colors;var f={studiesDesigns:{headerTitle:d("translate")("graphics.study-design"),chartObject:{options:b.options,type:"BarChart",data:b.data,vocabulary:b.vocabulary,entries:b.entries,d3Config:c}}};angular.extend(e.chartObjects,f)}}),h("model-methods-design",a.studyResultDto,[d("translate")(i.studiesDesigns.header[0]),d("translate")(i.studiesDesigns.header[1]),d("translate")(i.studiesDesigns.header[2])],d("translate")(i.studiesDesigns.title)+" (N="+a.studyResultDto.totalHits+")",i.studiesDesigns.options,!0).then(function(a){if(a){var b={chartObjectTable:{options:a.options,type:"BarChart",data:a.data,vocabulary:a.vocabulary,entries:a.entries}};b.getTable=function(){return b.chartObjectTable},angular.extend(e.chartObjects.studiesDesigns,b)}}),h("model-numberOfParticipants-participant-number-range",a.studyResultDto,[d("translate")(i.numberParticipants.header[0]),d("translate")(i.numberParticipants.header[1])],d("translate")(i.numberParticipants.title)+" (N="+a.studyResultDto.totalHits+")",i.numberParticipants.options).then(function(b){if(b){var c=new g(b.vocabulary).withType("pieChart").withTitle(d("translate")(i.numberParticipants.title)+" (N="+a.studyResultDto.totalHits+")").withData(angular.copy(b.entries),!0);c.options.chart.legendPosition="right",c.options.chart.color=i.numberParticipants.options.colors;var f={numberParticipants:{headerTitle:d("translate")("graphics.number-participants"),chartObject:{options:b.options,type:"PieChart",data:b.data,vocabulary:b.vocabulary,entries:b.entries,d3Config:c}}};f.numberParticipants.getTable=function(){return f.numberParticipants.chartObject},angular.extend(e.chartObjects,f)}}),h("populations-dataCollectionEvents-model-bioSamples",a.studyResultDto,[d("translate")(i.biologicalSamples.header[0]),d("translate")(i.biologicalSamples.header[1])],d("translate")(i.biologicalSamples.title)+" (N="+a.studyResultDto.totalHits+")",i.biologicalSamples.options).then(function(b){if(b){var c=new g(b.vocabulary).withType("multiBarHorizontalChart").withTitle(d("translate")(i.biologicalSamples.title)+" (N="+a.studyResultDto.totalHits+")").withData(angular.copy(b.entries),!1,d("translate")("graphics.nbr-studies"));c.options.chart.showLegend=!1,c.options.chart.color=i.numberParticipants.options.colors;var f={biologicalSamples:{headerTitle:d("translate")("graphics.bio-samples"),chartObject:{options:b.options,type:"BarChart",data:b.data,vocabulary:b.vocabulary,entries:b.entries,d3Config:c}}};f.biologicalSamples.getTable=function(){return f.biologicalSamples.chartObject},angular.extend(e.chartObjects,f)}}))})}]).controller("SearchResultPaginationController",["$scope",function(a){function b(){a.maxSize=Math.min(3,Math.ceil(a.totalHits/a.pagination.selected.value))}function c(){var b=a.pagination.selected.value,c=a.pagination.currentPage;a.pagination.from=b*(c-1)+1,a.pagination.to=Math.min(a.totalHits,b*c)}var d=function(){c(),a.onChange&&a.onChange(a.target,(a.pagination.currentPage-1)*a.pagination.selected.value,a.pagination.selected.value)},e=function(){b(),a.pagination.currentPage=1,d()};a.pageChanged=d,a.pageSizeChanged=e,a.pageSizes=[{label:"10",value:10},{label:"20",value:20},{label:"50",value:50},{label:"100",value:100}],a.pagination={selected:a.pageSizes[0],currentPage:1},a.$watch("totalHits",function(){b(),c()})}]);var CRITERIA_ITEM_EVENT={deleted:"event:delete-criteria-item",refresh:"event:refresh-criteria-item"};angular.module("obiba.mica.search").directive("taxonomyPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomy:"=",lang:"=",onNavigate:"="},templateUrl:"search/views/classifications/taxonomy-panel-template.html"}}]).directive("vocabularyPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",lang:"=",onNavigate:"=",onSelect:"=",onHideSearchNavigate:"=",isInHideNavigate:"="},templateUrl:"search/views/classifications/vocabulary-panel-template.html"}}]).directive("termPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",term:"=",lang:"=",onSelect:"="},templateUrl:"search/views/classifications/term-panel-template.html"}}]).directive("networksResultTable",["PageUrlService","ngObibaMicaSearch","RqlQueryService","StudyFilterShortcutService","ngObibaMicaSearchTemplateUrl",function(a,b,c,d,e){return{restrict:"EA",replace:!0,scope:{summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:e.getTemplateUrl("searchNetworksResultTable"),link:function(e){function f(){d.getStudyClassNameChoices().then(function(a){angular.extend(e,a),e.colSpans={datasets:(e.optionsCols.showNetworksStudyDatasetColumn&e.choseIndividual())+(e.optionsCols.showNetworksHarmonizationDatasetColumn&e.choseHarmonization()),variables:(e.optionsCols.showNetworksStudyVariablesColumn&e.choseIndividual())+(e.optionsCols.showNetworksDataschemaVariablesColumn&e.choseHarmonization())}})}e.options=b.getOptions().networks,e.optionsCols=e.options.networksColumn,e.PageUrlService=a,e.$on("$locationChangeSuccess",function(){f()}),e.updateCriteria=function(a,b,d){var f;"HarmonizationDataset"!==b&&"StudyDataset"!==b||(f=b,b="datasets");var g;"HarmonizationStudy"!==b&&"Study"!==b||(g=b,b="studies");var h;"DataschemaVariable"!==b&&"CollectedVariable"!==b||(h=b.replace("Variable",""),b="variables"),b=d?d:b,c.createCriteriaItem("network","Mica_network","id",a).then(function(a){f?c.createCriteriaItem("dataset","Mica_dataset","className",f).then(function(c){e.onUpdateCriteria(a,b),e.onUpdateCriteria(c,b)}):g?c.createCriteriaItem("study","Mica_study","className",g).then(function(c){e.onUpdateCriteria(a,b),e.onUpdateCriteria(c,b)}):h?c.createCriteriaItem("variable","Mica_variable","variableType",h).then(function(c){e.onUpdateCriteria(a,b),e.onUpdateCriteria(c,b)}):e.onUpdateCriteria(a,b)})},f()}}}]).directive("datasetsResultTable",["$log","PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService",function(a,b,c,d,e){return{restrict:"EA",replace:!0,scope:{summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:"search/views/list/datasets-search-result-table-template.html",link:function(f){f.classNames={},d.get({target:"dataset",taxonomy:"Mica_dataset"}).$promise.then(function(b){b.vocabularies?f.classNames=b.vocabularies.filter(function(a){return"className"===a.name})[0].terms.reduce(function(a,b){return a[b.name]=b.title.map(function(a){return{lang:a.locale,value:a.text}}),a},{}):a.warn("Taxonomy has no vocabularies")}),f.updateCriteria=function(a,b){e.createCriteriaItem("dataset","Mica_dataset","id",a).then(function(a){f.onUpdateCriteria(a,b)})},f.options=c.getOptions().datasets,f.optionsCols=f.options.datasetsColumn,f.PageUrlService=b}}}]).directive("studyFilterShortcut",["$location","$translate","RqlQueryService","StudyFilterShortcutService",function(a,b,c,d){return{restrict:"EA",replace:!0,templateUrl:"search/views/search-study-filter-template.html",link:function(a){function c(a){d.filter(a,b.use())}function e(){d.getStudyClassNameChoices().then(function(b){b.choseAll()?a.studyFilterSelection._selection=STUDY_FILTER_CHOICES.ALL_STUDIES:b.choseIndividual()?a.studyFilterSelection._selection=STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:b.choseHarmonization()&&(a.studyFilterSelection._selection=STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES)})}a.studyFilterSelection={get selection(){return this._selection},set selection(a){this._selection=a,c(a)}},a.$on("$locationChangeSuccess",function(){e()}),e()}}}]).directive("studiesResultTable",["$log","$q","$location","PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService","LocalizedValues","ngObibaMicaSearchTemplateUrl","StudyFilterShortcutService",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:i.getTemplateUrl("searchStudiesResultTable"),link:function(c){function i(a){j.filter(a,c.lang)}function k(){j.getStudyClassNameChoices().then(function(a){angular.extend(c,a)})}function l(){Object.keys(c.taxonomy).length<1||!c.taxonomy.vocabularies||Object.keys(c.datasourceTitles).length>0||c.taxonomy.vocabularies.some(function(a){return"populations-dataCollectionEvents-dataSources"===a.name&&(a.terms.forEach(function(a){c.datasourceTitles[a.name]={title:h.forLocale(a.title,c.lang)}}),!0)})}b.all([f.get({target:"study",taxonomy:"Mica_study"})]).then(function(b){var d=b[0];c.taxonomy=d,l(),d.vocabularies?c.designs=d.vocabularies.filter(function(a){return"methods-design"===a.name})[0].terms.reduce(function(a,b){return a[b.name]=b.title.map(function(a){return{lang:a.locale,value:a.text}}),a},{}):a.warn("Taxonomy has no vocabularies"),k()}),c.taxonomy={},c.designs={},c.datasourceTitles={},c.studyFilterSelection={get selection(){return this._selection},set selection(a){this._selection=a,i(a)}},c.$on("$locationChangeSuccess",function(){k()}),c.$watch("lang",l),c.hasDatasource=function(a,b){return a&&a.indexOf(b)>-1},c.options=e.getOptions().studies,c.optionsCols=c.options.studiesColumn,c.PageUrlService=d,c.updateCriteria=function(a,b,d){var e;"HarmonizationDataset"!==b&&"StudyDataset"!==b||(e=b,b="datasets");var f;"HarmonizationStudy"!==b&&"Study"!==b||(f=b,b="studies");var h;"DataschemaVariable"!==b&&"CollectedVariable"!==b||(h=b.replace("Variable",""),b="variables"),b=d?d:b,g.createCriteriaItem("study","Mica_study","id",a).then(function(a){e?g.createCriteriaItem("dataset","Mica_dataset","className",e).then(function(d){c.onUpdateCriteria(a,b),c.onUpdateCriteria(d,b)}):f?g.createCriteriaItem("study","Mica_study","className",f).then(function(d){c.onUpdateCriteria(a,b),c.onUpdateCriteria(d,b)}):h?g.createCriteriaItem("variable","Mica_variable","variableType",h).then(function(d){c.onUpdateCriteria(a,b),c.onUpdateCriteria(d,b)}):c.onUpdateCriteria(a,b)})}}}}]).directive("variablesResultTable",["PageUrlService","ngObibaMicaSearch",function(a,b){return{restrict:"EA",replace:!0,scope:{summaries:"=",loading:"="},templateUrl:"search/views/list/variables-search-result-table-template.html",link:function(c){c.options=b.getOptions().variables,c.optionsCols=c.options.variablesColumn,c.PageUrlService=a}}}]).directive("coverageResultTable",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",bucket:"=",query:"=",criteria:"=",onUpdateCriteria:"=",onRemoveCriteria:"="},controller:"CoverageResultTableController",templateUrl:"search/views/coverage/coverage-search-result-table-template.html"}}]).directive("graphicsResult",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",onUpdateCriteria:"="},controller:"GraphicsResultController",templateUrl:"search/views/graphics/graphics-search-result-template.html"}}]).directive("includeReplace",function(){return{require:"ngInclude",link:function(a,b){b.replaceWith(b.children())}}}).directive("scrollToTop",function(){return{restrict:"A",scope:{trigger:"=scrollToTop"},link:function(a,b){a.$watch("trigger",function(){b[0].scrollTop=0})}}}).directive("resultPanel",[function(){return{restrict:"EA",replace:!0,scope:{type:"=",bucket:"=",query:"=",criteria:"=",display:"=",result:"=",lang:"=",loading:"=",searchTabsOrder:"=",resultTabsOrder:"=",onTypeChanged:"=",onBucketChanged:"=",onPaginate:"=",onUpdateCriteria:"=",onRemoveCriteria:"="},controller:"SearchResultController",templateUrl:"search/views/search-result-panel-template.html"}}]).directive("criteriaRoot",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"=",onRemove:"=",onRefresh:"="},templateUrl:"search/views/criteria/criteria-root-template.html",link:function(a){a.$on(CRITERIA_ITEM_EVENT.deleted,function(b,c){a.onRemove(c)}),a.$on(CRITERIA_ITEM_EVENT.refresh,function(){a.onRefresh()})}}}]).directive("criteriaTarget",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},templateUrl:"search/views/criteria/criteria-target-template.html"}}]).directive("criteriaNode",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},controller:"CriterionLogicalController",templateUrl:"search/views/criteria/criteria-node-template.html"}}]).directive("criteriaLeaf",["CriteriaNodeCompileService",function(a){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},controller:"CriterionLogicalController",link:function(b,c){a.compile(b,c)}}}]).directive("numericCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"NumericCriterionController",templateUrl:"search/views/criteria/criterion-numeric-template.html"}}]).directive("criterionDropdown",["$document","$timeout",function(a,b){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"="},controller:"CriterionDropdownController",templateUrl:"search/views/criteria/criterion-dropdown-template.html",link:function(c,d){var e=function(a){document.querySelector("#"+c.criterion.id.replace(".","-")+"-dropdown-"+c.timestamp).contains(a.target)||b(function(){c.$apply("closeDropdown()")})};a.on("click",e),d.on("$destroy",function(){a.off("click",e)})}}}]).directive("stringCriterionTerms",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"StringCriterionTermsController",templateUrl:"search/views/criteria/criterion-string-terms-template.html"}}]).directive("matchCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"MatchCriterionTermsController",templateUrl:"search/views/criteria/criterion-match-template.html"}}]).directive("searchResultPagination",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",totalHits:"=",onChange:"="},controller:"SearchResultPaginationController",templateUrl:"search/views/list/search-result-pagination-template.html"}}]).directive("taxonomiesFacetsPanel",[function(){return{restrict:"EA",scope:{facetedTaxonomies:"=",onRefresh:"=",onSelectTerm:"=",lang:"=",criteria:"="},controller:"TaxonomiesFacetsController",templateUrl:"search/views/classifications/taxonomies-facets-view.html"}}]).directive("taxonomiesPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomyName:"=",target:"=",onClose:"=",onSelectTerm:"=",taxonomiesShown:"=",lang:"="},controller:"TaxonomiesPanelController",templateUrl:"search/views/classifications/taxonomies-view.html",link:function(a,b){a.closeTaxonomies=function(){b.collapse("hide"),a.onClose()},a.showTaxonomies=function(){b.collapse("show")},b.on("show.bs.collapse",function(){a.taxonomiesShown=!0}),b.on("hide.bs.collapse",function(){a.taxonomiesShown=!1}),a.$watch("taxonomiesShown",function(a){a?b.collapse("show"):b.collapse("hide")})}}}]).directive("classificationsPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",onSelectTerm:"=",isHistoryEnabled:"=",lang:"="},controller:"ClassificationPanelController",templateUrl:"search/views/classifications/classifications-view.html"}}]).factory("Fullscreen",["$document","$window","$rootScope",function(a,b,c){var d=a[0],e=void 0!==b.Element&&"ALLOW_KEYBOARD_INPUT"in b.Element&&b.Element.ALLOW_KEYBOARD_INPUT,f=c.$new(),g={$on:angular.bind(f,f.$on),enable:function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?/Version\/[\d]{1,2}(\.[\d]{1,2}){1}(\.(\d){1,2}){0,1} Safari/.test(b.navigator.userAgent)?a.webkitRequestFullscreen():a.webkitRequestFullscreen(e):a.msRequestFullscreen&&a.msRequestFullscreen()},cancel:function(){d.cancelFullScreen?d.cancelFullScreen():d.mozCancelFullScreen?d.mozCancelFullScreen():d.webkitExitFullscreen?d.webkitExitFullscreen():d.msExitFullscreen&&d.msExitFullscreen()},isEnabled:function(){return!!(d.fullscreenElement||d.mozFullScreenElement||d.webkitFullscreenElement||d.msFullscreenElement)}};return a.on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){f.$emit("ngObibaMicaSearch.fullscreenChange",g.isEnabled())}),g}]).directive("fullscreen",["Fullscreen",function(a){return{link:function(b,c,d){d.fullscreen&&b.$watch(d.fullscreen,function(b){var d=a.isEnabled();b&&!d?(a.enable(c[0]),c.addClass("isInFullScreen")):!b&&d&&(a.cancel(),c.removeClass("isInFullScreen"))})}}}]),angular.module("obiba.mica.search").config(["$routeProvider",function(a){a.when("/search",{templateUrl:"search/views/search.html",controller:"SearchController",reloadOnSearch:!1}).when("/classifications",{templateUrl:"search/views/classifications.html",controller:"SearchController",reloadOnSearch:!1})}]),angular.module("obiba.mica.graphics",["obiba.graphics","obiba.utils","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("GraphicChartsData",GraphicChartsDataProvider)}]).run(["GraphicChartsConfigurations",function(a){a.setClientConfig()}]),angular.module("obiba.mica.graphics").directive("obibaChart",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"=",chartType:"=",chartAggregationName:"=",chartEntityDto:"=",chartOptionsName:"=",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTitleGraph:"=",chartSelectGraphic:"="},templateUrl:"graphics/views/charts-directive.html",controller:"GraphicChartsController"}}]).directive("obibaTable",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"=",chartType:"@",chartAggregationName:"=",chartEntityDto:"=",chartOptionsName:"=",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTitleGraph:"=",chartSelectGraphic:"=",chartOrdered:"=",chartNotOrdered:"="},templateUrl:"graphics/views/tables-directive.html",controller:"GraphicChartsController"}}]),angular.module("obiba.mica.graphics").controller("GraphicChartsController",["$rootScope","$scope","$filter","$window","GraphicChartsConfig","GraphicChartsUtils","GraphicChartsData","RqlQueryService","ngObibaMicaUrl","D3GeoConfig","D3ChartConfig",function(a,b,c,d,e,f,g,h,i,j,k){function l(){b.chartObject={},g.getData(function(a){a&&f.getArrayByAggregation(b.chartAggregationName,a[b.chartEntityDto]).then(function(f){var g=f.map(function(a){return a.participantsNbr?[a.title,a.value,a.participantsNbr]:[a.title,a.value]});b.updateCriteria=function(a,b){h.createCriteriaItem("study","Mica_study",b,a).then(function(a){var b=e.getOptions().entityType,c=e.getOptions().entityIds,f=a.id.split("."),g=i.getUrl("GraphicsSearchRootUrl")+"?type=studies&query="+b+"(in(Mica_"+b+".id,"+c+")),study(in("+f[0]+"."+f[1]+","+f[2].replace(":","%253A")+"))";d.location.href=i.getUrl("BaseUrl")+g})},g&&(null!==/^Table-/.exec(b.chartType)?(b.chartObject.ordered=b.chartOrdered,b.chartObject.notOrdered=b.chartNotOrdered,b.chartHeader.length<3?b.chartObject.header=[c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])]:b.chartObject.header=[c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1]),c("translate")(b.chartHeader[2])],b.chartObject.type=b.chartType,b.chartObject.data=g,b.chartObject.vocabulary=b.chartAggregationName,b.chartObject.entries=f,b.chartObject.getTable=function(){return b.chartObject}):(b.chartHeader.length<3?g.unshift([c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])]):(g.map(function(a){return a.pop(),a}),g.unshift([c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])])),b.chartObject.term=!0,b.chartObject.type=b.chartType,b.chartObject.data=g,b.chartObject.options={backgroundColor:{fill:"transparent"}},angular.extend(b.chartObject.options,b.chartOptions),b.chartObject.options.title=c("translate")(b.chartTitleGraph)+" (N="+a.studyResultDto.totalHits+")",b.$parent.directive={title:b.chartObject.options.title})),"GeoChart"===b.chartType?(b.chartObject.d3Config=(new j).withData(f).withTitle(b.chartObject.options.title),b.chartObject.options&&b.chartObject.options.colorAxis&&b.chartObject.options.colorAxis.colors&&b.chartObject.d3Config.withColor(b.chartObject.options.colorAxis.colors)):(b.chartObject.d3Config=new k(b.chartAggregationName).withType("PieChart"===b.chartType?"pieChart":"multiBarHorizontalChart").withData(f,"PieChart"===b.chartType,c("translate")("graphics.nbr-studies")).withTitle(c("translate")(b.chartTitleGraph)+" (N="+a.studyResultDto.totalHits+")"),"PieChart"!==b.chartType&&(b.chartObject.d3Config.options.chart.showLegend=!1),b.chartObject.options&&b.chartObject.options.colors&&(b.chartObject.d3Config.options.chart.color=b.chartOptions.colors),b.chartObject.d3Config.options.chart.legendPosition="right",b.chartObject.d3Config.options.chart.legend={margin:{top:0,right:10,bottom:0,left:0}})})})}b.ready=!0,b.$watch("chartAggregationName",function(){b.chartAggregationName&&l()})}]),angular.module("obiba.mica.graphics").factory("GraphicChartsDataResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("JoinQuerySearchResource"),{},{studies:{method:"GET",errorHandler:!0,params:{type:"studies"}}})}]).service("GraphicChartsConfig",function(){var a={options:{entityIds:"NaN",entityType:null,ChartsOptions:{geoChartOptions:{header:["graphics.country","graphics.nbr-studies"],title:"graphics.geo-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#e5edfb","#cfddf5","#b8cbed","#a0b8e2","#88a4d4"]}},studiesDesigns:{header:["graphics.study-design","graphics.nbr-studies","graphics.number-participants"],title:"graphics.study-design-chart-title",options:{bars:"horizontal",series:{0:{axis:"nbrStudies"},1:{axis:"nbrParticipants"}},axes:{x:{nbrStudies:{side:"top",label:"Number of Studies"},nbrParticipants:{label:"Number of Participants"}}},backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"]}},numberParticipants:{header:["graphics.number-participants","graphics.nbr-studies"],title:"graphics.number-participants-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"],pieSliceTextStyle:{color:"#000000"}}},biologicalSamples:{header:["graphics.bio-samples","graphics.nbr-studies"],title:"graphics.bio-samples-chart-title",options:{bars:"horizontal",series:{0:{axis:"nbrStudies"}},axes:{x:{nbrStudies:{side:"top",label:"Number of Studies"}}},backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"]}}}}};return a.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a.options&&(a.options[c]=b[c])})},a.getOptions=function(){return angular.copy(a.options)},a}).service("GraphicChartsUtils",["LocalizedValues","TaxonomyResource","RqlQueryUtils","$q","$translate",function(a,b,c,d,e){var f={};f.getTerms=function(a){function e(){var b=null;f.vocabularies&&angular.forEach(f.vocabularies,function(d){c.vocabularyAlias(d)===a&&(b=d.terms)}),g.resolve(b)}var g=d.defer();return f.vocabularies?e():b.get({target:"study",taxonomy:"Mica_study"}).$promise.then(function(a){f.vocabularies=angular.copy(a.vocabularies),e()}),g.promise},this.getArrayByAggregation=function(b,c){var g=d.defer();b&&c||g.resolve([]);var h=[];return f.getTerms(b).then(function(d){var f=d,i=0;angular.forEach(c.aggs,function(c){if(c.aggregation===b)if(c["obiba.mica.RangeAggregationResultDto.ranges"])i=0,angular.forEach(f,function(b){angular.forEach(c["obiba.mica.RangeAggregationResultDto.ranges"],function(c){b.name===c.key&&c.count&&(h[i]={title:a.forLocale(b.title,e.use()),value:c.count,key:c.key},i++)})});else{if("populations-model-selectionCriteria-countriesIso"===c.aggregation){var d=e.use();f.sort(function(b,c){var e=a.forLocale(b.title,d),f=a.forLocale(c.title,d);return e<f?-1:e>f?1:0})}var g=0;i=0,angular.forEach(f,function(b){angular.forEach(c["obiba.mica.TermsAggregationResultDto.terms"],function(d){b.name===d.key&&d.count&&("model-methods-design"===c.aggregation?(angular.forEach(d.aggs,function(b){if("model-numberOfParticipants-participant-number"===b.aggregation){var c=b["obiba.mica.StatsAggregationResultDto.stats"];g=a.formatNumber(c?c.data.sum:0)}}),h[i]={title:a.forLocale(b.title,e.use()),value:d.count,participantsNbr:g,key:d.key}):h[i]={title:a.forLocale(b.title,e.use()),value:d.count,key:d.key},i++)})})}}),g.resolve(h)}),g.promise}}]).service("GraphicChartsQuery",["RqlQueryService","RqlQueryUtils","LocalizedValues",function(a,b,c){this.queryDtoBuilder=function(d,e){var f;d&&"NaN"!==d||(f="study(exists(Mica_study.id))"),e&&"NaN"!==d&&(f=e+"(in(Mica_"+e+".id,("+d+")))");var g=angular.copy(a.parseQuery(f));b.addLocaleQuery(g,c.getLocal());var h=(new RqlQuery).serializeArgs(g.args);return a.prepareGraphicsQuery(h,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-design"])}}]),angular.module("obiba.mica.localized",["obiba.notification","pascalprecht.translate","templates-ngObibaMica"]),angular.module("obiba.mica.localized").directive("localized",["LocalizedValues",function(a){return{restrict:"AE",scope:{value:"=",lang:"=",ellipsisSize:"=",markdownIt:"=",keyLang:"@",keyValue:"@"},templateUrl:"localized/localized-template.html",link:function(b){b.keyLang=b.keyLang||"lang",b.keyValue=b.keyValue||"value",b.LocalizedValues=a}}}]).directive("localizedNumber",["LocalizedValues",function(a){return{restrict:"E",scope:{number:"=value"},template:"{{LocalizedValues.formatNumber(number)}}",link:function(b){b.LocalizedValues=a}}}]).directive("localizedInput",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",customValidator:"="},templateUrl:"localized/localized-input-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]),0===a.model.filter(function(b){if(b.lang===a.lang)return b}).length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedInputGroup",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",remove:"=",customValidator:"="},templateUrl:"localized/localized-input-group-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]),0===a.model.filter(function(b){if(b.lang===a.lang)return b}).length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedTextarea",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",rows:"@",customValidator:"="},templateUrl:"localized/localized-textarea-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]),0===a.model.filter(function(b){if(b.lang===a.lang)return b}).length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]),angular.module("obiba.mica.localized").service("LocalizedValues",function(){var a=this;this.for=function(b,c,d,e){if(angular.isArray(b)){var f=b.filter(function(a){return a[d]===c});if(f&&f.length>0)return f[0][e];var g=b.map(function(a){return a[d]});if(g.length>0)return a.for(b,1===g.length?g[0]:"en",d,e)}else if(angular.isObject(b))return a.for(Object.keys(b).map(function(a){return{lang:a,value:b[a]}}),c,d,e);return""},this.forLocale=function(a,b){var c=this.for(a,b,"locale","text");return""===c&&(c=this.for(a,"und","locale","text")),c},this.forLang=function(a,b){var c=this.for(a,b,"lang","value");return""===c&&(c=this.for(a,"und","lang","value")),c},this.getLocal=function(){return"en"},this.formatNumber=function(a){return void 0===a&&null===a&&"number"!=typeof a?a:a.toLocaleString(this.getLocal())},this.arrayToObject=function(a){var b={};return a&&a.forEach(function(a){b[a.lang]=a.value}),b},this.objectToArray=function(a,b){var c=[];if(a){var d=b?b:Object.keys(a);d&&d.forEach(function(b){c.push({lang:b,value:a[b]})})}return 0===c.length?void 0:c}}).service("LocalizedSchemaFormService",["$filter",function(a){this.translate=function(a){return a?"string"==typeof a?this.translateString(a):"object"==typeof a?Array.isArray(a)?this.translateArray(a):this.translateObject(a):a:a},this.translateObject=function(a){if(!a)return a;for(var b in a)a.hasOwnProperty(b)&&("string"==typeof a[b]?a[b]=this.translateString(a[b]):"object"==typeof a[b]&&(Array.isArray(a[b])?a[b]=this.translateArray(a[b]):a[b]=this.translateObject(a[b])));return a},this.translateArray=function(a){if(!a)return a;var b=this;return a.map(function(a){return b.translate(a)}),a},this.translateString=function(b){return b?b.replace(/t\(([^\)]+)\)/g,function(b,c){return a("translate")(c)}):b}}]),angular.module("obiba.mica.localized").filter("localizedNumber",["LocalizedValues",function(a){return function(b){return 0===b?0:b?a.formatNumber(b):""}}]),angular.module("obiba.mica.fileBrowser",["pascalprecht.translate","ui.bootstrap","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaFileBrowserOptions",new NgObibaMicaFileBrowserOptionsProvider)}]),angular.module("obiba.mica.fileBrowser").directive("fileBrowser",[function(){return{restrict:"EA",replace:!0,controller:"FileBrowserController",scope:{docPath:"@",docId:"@",tokenKey:"@",subject:"="},templateUrl:"file-browser/views/file-browser-template.html"}}]),angular.module("obiba.mica.fileBrowser").controller("FileBrowserController",["$rootScope","$scope","$log","$filter","StringUtils","FileBrowserService","BrowserBreadcrumbHelper","AlertService","ServerErrorUtils","FileBrowserFileResource","FileBrowserSearchResource","ngObibaMicaFileBrowserOptions","FileBrowserDownloadService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){b.data.search.text=null,b.data.search.active=!1}function o(a,d){var e;b.data.search.active=!1,e=d?{path:a,keyToken:d}:{path:a},j.get(e,function(e){c.info(e),b.pagination.selected=-1,b.data.document=b.data.details.document=e,b.data.document.children||(b.data.document.children=[]),d&&(b.data.document.keyToken=d),b.data.document.path===b.data.rootPath&&(b.data.document.children=b.data.document.children.filter(function(a){return l.folders.excludes.indexOf(a.name)<0}),b.data.document.size=b.data.document.children.length),b.data.breadcrumbs=g.toArray(a,b.data.rootPath),b.data.isFile=f.isFile(e),b.data.isRoot=f.isRoot(e)},v)}function p(a,b,c){a.stopPropagation();var d=b.path;d=0===d.lastIndexOf("/")?"/":d.substring(0,d.lastIndexOf("/")),t(d,c)}function q(){if(!b.data.isRoot&&b.data.document){var a=b.data.document.path.replace(/\\/g,"/").replace(/\/[^\/]*$/,"");o(a?a:"/")}}function r(){b.pagination.selected=-1,b.data.details.show=!1}function s(a,d){function e(b){var c="";try{var d=[];l.folders.excludes.forEach(function(b){var c=a.replace(/\//g,"\\/")+"\\/"+b.replace(/\s/,"\\ ");d.push(c),d.push(c+"\\/*")}),c=d.length>0?"NOT path:("+d.join(" OR ")+")":""}catch(a){}return b?b+" AND "+c:c}d.query=e(d.query);var f=angular.extend({},{path:a},d);k.search(f,function(a){c.info("Search result",a);var d=b.data.document?angular.copy(b.data.document):{};d.children=a,b.data.document=d},function(a){c.debug("ERROR:",a)})}var t=function(a,b){n(),o(a,b)},u=function(a,b,c){a.stopPropagation(),b&&t(b.path,c)},v=function(a){h.alert({id:"FileSystemController",type:"danger",msg:i.buildMessage(a)}),403!==a.status&&b.data.document&&u(b.data.document)},w=function(a){b.data.search.active=!0,r();var c=b.data.search.recursively,d=null,e=null,f=999;switch(b.data.search.query=a,a){case"RECENT":a="",d="desc",e="lastModifiedDate",f=10}var g={query:a,recursively:c,sort:e,order:d,limit:f};s(b.data.document.path,g)},x=function(){b.data.search.recursively=!b.data.search.recursively,b.data.search.text?w(b.data.search.text):b.data.search.query&&w(b.data.search.query)},y=function(){n(),o(b.data.document.path)},z=function(a){switch(a.keyCode){case 13:b.data.search.text?w(b.data.search.text):y();break;case 27:b.data.search.active&&y()}},A=function(a,c){b.pagination.selected=c,b.data.details.document=a,b.data.details.show=!0},B=function(a){return f.isFile(a)&&a.attachment.type?a.attachment.type.split(/,|\s+/):[]},C=function(a){return f.getLocalizedValue(a,l.locale)},D=function(a){return f.hasLocalizedValue(a,l.locale)};b.downloadTarget=l.downloadInline?"_blank":"_self",b.getDownloadUrl=m.getUrl,b.screen=a.screen,b.truncate=e.truncate,b.getDocumentIcon=f.getDocumentIcon,b.navigateToPath=t,b.navigateTo=u,b.navigateBack=q,b.navigateToParent=p,b.clearSearch=y,b.searchDocuments=w,b.toggleRecursively=x,b.searchKeyUp=z,b.isFile=f.isFile,b.isRoot=f.isRoot,b.getLocalizedValue=C,b.hasLocalizedValue=D,b.hideDetails=r,b.showDetails=A,b.getTypeParts=B,b.pagination={selected:-1,currentPage:1,itemsPerPage:20},b.data={keyToken:null,details:{document:null,show:!1},docRootIcon:null,rootPath:null,document:null,accesses:[],search:{text:null,active:!1,recursively:!0},breadcrumbs:null,isFile:!1,isRoot:!1,editDescField:!1},b.$watchGroup(["docPath","docId"],function(){b.docPath&&b.docId&&(b.data.docRootIcon=g.rootIcon(b.docPath),b.data.rootPath=b.docPath+("null"!==b.docId?"/"+b.docId:""),b.tokenKey?o(b.data.rootPath,b.tokenKey,null):o(b.data.rootPath,null))})}]),angular.module("obiba.mica.fileBrowser").factory("FileBrowserFileResource",["$resource","ngObibaMicaUrl",function(a,b){var c=b.getUrl("FileBrowserFileResource");return console.log("PATH>",c),a(c,{path:"@path",keyToken:"@keyToken"},{get:{method:"GET",errorHandler:!0}})}]).factory("FileBrowserSearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("FileBrowserSearchResource"),{path:"@path"},{search:{method:"GET",isArray:!0,errorHandler:!0}})}]).service("FileBrowserDownloadService",["ngObibaMicaUrl","ngObibaMicaFileBrowserOptions",function(a,b){return this.getUrl=function(c,d){var e=a.getUrl("FileBrowserDownloadUrl").replace(/:path/,c).replace(/:inline/,b.downloadInline);return e=d?e.replace(/:key/,d):e.replace(/:key/,"")},this}]).service("FileBrowserService",[function(){this.isFile=function(a){return a&&"FILE"===a.type},this.isRoot=function(a){return a&&"/"===a.path},this.getLocalizedValue=function(a,b){if(!a)return null;var c=a.filter(function(a){return a.lang===b});return c&&c.length>0?c[0].value:null},this.hasLocalizedValue=function(a,b){var c=this.getLocalizedValue(a,b);return null!==c&&c.trim().length>0},this.getDocumentIcon=function(a){if(!a)return"";if("FOLDER"===a.type)return"fa-folder";var b=a.path.match(/\.(\w+)$/);if(b&&b.length>1)switch(b[1].toLowerCase()){case"doc":case"docx":case"odm":case"gdoc":return"fa-file-word-o";case"xls":case"xlsx":return"fa-file-excel-o";case"pdf":return"fa-file-pdf-o";case"ppt":case"odt":return"fa-file-powerpoint-o";case"xt":return"fa-file-text-o"}return"fa-file"}}]).service("BrowserBreadcrumbHelper",[function(){this.toArray=function(a,b){if(a){a=a.replace(b,"");var c=a.replace(/\/$/,"").split("/").slice(1),d=[],e=null;return c.forEach(function(a){e=(null===e?b:e)+"/"+a,d.push({name:a,path:e})}),d}return[{name:"",path:""}]},this.rootIcon=function(a){var b=/^\/([^\/]*)/.exec(a);switch(b?b[1]:""){case"study":return"i-obiba-study";case"network":return"i-obiba-network";case"study-dataset":return"i-obiba-study-dataset";case"harmonization-dataset":return"i-obiba-harmo-dataset";default:return"fa fa-hdd-o"}}}]),angular.module("templates-ngObibaMica",["access/views/data-access-request-documents-view.html","access/views/data-access-request-form.html","access/views/data-access-request-history-view.html","access/views/data-access-request-list.html","access/views/data-access-request-print-preview.html","access/views/data-access-request-profile-user-modal.html","access/views/data-access-request-submitted-modal.html","access/views/data-access-request-validation-modal.html","access/views/data-access-request-view.html","attachment/attachment-input-template.html","attachment/attachment-list-template.html","file-browser/views/document-detail-template.html","file-browser/views/documents-table-template.html","file-browser/views/file-browser-template.html","file-browser/views/toolbar-template.html","graphics/views/charts-directive.html","graphics/views/tables-directive.html","localized/localized-input-group-template.html","localized/localized-input-template.html","localized/localized-template.html","localized/localized-textarea-template.html","search/views/classifications.html","search/views/classifications/classifications-view.html","search/views/classifications/taxonomies-facets-view.html","search/views/classifications/taxonomies-view.html","search/views/classifications/taxonomy-accordion-group.html","search/views/classifications/taxonomy-panel-template.html","search/views/classifications/taxonomy-template.html","search/views/classifications/term-panel-template.html","search/views/classifications/vocabulary-accordion-group.html","search/views/classifications/vocabulary-panel-template.html","search/views/coverage/coverage-search-result-table-template.html","search/views/criteria/criteria-node-template.html","search/views/criteria/criteria-root-template.html","search/views/criteria/criteria-target-template.html","search/views/criteria/criterion-dropdown-template.html","search/views/criteria/criterion-header-template.html","search/views/criteria/criterion-match-template.html","search/views/criteria/criterion-numeric-template.html","search/views/criteria/criterion-string-terms-template.html","search/views/criteria/target-template.html","search/views/graphics/graphics-search-result-template.html","search/views/list/datasets-search-result-table-template.html","search/views/list/networks-search-result-table-template.html","search/views/list/pagination-template.html","search/views/list/search-result-pagination-template.html","search/views/list/studies-search-result-table-template.html","search/views/list/variables-search-result-table-template.html","search/views/search-result-coverage-template.html","search/views/search-result-graphics-template.html","search/views/search-result-list-dataset-template.html","search/views/search-result-list-network-template.html","search/views/search-result-list-study-template.html","search/views/search-result-list-template.html","search/views/search-result-list-variable-template.html","search/views/search-result-panel-template.html","search/views/search-study-filter-template.html","search/views/search.html","utils/views/unsaved-modal.html","views/pagination-template.html"]),angular.module("access/views/data-access-request-documents-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-documents-view.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <div class="help-block" ng-bind-html="config.documentsSectionHelpText || \'data-access-request.documents-help\' | translate"></div>\n\n  <div class="form-group">\n\n    <div class="panel panel-default" ng-show="showAttachmentsForm">\n      <div class="panel-body">\n        <attachment-input files="attachments" multiple="true" on-error="onAttachmentError"></attachment-input>\n\n        <div class="voffset2">\n          <a ng-click="cancelAttachments()" type="button" class="btn btn-default">\n            <span translate>cancel</span>\n          </a>\n\n          <a ng-click="updateAttachments()" type="button" class="btn btn-primary">\n            <span translate>save</span>\n          </a>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="showAttachmentsForm">\n      <p ng-if="dataAccessRequest.attachments.length == 0" class="voffset2" translate>\n        data-access-request.no-documents\n      </p>\n      <attachment-list files="dataAccessRequest.attachments"\n                       href-builder="getDownloadHref"></attachment-list>\n      <a ng-if="actions.canEditAttachments(dataAccessRequest)" ng-click="editAttachments()" type="button" class="btn btn-info">\n        <span translate>data-access-request.edit-documents</span>\n      </a>\n    </div>\n\n  </div>\n</div>')}]),angular.module("access/views/data-access-request-form.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-form.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="DataAccessRequestEditController"></obiba-alert>\n\n  <!-- \'ng-if\' does not bind the form to controller scope -->\n  <div ng-show="validForm">\n\n    <form name="form" role="form" novalidate class="ng-scope ng-invalid ng-invalid-required ng-dirty">\n      <div class="pull-right" ng-if="loaded">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n        <a ng-click="save()" type="button" class="btn btn-primary">\n          <span translate>save</span>\n        </a>\n\n        <a ng-click="validate(form)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <div sf-model="sfForm.model" sf-form="sfForm.definition" sf-schema="sfForm.schema" required="true" sf-options="sfOptions"></div>\n\n      <div class="pull-right" ng-if="loaded">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n      <a ng-click="save()" type="button" class="btn btn-primary">\n        <span translate>save</span>\n      </a>\n\n        <a ng-click="validate(form)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n    </form>\n\n    <div class="clearfix voffet2"></div>\n  </div>\n\n</div>\n')}]),angular.module("access/views/data-access-request-history-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-history-view.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<table id="data-access-request-history" class="table table-striped">\n  <thead>\n  <tr>\n    <th class="status-icon"></th>\n    <th translate>status</th>\n    <th translate>changed-by</th>\n    <th translate>changed-on</th>\n  </tr>\n  </thead>\n  <tbody>\n  <tr ng-repeat="status in dataAccessRequest.statusChangeHistory"\n    ng-init="info = getStatusHistoryInfo[getStatusHistoryInfoId(status)]">\n    <td><span><i class="{{info.icon}} hoffset"></i></span></td>\n    <td>{{info.msg}}</span></span></td>\n    <td>{{userProfileService.getFullName(status.profile) || status.author}}</td>\n    <td>\n      <span title="{{status.changedOn | amDateFormat: \'lll\'}}">\n        {{status.changedOn | amCalendar}}\n      </span>\n    </td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("access/views/data-access-request-list.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-list.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div id="data-access-request-list">\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <div class="row">\n    <div class="col-xs-12">\n      <a ng-href="#/data-access-request/new" class="btn btn-info">\n        <i class="fa fa-plus"></i>\n        <span>{{config.newRequestButtonCaption || \'data-access-request.add\' | translate}}</span>\n      </a>\n\n      <span ng-bind-html="config.newRequestButtonHelpText"></span>\n\n      <a ng-if="requests.length > 0" target="_self" download class="btn btn-info pull-right" ng-href="{{getCsvExportHref()}}">\n        <i class="fa fa-download"></i> {{\'report\' | translate}}\n      </a>\n    </div>\n  </div>\n\n  <p class="help-block" ng-if="requests.length == 0 && !loading">\n    <span translate>data-access-request.none</span>\n  </p>\n\n  <p ng-if="loading" class="voffset2 loading">\n  </p>\n\n  <div ng-if="requests.length > 0">\n    <div class="row voffset2">\n      <div class="col-xs-4">\n        <span class="input-group input-group-sm no-padding-top">\n          <span class="input-group-addon" id="data-access-requests-search"><i\n              class="glyphicon glyphicon-search"></i></span>\n          <input ng-model="searchText" type="text" class="form-control"\n              aria-describedby="data-access-requests-search">\n        </span>\n      </div>\n      <div class="col-xs-2">\n        <div class="input-group">\n          <ui-select id="status-select" theme="bootstrap"\n              ng-model="searchStatus.filter" reset-search-input="true">\n            <ui-select-match allow-clear="true"\n                placeholder="{{\'data-access-request.status-placeholder\' | translate}}">\n              <span ng-bind-html="$select.selected.translation"></span>\n            </ui-select-match>\n            <ui-select-choices repeat="data in REQUEST_STATUS">\n              {{data.translation}}\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n      <div class="col-xs-6">\n        <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n      </div>\n    </div>\n\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped">\n        <thead>\n        <tr>\n          <th>ID</th>\n          <th translate ng-if="showApplicant">data-access-request.applicant</th>\n          <th translate>data-access-request.title</th>\n          <th translate>data-access-request.lastUpdate</th>\n          <th translate>data-access-request.submissionDate</th>\n          <th translate>data-access-request.status</th>\n          <th translate>actions</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr\n            dir-paginate="request in requests | filter:{status: searchStatus.filter.key} : true | filter:searchText | itemsPerPage: 20">\n          <td>\n            <a ng-href="{{getDataAccessRequestPageUrl()}}#/data-access-request/{{request.id}}"\n                ng-if="actions.canView(request)" translate>{{request.id}}</a>\n            <span ng-if="!actions.canView(request)">{{request.id}}</span>\n          </td>\n          <td ng-if="showApplicant">\n            <span ng-if="!request.profile.attributes">\n              {{request.applicant}}\n            </span>\n            <span ng-if="request.profile.attributes && actions.canViewProfile(\'mica-user\') && !actions.canViewProfile(\'mica-data-access-officer\')">\n              {{getFullName(request.profile) || request.applicant}}\n            </span>\n            <a href ng-click="userProfile(request.profile)" ng-if="request.profile.attributes && actions.canViewProfile(\'mica-data-access-officer\')">\n              {{getFullName(request.profile) || request.applicant}}\n            </a>\n          </td>\n          <td>\n            {{request.title}}\n          </td>\n          <td>\n            <span title="{{(request.timestamps.lastUpdate || request.timestamps.created) | amDateFormat: \'lll\'}}">\n              {{(request.timestamps.lastUpdate || request.timestamps.created) | amCalendar}}\n            </span>\n\n          </td>\n          <td>\n            <span ng-if="request.submissionDate" title="{{ request.submissionDate | amDateFormat: \'lll\' }}">\n              {{request.submissionDate | amCalendar}}\n            </span>\n          </td>\n          <td>\n            {{request.status | translate}}\n          </td>\n          <td>\n            <ul class="list-inline">\n              <li ng-if="actions.canEdit(request)">\n                <a ng-href="#/data-access-request/{{request.id}}/edit"\n                    title="{{\'edit\' | translate}}"><i class="fa fa-pencil"></i></a>\n              </li>\n              <li>\n                <a ng-if="actions.canDelete(request)"\n                    ng-click="deleteRequest(request)"\n                    title="{{\'delete\' | translate}}"><i\n                    class="fa fa-trash-o"></i></a>\n              </li>\n            </ul>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n\n\n</div>\n')}]),angular.module("access/views/data-access-request-print-preview.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-print-preview.html",'<div ng-if="validForm">\n  <div class="clearfix"></div>\n\n  <div class="voffset2" ng-if="dataAccessRequest.project.permissions && dataAccessRequest.project.permissions.view">\n    <div ng-if="dataAccessRequest.project" class="pull-right">\n      <small class="help-block inline"> {{\'research-project.label\' | translate}} :\n        <a route-checker route-checker-hides-parent="true" href ng-href="#/project/{{dataAccessRequest.project.id}}">{{dataAccessRequest.project.id}}</a>\n      </small>\n    </div>\n  </div>\n\n  <div>\n    <form id="request-form" name="forms.requestForm">\n      <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema"></div>\n    </form>\n  </div>\n\n  <div ng-if="lastSubmittedDate">\n    <h3 translate>data-access-request.submissionDate</h3>\n    <p>{{lastSubmittedDate.changedOn | amDateFormat:\'dddd, MMMM Do YYYY\' | capitalizeFirstLetter}}</p>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-profile-user-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-profile-user-modal.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true"\n      ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      {{\'data-access-request.profile.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n\n    <table class="table table-bordered table-striped">\n      <tbody>\n      <tr>\n        <th>{{\'data-access-request.profile.name\' | translate}}</th>\n        <td>{{getFullName(applicant)}}</td>\n      </tr>\n      <tr>\n        <th>{{\'data-access-request.profile.email\' | translate}}</th>\n        <td>{{getProfileEmail(applicant)}}</td>\n      </tr>\n      <tr ng-repeat="attribute in applicant.attributes | filterProfileAttributes">\n          <th>{{\n              (\'userProfile.\' + attribute.key | translate) !== (\'userProfile.\' + attribute.key) ?\n              (\'userProfile.\' + attribute.key | translate) :\n              (attribute.key)\n              }}\n          </th>\n          <td>{{attribute.value}}</td>\n      </tr>\n      </tbody>\n    </table>\n\n    <a class="btn btn-default" ng-if="getProfileEmail(applicant)" href="mailto:{{getProfileEmail(applicant)}}" target="_blank">\n      {{\'data-access-request.profile.send-email\' | translate}}</a>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4"\n      ng-click="$dismiss()">\n      <span ng-hide="confirm.close" translate>close</span>\n      {{confirm.close}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-submitted-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-submitted-modal.html",'<?php\n/**\n * @file\n * Code for the obiba_mica_data_access_request modules.\n */\n\n?>\n<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.submit-confirmation.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p>{{\'data-access-request.submit-confirmation.message\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-validation-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-validation-modal.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 ng-if="isValid" class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.validation.title-success\' | translate}}\n    </h4>\n    <h4 ng-if="!isValid" class="modal-title">\n      <i class="fa fa-times fa-lg"></i>\n      {{\'data-access-request.validation.title-error\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p ng-if="isValid">{{\'data-access-request.validation.success\' | translate}}</p>\n    <p ng-if="!isValid" translate>{{\'data-access-request.validation.error\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-view.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <div class="visible-print" print-friendly-view></div>\n  <div class="hidden-print">\n    <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n    <obiba-alert id="DataAccessRequestViewController"></obiba-alert>\n\n    <div ng-if="validForm">\n\n      <p class="help-block pull-left"><span translate>created-by</span>\n        <span ng-if="!actions.canViewProfile(\'mica-data-access-officer\')">\n           {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}\n        </span>\n        <a href ng-click="userProfile(dataAccessRequest.profile)"\n            ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n          {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}</a>,\n        <span title="{{dataAccessRequest.timestamps.created | amDateFormat: \'lll\'}}">{{dataAccessRequest.timestamps.created | amCalendar}}</span>\n        <span class="label label-success">{{dataAccessRequest.status | translate}}</span></p>\n\n      <div class="pull-right">\n        <a ng-click="submit()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canSubmit(dataAccessRequest)"\n          class="btn btn-info" translate>submit\n        </a>\n        <a ng-click="reopen()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReopen(dataAccessRequest)"\n          class="btn btn-info" translate>reopen\n        </a>\n        <a ng-click="review()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReview(dataAccessRequest)"\n          class="btn btn-info" translate>review\n        </a>\n        <a ng-click="conditionallyApprove()"\n           ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canConditionallyApprove(dataAccessRequest)"\n           class="btn btn-info" translate>conditionallyApprove\n        </a>\n        <a ng-click="approve()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canApprove(dataAccessRequest)"\n          class="btn btn-info" translate>approve\n        </a>\n        <a ng-click="reject()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReject(dataAccessRequest)"\n          class="btn btn-info" translate>reject\n        </a>\n        <a ng-href="#/data-access-request/{{dataAccessRequest.id}}/edit"\n          ng-if="actions.canEdit(dataAccessRequest)"\n          class="btn btn-primary" title="{{\'edit\' | translate}}">\n          <i class="fa fa-pencil-square-o"></i>\n        </a>\n        <a ng-if="form.downloadTemplate === false" ng-click="printForm()"\n           class="btn btn-default" title="{{\'global.print\' | translate}}">\n          <i class="fa fa-print"></i> <span translate>global.print</span>\n        </a>\n        <a ng-if="form.downloadTemplate === true" target="_self" href="{{requestDownloadUrl}}" class="btn btn-default">\n          <i class="fa fa-download"></i> <span>{{config.downloadButtonCaption || \'download\' | translate}}</span>\n        </a>\n        <a ng-click="delete()"\n          ng-if="actions.canDelete(dataAccessRequest)"\n          class="btn btn-danger" title="{{\'delete\' | translate}}">\n          <i class="fa fa-trash-o"></i>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <div class="voffset2" ng-if="dataAccessRequest.project.permissions && dataAccessRequest.project.permissions.view">\n        <div ng-if="dataAccessRequest.project" class="pull-right">\n          <small class="help-block inline"> {{\'research-project.label\' | translate}} :\n            <a route-checker route-checker-hides-parent="true" href ng-href="#/project/{{dataAccessRequest.project.id}}">{{dataAccessRequest.project.id}}</a>\n          </small>\n        </div>\n      </div>\n\n      <uib-tabset class="voffset5">\n        <uib-tab ng-click="selectTab(\'form\')" heading="{{\'data-access-request.form\' | translate}}">\n          <form id="request-form" name="forms.requestForm">\n            <div sf-model="form.model" sf-form="form.definition" sf-schema="form.schema" sf-options="sfOptions"></div>\n          </form>\n        </uib-tab>\n        <uib-tab ng-click="selectTab(\'documents\')">\n          <uib-tab-heading>\n            {{config.documentsSectionTitle || \'data-access-request.documents\' | translate}}\n            <span class="badge hoffset1" ng-show="dataAccessRequest.attachments"><small>{{dataAccessRequest.attachments.length}}</small></span>\n          </uib-tab-heading>\n          <div ng-include="\'access/views/data-access-request-documents-view.html\'"></div>\n        </uib-tab>\n        <uib-tab ng-if="config.commentsEnabled" ng-click="selectTab(\'comments\')" heading="{{\'data-access-request.comments\' | translate}}">\n          <obiba-comments class="voffset2" comments="form.comments"\n                          on-update="updateComment" on-delete="deleteComment"\n                          name-resolver="userProfileService.getFullName"\n                          edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n          <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n        </uib-tab>\n        <uib-tab ng-click="selectTab(\'history\')" heading="{{\'data-access-request.history\' | translate}}">\n          <div ng-include="\'access/views/data-access-request-history-view.html\'"></div>\n        </uib-tab>\n      </uib-tabset>\n    </div>\n  </div>\n\n</div>\n')}]),angular.module("attachment/attachment-input-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-input-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<button ng-hide="{{disabled}}" type="button" class="btn btn-primary btn-xs" aria-hidden="true" ngf-multiple="{{multiple}}" ngf-select\n        ngf-change="onFileSelect($files)" translate>file.upload.button\n</button>\n\n<table ng-show="files.length" class="table table-bordered table-striped">\n  <thead>\n  <tr>\n    <th translate>data-access-request.default.documents.title</th>\n    <th class="col-xs-2"><span class="pull-right" translate>file.upload.date</span></th>\n    <th translate>size</th>\n    <th translate>actions</th>\n  </tr>\n  </thead>\n  <tbody>\n  <tr ng-repeat="file in files">\n    <td>\n      {{file.fileName}}\n      <uib-progressbar ng-show="file.showProgressBar" class="progress-striped" value="file.progress">\n        {{file.progress}}%\n      </uib-progressbar>\n    </td>\n    <td>\n      <span class="pull-right" ng-if="file.timestamps" title="{{ file.timestamps.created | amDateFormat: \'lll\' }}">{{file.timestamps.created | amCalendar }}</span>\n    </td>\n    <td style="width:1%;">\n        <span class="pull-right" style="white-space: nowrap;">\n          {{file.size | bytes}}\n        </span>\n    </td>\n    <td style="width:20px;">\n      <a ng-show="file.id" ng-click="deleteFile(file.id)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n      <a ng-show="file.tempId" ng-click="deleteTempFile(file.tempId)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("attachment/attachment-list-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-list-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <span ng-if="!hasAttachments && emptyMessage"><em>{{emptyMessage}}</em></span>\n  <table ng-if="hasAttachments" class="table table-bordered table-striped" >\n    <thead>\n    <tr>\n      <th translate>data-access-request.default.documents.title</th>\n      <th class="col-xs-2"><span class="pull-right" translate>file.upload.date</span></th>\n      <th translate>size</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr ng-repeat="attachment in attachments">\n      <th>\n        <a target="_self" ng-href="{{attachment.href}}"\n           download="{{attachment.fileName}}">{{attachment.fileName}}\n        </a>\n      </th>\n      <td><span class="pull-right" ng-if="attachment.timestamps" title="{{ attachment.timestamps.created | amDateFormat: \'lll\' }}">{{attachment.timestamps.created | amCalendar }}</span></td>\n      <td style="width:1%;">\n        <span class="pull-right" style="white-space: nowrap;">\n          {{attachment.size | bytes}}\n        </span>\n      </td>\n    </tr>\n    </tbody>\n  </table>\n\n</div>\n')}]),angular.module("file-browser/views/document-detail-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/document-detail-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="panel panel-default">\n  <div class="panel-heading">\n    <span>\n      <span title="{{data.details.document.name}}">\n        <i class="fa {{getDocumentIcon(data.details.document)}}"></i> {{truncate(data.details.document.name, 30)}}\n      </span>\n      <a href class="pull-right" ng-click="hideDetails()"><i class="fa fa-times"></i></a>\n    </span>\n  </div>\n  <div class="panel-body">\n    <div>\n      <label class="text-muted no-margin">\n        <small>{{\'size\' | translate}}</small>\n      </label>\n      <div>\n        <span ng-if="!isFile(data.details.document)">{{data.details.document.size}} {{data.details.document.size === 1 ? \'item\' : \'items\' | translate}}</span>\n        <span ng-if="isFile(data.details.document)">{{data.details.document.size | bytes}}</span>\n        <a target="{{downloadTarget}}" ng-href="{{getDownloadUrl(data.details.document.path, data.document.keyToken)}}" class="hoffset2" title="{{\'download\' | translate}}" download>\n          <span><i class="fa fa-download"></i><span class="hoffset2"></span></span>\n        </a>\n      </div>\n    </div>\n\n    <div class="voffset2">\n      <label class="text-muted no-margin">\n        <small>{{\'created-on\' | translate}}</small>\n      </label>\n      <div>\n        <span>{{data.details.document.timestamps.created | amDateFormat : \'lll\'}}</span>\n      </div>\n    </div>\n    <div class="voffset2">\n      <label class="text-muted no-margin">\n        <small>{{\'last-modified\' | translate}}</small>\n      </label>\n      <div>\n        <span>{{data.details.document.timestamps.lastUpdate | amDateFormat : \'lll\'}}</span>\n      </div>\n    </div>\n\n    <div ng-if="isFile(data.details.document)" class="voffset2">\n      <div ng-if="data.details.document.attachment.type">\n        <label class="text-muted no-margin">\n          <small>{{\'type\' | translate}}</small>\n        </label>\n        <div>\n          <span>{{data.details.document.attachment.type}}</span>\n        </div>\n      </div>\n\n      <div ng-show="hasLocalizedValue(data.details.document.attachment.description)"\n           class="voffset2">\n        <label class="text-muted no-margin">\n          <small>{{\'description\' | translate}}</small>\n        </label>\n        <div>\n          <span>{{getLocalizedValue(data.details.document.attachment.description)}}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("file-browser/views/documents-table-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/documents-table-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="panel panel-default table-responsive table-responsive-dropdown">\n  <div class="panel-heading" ng-if="data.search.active">\n      <a class="no-text-decoration" ng-click="clearSearch()">\n        <i class="fa fa-chevron-left"> </i>\n      </a>\n      <span ng-if="data.search.recursively">{{\'file.search-results.current-sub\' | translate}}</span>\n      <span ng-if="!data.search.recursively">{{\'file.search-results.current\' | translate}}</span>\n      ({{data.document.children.length}})\n  </div>\n  <div ng-if="data.document.children.length > 0" test-ref="file-search-result-list">\n    <table class="table table-bordered table-striped no-padding no-margin">\n      <thead>\n      <tr>\n        <th colspan="2" translate>name</th>\n        <th style="width: 100px" translate>type</th>\n        <th style="width: 100px" translate>size</th>\n        <th style="width: 150px" translate>global.modified</th>\n        <th ng-if="data.search.active" translate>folder</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-show="!data.isRoot && data.document.path !== data.rootPath && !data.search.active">\n        <td colspan="5">\n          <i class="fa fa-folder"></i>\n          <span><a href style="text-decoration: none" class="no-text-decoration" ng-click="navigateBack()"> ..</a></span>\n        </td>\n      </tr>\n      <tr ng-class="{\'selected-row\': $index === pagination.selected}"\n          dir-paginate="document in data.document.children | itemsPerPage: pagination.itemsPerPage"\n          ng-init="fileDocument = isFile(document)"\n          current-page="pagination.currentPage">\n\n        <td ng-click="showDetails(document, $index);">\n          <span>\n            <span ng-if="fileDocument">\n              <i class="fa {{getDocumentIcon(document)}}"></i>\n              <a ng-if="fileDocument" target="{{downloadTarget}}" test-ref="file-name"\n                 style="text-decoration: none" ng-click="$event.stopPropagation();" ng-href="{{getDownloadUrl(document.path, data.document.keyToken)}}"\n                  title="{{document.name}}">\n                {{document.name}}\n              </a>\n            </span>\n            <span ng-if="!fileDocument">\n              <i class="fa {{getDocumentIcon(document)}}"></i>\n              <a href style="text-decoration: none" ng-click="navigateTo($event, document, data.document.keyToken)">\n                {{document.name}}\n              </a>\n            </span>\n          </span>\n        </td>\n\n        <td class="fit-content">\n          <span class="btn-group pull-right" uib-dropdown is-open="status.isopen">\n            <a title="{{\'file.show-details\' | translate}}" id="single-button" class="dropdown-anchor" uib-dropdown-toggle\n               ng-disabled="disabled">\n              <i class="glyphicon glyphicon-option-horizontal btn-large"></i>\n            </a>\n            <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n              <li role="menuitem">\n                <a href ng-click="showDetails(document, $index)">\n                  <span><i class="fa fa-info"></i><span class="hoffset2">{{\'details\' | translate}}</span></span>\n                </a>\n              </li>\n              <li role="menuitem">\n                <a target="{{downloadTarget}}" ng-href="{{getDownloadUrl(document.path, data.document.keyToken)}}" download>\n                  <span><i class="fa fa-download"></i><span class="hoffset2">{{\'download\' | translate}}</span></span>\n                </a>\n              </li>\n            </ul>\n          </span>\n        </td>\n\n        <td>\n          <span ng-repeat="t in getTypeParts(document) track by $index"\n            class="label label-info" test-ref="file-type"\n            ng-class="{\'hoffset1\' : !$first}">{{t}}</span>\n        </td>\n        <td class="no-wrap" ng-if="fileDocument" test-ref="file-size">\n          {{document.size | bytes}}\n        </td>\n        <td class="no-wrap" ng-if="!fileDocument">\n          {{document.size}} {{document.size === 1 ? \'item\' : \'items\' | translate}}\n        </td>\n        <td>\n          <span title="{{document.timestamps.lastUpdate | amDateFormat: \'lll\'}}" test-ref="file-lastModification">\n            {{document.timestamps.lastUpdate | amTimeAgo}}\n          </span>\n        </td>\n        <td ng-if="data.search.active">\n          <a href class="no-text-decoration" ng-click="navigateToParent($event, document, data.document.keyToken)" test-ref="file-parent">\n'+"            {{document.attachment.path === data.rootPath ? '/' : document.attachment.path.replace(data.rootPath, '')}}\n          </a>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>")}]),angular.module("file-browser/views/file-browser-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/file-browser-template.html",'<div ng-cloak>\n  <div ng-if="!data.document" class="loading"></div>\n\n  <div ng-if="data.document">\n    <obiba-alert id="FileSystemController"></obiba-alert>\n\n    <div>\n      <!-- Document details -->\n      <div class="row">\n        <div class="col-md-12">\n          <div ng-include="\'file-browser/views/toolbar-template.html\'"></div>\n        </div>\n      </div>\n\n      <div class="row voffset2">\n        <div ng-class="{\'col-md-8\': data.details.show, \'col-md-12\': !data.details.show}">\n          <div ng-include="\'file-browser/views/documents-table-template.html\'"></div>\n          <div ng-if="!data.isFile && data.document.children.length < 1 && !data.search.active" class="text-muted">\n            <em>{{\'empty-folder\' | translate}}</em>\n          </div>\n          <div class="pull-right no-margin">\n            <dir-pagination-controls></dir-pagination-controls>\n          </div>\n        </div>\n        <div ng-if="data.details.show" class="col-md-4">\n          <div ng-include="\'file-browser/views/document-detail-template.html\'"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n</div>')}]),angular.module("file-browser/views/toolbar-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/toolbar-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n<div>\n    <div class="pull-left voffset3">\n        <ol ng-show="data.document.path !== data.rootPath" class="breadcrumb mica-breadcrumb no-margin no-padding">\n            <li>\n                <a href ng-click="navigateToPath(data.rootPath, data.document.keyToken)">\n                    <span><i class="fa {{getDocumentIcon(data.document)}}"></i></span>\n                </a>\n            </li>\n\n            <li ng-repeat="part in data.breadcrumbs" ng-class="{\'active\': $first === $last && $last}">\n                <a ng-show="!$last && part.name !== \'/\'" href ng-click="navigateToPath(part.path, data.document.keyToken)">\n                    <span ng-show="part.name !== \'/\'">{{part.name}}</span>\n                </a>\n                <span class="no-padding" ng-if="part.name !== \'/\' && $last">{{data.document.name || \'empty\'}}</span>\n            </li>\n        </ol>\n    </div>\n    <div ng-if="!data.document.keyToken" class="pull-right">\n\n      <table style="border:none">\n        <tbody>\n        <tr>\n          <td>\n            <a href>\n              <span class="input-group input-group-sm no-padding-top no-padding-right">\n               <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>\n               <input ng-keyup="searchKeyUp($event)"\n                      ng-model="data.search.text"\n                      type="text"\n                      class="form-control ng-pristine ng-untouched ng-valid"\n                      aria-describedby="study-search"\n                      style="max-width: 200px;"\n                      test-ref="file-search-input">\n               <span ng-show="data.search.text" title="{{\'search-tooltip.clear\' | translate}}" ng-click="clearSearch()"\n                  class="input-group-addon">\n                <i class="fa fa-times"></i>\n               </span>\n              </span>\n            </a>\n          </td>\n          <td>\n            <a href ng-model="data.search.recursively"\n              class="btn btn-sm hoffset1"\n              ng-class="{\'btn-info\': data.search.recursively, \'btn-default\': !data.search.recursively}"\n              data-toggle="button" ng-click="toggleRecursively()"\n              title="{{\'search-tooltip.recursively\' | translate}}">\n              <i class="fa i-obiba-hierarchy"></i>\n            </a>\n            <a href ng-click="searchDocuments(\'RECENT\')"\n              class="btn btn-info btn-sm"\n              title="{{\'search-tooltip.most-recent\' | translate}}">\n              <span><i class="fa fa-clock-o fa-lg"></i></span>\n            </a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n</div>')}]),angular.module("graphics/views/charts-directive.html",[]).run(["$templateCache",function(a){a.put("graphics/views/charts-directive.html",'<div>\n  <div ng-if="chartObject.type === \'GeoChart\'">\n    <obiba-geo config="chartObject.d3Config"></obiba-geo>\n  </div>\n  <div ng-if="chartObject.type !== \'GeoChart\'">\n    <obiba-nv-chart chart-config="chartObject.d3Config"></obiba-nv-chart>\n  </div>\n</div>\n')}]),angular.module("graphics/views/tables-directive.html",[]).run(["$templateCache",function(a){a.put("graphics/views/tables-directive.html",'<div>\n    <table ng-if="chartObject.entries && chartObject.entries.length" style="max-height: 400px;" class="table table-bordered table-striped" fixed-header="chartObject.getTable().data">\n        <thead>\n        <tr>\n        <th ng-repeat="header in chartObject.header track by $index">{{header}}</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-repeat="row in chartObject.entries track by $index">\n            <td>{{row.title}}</td>\n            <td><a href ng-click="updateCriteria(row.key, chartObject.vocabulary)">{{row.value}}</a></td>\n            <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n        </tr>\n        </tbody>\n    </table>\n</div>\n')}]),angular.module("localized/localized-input-group-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-group-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <div class="input-group">\n    <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <span class="input-group-btn" ng-show="remove">\n    <button class="btn btn-default" type="button" ng-click="remove(model)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n  </span>\n  </div>\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-input-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n<span ng-bind-html="LocalizedValues.for(value,lang,keyLang,keyValue)  | markdown:markdownIt | ellipsis:ellipsisSize"></span>')}]),angular.module("localized/localized-textarea-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-textarea-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n\n  <textarea ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" rows="{{rows ? rows : 5}}" class="form-control" id="{{fieldName}}" name="{{fieldName}}" form-server-error ng-disabled="disabled" ng-required="required"></textarea>\n\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n\n</div>')}]),angular.module("search/views/classifications.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div>\n  <div ng-if="classificationsHeaderTemplateUrl" ng-include="classificationsHeaderTemplateUrl"></div>\n\n  <div class="container alert-fixed-position">\n    <obiba-alert id="SearchController"></obiba-alert>\n  </div>\n\n  <div class="alert-growl-container">\n    <obiba-alert id="SearchControllerGrowl"></obiba-alert>\n  </div>\n\n  <a href class="btn btn-sm btn-success" ng-click="goToSearch()">\n    <i class="fa fa-chevron-left"></i>\n    <span translate>search.back</span>\n  </a>\n\n  <!-- Lang tabs -->\n  <ul class="nav nav-tabs voffset2" role="tablist" ng-if="tabs && tabs.length>1">\n    <li ng-repeat="tab in tabs" role="presentation" ng-class="{ active: tab === lang }"><a href role="tab"\n      ng-click="setLocale(tab)">{{\'language.\' + tab | translate}}</a></li>\n  </ul>\n\n  <!-- Search criteria region -->\n  <div class="panel panel-default voffset2" ng-if="search.criteria.children && search.criteria.children.length>0">\n    <div class="panel-body">\n      <table style="border:none">\n        <tbody>\n        <tr>\n          <td>\n            <a href class="btn btn-sm btn-default" ng-click="clearSearchQuery()" translate>clear</a>\n          </td>\n          <td style="padding-left: 10px">\n            <div criteria-root item="search.criteria" query="search.query" advanced="search.advanced" on-remove="removeCriteriaItem"\n              on-refresh="refreshQuery" class="inline"></div>\n\n            <small ng-if="showAdvanced()" class="hoffset2">\n              <a href ng-click="toggleSearchQuery()"\n                title="{{search.advanced ? \'search.basic-help\' : \'search.advanced-help\' | translate}}" translate>\n                {{search.advanced ? \'search.basic\' : \'search.advanced\' | translate}}\n              </a>\n            </small>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n\n  <!-- Classifications region -->\n  <div class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n    <ul class="nav nav-pills voffset2" role="tablist" ng-if="targetTabsOrder.length > 1">\n      <li ng-repeat="target in targetTabsOrder" role="presentation" ng-class="{ active: target === $parent.target }"><a href role="tab"\n          ng-click="navigateToTarget(target)">{{\'taxonomy.target.\' + target | translate}}</a></li>\n    </ul>\n\n    <classifications-panel target="target" is-history-enabled="true" on-select-term="onSelectTerm" lang="lang"></classifications-panel>\n  </div>\n\n</div>')}]),angular.module("search/views/classifications/classifications-view.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/classifications-view.html",'<div ng-show="!inSearchMode()" class="voffset2">\n  <div>\n    <ol class="breadcrumb">\n      <li ng-if="!taxonomies.taxonomy">\n        {{\'all-\' + taxonomies.target + \'-classifications\' | translate}}\n      </li>\n      <li ng-if="taxonomies.taxonomy">\n        <a href ng-click="navigateTaxonomy()">{{\'all-\' + taxonomies.target + \'-classifications\' |\n          translate}}</a>\n      </li>\n      <li ng-if="taxonomies.taxonomy">\n        <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="!taxonomies.vocabulary && label.locale === lang">\n          {{label.text}}\n        </span>\n        <a href ng-click="navigateTaxonomy(taxonomies.taxonomy)" ng-if="taxonomies.vocabulary">\n          <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n            {{label.text}}\n          </span>\n        </a>\n      </li>\n      <li ng-if="taxonomies.vocabulary">\n        <span ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </span>\n      </li>\n      <a ng-if="options.showSearchRefreshButton" title="{{\'search.refresh-taxonomies\' | translate}}"\n         href class="hoffset1" ng-click="refreshTaxonomyCache()">\n        <span class="fa fa-refresh"></span>\n      </a>\n    </ol>\n\n  </div>\n\n  <div ng-if="taxonomies.search.active" class="loading"></div>\n\n  <div ng-if="!taxonomies.search.active">\n    <div ng-if="!taxonomies.taxonomy">\n      <div ng-repeat="group in taxonomyGroups">\n        <h3 ng-if="group.title">{{group.title}}</h3>\n        <p class="help-block" ng-if="group.description">{{group.description}}</p>\n        <div ng-if="!taxonomies.taxonomy">\n          <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n            <div class="col-md-4">\n              <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang"\n                   on-navigate="navigateTaxonomy"></div>\n            </div>\n            <div class="col-md-4">\n              <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang"\n                   on-navigate="navigateTaxonomy"></div>\n            </div>\n            <div class="col-md-4">\n              <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang"\n                   on-navigate="navigateTaxonomy"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-if="taxonomies.taxonomy && !taxonomies.vocabulary">\n      <h3 ng-repeat="label in taxonomies.taxonomy.title"\n          ng-if="label.locale === lang">\n        {{label.text}}\n      </h3>\n\n      <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </p>\n\n      <div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n        <div class="col-md-4">\n          <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index]"\n               lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n        <div class="col-md-4">\n          <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 1]"\n               lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n        <div class="col-md-4">\n          <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 2]"\n               lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && !taxonomies.term">\n      <h3 ng-repeat="label in taxonomies.vocabulary.title"\n          ng-if="label.locale === lang">\n        {{label.text}}\n      </h3>\n\n      <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description"\n         ng-if="label.locale === lang">\n        {{label.text}}\n      </p>\n\n      <div ng-repeat="term in taxonomies.vocabulary.terms" ng-if="$index % 3 == 0" class="row">\n        <div class="col-md-4">\n          <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index]"\n               lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n        <div class="col-md-4">\n          <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 1]"\n               lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n        <div class="col-md-4">\n          <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 2]"\n               lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && taxonomies.term">\n      <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n        {{label.text}}\n      </h5>\n      <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n        <span class="help-block" ng-bind-html="label.text | dceDescription" ng-if="taxonomies.vocabulary.name === \'dceId\'"></span>\n        <span class="help-block" ng-bind-html="label.text" ng-if="taxonomies.vocabulary.name !== \'dceId\'"></span>\n      </p>\n      <div>\n        <a href class="btn btn-default btn-xs"\n           ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {term: taxonomies.term})">\n          <i class="fa fa-plus-circle"></i>\n          <span translate>add-query</span>\n        </a>\n      </div>\n    </div>\n  </div>\n\n</div>\n')}]),angular.module("search/views/classifications/taxonomies-facets-view.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomies-facets-view.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<ul class="nav nav-tabs" role="tablist" ng-if="targets.length > 1">\n  <li ng-repeat="tab in targets" role="presentation" ng-class="{ active: tab === target }">\n    <a href role="tab" ng-click="setTarget(tab)">{{\'search.\' + tab + \'.facet-label\' | translate}}</a></li>\n</ul>\n\n<uib-accordion close-others="false">\n    <div uib-accordion-group ng-repeat="taxonomy in taxonomies[target]" is-open="taxonomy.isOpen" is-disabled="false" template-url="search/views/classifications/taxonomy-accordion-group.html">\n      <uib-accordion-heading>\n          <i class="fa" ng-class="{\'fa-chevron-down\': taxonomy.isOpen, \'fa-chevron-right\': !taxonomy.isOpen}"></i>\n          <span uib-popover="{{localize(taxonomy.description ? taxonomy.description : taxonomy.title)}}"\n                popover-title="{{taxonomy.description ? localize(taxonomy.title) : null}}"\n                popover-placement="bottom"\n                popover-trigger="\'mouseenter\'"\n                popover-popup-delay="1000">\n            {{localize(taxonomy.title)}}\n          </span>\n      </uib-accordion-heading>\n      <uib-accordion close-others="false">\n        <div uib-accordion-group ng-repeat="vocabulary in taxonomy.vocabularies | visibleVocabularies" is-open="vocabulary.isOpen" is-disabled="false" template-url="search/views/classifications/vocabulary-accordion-group.html">\n          <uib-accordion-heading>\n            <span uib-popover="{{localize(vocabulary.description ? vocabulary.description : vocabulary.title)}}"\n                  popover-title="{{vocabulary.description ? localize(vocabulary.title) : null}}"\n                  popover-placement="bottom"\n                  popover-trigger="\'mouseenter\'"\n                  popover-popup-delay="1000"\n                  ng-click="loadVocabulary(taxonomy, vocabulary)">\n              <i class="fa" ng-class="{\'fa-caret-down\': vocabulary.isOpen, \'fa-caret-right\': !vocabulary.isOpen}"></i>\n              <span>\n                {{localize(vocabulary.title)}}\n              </span>\n              <span ng-if="!vocabulary.title">\n                {{vocabulary.name}}\n              </span>\n            </span>\n          </uib-accordion-heading>\n          <div>\n            <div ng-if="vocabulary.isMatch" ng-controller="MatchVocabularyFacetController" class="voffset2 form-group">\n              <form novalidate class="form-inline" ng-keypress="onKeypress($event)">\n                <div class="form-group form-group-sm">\n                  <input type="text" class="form-control" ng-model="text" placeholder="{{\'search.match.placeholder\' | translate}}">\n                </div>\n              </form>\n            </div>\n            <div ng-if="vocabulary.isNumeric" ng-controller="NumericVocabularyFacetController" class="voffset2 form-group">\n              <form novalidate class="form-inline"  ng-keypress="onKeypress($event)">\n                <div class="form-group form-group-sm">\n                  <label for="nav-{{vocabulary.name}}-from" translate>from</label>\n                  <input type="number" class="form-control" id="nav-{{vocabulary.name}}-from" ng-model="from" placeholder="{{min}}" style="width:75px;">\n                  <label for="nav-{{vocabulary.name}}-to" translate>to</label>\n                  <input type="number" class="form-control" id="nav-{{vocabulary.name}}-to" ng-model="to" placeholder="{{max}}" style="width:75px;">\n                </div>\n              </form>\n            </div>\n            <div ng-controller="TermsVocabularyFacetController">\n              <ul class="nav nav-pills nav-stacked" ng-if="vocabulary.terms">\n                <li ng-repeat="term in vocabulary.terms | orderBy:[\'-selected\', \'-count\', \'+name\']  | limitTo:vocabulary.limit:begin"\n                    class="checkbox" ng-class="{active: term.name === term.name}">\n                  <label style="max-width: 80%;">\n                    <input type="checkbox" ng-model="term.selected" ng-change="selectTerm(target, taxonomy, vocabulary, {term: term})">\n                    <span uib-popover="{{localize(term.description ? term.description : term.title)}}"\n                          popover-title="{{term.description ? localize(term.title) : null}}"\n                          popover-placement="bottom"\n                          popover-trigger="\'mouseenter\'"\n                          popover-popup-delay="1000">\n                      <span>\n                        {{localize(term.title)}}\n                      </span>\n                      <span ng-if="!term.title">\n                        {{term.name}}\n                      </span>\n                    </span>\n                  </label>\n                    <span class="pull-right" ng-class="{\'text-muted\': !term.selected}">\n                      {{term.count}}\n                    </span>\n                </li>\n              </ul>\n              <div ng-if="!vocabulary.isNumeric && !vocabulary.isMatch && vocabulary.terms.length > 10" class="voffset1 pull-right form-group">\n                <button class="btn btn-xs btn-primary" ng-if="vocabulary.limit" ng-click="vocabulary.limit = undefined" translate>search.facet.more</button>\n                <button class="btn btn-xs btn-default" ng-if="!vocabulary.limit" ng-click="vocabulary.limit = 10" translate>search.facet.less</button>\n              </div>\n            </div>\n          </div>\n        </div >\n      </uib-accordion>\n    </div>\n</uib-accordion>\n')}]),angular.module("search/views/classifications/taxonomies-view.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomies-view.html",'<div class="collapse">\n  <div class="voffset2">\n    <div class="panel panel-default">\n      <div class="panel-heading no-padding-top no-padding-bottom">\n        <div class="row no-padding">\n          <div class="col-md-8">\n            <ol class="breadcrumb no-margin no-padding pull-left">\n              <li ng-if="taxonomies.taxonomy">\n                <h4 ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang" class="pull-left">\n                  <strong>{{label.text}}</strong>\n                </h4>\n                <a ng-if="options.showSearchRefreshButton" title="{{\'search.refresh-taxonomies\' | translate}}"\n                   href class="hoffset1 voffset2 pull-right" ng-click="refreshTaxonomyCache(target, taxonomies.taxonomy.name)">\n                  <span class="fa fa-refresh"></span>\n                </a>\n              </li>\n            </ol>\n          </div>\n          <div class="col-md-4">\n            <h4 ng-click="closeTaxonomies()" title="{{\'close\' | translate}}" class="pull-right" style="cursor: pointer">\n              <i class="fa fa-close"></i>\n            </h4>\n        </div>\n        </div>\n      </div>\n      <div class="panel-body">\n        <div ng-if="taxonomies.search.active" class="loading"></div>\n\n        <div ng-if="!taxonomies.search.active">\n          <div ng-if="!taxonomies.taxonomy">\n            <div ng-repeat="group in taxonomyGroups">\n              <h4 ng-if="group.title">{{group.title}}</h4>\n              <p class="help-block" ng-if="group.description">{{group.description}}</p>\n              <div ng-if="!taxonomies.taxonomy">\n                <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang"\n                         on-navigate="navigateTaxonomy"></div>\n                  </div>\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang"\n                         on-navigate="navigateTaxonomy"></div>\n                  </div>\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang"\n                         on-navigate="navigateTaxonomy"></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div ng-if="taxonomies.taxonomy">\n            <div class="row">\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.taxonomy">\n                <h5 ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n                  {{label.text}}\n                </h5>\n                <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description"\n                   ng-if="label.locale === lang">\n                  {{label.text}}\n                </p>\n                <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.taxonomy.vocabularies">\n                  <li ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies | visibleVocabularies | filter:canNavigate "\n                      class="{{taxonomies.vocabulary.name === vocabulary.name ? \'active\' : \'\'}}">\n                    <a class="clearfix" id="search-navigate-taxonomy" href\n                       ng-click="navigateTaxonomy(taxonomies.taxonomy, vocabulary)">\n                      <i class="pull-right {{taxonomies.vocabulary.name !== vocabulary.name ? \'hidden\' : \'\'}} hidden-sm hidden-xs fa fa-chevron-circle-right"></i>\n                      <span ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n                        {{label.text}}\n                      </span>\n                      <span ng-if="!vocabulary.title">\n                        {{vocabulary.name}}\n                      </span>\n\n\n                    </a>\n                  </li>\n                </ul>\n              </div>\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.vocabulary">\n                <div ng-if="taxonomies.vocabulary">\n                  <h5 ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </h5>\n                  <div class="form-group" ng-if="!taxonomies.isNumericVocabulary && !taxonomies.isMatchVocabulary">\n                    <a href class="btn btn-default btn-xs"\n                       ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary)">\n                      <i class="fa fa-plus-circle"></i>\n                      <span translate>add-query</span>\n                    </a>\n                  </div>\n                  <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description"\n                     ng-if="label.locale === lang">\n                    {{label.text}}\n                  </p>\n                  <div ng-if="taxonomies.isMatchVocabulary" ng-controller="MatchVocabularyPanelController">\n                    <div class="form-group">\n                      <a href class="btn btn-default btn-xs"\n                         ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {text: text})">\n                        <i class="fa fa-plus-circle"></i>\n                        <span translate>add-query</span>\n                      </a>\n                    </div>\n                    <form novalidate class="form-inline"\n                          ui-keypress="{13: \'selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {text: text})\'}">\n                      <div class="form-group">\n                        <input type="text" class="form-control" ng-model="text"\n                               placeholder="{{\'search.match.placeholder\' | translate}}">\n                      </div>\n                    </form>\n                  </div>\n                  <div ng-if="taxonomies.isNumericVocabulary" ng-controller="NumericVocabularyPanelController">\n                    <div class="form-group">\n                      <a href class="btn btn-default btn-xs"\n                         ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {from: from, to: to})">\n                        <i class="fa fa-plus-circle"></i>\n                        <span translate>add-query</span>\n                      </a>\n                    </div>\n                    <form novalidate class="form-inline"\n                          ui-keypress="{13:\'selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {from: from, to: to})\'}">\n                      <div class="form-group">\n                        <label for="nav-{{taxonomies.vocabulary.name}}-from" translate>from</label>\n                        <input type="number" class="form-control" id="nav-{{taxonomies.vocabulary.name}}-from"\n                               ng-model="from" style="width:150px">\n                      </div>\n                      <div class="form-group">\n                        <label for="nav-{{taxonomies.vocabulary.name}}-to" translate>to</label>\n                        <input type="number" class="form-control" id="nav-{{taxonomies.vocabulary.name}}-to"\n                               ng-model="to" style="width:150px">\n                      </div>\n                    </form>\n                  </div>\n                  <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.vocabulary.terms">\n                    <li ng-repeat="term in taxonomies.vocabulary.terms"\n                        class="{{taxonomies.term.name === term.name ? \'active\' : \'\'}}">\n                      <a class="clearfix" id="search-navigate-vocabulary" href\n                         ng-click="navigateTaxonomy(taxonomies.taxonomy, taxonomies.vocabulary, term)">\n                        <i class="pull-right {{taxonomies.term.name !== term.name ? \'hidden\' : \'\'}} hidden-sm hidden-xs fa fa-chevron-circle-right"></i>\n                        <span ng-repeat="label in term.title" ng-if="label.locale === lang">\n                          {{label.text}}\n                        </span>\n                        <span ng-if="!term.title">\n                          {{term.name}}\n                        </span>\n                      </a>\n                    </li>\n                  </ul>\n                </div>\n                <div ng-if="!taxonomies.vocabulary" translate>search.taxonomy-nav-help</div>\n              </div>\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.term">\n                <div ng-if="taxonomies.term">\n                  <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </h5>\n                  <div>\n                    <a href class="btn btn-default btn-xs"\n                       ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {term: taxonomies.term})">\n                      <i class="fa fa-plus-circle"></i>\n                      <span translate>add-query</span>\n                    </a>\n                  </div>\n                  <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n                    <span class="help-block" ng-bind-html="label.text | dceDescription"\n                          ng-if="taxonomies.vocabulary.name === \'dceId\'"></span>\n                    <span class="help-block" ng-bind-html="label.text"\n                          ng-if="taxonomies.vocabulary.name !== \'dceId\'"></span>\n                  </p>\n                </div>\n                <div ng-if="!taxonomies.term && taxonomies.vocabulary" translate>search.vocabulary-nav-help</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/taxonomy-accordion-group.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomy-accordion-group.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="panel no-margin no-border-radius" ng-class="panelClass || \'panel-default\'">\n  <div role="tab" id="{{::headingId}}" aria-selected="{{isOpen}}" class="panel-heading" ng-keypress="toggleOpen($event)">\n    <h4 class="panel-title">\n      <a role="button" data-toggle="collapse" href aria-expanded="{{isOpen}}" aria-controls="{{::panelId}}" tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading"><small><span uib-accordion-header ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></small></a>\n    </h4>\n  </div>\n  <div id="{{::panelId}}" aria-labelledby="{{::headingId}}" aria-hidden="{{!isOpen}}" role="tabpanel" class="panel-collapse collapse" uib-collapse="!isOpen">\n    <div class="panel-body no-padding small" ng-transclude></div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/taxonomy-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomy-panel-template.html",'<div>\n  <div class="panel panel-default" ng-if="taxonomy">\n    <div class="panel-heading">\n      <div ng-repeat="label in taxonomy.title" ng-if="label.locale === lang">\n        <a href ng-click="onNavigate(taxonomy)">{{label.text}}</a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div ng-repeat="label in taxonomy.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/taxonomy-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomy-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n  <div class="col-md-4">\n    <div vocabulary-panel taxonomy="taxonomies.taxonomy.vocabularies[$index]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 1]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 2]"></div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/term-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/term-panel-template.html",'<div>\n  <div class="panel panel-default" ng-if="term">\n    <div class="panel-heading">\n      <div>\n        <localized value="term.title" lang="lang" key-lang="locale" key-value="text"></localized>\n        {{label.text}}\n        <small>\n          <a href ng-click="onSelect(target, taxonomy, vocabulary, {term: term})">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </a>\n        </small>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div>\n        <localized value="term.description" lang="lang" key-lang="locale" key-value="text"></localized>\n      </div>\n      <div ng-if="!term.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/vocabulary-accordion-group.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/vocabulary-accordion-group.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="panel no-margin no-padding no-border-radius" ng-class="panelClass || \'panel-default\'">\n  <div role="tab" id="{{::headingId}}" aria-selected="{{isOpen}}" class="panel-heading" ng-keypress="toggleOpen($event)">\n    <h4 class="panel-title">\n      <a role="button" data-toggle="collapse" href aria-expanded="{{isOpen}}" aria-controls="{{::panelId}}" tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading"><small><span uib-accordion-header ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></small></a>\n    </h4>\n  </div>\n  <div id="{{::panelId}}" aria-labelledby="{{::headingId}}" aria-hidden="{{!isOpen}}" role="tabpanel" class="panel-collapse collapse" uib-collapse="!isOpen">\n    <div class="panel-body no-padding-top no-padding-bottom" ng-transclude></div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/vocabulary-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/vocabulary-panel-template.html",'<div>\n  <div class="panel panel-default" ng-if="vocabulary">\n    <div class="panel-heading">\n      <div ng-repeat="label in vocabulary.title" ng-if="label.locale === lang" class="clearfix">\n        <a href ng-click="onNavigate(taxonomy, vocabulary)" ng-if="vocabulary.terms">{{label.text}}</a>\n        <span ng-if="!vocabulary.terms">{{label.text}}</span>\n        <a href ng-click="onSelect(target, taxonomy, vocabulary)">\n          <small ng-if="vocabulary.terms"><i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i></small>\n          <small ng-if="!vocabulary.terms"><i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i></small>\n        </a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div>\n        <localized value="vocabulary.description" lang="lang" key-lang="locale" key-value="text"></localized>\n      </div>\n      <div ng-if="!vocabulary.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/coverage/coverage-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/coverage/coverage-search-result-table-template.html",'<div>\n\n  <div ng-if="hasVariableTarget()">\n    <ul class="nav nav-pills pull-left">\n      <li ng-if="groupByOptions.canShowStudy()"\n        ng-class="{\'active\': bucket.startsWith(\'study\') || bucket.startsWith(\'dce\')}">\n        <a href ng-click="selectTab(\'study\')" translate>{{groupByOptions.studyTitle()}}</a>\n      </li>\n      <li ng-if="groupByOptions.canShowDataset()"\n        ng-class="{\'active\': bucket.startsWith(\'dataset\')}">\n        <a href ng-click="selectTab(\'dataset\')" translate>{{groupByOptions.datasetTitle()}}</a>\n      </li>\n    </ul>\n\n    <div class="pull-right">\n      <a ng-if="hasSelected()" href class="btn btn-default" ng-click="updateFilterCriteria()">\n        <i class="fa fa-filter"></i> {{\'search.filter\' | translate}}\n      </a>\n\n      <span ng-if="table.taxonomyHeaders.length > 0" >\n        <a href class="btn btn-info btn-responsive" ng-click="selectFullAndFilter()" ng-hide="isFullCoverageImpossibleOrCoverageAlreadyFull()">\n          {{\'search.coverage-select.full\' | translate}}\n        </a>\n        <a target="_self" class="btn btn-info btn-responsive"\n           ng-href="{{downloadUrl()}}">\n          <i class="fa fa-download"></i> {{\'download\' | translate}}\n        </a>\n      </span>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <div class="voffset2" ng-class="{\'pull-right\': groupByOptions.canShowVariableTypeFilter(bucket)}" ng-if="groupByOptions.canShowDce(bucket)">\n      <label class="checkbox-inline">\n        <input type="checkbox" ng-model="bucketSelection.dceBucketSelected">\n        <span translate>search.coverage-buckets.dce</span>\n      </label>\n    </div>\n\n    <div class="voffset2">\n      <div class="btn btn-group" style="padding: 0">\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'all\'" translate>all</label>\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'individual\'" translate>search.coverage-buckets.individual</label>\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'harmonization\'" translate>search.coverage-buckets.harmonization</label>\n      </div>\n    </div>\n  </div>\n\n  <p class="help-block" ng-if="!loading && !table.taxonomyHeaders">\n    <span ng-if="!hasVariableTarget()" translate>search.no-coverage</span>\n    <span ng-if="hasVariableTarget()" translate>search.no-results</span>\n  </p>\n\n  <div ng-if="loading" class="loading"></div>\n\n  <div class="table-responsive" ng-if="!loading && table.taxonomyHeaders.length > 0">\n    <table class="table table-bordered table-striped">\n      <thead>\n      <tr>\n        <th rowspan="2" width="50" style="text-align: center">\n          <div class="btn-group voffset1" uib-dropdown>\n            <div uib-dropdown-toggle>\n              <small><i class="glyphicon glyphicon-unchecked"></i></small>\n              <span class=\'fa fa-caret-down\'></span>\n            </div>\n            <ul uib-dropdown-menu role="menu">\n              <li role="menuitem"><a href ng-click="selectAll()" translate>search.coverage-select.all</a></li>\n              <li role="menuitem"><a href ng-click="selectNone()" translate>search.coverage-select.none</a></li>\n              <li role="menuitem"><a href ng-click="selectFull()" translate>search.coverage-select.full</a></li>\n            </ul>\n          </div>\n        </th>\n        <th rowspan="{{bucket.startsWith(\'dce\') ? 1 : 2}}" colspan="{{table.cols.colSpan}}" translate>\n          {{\'search.coverage-buckets.\' + bucket}}\n        </th>\n        <th ng-repeat="header in table.vocabularyHeaders" colspan="{{header.termsCount}}">\n          <span\n            uib-popover="{{header.entity.descriptions[0].value}}"\n            popover-title="{{header.entity.titles[0].value}}"\n            popover-placement="bottom"\n            popover-trigger="\'mouseenter\'">\n          {{header.entity.titles[0].value}}\n          </span>\n          <small>\n            <a href ng-click="removeVocabulary(header)"><i class="fa fa-times"></i></a>\n          </small>\n        </th>\n      </tr>\n      <tr>\n        <th ng-if="bucket.startsWith(\'dce\')" translate>search.coverage-dce-cols.study</th>\n        <th ng-if="bucket.startsWith(\'dce\')" colspan="{{choseHarmonization() && !choseAll() ? 2 : 1}}" translate>search.coverage-dce-cols.population</th>\n        <th ng-if="bucket.startsWith(\'dce\')" ng-hide="choseHarmonization() && !choseAll()" translate>search.coverage-dce-cols.dce</th>\n        <th ng-repeat="header in table.termHeaders">\n          <span\n            uib-popover="{{header.entity.descriptions[0].value}}"\n            popover-title="{{header.entity.titles[0].value}}"\n            popover-placement="bottom"\n            popover-trigger="\'mouseenter\'">\n          {{header.entity.titles[0].value}}\n          </span>\n          <small>\n            <a ng-if="header.canRemove" href ng-click="removeTerm(header)"><i class="fa fa-times"></i></a>\n          </small>\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="row in table.rows" ng-if="showMissing || table.termHeaders.length == keys(row.hits).length">\n        <td style="text-align: center">\n          <input type="checkbox" ng-model="row.selected">\n        </td>\n        <td ng-repeat="col in table.cols.ids[row.value]" colspan="{{$middle && (choseHarmonization() && !choseAll()) ? 2 : 1}}" ng-hide="col.id === \'-\' && (choseHarmonization() && !choseAll())">\n          <span ng-if="col.id === \'-\'">-</span>\n          <a ng-if="col.rowSpan > 0 && col.id !== \'-\'" href="{{col.url ? col.url : \'\'}}"\n            uib-popover-html="col.description === col.title ? null : col.description"\n            popover-title="{{col.title}}"\n            popover-placement="bottom"\n            popover-trigger="\'mouseenter\'">{{col.title}}</a>\n          <div style="text-align: center" ng-if="col.start && bucket.startsWith(\'dce\')">\n            <div>\n              <small class="help-block no-margin" ng-if="col.end">\n                {{col.start}} {{\'to\' | translate}} {{col.end}}\n              </small>\n              <small class="help-block no-margin" ng-if="!col.end">\n                {{col.start}}, {{\'search.coverage-end-date-ongoing\' | translate}}\n              </small>\n            </div>\n            <div class="progress no-margin">\n              <div class="progress-bar progress-bar-transparent" role="progressbar"\n                aria-valuenow="{{col.start}}" aria-valuemin="{{col.min}}"\n                aria-valuemax="{{col.start}}" style="{{\'width: \' + col.progressStart + \'%\'}}">\n              </div>\n              <div class="{{\'progress-bar progress-bar-\' + col.progressClass}}" role="progressbar"\n                aria-valuenow="{{col.current}}" aria-valuemin="{{col.start}}"\n                aria-valuemax="{{col.end ? col.end : col.current}}" style="{{\'width: \' + col.progress + \'%\'}}">\n              </div>\n            </div>\n          </div>\n        </td>\n        <td ng-repeat="h in table.termHeaders" title="{{h.entity.titles[0].value}}">\n          <a href ng-click="updateCriteria(row.value, h, $index, \'variables\')"><span class="label label-info"\n            ng-if="row.hits[$index]"><localized-number value="row.hits[$index]"></localized-number></span></a>\n          <span ng-if="!row.hits[$index]">0</span>\n        </td>\n      </tr>\n      </tbody>\n      <tfoot>\n      <tr>\n        <th></th>\n        <th colspan="{{table.cols.colSpan}}" translate>all</th>\n        <th ng-repeat="header in table.termHeaders" title="{{header.entity.descriptions[0].value}}">\n          <a href ng-click="updateCriteria(null, header, $index, \'variables\')"><localized-number value="header.hits"></localized-number></a>\n        </th>\n      </tr>\n      </tfoot>\n    </table>\n  </div>\n</div>')}]),angular.module("search/views/criteria/criteria-node-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criteria-node-template.html",'<span>\n  <span ng-if="item.children.length > 0">\n    <criteria-leaf item="item.children[0]" parent-type="$parent.item.type" query="query" advanced="advanced"></criteria-leaf>\n\n    <div class="btn-group voffset1" ng-show="$parent.advanced" uib-dropdown>\n      <button type="button" class="btn btn-default btn-xs" uib-dropdown-toggle>\n        {{item.type | translate}} <span class="caret"></span>\n      </button>\n      <ul uib-dropdown-menu role="menu">\n        <li role="menuitem"><a href ng-click="updateLogical(\'or\')" translate>or</a></li>\n        <li role="menuitem"><a href ng-click="updateLogical(\'and\')" translate>and</a></li>\n      </ul>\n    </div>\n    <criteria-leaf item="item.children[1]" parent-type="$parent.item.type" query="query" advanced="advanced"></criteria-leaf>\n\n  </span>\n  <span ng-if="item.children.length === 0">\n    <criteria-leaf item="item" parent-type="item.parent.type" query="query" advanced="advanced"></criteria-leaf>\n  </span>\n</span>')}]),angular.module("search/views/criteria/criteria-root-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criteria-root-template.html",'<div class="form-inline">\n  <div ng-repeat="child in item.children" class="inline">\n    <div class="inline hoffset2" ng-if="$index>0">+</div>\n    <criteria-target item="child" query="$parent.query" advanced="$parent.advanced" class="inline"></criteria-target>\n  </div>\n</div>\n')}]),angular.module("search/views/criteria/criteria-target-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criteria-target-template.html",'<div>\n  <div class="form-group" title="{{\'search.\' + item.target + \'-where\' | translate}}">\n    <i class="{{\'i-obiba-x-large i-obiba-\' + item.target + \' color-\' + item.target}}">&nbsp;</i>\n  </div>\n  <criteria-node ng-repeat="child in item.children" item="child" query="$parent.query" advanced="$parent.advanced"></criteria-node>\n</div>')}]),angular.module("search/views/criteria/criterion-dropdown-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-dropdown-template.html",'<div id="{{criterion.id.replace(\'.\',\'-\')}}-dropdown-{{timestamp}}" class="{{\'btn-group voffset1 btn-\' + criterion.target}}" ng-class=\'{open: state.open}\'\n     ng-keyup="onKeyup($event)">\n\n  <button class="{{\'btn btn-xs dropdown btn-\' + criterion.target}}"\n    ng-click="openDropdown()">\n    <span uib-popover="{{localize(criterion.vocabulary.description ? criterion.vocabulary.description : criterion.vocabulary.title)}}"\n          popover-title="{{criterion.vocabulary.description ? localize(criterion.vocabulary.title) : null}}"\n          popover-placement="bottom"\n          popover-trigger="\'mouseenter\'">\n    <i class="fa fa-info-circle"> </i>\n  </span>\n    <span title="{{localizeCriterion()}}" test-ref="search-criterion">\n    {{truncate(localizeCriterion())}}\n    </span>\n    <span class=\'fa fa-caret-down\'></span>\n  </button>\n  <button class=\'btn btn-xs btn-default\' ng-click=\'remove(criterion.id)\'>\n    <span class=\'fa fa-times\'></span>\n  </button>\n\n  <match-criterion ng-if="RqlQueryUtils.isMatchVocabulary(criterion.vocabulary)" criterion="criterion" query="query"\n                  state="state"></match-criterion>\n\n  <string-criterion-terms\n    ng-if="RqlQueryUtils.isTermsVocabulary(criterion.vocabulary) || RqlQueryUtils.isRangeVocabulary(criterion.vocabulary)"\n    criterion="criterion" query="query" state="state"></string-criterion-terms>\n\n  <numeric-criterion ng-if="RqlQueryUtils.isNumericVocabulary(criterion.vocabulary)" criterion="criterion" query="query"\n    state="state"></numeric-criterion>\n\n</div>\n')}]),angular.module("search/views/criteria/criterion-header-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-header-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<li class="criteria-list-item">\n  <label uib-popover="{{localize(criterion.vocabulary.description)}}"\n         popover-title="{{localize(criterion.vocabulary.title)}}"\n         popover-placement="bottom"\n         popover-trigger="\'mouseenter\'">\n    {{localize(criterion.vocabulary.title)}}\n  </label>\n  <span class="pull-right" title="{{\'search.close-and-search\' | translate}}" ng-click="$parent.$parent.closeDropdown()"><i class="fa fa-close"></i></span>\n</li>\n<li class=\'divider\'></li>\n')}]),angular.module("search/views/criteria/criterion-match-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-match-template.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="criteria-list-item">\n    <form novalidate>\n      <div>\n        <input class="form-control" id="{{criterion.vocabulary.name}}-match"\n               ng-model="match"\n               ng-change="update()"\n               placeholder="{{\'search.match.placeholder\' | translate}}">\n      </div>\n    </form>\n  </li>\n</ul>')}]),angular.module("search/views/criteria/criterion-numeric-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-numeric-template.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="btn-group">\n    <ul class="criteria-list-item">\n      <li>\n        <label title="{{\'search.any-help\' | translate}}">\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="false">\n          {{\'search.any\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label title="{{\'search.none-help\' | translate}}">\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="true">\n          {{\'search.none\' | translate}}\n        </label>\n      </li>\n    </ul>\n  </li>\n  <li ng-show="!selectMissing" class=\'divider\'></li>\n  <li ng-show="!selectMissing" class="btn-group criteria-list-item">\n    <form novalidate>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-from" translate>from</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-from" placeholder="{{min}}" ng-model="from" style="width:150px">\n      </div>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-to" translate>to</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-to" placeholder="{{max}}" ng-model="to" style="width:150px">\n      </div>\n    </form>\n  </li>\n</ul>')}]),angular.module("search/views/criteria/criterion-string-terms-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-string-terms-template.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="btn-group">\n    <ul class="criteria-list-item">\n      <li>\n        <label title="{{\'search.any-help\' | translate}}">\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.EXISTS}}">\n          {{\'search.any\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label title="{{\'search.none-help\' | translate}}">\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.MISSING}}">\n          {{\'search.none\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label title="{{\'search.in-help\' | translate}}">\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.IN}}">\n          {{\'search.in\' | translate}}\n        </label>\n      </li>\n      <li ng-show="criterion.vocabulary.repeatable">\n        <label title="{{\'search.contains-help\' | translate}}">\n          <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.CONTAINS}}">\n          {{\'search.contains\' | translate}}\n        </label>\n      </li>\n    </ul>\n  </li>\n  <li ng-show="isInFilter() || isContainsFilter()" class=\'divider\'></li>\n  <li class="criteria-list-item" ng-show="state.loading">\n    <p class="voffset2 loading">\n    </p>\n  </li>\n  <li ng-show="isInFilter() || isContainsFilter()">\n    <ul ng-show="!state.loading" class="no-padding criteria-list-terms">\n      <li class="criteria-list-item" ng-show="terms && terms.length>10">\n        <span class="input-group input-group-sm no-padding-top">\n          <input ng-model="searchText" type="text" class="form-control" aria-describedby="term-search">\n          <span class="input-group-addon" id="term-search"><i class="glyphicon glyphicon-search"></i></span>\n        </span>\n      </li>\n      <li ng-show="terms && terms.length>10"></li>\n      <li class="criteria-list-item"\n        ng-show="isInFilter() || isContainsFilter()"\n        ng-repeat="term in terms | regex:searchText:[\'key\',\'title\',\'description\']"\n        uib-popover="{{term.description ? term.description : (truncate(term.title) === term.title ? null : term.title)}}"\n        popover-title="{{term.description ? term.title : null}}"\n        popover-placement="bottom"\n        popover-trigger="\'mouseenter\'">\n          <span>\n            <label class="control-label">\n              <input ng-model="checkboxTerms[term.key]"\n                type="checkbox"\n                ng-click="updateSelection()">\n              <span>{{truncate(term.title ? term.title : term.key)}}</span>\n            </label>\n          </span>\n          <span class="pull-right">\n            <span class="agg-term-count" ng-show="isSelectedTerm(term)">{{term.count}}</span>\n            <span class="agg-term-count-default" ng-show="!isSelectedTerm(term)">{{term.count}}</span>\n          </span>\n      </li>\n    </ul>\n  </li>\n</ul>')}]),angular.module("search/views/criteria/target-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/target-template.html","<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<span></span>")}]),angular.module("search/views/graphics/graphics-search-result-template.html",[]).run(["$templateCache",function(a){a.put("search/views/graphics/graphics-search-result-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n\n  <p class="help-block" ng-if="!loading && !noResults && !hasChartObjects()" translate>search.no-graphic-result</p>\n  <p class="help-block" ng-if="!loading && noResults" translate>search.no-results</p>\n\n  <div ng-repeat="chart in chartObjects" class="panel panel-default">\n    <div class="panel-heading">\n      {{chart.headerTitle}}\n    </div>\n    <div class="panel-body">\n      <div class="row">\n        <div class="col-md-6">\n          <div ng-if="chart.chartObject.type === \'GeoChart\'">\n            <obiba-geo config="chart.chartObject.d3Config"></obiba-geo>\n          </div>\n          <div ng-if="chart.chartObject.type !== \'GeoChart\'">\n            <obiba-nv-chart chart-config="chart.chartObject.d3Config"></obiba-nv-chart>\n          </div>\n        </div>\n        <div class="col-md-6">\n          <div class="table-responsive" ng-if="chart.getTable().data  &&  chart.getTable().data.length>1">\n            <table style="max-height: 400px;" class="table table-bordered table-striped" fixed-header="chart.getTable().data">\n              <thead>\n              <tr>\n                <th>{{chart.getTable().data[0][0]}}</th>\n                <th>{{chart.getTable().data[0][1]}}</th>\n                <th ng-if="chart.getTable().data[0][2]">{{chart.getTable().data[0][2]}}</th>\n              </tr>\n              </thead>\n              <tbody>\n              <tr ng-repeat="row in chart.getTable().entries">\n                <td>{{row.title}}</td>\n                <td><a href ng-click="updateCriteria(row.key, chart.getTable().vocabulary)"><localized-number value="row.value"></localized-number></a></td>\n                <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n              </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/list/datasets-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/datasets-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div study-filter-shortcut></div>\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.dataset.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n        <tr>\n          <th translate ng-if="optionsCols.showDatasetsAcronymColumn">acronym</th>\n          <th translate>name</th>\n          <th translate ng-if="optionsCols.showDatasetsTypeColumn">type</th>\n          <th translate ng-if="optionsCols.showDatasetsNetworkColumn">networks</th>\n          <th translate ng-if="optionsCols.showDatasetsStudiesColumn">studies</th>\n          <th translate ng-if="optionsCols.showDatasetsVariablesColumn">variables</th>\n        </tr>\n        </thead>\n        <tbody test-ref="search-results">\n        <tr ng-if="!summaries || !summaries.length">\n          <td colspan="6" translate>search.dataset.noResults</td>\n        </tr>\n        <tr ng-repeat="summary in summaries">\n          <td ng-if="optionsCols.showDatasetsAcronymColumn">\n            <a ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n              <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n            </a>\n          </td>\n          <td>\n            <a ng-if="!optionsCols.showDatasetsAcronymColumn" ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n              <localized value="summary.name" lang="lang"></localized>\n            </a>\n            <localized ng-if="optionsCols.showDatasetsAcronymColumn" value="summary.name" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showDatasetsTypeColumn">\n            <localized value="classNames[(summary.variableType === \'Collected\' ? \'Study\' : \'Harmonization\') + \'Dataset\']" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showDatasetsNetworkColumn">\n            <a href ng-click="updateCriteria(summary.id, \'networks\')" ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks"><localized-number value="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks">-</span>\n          </td>\n          <td ng-if="optionsCols.showDatasetsStudiesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'studies\')" ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies"><localized-number value="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies">-</span>\n          </td>\n          <td ng-if="optionsCols.showDatasetsVariablesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'variables\')"><localized-number value="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].variables"></localized-number></a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/list/networks-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/networks-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div study-filter-shortcut></div>\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.network.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n        <tr>\n          <th rowspan="2" translate>acronym</th>\n          <th rowspan="2" translate>name</th>\n          <th rowspan="2" translate ng-if="optionsCols.showNetworksStudiesColumn">studies</th>\n          <th translate\n              ng-attr-colspan="{{colSpans.datasets}}"\n              ng-if="(optionsCols.showNetworksStudyDatasetColumn && choseIndividual()) || (optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization())">\n            datasets\n          </th>\n          <th rowspan="2" translate ng-if="optionsCols.showNetworksVariablesColumn">variables</th>\n          <th translate\n              ng-attr-colspan="{{colSpans.variables}}"\n              ng-if="(optionsCols.showNetworksStudyVariablesColumn && choseIndividual()) || (optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization())">variables</th>\n        </tr>\n        </tr>\n        <tr>\n          <th translate ng-if="optionsCols.showNetworksStudyDatasetColumn && choseIndividual()">search.dataset.collected</th>\n          <th translate ng-if="optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization()">search.dataset.harmonized</th>\n          <th translate ng-if="optionsCols.showNetworksStudyVariablesColumn && choseIndividual()">search.variable.collected</th>\n          <th translate ng-if="optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization()">search.variable.dataschema</th>\n        </tr>\n        </thead>\n        <tbody test-ref="search-results">\n        <tr ng-if="!summaries || !summaries.length">\n          <td colspan="6" translate>search.network.noResults</td>\n        </tr>\n        <tr ng-repeat="summary in summaries">\n          <td>\n            <a ng-href="{{PageUrlService.networkPage(summary.id)}}">\n              <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n            </a>\n          </td>\n          <td>\n            <localized value="summary.name" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showNetworksStudiesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'studies\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies"><localized-number value="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies">-</span>\n          </td>\n          <td ng-if="optionsCols.showNetworksStudyDatasetColumn && choseIndividual()">\n            <a href ng-click="updateCriteria(summary.id, \'Study\', \'datasets\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization()">\n            <a href ng-click="updateCriteria(summary.id, \'HarmonizationStudy\', \'datasets\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showNetworksVariablesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'variables\')"><localized-number value="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].variables"></localized-number></a>\n          </td>\n          <td ng-if="optionsCols.showNetworksStudyVariablesColumn && choseIndividual()">\n            <a href ng-click="updateCriteria(summary.id, \'Study\', \'variables\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyVariables"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization()">\n            <a href ng-click="updateCriteria(summary.id, \'HarmonizationStudy\', \'variables\')" ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].dataschemaVariables"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">-</span>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/list/pagination-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/pagination-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<span class="input-group voffset1">\n  <ul class="pagination pagination-sm no-padding no-margin">\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first">\n      <a href ng-click="selectPage(1, $event)">{{::getText(\'first\')}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-prev">\n      <a href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a>\n    </li>\n    <li ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}"\n        class="pagination-page">\n      <a href ng-click="selectPage(page.number, $event)">{{page.text}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-next">\n      <a href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a>\n    </li>\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last">\n      <a href ng-click="selectPage(totalPages, $event)">{{::getText(\'last\')}}</a>\n    </li>\n  </ul>\n  <ul class="pagination no-margin pagination-sm" ng-show="1 < totalPages">\n    <li>\n      <a href ng-show="1 < totalPages" class="pagination-total">{{$parent.pagination.from}} - {{$parent.pagination.to}} {{\'of\' | translate}} {{totalItems}}</a>\n    </li>\n  </ul>\n</span>')}]),angular.module("search/views/list/search-result-pagination-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/search-result-pagination-template.html",'<span ng-show="totalHits > 10" class="form-inline">\n  <span class="input-group">\n    <select class="form-control form-select"\n            ng-model="pagination.selected"\n            ng-options="size.label for size in pageSizes"\n            ng-change="pageSizeChanged()"></select>\n  </span>\n\n  <span ng-show="maxSize > 1"\n        uib-pagination\n        total-items="totalHits"\n        max-size="maxSize"\n        ng-model="pagination.currentPage"\n        boundary-links="true"\n        force-ellipses="true"\n        items-per-page="pagination.selected.value"\n        previous-text="&lsaquo;"\n        next-text="&rsaquo;"\n        first-text="&laquo;"\n        last-text="&raquo;"\n        template-url="search/views/list/pagination-template.html"\n        ng-change="pageChanged()">\n  </span>\n</span>')}]),angular.module("search/views/list/studies-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/studies-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div study-filter-shortcut></div>\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.study.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped">\n        <thead>\n        <tr>\n          <th rowspan="2" translate>acronym</th>\n          <th rowspan="2" translate>name</th>\n          <th rowspan="2" translate ng-if="choseAll()">type</th>\n          <th rowspan="2" translate ng-if="optionsCols.showStudiesDesignColumn && choseIndividual()">search.study.design</th>\n          <th translate\n              ng-attr-colspan="{{optionsCols.showStudiesQuestionnaireColumn + optionsCols.showStudiesPmColumn + optionsCols.showStudiesBioColumn + optionsCols.showStudiesOtherColumn}}"\n              ng-if="(optionsCols.showStudiesQuestionnaireColumn || optionsCols.showStudiesPmColumn || optionsCols.showStudiesBioColumn || optionsCols.showStudiesOtherColumn) && choseIndividual()">\n            search.study.dataSources\n          </th>\n          <th rowspan="2" translate ng-if="optionsCols.showStudiesParticipantsColumn && choseIndividual()">search.study.participants</th>\n          <th rowspan="2" translate ng-if="optionsCols.showStudiesNetworksColumn">networks</th>\n          <th rowspan="2" translate ng-if="optionsCols.showStudiesVariablesColumn">variables</th>\n          <th translate\n              ng-attr-colspan="{{optionsCols.showStudiesStudyDatasetsColumn + optionsCols.showStudiesStudyVariablesColumn}}"\n              ng-if="choseIndividual() && (optionsCols.showStudiesStudyDatasetsColumn || optionsCols.showStudiesStudyVariablesColumn)">search.coverage-buckets.collection\n          </th>\n          <th translate\n              ng-attr-colspan="{{optionsCols.showStudiesHarmonizationDatasetsColumn + optionsCols.showStudiesDataschemaVariablesColumn}}"\n              ng-if="choseHarmonization() && (optionsCols.showStudiesHarmonizationDatasetsColumn || optionsCols.showStudiesDataschemaVariablesColumn)">search.coverage-buckets.harmonization</th>\n        </tr>\n        <tr>\n          <th class="text-nowrap" title="{{datasourceTitles.questionnaires.title}}" ng-if="optionsCols.showStudiesQuestionnaireColumn && choseIndividual()">\n            <i class="fa fa-file-text-o"></i>\n          </th>\n          <th class="text-nowrap" title="{{datasourceTitles.physical_measures.title}}" ng-if="optionsCols.showStudiesPmColumn && choseIndividual()">\n            <i class="fa fa-stethoscope"></i>\n          </th>\n          <th class="text-nowrap"  title="{{datasourceTitles.biological_samples.title}}" ng-if="optionsCols.showStudiesBioColumn && choseIndividual()">\n            <i class="fa fa-flask"></i>\n          </th>\n          <th class="text-nowrap"  title="{{datasourceTitles.others.title}}" ng-if="optionsCols.showStudiesOtherColumn && choseIndividual()">\n            <i class="fa fa-plus-square-o"></i>\n          </th>\n          <th translate ng-if="optionsCols.showStudiesStudyDatasetsColumn && choseIndividual()">datasets</th>\n          <th translate ng-if="optionsCols.showStudiesStudyVariablesColumn && choseIndividual()">variables</th>\n          <th translate ng-if="optionsCols.showStudiesHarmonizationDatasetsColumn && choseHarmonization()">datasets</th>\n          <th translate ng-if="optionsCols.showStudiesDataschemaVariablesColumn && choseHarmonization()">variables</th>\n        </tr>\n        </thead>\n        <tbody test-ref="search-results">\n        <tr ng-repeat="summary in summaries" ng-init="lang = $parent.$parent.lang">\n          <td>\n            <a ng-href="{{PageUrlService.studyPage(summary.id, summary.studyResourcePath === \'harmonization-study\' ? \'harmonization\' : \'individual\')}}">\n              <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n            </a>\n          </td>\n          <td>\n            <localized value="summary.name" lang="lang"></localized>\n          </td>\n          <td ng-if="choseAll()">{{(summary.studyResourcePath === \'individual-study\' ? \'search.study.individual\' : \'search.study.harmonization\') | translate}}</td>\n          <td ng-if="optionsCols.showStudiesDesignColumn && choseIndividual()">\n            {{ summary.design === undefined ? \'-\' : \'study_taxonomy.vocabulary.methods-design.term.\' + summary.design + \'.title\' | translate}}\n          </td>\n          <td ng-if="optionsCols.showStudiesQuestionnaireColumn && choseIndividual()">\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'questionnaires\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'questionnaires\')">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesPmColumn && choseIndividual()">\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'physical_measures\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'physical_measures\')">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesBioColumn && choseIndividual()">\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'biological_samples\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'biological_samples\')">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesOtherColumn && choseIndividual()">\n            <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'others\')"></i><span\n              ng-if="!hasDatasource(summary.dataSources, \'others\')">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesParticipantsColumn && choseIndividual()">\n            <span ng-if="summary.targetNumber.number">\n              <localized-number value="summary.targetNumber.number"></localized-number>\n            </span>\n            <span translate ng-if="summary.targetNumber.noLimit">\n              numberOfParticipants.no-limit\n            </span>\n            <span ng-if="!summary.targetNumber.number && !summary.targetNumber.noLimit">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesNetworksColumn">\n            <a href ng-click="updateCriteria(summary.id, \'networks\')"\n                ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks"><localized-number value="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesVariablesColumn">\n            <a href ng-click="updateCriteria(summary.id, \'variables\')"><localized-number value="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].variables"></localized-number></a>\n          </td>\n          <td ng-if="optionsCols.showStudiesStudyDatasetsColumn && choseIndividual()">\n            <a href ng-click="updateCriteria(summary.id, \'Study\', \'datasets\')"\n                ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesStudyVariablesColumn && choseIndividual()">\n            <a href ng-click="updateCriteria(summary.id, \'Study\', \'variables\')" ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyVariables"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesHarmonizationDatasetsColumn && choseHarmonization()">\n            <a href ng-click="updateCriteria(summary.id, \'HarmonizationStudy\', \'datasets\')"\n               ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">-</span>\n          </td>\n          <td ng-if="optionsCols.showStudiesDataschemaVariablesColumn && choseHarmonization()">\n            <a href ng-click="updateCriteria(summary.id, \'HarmonizationStudy\', \'variables\')" ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets"><localized-number value="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].dataschemaVariables"></localized-number></a>\n            <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">-</span>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n')}]),angular.module("search/views/list/variables-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/variables-search-result-table-template.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <div study-filter-shortcut></div>\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.variable.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n        <tr>\n          <th translate>name</th>\n          <th translate>search.variable.label</th>\n          <th translate ng-if="optionsCols.showVariablesTypeColumn">type</th>\n          <th translate ng-if="optionsCols.showVariablesStudiesColumn">search.study.label</th>\n          <th translate ng-if="optionsCols.showVariablesDatasetsColumn">search.dataset.label</th>\n        </tr>\n        </thead>\n        <tbody test-ref="search-results">\n        <tr ng-repeat="summary in summaries">\n          <td>\n            <a test-ref="name"\n              href="{{PageUrlService.variablePage(summary.id) ? PageUrlService.variablePage(summary.id) : PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n              {{summary.name}}\n            </a>\n          </td>\n          <td>\n            <localized value="summary.variableLabel" lang="lang"></localized>\n          </td>\n          <td ng-if="optionsCols.showVariablesTypeColumn">\n            {{\'search.variable.\' + summary.variableType.toLowerCase() | translate}}\n          </td>\n          <td ng-if="optionsCols.showVariablesStudiesColumn">\n            <a ng-if="summary.studyId" ng-href="{{PageUrlService.studyPage(summary.studyId, summary.variableType == \'Dataschema\' ? \'harmonization\' : \'individual\')}}">\n              <localized value="summary.studyAcronym" lang="lang"></localized>\n            </a>\n            <a ng-if="summary.networkId" ng-href="{{PageUrlService.networkPage(summary.networkId)}}">\n              <localized value="summary.networkAcronym" lang="lang"></localized>\n            </a>\n          </td>\n          <td ng-if="optionsCols.showVariablesDatasetsColumn">\n            <a ng-href="{{PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n              <localized value="summary.datasetAcronym" lang="lang"></localized>\n            </a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/search-result-coverage-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-coverage-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div ng-show="display === \'coverage\'">\n  <coverage-result-table\n    result="result.coverage"\n    loading="loading"\n    bucket="bucket"\n    query="query"\n    criteria="criteria"\n    class="voffset2"\n    on-update-criteria="onUpdateCriteria"\n    on-remove-criteria="onRemoveCriteria"></coverage-result-table>\n</div>\n')}]),angular.module("search/views/search-result-graphics-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-graphics-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div ng-show="display === \'graphics\'">\n  <graphics-result on-update-criteria="onUpdateCriteria" result="result.graphics" loading="loading" class="voffset2"></graphics-result>\n</div>')}]),angular.module("search/views/search-result-list-dataset-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-dataset-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="tab-pane" ng-show="options.datasets.showSearchTab" ng-class="{\'active\': activeTarget.datasets.active}">\n  <datasets-result-table loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.datasetResultDto[\'obiba.mica.DatasetResultDto.result\'].datasets"></datasets-result-table>\n</div>\n')}]),angular.module("search/views/search-result-list-network-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-network-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="tab-pane" ng-show="options.networks.showSearchTab" ng-class="{\'active\': activeTarget.networks.active}">\n  <networks-result-table loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.networkResultDto[\'obiba.mica.NetworkResultDto.result\'].networks"></networks-result-table>\n</div>\n')}]),angular.module("search/views/search-result-list-study-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-study-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="tab-pane" ng-show="options.studies.showSearchTab" ng-class="{\'active\': activeTarget.studies.active}">\n  <studies-result-table lang="lang" loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.studyResultDto[\'obiba.mica.StudyResultDto.result\'].summaries"></studies-result-table>\n</div>')}]),angular.module("search/views/search-result-list-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div ng-show="display === \'list\'">\n    <ul class="nav nav-pills pull-left voffset2" test-ref="search-counts">\n        <li role="presentation" ng-repeat="res in resultTabsOrder"\n            ng-class="{active: activeTarget[targetTypeMap[res]].active && resultTabsOrder.length > 1, disabled: resultTabsOrder.length === 1}"\n            ng-if="options[targetTypeMap[res]].showSearchTab">\n            <a href\n               ng-click="selectTarget(targetTypeMap[res])" ng-if="resultTabsOrder.length > 1">\n                {{targetTypeMap[res] | translate}}\n                <span class="badge hoffset1" test-ref="{{targetTypeMap[res]}}"><small>{{getTotalHits(res) | localizedNumber}}</small></span>\n            </a>\n            <a href style="cursor: default;" ng-if="resultTabsOrder.length === 1">\n              <span class="text-primary">\n                {{targetTypeMap[res] | translate}} (<small>{{getTotalHits(res) | localizedNumber}}</small>)\n              </span>\n            </a>\n        </li>\n    </ul>\n    <div class="pull-right voffset2">\n        <a target="_self" ng-if="type==\'studies\'" download class="btn btn-info" ng-href="{{getStudySpecificReportUrl()}}">\n            <i class="fa fa-download"></i> {{\'report-group.study.button-name\' | translate}}\n        </a>\n        <a target="_self" download class="btn btn-info" ng-href="{{getReportUrl()}}">\n            <i class="fa fa-download"></i> {{\'download\' | translate}}\n        </a>\n        <div ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active" class="inline" test-ref="pager">\n          <span search-result-pagination\n                target="activeTarget[targetTypeMap[res]].name"\n                total-hits="activeTarget[targetTypeMap[res]].totalHits"\n                on-change="onPaginate"></span>\n        </div>\n    </div>\n    <div class="clearfix"/>\n    <div class="tab-content">\n        <ng-include include-replace ng-repeat="res in resultTabsOrder"\n                    src="\'search/views/search-result-list-\' + res + \'-template.html\'"></ng-include>\n    </div>\n</div>\n')}]),angular.module("search/views/search-result-list-variable-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-variable-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="tab-pane" ng-show="options.variables.showSearchTab" ng-class="{\'active\': activeTarget.variables.active}">\n  <variables-result-table loading="loading"\n      summaries="result.list.variableResultDto[\'obiba.mica.DatasetVariableResultDto.result\'].summaries"></variables-result-table>\n</div>\n')}]),angular.module("search/views/search-result-panel-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-panel-template.html",'<div>\n  <ng-include include-replace ng-repeat="tab in searchTabsOrder"\n              src="getUrlTemplate(tab)"></ng-include>\n</div>\n')}]),angular.module("search/views/search-study-filter-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-study-filter-template.html",'<div class="voffset2">\n  <div class="btn btn-group" style="padding: 0">\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'all\'" translate>all</label>\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'individual\'" translate>search.coverage-buckets.individual</label>\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'harmonization\'" translate>search.coverage-buckets.harmonization</label>\n  </div>\n</div>')}]),angular.module("search/views/search.html",[]).run(["$templateCache",function(a){a.put("search/views/search.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div ng-show="inSearchMode()">\n  <div class="container alert-fixed-position">\n    <obiba-alert id="SearchController"></obiba-alert>\n  </div>\n\n  <div class="alert-growl-container">\n    <obiba-alert id="SearchControllerGrowl"></obiba-alert>\n  </div>\n\n  <div ng-if="searchHeaderTemplateUrl" ng-include="searchHeaderTemplateUrl"></div>\n\n  <div class="row voffset2">\n    <div class="col-md-3" ng-if="hasFacetedTaxonomies" >\n      <!-- Search Facets region -->\n      <taxonomies-facets-panel id="search-facets-region" faceted-taxonomies="facetedTaxonomies" criteria="search.criteria" on-select-term="onSelectTerm"\n                    on-refresh="refreshQuery" lang="lang"></taxonomies-facets-panel>\n    </div>\n    <div class="{{hasFacetedTaxonomies ? \'col-md-9\' : \'col-md-12\'}}">\n\n      <!-- Search box region -->\n      <div id="search-region" class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n        <div ng-if="options.showSearchBox" id="search-box-region" class="{{hasFacetedTaxonomies ? \'\' : \'row\'}}">\n          <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-3\'}}"></div>\n          <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-6\'}}">\n            <script type="text/ng-template" id="customTemplate.html">\n              <a ng-if="match.model.id">\n                <table style="border:none;">\n                  <tbody>\n                  <tr>\n                    <td style="min-width: 30px;">\n                  <span title="{{match.model.target + \'-classifications\' | translate}}">\n                    <i class="{{\'i-obiba-large i-obiba-\' + match.model.target}}"></i>\n                  </span>\n                    </td>\n                    <td>\n                  <span\n                          uib-popover-html="match.model.itemDescription | uibTypeaheadHighlight:query"\n                          popover-title="{{match.model.itemTitle}}"\n                          popover-placement="bottom"\n                          popover-trigger="\'mouseenter\'"\n                          ng-bind-html="match.model.itemTitle | uibTypeaheadHighlight:query">\n                  </span>\n                      <small class="help-block no-margin" title="{{match.model.itemParentDescription}}">\n                        {{match.model.itemParentTitle}}\n                      </small>\n                    </td>\n                  </tr>\n                  </tbody>\n                </table>\n              </a>\n              <a ng-if="!match.model.id" class="{{match.model.status}}">\n                <small class="help-block no-margin">\n                  {{match.model.message}}\n                </small>\n              </a>\n            </script>\n          <span class="input-group input-group-sm">\n            <span class="input-group-btn" uib-dropdown>\n              <button type="button" class="btn btn-primary" uib-dropdown-toggle>\n                {{\'taxonomy.target.\' + (documents.search.target ? documents.search.target : \'all\')| translate}} <span\n                      class="caret"></span>\n              </button>\n              <ul uib-dropdown-menu role="menu">\n                <li>\n                  <a href ng-click="selectSearchTarget()" translate>taxonomy.target.all</a>\n                </li>\n                <li ng-repeat="target in targets" role="menuitem"><a href ng-click="selectSearchTarget(target)">{{\'taxonomy.target.\'\n                  + target | translate}}</a></li>\n              </ul>\n            </span>\n            <input type="text" ng-model="$parent.selectedCriteria"\n                   placeholder="{{\'search.placeholder.\' + (documents.search.target ? documents.search.target : \'all\') | translate}}"\n                   uib-typeahead="criteria for criteria in searchCriteria($viewValue)"\n                   typeahead-min-length="2"\n                   typeahead-loading="documents.search.active"\n                   typeahead-template-url="customTemplate.html"\n                   typeahead-on-select="selectCriteria($item)"\n                   class="form-control">\n            <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>\n            <span ng-if="options.SearchHelpLinkUrl" class="input-group-btn">\n              <a type="button" target="_blank" class="btn btn-default" href="{{options.SearchHelpLinkUrl}}">\n                <span class="glyphicon glyphicon-question-sign"></span> {{options.SearchHelpLinkLabel}}</a>\n            </span>\n          </span>\n\n          </div>\n        </div>\n        <div ng-if="options.showSearchBrowser" id="search-selector-region" class="{{hasFacetedTaxonomies ? \'\' : \'row\'}}">\n          <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-3\'}}"></div>\n          <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-6\'}}">\n            <small>\n              <ul class="nav nav-pills">\n                <li ng-if="hasClassificationsTitle">\n                  <label class="nav-label" translate>search.classifications-title</label>\n                </li>\n                <li ng-repeat="t in taxonomyNav track by $index" title="{{translateTaxonomyNav(t, \'description\')}}">\n                  <a href ng-click="showTaxonomy(t.target, t.name)" ng-if="!t.terms">{{translateTaxonomyNav(t, \'title\')}}</a>\n            <span uib-dropdown ng-if="t.terms">\n              <ul class="nav nav-pills">\n                <li>\n                  <a href uib-dropdown-toggle>{{translateTaxonomyNav(t, \'title\')}} <span class="caret"></span></a>\n                </li>\n              </ul>\n              <ul uib-dropdown-menu>\n                <li ng-repeat="st in t.terms">\n                  <a href ng-click="showTaxonomy(t.target, st.name)" title="{{translateTaxonomyNav(st, \'description\')}}">{{translateTaxonomyNav(st, \'title\')}}</a>\n                </li>\n              </ul>\n            </span>\n                </li>\n                <li>\n                  <a href ng-click="goToClassifications()" title="{{\'search.classifications-show\' | translate}}">\n                    <span ng-if="hasClassificationsLinkLabel" translate>search.classifications-link</span>\n                    <i class="glyphicon glyphicon-option-horizontal" ng-if="!hasClassificationsLinkLabel"></i>\n                  </a>\n                </li>\n              </ul>\n            </small>\n          </div>\n        </div>\n        <taxonomies-panel ng-if="options.showSearchBrowser" taxonomy-name="taxonomyName" target="target" on-select-term="onSelectTerm"\n                          on-close="clearTaxonomy" lang="lang" taxonomies-shown="taxonomiesShown"></taxonomies-panel>\n      </div>\n\n      <div ng-if="hasFacetedTaxonomies && hasFacetedNavigationHelp && !(search.criteria.children && search.criteria.children.length > 0)">\n        <p class="help-block" translate>search.faceted-navigation-help</p>\n      </div>\n\n      <!-- Search criteria region -->\n      <div id="search-criteria-region" ng-class="options.showSearchBox || options.showSearchBrowser ? \'voffset2\' : \'\'" class="panel panel-default" ng-if="search.criteria.children && search.criteria.children.length>0">\n        <div class="panel-body">\n          <table style="border:none">\n            <tbody>\n            <tr>\n              <td>\n                <a href class="btn btn-sm btn-default" ng-click="clearSearchQuery()" translate>clear</a>\n              </td>\n              <td style="padding-left: 10px">\n                <div criteria-root item="search.criteria" query="search.query" advanced="search.advanced" on-remove="removeCriteriaItem"\n                     on-refresh="refreshQuery" class="inline"></div>\n\n                <small class="hoffset2" ng-if="showAdvanced()">\n                  <a href ng-click="toggleSearchQuery()"\n                     title="{{search.advanced ? \'search.basic-help\' : \'search.advanced-help\' | translate}}" translate>\n                    {{search.advanced ? \'search.basic\' : \'search.advanced\' | translate}}\n                  </a>\n                </small>\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <!-- Search Results region -->\n      <div id="search-result-region" class="voffset3 can-full-screen" ng-if="search.query" fullscreen="isFullscreen">\n        <div ng-if="searchTabsOrder.length > 1">\n          <a href class="btn btn-sm btn-default pull-right" ng-click="toggleFullscreen()">\n            <i class="glyphicon" ng-class="{\'glyphicon-resize-full\': !isFullscreen, \'glyphicon-resize-small\': isFullscreen}"></i>\n          </a>\n          <ul class="nav nav-tabs voffset2">\n            <li role="presentation" ng-repeat="tab in searchTabsOrder" ng-class="{active: search.display === tab}">\n              <a href ng-click="selectDisplay(tab)">{{ \'search.\' + tab | translate}}</a>\n            </li>\n          </ul>\n        </div>\n\n        <div translate>{{\'search.\' + search.display + \'-help\'}}</div>\n        <result-panel display="search.display"\n                      type="search.type"\n                      bucket="search.bucket"\n                      criteria="search.criteria"\n                      query="search.executedQuery"\n                      result="search.result"\n                      loading="search.loading"\n                      on-update-criteria="onUpdateCriteria"\n                      on-remove-criteria="onRemoveCriteria"\n                      on-type-changed="onTypeChanged"\n                      on-bucket-changed="onBucketChanged"\n                      on-paginate="onPaginate"\n                      search-tabs-order="searchTabsOrder"\n                      result-tabs-order="resultTabsOrder"\n                      lang="lang"></result-panel>\n      </div>\n\n    </div>\n  </div>\n\n</div>')}]),angular.module("utils/views/unsaved-modal.html",[]).run(["$templateCache",function(a){a.put("utils/views/unsaved-modal.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<div class="modal-content">\n    <div class="modal-header">\n        <h4 class="modal-title" translate>unsaved-title</h4>\n    </div>\n    <div class="modal-body" translate>\n        unsaved-prompt\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-default" type="button" ng-click="cancel()" translate>cancel</button>\n        <button class="btn btn-primary" type="button" ng-click="ok()" translate>ok</button>\n    </div>\n</div>\n')}]),angular.module("views/pagination-template.html",[]).run(["$templateCache",function(a){a.put("views/pagination-template.html",'<!--\n  ~ Copyright (c) 2017 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -->\n\n<ul class="pagination no-margin pagination-sm" ng-if="1 < pages.length">\n  <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == 1 }">\n    <a href="" ng-click="setCurrent(1)">&laquo;</a>\n  </li>\n  <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == 1 }">\n    <a href="" ng-click="setCurrent(pagination.current - 1)">&lsaquo;</a>\n  </li>\n  <li ng-repeat="pageNumber in pages track by $index" ng-class="{ active : pagination.current == pageNumber, disabled : pageNumber == \'...\' }">\n    <a href="" ng-click="setCurrent(pageNumber)">{{ pageNumber }}</a>\n  </li>\n  <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == pagination.last }">\n    <a href="" ng-click="setCurrent(pagination.current + 1)">&rsaquo;</a>\n  </li>\n  <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == pagination.last }">\n    <a ng-class="round-border" href="" ng-click="setCurrent(pagination.last)">&raquo;</a>\n  </li>\n</ul>\n\n\n<ul class="pagination no-margin pagination-sm" ng-if="1 < pages.length">\n  <li>\n    <a href="" class="pagination-total" ng-if="1 < pages.length" class="pagination-total"><span>{{ range.lower }} - {{ range.upper }} </span><span translate>pagination.of</span><span> {{ range.total }}</span></a>\n  </li>\n</ul>')}]);