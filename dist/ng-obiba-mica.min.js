"use strict";var ngObibaMica;function NgObibaMicaTemplateUrlFactory(){var a={searchStudiesResultTable:"search/components/result/studies-result-table/component.html",searchNetworksResultTable:"search/components/result/networks-result-table/component.html",searchDatasetsResultTable:"search/components/result/datasets-result-table/component.html",searchCriteriaRegionTemplate:"search/components/criteria/item-region/region/component.html",vocabularyFilterDetailHeading:"search/components/vocabulary-filter-detail-heading/component.html",CriterionDropdownTemplate:"search/components/criteria/item-region/dropdown/component.html",searchResultList:"search/components/result/search-result/list.html",searchInputList:"lists/views/input-search-widget/input-search-widget-template.html",searchResultCoverage:"search/components/result/search-result/coverage.html",searchResultGraphics:"search/components/result/search-result/graphics.html",variableCrosstab:"analysis/crosstab/views/crosstab-variable-crosstab.html",variableFrequencies:"analysis/crosstab/views/crosstab-variable-frequencies.html",variableFrequenciesEmpty:"analysis/crosstab/views/crosstab-variable-frequencies-empty.html",variableStatistics:"analysis/crosstab/views/crosstab-variable-statistics.html",variableStatisticsEmpty:"analysis/crosstab/views/crosstab-variable-statistics-empty.html",searchCellStatValue:"search/components/result/cell-stat-value/component.html"},t={registry:null};function e(e){var t=e;this.getHeaderUrl=function(e){return e in t?t[e].header:null},this.getFooterUrl=function(e){return e in t?t[e].footer:null},this.getTemplateUrl=function(e){return e in t?t[e].template?t[e].template:a[e]:null}}t.setTemplateUrl=function(e,t){e in this.registry&&(this.registry[e].template=t)},t.setHeaderUrl=function(e,t){e in this.registry&&(this.registry[e].header=t)},t.setFooterUrl=function(e,t){e in this.registry&&(this.registry[e].footer=t)},t.$get=function(){return new e(this.registry)},this.create=function(e){return t.registry=e,t}}!function(){function a(){var t=this;t.$get=function(){throw new Error("The provider factory method $get() must be overridden by client code.")},t.setFactory=function(e){t.$get=e}}function n(){var a={DataAccessClientDetailPath:"",DataAccessClientListPath:"",DataAccessFormConfigResource:"ws/config/data-access-form",DataAccessAmendmentFormConfigResource:"ws/config/data-access-amendment-form",DataAccessRequestsResource:"ws/data-access-requests",DataAccessAmendmentsResource:"ws/data-access-request/:parentId/amendments",DataAccessAmendmentResource:"ws/data-access-request/:parentId/amendment/:id",DataAccessRequestsExportHistoryResource:"ws/data-access-requests/_history?lang=:lang",DataAccessRequestsExportCsvResource:"ws/data-access-requests/csv?lang=:lang",DataAccessRequestResource:"ws/data-access-request/:id",DataAccessRequestActionLogsResource:"ws/data-access-request/:id/_log-actions",DataAccessAmendmentsLogHistoryResource:"/ws/data-access-request/:id/amendments/_history",DataAccessRequestAttachmentsUpdateResource:"/ws/data-access-request/:id/_attachments",DataAccessRequestAttachmentDownloadResource:"/ws/data-access-request/:id/attachments/:attachmentId/_download",SchemaFormAttachmentDownloadResource:"/ws/:path/form/attachments/:attachmentName/:attachmentId/_download",DataAccessRequestDownloadPdfResource:"/ws/data-access-request/:id/_pdf",DataAccessRequestCommentsResource:"ws/data-access-request/:id/comments?admin=:admin",DataAccessRequestCommentResource:"ws/data-access-request/:id/comment/:commentId",DataAccessRequestStatusResource:"ws/data-access-request/:id/_status?to=:status",DataAccessAmendmentStatusResource:"ws/data-access-request/:parentId/amendment/:id/_status?to=:status",TempFileUploadResource:"ws/files/temp",TempFileResource:"ws/files/temp/:id",TaxonomiesSearchResource:"ws/taxonomies/_search",TaxonomiesResource:"ws/taxonomies/_filter",TaxonomyResource:"ws/taxonomy/:taxonomy/_filter",VocabularyResource:"ws/taxonomy/:taxonomy/vocabulary/:vocabulary/_filter",VariableResource:"ws/variable/:id",VariableSummaryResource:"ws/variable/:id/summary",SetsResource:"ws/:type/sets",SetsImportResource:"ws/:type/sets/_import",SetResource:"ws/:type/set/:id",SetClearResource:"ws/:type/set/:id/documents",SetDocumentsResource:"ws/:type/set/:id/documents?from=:from&limit=:limit",SetExistsResource:"ws/:type/set/:id/document/:did/_exists",SetImportResource:"ws/:type/set/:id/documents/_import",SetImportQueryResource:"ws/:type/set/:id/documents/_rql",SetRemoveResource:"ws/:type/set/:id/documents/_delete",JoinQuerySearchResource:"ws/:type/_rql",JoinQuerySearchCsvResource:"ws/:type/_rql_csv?query=:query",JoinQuerySearchCsvReportResource:"ws/:type/_report?query=:query",JoinQuerySearchCsvReportByNetworkResource:"ws/:type/_report_by_network?networkId=:networkId&locale=:locale",JoinQueryCoverageResource:"ws/variables/_coverage",JoinQueryCoverageDownloadResource:"ws/variables/_coverage_download?query=:query",VariablePage:"",NetworkPage:"#/network/:network",StudyPage:"#/:type/:study",StudyPopulationsPage:"#/:type/:study",DatasetPage:"#/:type/:dataset",BaseUrl:"/",FileBrowserFileResource:"ws/file/:path/",FileBrowserSearchResource:"ws/files-search/:path",FileBrowserDownloadUrl:"ws/draft/file-dl/:path?inline=:inline",SearchBaseUrl:"#/search",DocumentSuggestion:"ws/:documentType/_suggest",EntitiesCountResource:"ws/datasets/entities/_count?query=:query",EntitiesCountBaseUrl:"#/entities-count",DatasetCategoricalVariablesResource:"ws/:dsType/:dsId/variables/:query/categorical",DatasetVariablesResource:"ws/:dsType/:dsId/variables/:query",DatasetVariableResource:"ws/variable/:varId",DatasetVariablesCrosstabResource:"ws/:dsType/:dsId/variables/cross/:v1/by/:v2",DatasetResource:"ws/dataset/:dsType/:dsId"};function e(e){var t=e;this.getUrl=function(e){return e in t?t[e]:null}}this.setUrl=function(e,t){e in a&&(a[e]=t)},this.$get=function(){return new e(a)}}(ngObibaMica=angular.module("ngObibaMica",["schemaForm","ngCookies","obiba.mica.utils","obiba.mica.file","obiba.mica.attachment","obiba.mica.access","obiba.mica.search","obiba.mica.analysis","obiba.mica.graphics","obiba.mica.localized","obiba.mica.fileBrowser","angularUtils.directives.dirPagination"])).constant("USER_ROLES",{all:"*",admin:"mica-administrator",reviewer:"mica-reviewer",editor:"mica-editor",user:"mica-user",dao:"mica-data-access-officer"}).config(["$provide","paginationTemplateProvider",function(e,t){e.provider("ngObibaMicaUrl",n),e.provider("ObibaServerConfigResource",a),t.setPath("views/pagination-template.html")}])}(),angular.module("templates-ngObibaMica",[]).run(["$templateCache",function(e){e.put("access/components/action-log/component.html",'<form class="form-inline voffset2" name="actionLogForm">\n  <div class="form-group">\n    <input type="text" class="form-control" ng-model="$ctrl.item.action" ng-required="true" placeholder="{{\'data-access-request.action-log.action-placeholder\' | translate}}" typeahead-editable="true" uib-typeahead="value for value in $ctrl.predefinedActionNames | filter:$viewValue | limitTo:8">\n  </div>\n  <div class="form-group">\n    <div class="input-group">\n      <input type="datetime" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="$ctrl.item.changedOn" ng-required="true" ng-focus="$ctrl.open = !$ctrl.item.changedOn" is-open="$ctrl.open" placeholder="dd/MM/yyyy" show-button-bar="false">\n\n      <span class="input-group-btn">\n        <button type="button" class="btn btn-sm btn-default" ng-click="$ctrl.open = !$ctrl.open">\n          <i class="glyphicon glyphicon-calendar"></i>\n        </button>\n      </span>\n    </div>\n  </div>\n\n  <button type="button" class="btn btn-sm btn-info" ng-click="$ctrl.add($ctrl.item)">{{\'global.add\' | translate}}\n    <i class="fa fa-plus"></i>\n  </button>\n\n  <div class="form-group has-error" ng-if="$ctrl.showError && (!$ctrl.item.action || !$ctrl.item.changedOn)">\n    <span class="control-label">{{\'data-access-request.action-log.required\' | translate}}</span>\n  </div>\n</form>'),e.put("access/components/action-log/item/component.html",'<ul class="list-inline" ng-if="$ctrl.showButtons">\n  <li>\n    <a ng-click="$ctrl.edit($ctrl.item)">\n      <i class="fa fa-pencil"></i>\n    </a>\n  </li>\n  <li>\n    <a ng-click="$ctrl.remove($ctrl.item)">\n      <i class="fa fa-trash-o"></i>\n    </a>\n  </li>\n</ul>'),e.put("access/components/action-log/item/delete-modal.html",'<div class="modal-header">\n  <h4 class="modal-title">\n    <i class="fa fa-exclamation-triangle"></i>\n    {{\'data-access-request.action-log.delete.title\' | translate}}\n  </h4>\n</div>\n\n<div class="modal-body">\n  {{\'data-access-request.action-log.delete.message\' | translate:$modal.item}}\n</div>\n\n<div class="modal-footer">\n  <button class="btn btn-responsive btn-default" type="button" ng-click="$dismiss()" translate>cancel</button>\n  <button class="btn btn-responsive btn-primary" type="button" ng-click="$close()" translate>ok</button>\n</div>'),e.put("access/components/action-log/item/edit-modal.html",'<div class="modal-header">\n  <h4 class="modal-title">\n    {{\'data-access-request.action-log.edit.title\' | translate}}\n  </h4>\n</div>\n\n<div class="modal-body">\n  <form name="actionLogModalForm">\n    <div class="form-group">\n      <input type="text" class="form-control" ng-model="$modal.item.action" ng-required="true" placeholder="{{\'data-access-request.action-log.action-placeholder\' | translate}}" typeahead-editable="true" uib-typeahead="value for value in $modal.predefinedActionNames | filter:$viewValue | limitTo:8">\n    </div>\n\n    <div class="form-group">\n      <div class="input-group">\n        <input type="datetime" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="$modal.item.changedOn" ng-required="true" ng-focus="$modal.open = !$modal.item.changedOn" is-open="$modal.open" placeholder="dd/MM/yyyy" show-button-bar="false">\n\n        <span class="input-group-btn">\n          <button type="button" class="btn btn-sm btn-default" ng-click="$modal.open = !$modal.open">\n            <i class="glyphicon glyphicon-calendar"></i>\n          </button>\n        </span>\n      </div>\n    </div>\n  </form>\n</div>\n\n<div class="modal-footer">\n  <button class="btn btn-responsive btn-default" type="button" ng-click="$dismiss()" translate>cancel</button>\n  <button class="btn btn-responsive btn-primary" type="button" ng-disabled="!$modal.item.action || !$modal.item.changedOn" ng-click="$close($modal.item)" translate>ok</button>\n</div>'),e.put("access/components/entity-list/component.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  <div class="row">\n    <div class="col-xs-12">\n      <a ng-href="#{{$ctrl.entityBaseUrl}}/new" class="btn btn-info" ng-if="$ctrl.canAdd">\n        <i class="fa fa-plus"></i>\n        <span>{{$ctrl.addButtonCaption | translate}}</span>\n      </a>\n\n      <span ng-bind-html="config.newRequestButtonHelpText" ng-if="$ctrl.canAdd"></span>\n\n      <span class="pull-right" ng-if="$ctrl.requests.length > 0 && !$ctrl.parentId">\n        <a target="_self" download class="btn btn-info" ng-href="{{$ctrl.getCsvExportHref()}}">\n          <i class="fa fa-download"></i> {{\'report\' | translate}}\n        </a>\n\n        <a target="_self" download class="btn btn-info" ng-href="{{$ctrl.getHistoryExportHref()}}">\n          <i class="fa fa-download"></i> {{\'history\' | translate}}\n        </a>\n      </span>\n    </div>\n  </div>\n\n  <p class="help-block">\n    <span ng-if="!$ctrl.canAdd" translate>data-access-amendment.cannot-add</span>\n    <span ng-if="$ctrl.canAdd && $ctrl.requests.length == 0 && !loading">{{$ctrl.noneCaption | translate}}</span>\n  </p>\n\n  <p ng-if="$ctrl.loading" class="voffset2 loading">\n  </p>\n\n  <div ng-if="$ctrl.requests.length > 0">\n    <div class="row voffset2">\n      <div class="col-xs-4">\n        <span class="input-group input-group-sm no-padding-top">\n          <span class="input-group-addon" id="data-access-requests-search">\n            <i class="glyphicon glyphicon-search"></i>\n          </span>\n          <input ng-model="$ctrl.searchText" type="text" class="form-control" aria-describedby="data-access-requests-search">\n        </span>\n      </div>\n      <div class="col-xs-3">\n        <ui-select id="status-select" theme="bootstrap" ng-model="$ctrl.searchStatus.filter" reset-search-input="true">\n          <ui-select-match allow-clear="true" placeholder="{{\'data-access-request.status-placeholder\' | translate}}">\n            <span ng-bind-html="$select.selected.translation"></span>\n          </ui-select-match>\n          <ui-select-choices repeat="data in $ctrl.REQUEST_STATUS">\n            {{data.translation}}\n          </ui-select-choices>\n        </ui-select>\n      </div>\n      <div class="col-xs-6">\n        <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n      </div>\n    </div>\n\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped" obiba-table-sorter="$ctrl.requests">\n        <thead>\n          <tr>\n            <th data-column-name="id">ID</th>\n            <th ng-if="$ctrl.showApplicant" data-column-name="applicant">{{"data-access-request.applicant" | translate}}</th>\n            <th data-column-name="title">{{"title" | translate}}</th>\n            <th data-column-name="timestamps.lastUpdate">{{"data-access-request.lastUpdate" | translate}}</th>\n            <th data-column-name="submissionDate">{{"data-access-request.submissionDate" | translate}}</th>\n            <th data-column-name="status">{{"data-access-request.status" | translate}}</th>\n            <th translate>actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr dir-paginate="request in $ctrl.requests | filter:{status: $ctrl.searchStatus.filter.key} : true | filter:$ctrl.searchText | itemsPerPage: 20">\n            <td>\n              <a ng-href="#{{$ctrl.entityBaseUrl}}/{{request.id}}" ng-if="$ctrl.actions.canView(request)" translate>{{request.id}}</a>\n              <span ng-if="!$ctrl.actions.canView(request)">{{request.id}}</span>\n            </td>\n            <td ng-if="$ctrl.showApplicant">\n              <span ng-if="!request.profile.attributes">\n                {{request.applicant}}\n              </span>\n              <span ng-if="request.profile.attributes && $ctrl.actions.canViewProfile(\'mica-user\') && !$ctrl.actions.canViewProfile(\'mica-data-access-officer\')">\n                {{$ctrl.UserProfileService.getFullName(request.profile) || request.applicant}}\n              </span>\n              <a href ng-click="$ctrl.UserProfileModalService.show(request.profile)" ng-if="request.profile.attributes && $ctrl.actions.canViewProfile(\'mica-data-access-officer\')">\n                {{$ctrl.UserProfileService.getFullName(request.profile) || request.applicant}}\n              </a>\n            </td>\n            <td>\n              {{request.title}}\n            </td>\n            <td>\n              <span title="{{(request.timestamps.lastUpdate || request.timestamps.created) | amDateFormat: \'lll\'}}">\n                {{(request.timestamps.lastUpdate || request.timestamps.created) | amCalendar}}\n              </span>\n\n            </td>\n            <td>\n              <span ng-if="request.submissionDate" title="{{ request.submissionDate | amDateFormat: \'lll\' }}">\n                {{request.submissionDate | amCalendar}}\n              </span>\n            </td>\n            <td>\n              {{request.status | translate}}\n            </td>\n            <td>\n              <ul class="list-inline">\n                <li ng-if="$ctrl.actions.canEdit(request)">\n                  <a ng-href="#{{$ctrl.entityBaseUrl}}/{{request.id}}/edit" title="{{\'edit\' | translate}}">\n                    <i class="fa fa-pencil"></i>\n                  </a>\n                </li>\n                <li>\n                  <a ng-if="$ctrl.actions.canDelete(request)" ng-click="$ctrl.deleteRequest(request)" title="{{\'delete\' | translate}}">\n                    <i class="fa fa-trash-o"></i>\n                  </a>\n                </li>\n              </ul>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>'),e.put("access/components/print-friendly-view/component.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n<div>\n  <div class="clearfix"></div>\n  <div class="voffset2" ng-if="$ctrl.project && $ctrl.project.permissions && $ctrl.project.permissions.view">\n    <div ng-if="$ctrl.project" class="pull-right">\n      <small class="help-block inline"> {{\'research-project.label\' | translate}} :\n        <a route-checker route-checker-hides-parent="true" href ng-href="#/project/{{$ctrl.project.id}}">{{$ctrl.project.id}}</a>\n      </small>\n    </div>\n  </div>\n\n  <div>\n    <form id="request-form" name="forms.requestForm">\n      <obiba-schema-form-renderer model="$ctrl.model" schema-form="$ctrl.accessForm" read-only="true"></obiba-schema-form-renderer>\n    </form>\n  </div>\n\n  <div ng-if="$ctrl.lastSubmittedDate">\n    <h3 translate>data-access-request.submissionDate</h3>\n    <p>{{$ctrl.lastSubmittedDate.changedOn | amDateFormat:\'dddd, MMMM Do YYYY\' | capitalizeFirstLetter}}</p>\n  </div>\n</div>'),e.put("access/views/data-access-amendment-view.html",'<div>\n  <print-friendly-view class="visible-print" valid-form="true" model="model" access-form="dataAccessForm" last-submitted-date="lastSubmittedDate">\n  </print-friendly-view>\n\n  <div class="hidden-print">\n    <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n    <obiba-alert id="DataAccessAmendmentViewController"></obiba-alert>\n\n    <p class="help-block pull-left" ng-if="requestEntity.applicant">\n      <span translate>created-by</span>\n      <span ng-if="!actions.canViewProfile(\'mica-data-access-officer\')">\n        {{getFullName(requestEntity.profile) || requestEntity.applicant}},\n      </span>\n      <span ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n        <a href ng-click="userProfile(requestEntity.profile)">\n          {{getFullName(requestEntity.profile) || requestEntity.applicant}}</a>,\n      </span>\n      <span title="{{requestEntity.timestamps.created | amDateFormat: \'lll\'}}">{{requestEntity.timestamps.created | amCalendar}}</span>\n      <span class="label label-success">{{requestEntity.status | translate}}</span>\n    </p>\n\n    <div class="pull-right" ng-if="read && formDrawn">\n      <a ng-click="submit()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canSubmit(requestEntity)" class="btn btn-info" translate>submit</a>\n\n      <a ng-click="reopen()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canReopen(requestEntity)" class="btn btn-info" translate>reopen</a>\n\n      <a ng-click="review()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canReview(requestEntity)" class="btn btn-info" translate>review</a>\n\n      <a ng-click="conditionallyApprove()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canConditionallyApprove(requestEntity)" class="btn btn-info" translate>conditionallyApprove</a>\n\n      <a ng-click="approve()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canApprove(requestEntity)" class="btn btn-info" translate>approve</a>\n\n      <a ng-click="reject()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canReject(requestEntity)" class="btn btn-info" translate>reject</a>\n\n      <a ng-href="#{{entityUrl}}/edit" ng-if="actions.canEdit(requestEntity)" class="btn btn-primary" title="{{\'edit\' | translate}}">\n        <i class="fa fa-pencil-square-o"></i>\n      </a>\n\n      <a ng-click="printForm()" class="btn btn-default" title="{{\'global.print\' | translate}}">\n        <i class="fa fa-print"></i>\n        <span translate>global.print</span>\n      </a>\n\n      <a ng-click="delete()" ng-if="actions.canDelete(requestEntity)" class="btn btn-danger" title="{{\'delete\' | translate}}">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <form id="request-form" name="forms.requestForm">\n      <div class="pull-right" ng-if="!read && formDrawn">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n        <a ng-click="save()" type="button" class="btn btn-primary">\n          <span translate>save</span>\n        </a>\n\n        <a ng-click="validate(forms.requestForm)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <obiba-schema-form-renderer model="model" schema-form="dataAccessForm" read-only="read" on-redraw="toggleFormDrawnStatus"></obiba-schema-form-renderer>\n\n      <div class="clearfix"></div>\n\n      <div class="pull-right" ng-if="!read && formDrawn">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n        <a ng-click="save()" type="button" class="btn btn-primary">\n          <span translate>save</span>\n        </a>\n\n        <a ng-click="validate(forms.requestForm)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n    </form>\n  </div>\n</div>'),e.put("access/views/data-access-request-documents-view.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  <div class="help-block" ng-bind-html="config.documentsSectionHelpText || \'data-access-request.documents-help\' | translate"></div>\n\n  <div class="form-group">\n\n    <div class="panel panel-default" ng-show="showAttachmentsForm">\n      <div class="panel-body">\n        <attachment-input files="attachments" multiple="true" on-error="onAttachmentError" delete-attachments="actions.canDeleteAttachments(dataAccessRequest)"></attachment-input>\n\n        <div class="voffset2">\n          <a ng-click="cancelAttachments()" type="button" class="btn btn-default">\n            <span translate>cancel</span>\n          </a>\n\n          <a ng-click="updateAttachments()" type="button" class="btn btn-primary">\n            <span translate>save</span>\n          </a>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="showAttachmentsForm">\n      <p ng-if="dataAccessRequest.attachments.length == 0" class="voffset2" translate>\n        data-access-request.no-documents\n      </p>\n      <attachment-list files="dataAccessRequest.attachments" href-builder="getDownloadHref"></attachment-list>\n      <a ng-if="actions.canEditAttachments(dataAccessRequest)" ng-click="editAttachments()" type="button" class="btn btn-info">\n'+"        <span>{{actions.canDeleteAttachments(dataAccessRequest) ? 'data-access-request.edit-documents' : 'data-access-request.add-documents' | translate}}</span>\n      </a>\n    </div>\n\n  </div>\n</div>"),e.put("access/views/data-access-request-form.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="DataAccessRequestEditController"></obiba-alert>\n\n  \x3c!-- \'ng-if\' does not bind the form to controller scope --\x3e\n  <div ng-show="validForm">\n\n    <form name="form" role="form" novalidate class="ng-scope ng-invalid ng-invalid-required ng-dirty">\n      <div class="pull-right" ng-if="loaded">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n        <a ng-click="save()" type="button" class="btn btn-primary">\n          <span translate>save</span>\n        </a>\n\n        <a ng-click="validate(form)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <div sf-model="sfForm.model" sf-form="sfForm.definition" sf-schema="sfForm.schema" required="true" sf-options="sfOptions"></div>\n\n      <div class="pull-right" ng-if="loaded">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n      <a ng-click="save()" type="button" class="btn btn-primary">\n        <span translate>save</span>\n      </a>\n\n        <a ng-click="validate(form)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n    </form>\n\n    <div class="clearfix voffet2"></div>\n  </div>\n\n</div>'),e.put("access/views/data-access-request-history-view.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-if="actions.canEditActionLogs(dataAccessRequest)">\n  <action-log-editor source-collection="dataAccessRequest.actionLogHistory" predefined-actions="dataAccessForm.predefinedActions" update="updateActionLogs(logs)"></action-log-editor>\n</div>\n<div class="table-responsive">\n  <table id="data-access-request-history" class="table table-bordered table-striped" obiba-table-sorter="logsHistory">\n    <thead>\n      <tr>\n        <th class="status-icon"></th>\n        <th translate>status</th>\n        <th translate>changed-by</th>\n        <th data-column-name="changedOn" translate>changed-on</th>\n        <th class="col-xs-1" ng-if="actions.canEditActionLogs(dataAccessRequest)" translate>actions</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="log in logsHistory track by $index">\n        <td>\n          <span>\n            <i class="{{log.icon}} hoffset"></i>\n          </span>\n        </td>\n        <td>\n          <span ng-if="log.reference">{{\'data-access-amendment.title\' | translate}}\n            <a ng-href="#{{\'/data-access-request/\' + dataAccessRequest.id + \'/amendment/\' + log.reference}}">{{log.reference}}</a>\n          </span>\n          {{log.msg | translate}}\n        </td>\n        <td>{{UserProfileService.getFullName(log.profile) || log.author}}</td>\n        <td>\n          <span title="{{log.changedOn | amDateFormat: \'lll\'}}">\n            {{log.changedOn | amCalendar}}\n          </span>\n        </td>\n        <td ng-if="actions.canEditActionLogs(dataAccessRequest)">\n          <span ng-if="!loading">\n            <action-log-item-editor item="log" source-collection="dataAccessRequest.actionLogHistory" predefined-actions="dataAccessForm.predefinedActions" update="updateActionLogs(logs)"></action-log-item-editor>\n          </span>\n          \n          <span class="loading" ng-if="loading"></span>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</div>'),e.put("access/views/data-access-request-list.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div id="data-access-request-list">\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <entity-list parent-id="null" can-add="true"></entity-list>\n\n</div>'),e.put("access/views/data-access-request-profile-user-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      {{\'data-access-request.profile.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n\n    <table class="table table-bordered table-striped">\n      <tbody>\n      <tr>\n        <th>{{\'data-access-request.profile.name\' | translate}}</th>\n        <td>{{getFullName(applicant)}}</td>\n      </tr>\n      <tr>\n        <th>{{\'data-access-request.profile.email\' | translate}}</th>\n        <td>{{getProfileEmail(applicant)}}</td>\n      </tr>\n      <tr ng-repeat="attribute in applicant.attributes | filterProfileAttributes">\n          <th>{{\n              (\'userProfile.\' + attribute.key | translate) !== (\'userProfile.\' + attribute.key) ?\n              (\'userProfile.\' + attribute.key | translate) :\n              (attribute.key)\n              }}\n          </th>\n          <td>{{attribute.value}}</td>\n      </tr>\n      </tbody>\n    </table>\n\n    <a class="btn btn-default" ng-if="getProfileEmail(applicant)" href="mailto:{{getProfileEmail(applicant)}}" target="_blank">\n      {{\'data-access-request.profile.send-email\' | translate}}</a>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.close" translate>close</span>\n      {{confirm.close}}\n    </button>\n  </div>\n</div>'),e.put("access/views/data-access-request-submitted-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$close(\'OK\')">&times;</button>\n    <h4 class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.submit-confirmation.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p>{{\'data-access-request.submit-confirmation.message\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$close(\'OK\')">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>'),e.put("access/views/data-access-request-validation-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 ng-if="isValid" class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.validation.title-success\' | translate}}\n    </h4>\n    <h4 ng-if="!isValid" class="modal-title">\n      <i class="fa fa-times fa-lg"></i>\n      {{\'data-access-request.validation.title-error\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p ng-if="isValid">{{\'data-access-request.validation.success\' | translate}}</p>\n    <p ng-if="!isValid" translate>{{\'data-access-request.validation.error\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>'),e.put("access/views/data-access-request-view.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  \x3c!--<div class="visible-print" print-friendly-view></div>--\x3e\n  <print-friendly-view class="visible-print" project="dataAccessRequest.project" valid-form="validForm" model="form.model" access-form="dataAccessForm" last-submitted-date="lastSubmittedDate">\n  </print-friendly-view>\n  <div class="hidden-print">\n    <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n    <obiba-alert id="DataAccessRequestViewController"></obiba-alert>\n\n    <div ng-if="validForm">\n\n      <p class="help-block pull-left"><span translate>created-by</span>\n        <span ng-if="!actions.canViewProfile(\'mica-data-access-officer\')">\n           {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}},\n        </span>\n        <span ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n          <a href ng-click="userProfile(dataAccessRequest.profile)">\n            {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}</a>,\n        </span>\n        <span title="{{dataAccessRequest.timestamps.created | amDateFormat: \'lll\'}}">{{dataAccessRequest.timestamps.created | amCalendar}}</span>\n        <span class="label label-success">{{dataAccessRequest.status | translate}}</span></p>\n\n      <div class="pull-right">\n        <a ng-click="submit()" ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canSubmit(dataAccessRequest)" class="btn btn-info" translate>submit\n        </a>\n        <a ng-click="reopen()" ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReopen(dataAccessRequest)" class="btn btn-info" translate>reopen\n        </a>\n        <a ng-click="review()" ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReview(dataAccessRequest)" class="btn btn-info" translate>review\n        </a>\n        <a ng-click="conditionallyApprove()" ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canConditionallyApprove(dataAccessRequest)" class="btn btn-info" translate>conditionallyApprove\n        </a>\n        <a ng-click="approve()" ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canApprove(dataAccessRequest)" class="btn btn-info" translate>approve\n        </a>\n        <a ng-click="reject()" ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReject(dataAccessRequest)" class="btn btn-info" translate>reject\n        </a>\n        <a ng-href="#/data-access-request/{{dataAccessRequest.id}}/edit" ng-if="actions.canEdit(dataAccessRequest)" class="btn btn-primary" title="{{\'edit\' | translate}}">\n          <i class="fa fa-pencil-square-o"></i>\n        </a>\n        <a ng-if="form.downloadTemplate === false" ng-click="printForm()" class="btn btn-default" title="{{\'global.print\' | translate}}">\n          <i class="fa fa-print"></i> <span translate>global.print</span>\n        </a>\n        <a ng-if="form.downloadTemplate === true" target="_self" href="{{requestDownloadUrl}}" class="btn btn-default">\n          <i class="fa fa-download"></i> <span>{{config.downloadButtonCaption || \'download\' | translate}}</span>\n        </a>\n        <a ng-click="delete()" ng-if="actions.canDelete(dataAccessRequest)" class="btn btn-danger" title="{{\'delete\' | translate}}">\n          <i class="fa fa-trash-o"></i>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <div class="voffset2" ng-if="dataAccessRequest.project.permissions && dataAccessRequest.project.permissions.view">\n        <div ng-if="dataAccessRequest.project" class="pull-right">\n          <small class="help-block inline"> {{\'research-project.label\' | translate}} :\n            <a route-checker route-checker-hides-parent="true" href ng-href="#/project/{{dataAccessRequest.project.id}}">{{dataAccessRequest.project.id}}</a>\n          </small>\n        </div>\n      </div>\n      <uib-tabset active="tabs.activeTab" class="voffset5">\n        \x3c!--Form--\x3e\n        <uib-tab index="0" select="selectTab(TAB_NAMES.form)" heading="{{\'data-access-request.form\' | translate}}">\n          <form id="request-form" name="forms.requestForm">\n            <obiba-schema-form-renderer model="form.model" schema-form="dataAccessForm" read-only="true"></obiba-schema-form-renderer>\n          </form>\n        </uib-tab>\n        \x3c!--Amendments--\x3e\n        <uib-tab index="1" select="selectTab(TAB_NAMES.amendments)">\n          <uib-tab-heading>\n            {{\'data-access-amendments\' | translate}}\n          </uib-tab-heading>\n\n          <div ng-show="parentId" class="voffset1">\n            <entity-list parent-id="parentId" can-add="actions.canAddAmendments(dataAccessRequest)"></entity-list>\n          </div>\n        </uib-tab>\n        \x3c!--Documents--\x3e\n        <uib-tab index="2" select="selectTab(TAB_NAMES.documents)">\n          <uib-tab-heading>\n            {{config.documentsSectionTitle || \'data-access-request.documents\' | translate}}\n            <span class="badge hoffset1" ng-show="dataAccessRequest.attachments"><small>{{dataAccessRequest.attachments.length}}</small></span>\n          </uib-tab-heading>\n          <div ng-include="\'access/views/data-access-request-documents-view.html\'"></div>\n        </uib-tab>\n        \x3c!--Comments--\x3e\n        <uib-tab index="3" ng-if="config.commentsEnabled" select="selectTab(TAB_NAMES.comments)" heading="{{\'data-access-request.comments\' | translate}}">\n          <obiba-comments class="voffset2" comments="form.comments" on-update="updateComment" on-delete="deleteComment" name-resolver="getFullName(profile)" edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n          <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n        </uib-tab>\n        <uib-tab index="4" ng-if="config.commentsEnabled && actions.canViewPrivateComments(dataAccessRequest)" select="selectTab(TAB_NAMES.privateComments)" heading="{{\'data-access-request.private-comments\' | translate}}">\n          <obiba-comments class="voffset2" comments="form.comments" on-update="updateComment" on-delete="deleteComment" name-resolver="getFullName(profile)" edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n          <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n        </uib-tab>\n        \x3c!--History--\x3e\n        <uib-tab index="5" select="selectTab(TAB_NAMES.history)" heading="{{\'data-access-request.history\' | translate}}">\n          <div ng-include="\'access/views/data-access-request-history-view.html\'"></div>\n        </uib-tab>\n      </uib-tabset>\n    </div>\n  </div>\n\n</div>'),e.put("analysis/components/entities-count-result-table/component.html",'<div>\n  <p class="help-block" ng-if="$ctrl.result && $ctrl.result.query && (!$ctrl.result.counts || $ctrl.result.counts.length === 0)" translate>search.no-results</p>\n  <table class="table table-bordered table-striped" ng-if="$ctrl.result && $ctrl.result.counts && $ctrl.result.counts.length>0">\n    <thead>\n      <th ng-if="$ctrl.showStudyColumn()" translate>taxonomy.target.study</th>\n      <th translate>taxonomy.target.variable</th>\n      <th translate>taxonomy.target.dataset</th>\n      <th style="width: 400px" translate>analysis.criteria</th>\n      <th style="width: 100px" translate>analysis.count</th>\n    </thead>\n    <tbody>\n        <tr ng-repeat="row in $ctrl.table.rows">\n          <td ng-if="row[0].rowspan>0 && $ctrl.showStudyColumn()" colspan="{{row[0].colspan}}" rowspan="{{row[0].rowspan}}" title="{{row[0].title}}">\n            <a href="{{row[0].link}}">{{row[0].value}}</a>\n          </td>\n          \n          \x3c!-- per variable criteria --\x3e\n          <td ng-if="row.length===5" colspan="{{row[1].colspan}}">\n              <a href="{{row[1].link}}">{{row[1].value}}</a>\n              <div class="help-block">{{row[1].title}}</div>\n          </td>\n          <td ng-if="row.length===5" colspan="{{row[2].colspan}}" title="{{row[2].title}}">\n              <a href="{{row[2].link}}">{{row[2].value}}</a>\n          </td>\n          <td ng-if="row.length===5" colspan="{{row[3].colspan}}">\n            <variable-criteria query="row[3].value"></variable-criteria>  \n          </td>\n          <td ng-if="row.length===5" colspan="{{row[4].colspan}}">\n            {{row[4].value}}\n          </td>\n\n          \x3c!-- all criteria --\x3e\n          <td ng-if="row.length===3" colspan="{{row[1].colspan}}" title="{{row[1].title}}">\n            <b translate>analysis.all-criteria</b>\n          </td>\n          <td ng-if="row.length===3" colspan="{{row[2].colspan}}">\n            <span ng-if="$ctrl.studyCount === 1" class="badge">{{$ctrl.localizedTotal}}</span>\n            <b ng-if="$ctrl.studyCount > 1">{{row[2].value}}</b>\n          </td>\n        </tr>\n        <tr ng-if="$ctrl.studyCount > 1">\n          <td colspan="{{$ctrl.showStudyColumn() ? 4 : 3}}">\n            <b translate>total</b>\n          </td>\n          <td>\n            <span class="badge">{{$ctrl.localizedTotal}}</span>\n          </td>\n        </tr>\n    </tbody>\n  </table>\n</div>'),e.put("analysis/components/variable-criteria/component.html",'<div>\n  <p ng-if="$ctrl.loading" class="voffset2 loading"></p>\n  \n  <div ng-hide="$ctrl.loading" class="btn-group voffset1 btn-variable" ng-class="{open: $ctrl.state.open}" ng-keyup="$ctrl.onKeyup($event)">\n\n    <button class="btn btn-xs dropdown btn-variable" ng-click="$ctrl.openDropdown()">\n      <span title="{{$ctrl.getQueryTitle(false)}}" test-ref="search-criterion">\n        {{$ctrl.getQueryTitle(true)}}\n      </span>\n      <span class="fa fa-caret-down"></span>\n    </button>\n    <button class="btn btn-xs btn-default" ng-click="$ctrl.onRemove()">\n      <span class="fa fa-times"></span>\n    </button>\n\n    <ul class="dropdown-menu query-dropdown-menu" aria-labelledby="">\n        <li class="criteria-list-item">\n          <span>{{$ctrl.variable.name}}</span>\n          <span class="pull-right" title="{{\'search.close-and-search\' | translate}}" ng-click="$ctrl.closeDropdown()"><i class="fa fa-check"></i></span>\n        </li>\n        <li class="divider"></li>\n        <li class="criteria-list-item">\n          <label title="{{\'analysis.all-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="all">\n              {{\'analysis.all\' | translate}}\n          </label>\n          <div class="pull-right">\n            <span class="agg-term-count">{{$ctrl.localizeNumber($ctrl.allFrequency)}}</span>\n          </div>\n        </li>\n        <li class="criteria-list-item">\n          <label title="{{\'analysis.exists-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="exists">\n              {{\'analysis.exists\' | translate}}\n          </label>\n          <div class="pull-right">\n            <span class="agg-term-count">{{$ctrl.localizeNumber($ctrl.existsFrequency)}}</span>\n          </div>\n        </li>\n        <li class="criteria-list-item">\n          <label title="{{\'analysis.empty-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="empty">\n              {{\'analysis.empty\' | translate}}\n          </label>\n          <div class="pull-right">\n            <span class="agg-term-count">{{$ctrl.localizeNumber($ctrl.emptyFrequency)}}</span>\n          </div>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showInOperations()">\n          <label title="{{\'analysis.in-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="in">\n              {{\'analysis.in\' | translate}}\n          </label>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showInOperations()">\n          <label title="{{\'analysis.out-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="out">\n              {{\'analysis.out\' | translate}}\n          </label>\n        </li><li>\n\n        </li><li class="divider" ng-if="$ctrl.showCategoricalOptions()"></li>\n        <li class="criteria-list-item" ng-if="$ctrl.showCategoricalOptions() && $ctrl.categoriesData && $ctrl.categoriesData.length>10">\n          <span class="input-group input-group-sm no-padding-top">\n            <input ng-model="$ctrl.searchText" type="text" class="form-control" aria-describedby="category-search" ng-keyup="$ctrl.onSearchTextKeyup($event)">\n            <span class="input-group-addon" id="category-search"><i class="fa fa-search"></i></span>\n          </span>\n        </li>\n        <li ng-if="$ctrl.showCategoricalOptions()">\n          <ul class="no-padding criteria-list-terms">\n            <li class="criteria-list-item" ng-if="category.visible" ng-repeat="category in $ctrl.categoriesData">\n              <label class="control-label">\n                <input ng-model="$ctrl.selectedCategories[category.name]" type="checkbox" ng-click="$ctrl.updateSelection()">\n                  <span title="{{category.name}}">{{category.label}}</span>\n              </label>\n              <div class="pull-right">\n                <span class="agg-term-count">{{$ctrl.localizeNumber(category.frequency)}}</span>\n              </div>\n            </li>\n          </ul>\n        </li>\n\n        <li class="divider" ng-if="$ctrl.showNumericalOptions()"></li>\n        <li class="criteria-list-item" ng-if="$ctrl.showNumericalOptions()">\n          <select class="form-control input-sm form-select" ng-model="$ctrl.selectedNumericalOperation">\n            <option value="range">{{\'analysis.range\' | translate}}</option>\n            <option value="in">{{\'analysis.values\' | translate}}</option>\n          </select>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showNumericalOptions() && $ctrl.selectedNumericalOperation === \'range\'">\n          <div class="row">\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="range-min" translate>analysis.min</label>\n                <input ng-model="$ctrl.selectedMin" type="text" class="form-control" id="range-min" ng-keyup="$ctrl.onNumericalMinKeyup($event)" placeholder="{{$ctrl.rangeMin}}">\n              </div>\n            </div>\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="range-max" translate>analysis.max</label>\n                <input ng-model="$ctrl.selectedMax" type="text" class="form-control" id="range-max" ng-keyup="$ctrl.onNumericalMaxKeyup($event)" placeholder="{{$ctrl.rangeMax}}">\n              </div>    \n            </div>\n          </div>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showNumericalOptions() && $ctrl.selectedNumericalOperation === \'in\'">\n          <div class="form-group">\n            <label for="in-values" translate>analysis.values-title</label>\n            <input ng-model="$ctrl.selectedNumericalValues" type="text" class="form-control" id="in-values" ng-keyup="$ctrl.onNumericalValuesKeyup($event)">\n          </div>\n        </li>\n\n        <li class="divider" ng-if="$ctrl.showTemporalOptions()"></li>\n        <li class="criteria-list-item" ng-if="$ctrl.showTemporalOptions()">\n          <select class="form-control input-sm form-select" ng-model="$ctrl.selectedTemporalOperation">\n            <option value="range">{{\'analysis.range\' | translate}}</option>\n            <option value="in">{{\'analysis.value\' | translate}}</option>\n          </select>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showTemporalOptions() && $ctrl.selectedTemporalOperation === \'range\'">\n          <div class="row">\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="from-date" class="control-label" translate>analysis.to</label>  \n                <span class="input-group input-group-sm no-padding-top">\n                  <input id="from-date" type="text" class="form-control" aria-describedby="from-date-picker" uib-datepicker-popup="yyyy-MM-dd" ng-model="$ctrl.selectedFrom" is-open="$ctrl.fromDatePickerOpened">\n                  <span class="input-group-addon" id="from-date-picker" ng-click="$ctrl.fromDatePickerOpened = true"><i class="fa fa-calendar"></i></span>\n                </span>\n              </div>\n            </div>\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="to-date" class="control-label" translate>analysis.to</label>  \n                <span class="input-group input-group-sm no-padding-top">\n                  <input id="to-date" type="text" class="form-control" aria-describedby="to-date-picker" uib-datepicker-popup="yyyy-MM-dd" ng-model="$ctrl.selectedTo" is-open="$ctrl.toDatePickerOpened">\n                  <span class="input-group-addon" id="to-date-picker" ng-click="$ctrl.toDatePickerOpened = true"><i class="fa fa-calendar"></i></span>\n                </span>\n              </div>\n            </div>\n          </div>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showTemporalOptions() && $ctrl.selectedTemporalOperation === \'in\'">\n          <div class="row">\n            <div class="col-xs-12">\n              <div class="form-group">\n                <label for="in-date" class="control-label" translate>analysis.date-title</label>  \n                <span class="input-group input-group-sm no-padding-top">\n                  <input id="in-date" type="text" class="form-control" aria-describedby="date-picker" uib-datepicker-popup="yyyy-MM-dd" ng-model="$ctrl.selectedTemporalValue" is-open="$ctrl.datePickerOpened">\n                  <span class="input-group-addon" id="date-picker" ng-click="$ctrl.datePickerOpened = true"><i class="fa fa-calendar"></i></span>\n                </span>\n              </div>\n            </div>\n          </div>\n        </li>\n    </ul>\n\n  </div>\n\n</div>'),e.put("analysis/views/analysis-entities-count.html",'<div>\n  <div ng-if="entitiesHeaderTemplateUrl" ng-include="entitiesHeaderTemplateUrl"></div>\n  <div>\n      <span class="btn btn-primary" ng-show="result.counts">\n        <span ng-show="result.counts.length>0" translate>{{result.counts[0].entityType}}</span>\n        <span class="badge">{{localizedTotal}}</span>\n      </span>\n      <span ng-if="loading" class="voffset2 loading"></span>\n  </div>\n  <entities-count-result-table ng-hide="loading && !result.total" result="result"></entities-count-result-table>\n  <p ng-hide="query" translate>analysis.entities-count.no-query</p>\n</div>'),e.put("attachment/attachment-input-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<button ng-hide="{{disabled}}" type="button" class="btn btn-primary btn-xs" aria-hidden="true" ngf-multiple="{{multiple}}" ngf-select ngf-change="onFileSelect($files)" translate>file.upload.button\n</button>\n\n<table ng-show="files.length" class="table table-bordered table-striped">\n  <thead>\n  <tr>\n    <th translate>data-access-request.default.documents.title</th>\n    <th class="col-xs-2"><span class="pull-right" translate>file.upload.date</span></th>\n    <th translate>size</th>\n    <th ng-show="deleteAttachments" translate>actions</th>\n  </tr>\n  </thead>\n  <tbody>\n  <tr ng-repeat="file in files">\n    <td>\n      {{file.fileName}}\n      <uib-progressbar ng-show="file.showProgressBar" class="progress-striped" value="file.progress">\n        {{file.progress}}%\n      </uib-progressbar>\n    </td>\n    <td>\n      <span class="pull-right" ng-if="file.timestamps" title="{{ file.timestamps.created | amDateFormat: \'lll\' }}">{{file.timestamps.created | amCalendar }}</span>\n    </td>\n    <td style="width:1%;">\n        <span class="pull-right" style="white-space: nowrap;">\n          {{file.size | bytes}}\n        </span>\n    </td>\n    <td style="width:20px;" ng-show="deleteAttachments">\n      <a ng-show="file.id" ng-click="deleteFile(file.id)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n      <a ng-show="file.tempId" ng-click="deleteTempFile(file.tempId)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </td>\n  </tr>\n  </tbody>\n</table>'),e.put("attachment/attachment-list-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  <span ng-if="!hasAttachments && emptyMessage"><em>{{emptyMessage}}</em></span>\n  <table ng-if="hasAttachments" class="table table-bordered table-striped">\n    <thead>\n    <tr>\n      <th translate>data-access-request.default.documents.title</th>\n      <th class="col-xs-2"><span class="pull-right" translate>file.upload.date</span></th>\n      <th translate>size</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr ng-repeat="attachment in attachments">\n      <th>\n        <a target="_self" ng-href="{{attachment.href}}" download="{{attachment.fileName}}">{{attachment.fileName}}\n        </a>\n      </th>\n      <td><span class="pull-right" ng-if="attachment.timestamps" title="{{ attachment.timestamps.created | amDateFormat: \'lll\' }}">{{attachment.timestamps.created | amCalendar }}</span></td>\n      <td style="width:1%;">\n        <span class="pull-right" style="white-space: nowrap;">\n          {{attachment.size | bytes}}\n        </span>\n      </td>\n    </tr>\n    </tbody>\n  </table>\n\n</div>'),e.put("crosstab/components/crosstab-study-table/component.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<span title="{{$ctrl.contingency.info.population ? $ctrl.contingency.info.population + \':\' + $ctrl.contingency.info.dce : \'\'}}">\n  <span ng-if="$ctrl.contingency.studyTable">\n    <a ng-href="{{$ctrl.studyLink}}">{{$ctrl.contingency.info.summary}}</a>\n    <span>{{$ctrl.contingency.info.tableName}}</span>\n  </span>\n</span>'),e.put("crosstab/views/crosstab-variable-crosstab.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-cloak>\n  <h4>{{dataset.translatedAcronym}} {{\'dataset.crosstab.title\' | translate}}</h4>\n\n  <obiba-alert id="DatasetVariableCrosstabController"></obiba-alert>\n\n  \x3c!-- crosstab variable selection --\x3e\n  <div class="well well-sm">\n    <div class="row">\n      <div class="cross-tab col-xs-4">\n        <ui-select ng-model="crosstab.lhs.variable" theme="bootstrap">\n          <ui-select-match placeholder="{{\'dataset.crosstab.categorical\' | translate}}">{{$select.selected.name}}\n          </ui-select-match>\n          <ui-select-choices refresh="searchCategoricalVariables($select.search)" refresh-delay="0" repeat="variable in crosstab.lhs.variables">\n\n            <div>{{variable.name}}</div>\n            <small>{{variable | variableLabel}}</small>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="col-xs-1 text-center no-padding no-margin sm-width">\n        <i class="fa fa-times fa-2x"></i>\n      </div>\n\n      <div class="cross-tab col-xs-4">\n        <ui-select ng-model="crosstab.rhs.variable" theme="bootstrap">\n          <ui-select-match placeholder="{{\'dataset.crosstab.another\' | translate}}">{{$select.selected.name}}\n          </ui-select-match>\n          <ui-select-choices refresh="searchVariables($select.search)" refresh-delay="0" repeat="variable in crosstab.rhs.variables">\n\n            <div>{{variable.name}}</div>\n            <small>{{variable | variableLabel}}</small>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="col-xs-3">\n        <span>\n          <button type="button" class="btn btn-primary" aria-hidden="true" ng-click="submit()">{{\'submit\' | translate}}\n          </button>\n          <button ng-if="canExchangeVariables()" type="button" class="btn btn-primary" aria-hidden="true" ng-click="exchangeVariables()"> v1 <i class="fa fa-exchange fa-1x"></i> v2\n          </button>\n          <button type="button" class="btn btn-default" aria-hidden="true" ng-click="clear()">{{\'clear\' | translate}}\n          </button>\n        </span>\n      </div>\n    </div>\n    <span class="help-block">{{\'dataset.crosstab.query-help\' | translate}}</span>\n  </div>\n\n  \x3c!-- crosstab results --\x3e\n  <div ng-if="crosstab.contingencies && crosstab.contingencies.length > 0">\n\n    <div>\n      \x3c!-- table detail and stats options --\x3e\n      <div class="btn-group">\n        <label class="btn" ng-class="{\'btn-info\': options.showDetails, \'btn-default\': !options.showDetails}" ng-model="options.showDetails" uib-btn-checkbox>{{\'global.detailed\' | translate}}</label>\n        <div class="btn-group" ng-if="!isStatistical(crosstab.rhs.xVariable)">\n          <label class="btn" ng-class="{\'btn-info\': options.statistics === StatType.CPERCENT, \'btn-default\': options.statistics !== StatType.CPERCENT}" ng-model="options.statistics" uib-btn-radio="StatType.CPERCENT">{{\'global.percentage\' | translate}} <i class="fa fa-long-arrow-down"></i></label>\n          <label class="btn" ng-class="{\'btn-info\': options.statistics === StatType.RPERCENT, \'btn-default\': options.statistics !== StatType.RPERCENT}" ng-model="options.statistics" uib-btn-radio="StatType.RPERCENT">{{\'global.percentage\' | translate}} <i class="fa fa-long-arrow-right"></i></label>\n        </div>\n      </div>\n\n      \x3c!-- download menu --\x3e\n      <div class="pull-right sm-bottom-margin">\n        <div class="btn-group" role="group">\n          <button type="button" class="btn btn-info btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n            <i class="glyphicon glyphicon-download-alt"></i> <span>{{\'download\' | translate}}</span>\n            <span class="caret"></span>\n          </button>\n          <ul class="dropdown-menu dropdown-menu-compact">\n            <li><a obiba-file-download url="downloadUrl(DocType.EXCEL)" target="_self" download><i class="fa fa-file-excel-o"></i> {{\'excel\' | translate}}</a></li>\n            <li><a obiba-file-download url="downloadUrl(DocType.CSV)" target="_self" download><i class="fa fa-file-text-o"></i> {{\'csv\' | translate}}</a></li>\n          </ul>\n        </div>\n      </div>\n    </div>\n    \x3c!-- progress image --\x3e\n    <div>\n      <div ng-if="loading" class="loading"></div>\n    </div>\n\n    <table ng-if="!loading" class="table table-striped table-bordered no-margin no-padding">\n      <thead>\n      <tr>\n        <th style="vertical-align: top" class="" ng-if="datasetHarmo" width="20%" rowspan="{{crosstab.lhs.xVariable.categories.length}}">{{options.showDetailedStats ? (\'dataset.study-table.title\' | translate) : \'\'}}\n        </th>\n        <th style="vertical-align: top" rowspan="{{crosstab.lhs.xVariable.categories.length}}" width="10%">\n          <a href="{{PageUrlService.variablePage(crosstab.rhs.xVariable.id)}}">{{crosstab.rhs.xVariable.name}}</a>\n        </th>\n        <th class="text-center" colspan="{{crosstab.lhs.xVariable.categories.length}}">\n          <a href="{{PageUrlService.variablePage(crosstab.lhs.xVariable.id)}}">{{crosstab.lhs.xVariable.name}}</a>\n        </th>\n        <th style="vertical-align: top" class="text-center" rowspan="{{crosstab.lhs.xVariable.categories.length}}">\n          {{\'total\' | translate}}\n        </th>\n      </tr>\n      <tr>\n        <th class="text-center" ng-repeat="category in crosstab.lhs.xVariable.categories">\n          <span class="clickable" popover-title="" popover-popup-delay="250" popover-placement="bottom" popover-trigger="\'mouseenter\'" uib-popover="{{crosstab.lhs.xVariable.categories | variableCategory:category.name | variableLabel}}">{{category.name}}</span>\n        </th>\n      </tr>\n      </thead>\n\n      \x3c!-- Categorical --\x3e\n      <tbody ng-repeat="contingency in crosstab.contingencies track by $index" ng-if="!isStatistical(crosstab.rhs.xVariable) && (!datasetHarmo || (datasetHarmo && options.showDetailedStats))" ng-include="getTemplatePath(contingency)">\n      </tbody>\n      <tbody ng-if="!isStatistical(crosstab.rhs.xVariable) && datasetHarmo && options.showDetailedStats">\n      <tr>\n        <td colspan="{{crosstab.lhs.xVariable.categories.length + 3}}"></td>\n      </tr>\n      </tbody>\n      <tbody ng-repeat="contingency in [crosstab.all]" ng-init="grandTotal = true" ng-if="datasetHarmo && !isStatistical(crosstab.rhs.xVariable)" ng-include="getTemplatePath(contingency)">\n      </tbody>\n\n      \x3c!-- Statistical --\x3e\n      <tbody ng-repeat="contingency in crosstab.contingencies" ng-if="isStatistical(crosstab.rhs.xVariable) && (!datasetHarmo || (datasetHarmo && options.showDetailedStats))" ng-include="getTemplatePath(contingency)">\n      </tbody>\n      <tbody ng-if="isStatistical(crosstab.rhs.xVariable) && datasetHarmo && options.showDetailedStats">\n      <tr>\n        <td colspan="{{crosstab.lhs.xVariable.categories.length + 3}}"></td>\n      </tr>\n      </tbody>\n      <tbody ng-repeat="contingency in [crosstab.all]" ng-init="grandTotal = true" ng-if="datasetHarmo && isStatistical(crosstab.rhs.xVariable)" ng-include="getTemplatePath(contingency)">\n      </tbody>\n\n    </table>\n  </div>\n  <span ng-bind-html="renderHtml(body)"></span>\n</div>'),e.put("crosstab/views/crosstab-variable-frequencies-empty.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr>\n  <td ng-if="datasetHarmo" rowspan="{{crosstab.rhs.xVariable.categories.length + 1}}">\n    <crosstab-study-table contingency="contingency"></crosstab-study-table>\n  </td>\n  <td colspan="{{crosstab.lhs.xVariable.categories.length + 2}}"><em>{{\'search.no-results\' | translate}}</em></td>\n</tr>'),e.put("crosstab/views/crosstab-variable-frequencies.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr ng-if="options.showDetails" ng-repeat="frequency in contingency.aggregations[0].frequencies track by $index">\n  <td ng-if="datasetHarmo && $index === 0" rowspan="{{crosstab.rhs.xVariable.categories.length + 2}}">\n      <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n\n  <td>\n    <span class="clickable" popover-title="" popover-popup-delay="250" popover-placement="bottom" popover-trigger="\'mouseenter\'" uib-popover="{{crosstab.rhs.xVariable.categories | variableCategory:frequency.value | variableLabel}}">\n      {{frequency.value}}\n    </span>\n  </td>\n\n  <td ng-repeat="aggregation in contingency.aggregations">\n    {{aggregation.frequencies[$parent.$index].count}}&nbsp;\n\n    <span ng-show="aggregation.privacyCheck" class="help-inline">\n      <span ng-show="options.statistics === StatType.RPERCENT">\n        ({{aggregation.frequencies[$parent.$index].percent | number:2}}%)\n      </span>\n      <span ng-show="options.statistics === StatType.CPERCENT">\n        ({{aggregation.frequencies[$parent.$index].cpercent | number:2}}%)\n      </span>\n    </span>\n  </td>\n  <td>\n    {{contingency.all.frequencies[$index].count}}&nbsp;\n    <span ng-if="contingency.all.privacyCheck" class="help-inline">\n      <span ng-if="options.statistics === StatType.RPERCENT">\n        (100%)\n      </span>\n      <span ng-if="options.statistics === StatType.CPERCENT">\n        ({{contingency.all.frequencies[$index].percent | number:2}}%)\n      </span>\n    </span>\n  </td>\n</tr>\n<tr>\n  <td ng-if="options.showDetailedStats &&  datasetHarmo && !options.showDetails" rowspan="{{crosstab.rhs.xVariable.categories.length}}">\n    <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n  <td><em>N</em></td>\n  <td ng-repeat="aggregation in contingency.aggregations">\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{aggregation.n}}&nbsp;\n      <span class="help-inline">\n        <span ng-if="options.statistics === StatType.RPERCENT">\n          ({{aggregation.percent | number:2}}%)\n        </span>\n        <span ng-if="options.statistics === StatType.CPERCENT">\n          (100%)\n        </span>\n      </span>\n    </span>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n  </td>\n  <td>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{contingency.all.n}}&nbsp;\n      <span ng-if="contingency.privacyCheck" class="help-inline">\n        <span ng-if="options.statistics === StatType.CPERCENT">\n          (100%)\n        </span>\n        <span ng-if="options.statistics === StatType.RPERCENT">\n          (100%)\n        </span>\n      <span>\n    </span>\n  </span></span></td>\n</tr>\n\n<tr ng-if="options.showDetails && !grandTotal && contingency.privacyCheck">\n  <td>\n    <em>{{\'dataset.crosstab.chi-squared.test\' | translate}}</em>\n  </td>\n  <td colspan="{{crosstab.lhs.xVariable.categories.length + 1}}">\n    <span>\n      χ2 = {{contingency.chiSquaredInfo.sum | number:4 }},&nbsp;&nbsp;\n      df = {{contingency.chiSquaredInfo.df}},&nbsp;&nbsp;\n      p-value = {{contingency.chiSquaredInfo.pValue | number:4 }}\n    </span>\n    <span class="text-danger" ng-if="!contingency.privacyCheck">\n      {{\'dataset.crosstab.privacy-check-failed\' | translate:{arg0:contingency.privacyThreshold} }}\n    </span>\n  </td>\n</tr>\n<tr ng-if="!grandTotal && !contingency.privacyCheck">\n  <td colspan="{{crosstab.lhs.xVariable.categories.length + 2}}">\n    <span class="text-danger" ng-if="!contingency.privacyCheck">\n      {{getPrivacyErrorMessage(contingency) | translate:{arg0:contingency.privacyThreshold} }}\n    </span>\n  </td>\n</tr>'),e.put("crosstab/views/crosstab-variable-statistics-empty.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr>\n  <td ng-if="datasetHarmo">\n    <crosstab-study-table contingency="contingency"></crosstab-study-table>\n  </td>\n  <td colspan="4" class="danger"><em>{{\'no-results\' | translate}}</em></td>\n</tr>'),e.put("crosstab/views/crosstab-variable-statistics.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr ng-if="options.showDetails">\n  <td ng-if="datasetHarmo" rowspan="{{!grandTotal && !contingency.privacyCheck ? \'6\' : \'5\'}}">\n    <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n  <td translate>min</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.min | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.min | roundNumber}}</td>\n</tr>\n<tr ng-if="options.showDetails">\n  <td translate>max</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.max | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.max | roundNumber}}</td>\n</tr>\n<tr ng-if="options.showDetails">\n  <td translate>mean</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.mean | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.mean | roundNumber}}</td>\n</tr>\n<tr ng-if="options.showDetails">\n  <td translate>std-deviation</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.stdDeviation | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.stdDeviation | roundNumber}}</td>\n</tr>\n<tr>\n  <td ng-if="datasetHarmo && !options.showDetails">\n    <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n  <td>N</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{aggregation.n}}\n    </span>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n  </td>\n  <td class="text-center">\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{contingency.all.n}}\n    </span>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n  </td>\n</tr>\n<tr>\n  <td ng-if="!grandTotal && !contingency.privacyCheck" colspan="{{crosstab.lhs.xVariable.categories.length + 3}}">\n    <span class="text-danger" ng-if="!contingency.privacyCheck">\n      {{getPrivacyErrorMessage(contingency) | translate:{arg0:contingency.privacyThreshold} }}\n    <span>\n  </span></span></td>\n</tr>'),e.put("file-browser/views/document-detail-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-default">\n  <div class="panel-heading">\n    <span>\n      <span title="{{data.details.document.name}}">\n        <i class="fa {{getDocumentIcon(data.details.document)}}"></i> {{truncate(data.details.document.name, 30)}}\n      </span>\n      <a href class="pull-right" ng-click="hideDetails()"><i class="fa fa-times"></i></a>\n    </span>\n  </div>\n  <div class="panel-body">\n    <div>\n      <label class="text-muted no-margin">\n        <small>{{\'size\' | translate}}</small>\n      </label>\n      <div>\n        <span ng-if="!isFile(data.details.document)">{{data.details.document.size}} {{data.details.document.size === 1 ? \'item\' : \'items\' | translate}}</span>\n        <span ng-if="isFile(data.details.document)">{{data.details.document.size | bytes}}</span>\n        <a target="{{downloadTarget}}" ng-href="{{getDownloadUrl(data.details.document.path, data.document.keyToken)}}" class="hoffset2" title="{{\'download\' | translate}}" download>\n          <span><i class="fa fa-download"></i><span class="hoffset2"></span></span>\n        </a>\n      </div>\n    </div>\n\n    <div class="voffset2">\n      <label class="text-muted no-margin">\n        <small>{{\'created-on\' | translate}}</small>\n      </label>\n      <div>\n        <span>{{data.details.document.timestamps.created | amDateFormat : \'lll\'}}</span>\n      </div>\n    </div>\n    <div class="voffset2">\n      <label class="text-muted no-margin">\n        <small>{{\'last-modified\' | translate}}</small>\n      </label>\n      <div>\n        <span>{{data.details.document.timestamps.lastUpdate | amDateFormat : \'lll\'}}</span>\n      </div>\n    </div>\n\n    <div ng-if="isFile(data.details.document)" class="voffset2">\n      <div ng-if="data.details.document.attachment.type">\n        <label class="text-muted no-margin">\n          <small>{{\'type\' | translate}}</small>\n        </label>\n        <div>\n          <span>{{data.details.document.attachment.type}}</span>\n        </div>\n      </div>\n\n      <div ng-show="hasLocalizedValue(data.details.document.attachment.description)" class="voffset2">\n        <label class="text-muted no-margin">\n          <small>{{\'description\' | translate}}</small>\n        </label>\n        <div>\n          <span>{{getLocalizedValue(data.details.document.attachment.description)}}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("file-browser/views/documents-table-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-default table-responsive table-responsive-dropdown">\n  <div class="panel-heading" ng-if="data.search.active">\n      <a class="no-text-decoration" ng-click="clearSearch()">\n        <i class="fa fa-chevron-left"> </i>\n      </a>\n      <span ng-if="data.search.recursively">{{\'file.search-results.current-sub\' | translate}}</span>\n      <span ng-if="!data.search.recursively">{{\'file.search-results.current\' | translate}}</span>\n      ({{data.document.children.length}})\n  </div>\n  <div ng-if="data.document.children.length > 0" test-ref="file-search-result-list">\n    <table class="table table-bordered table-striped no-padding no-margin">\n      <thead>\n      <tr>\n        <th colspan="2" translate>name</th>\n        <th style="width: 100px" translate>type</th>\n        <th style="width: 100px" translate>size</th>\n        <th style="width: 150px" translate>global.modified</th>\n        <th ng-if="data.search.active" translate>folder</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-show="!data.isRoot && data.document.path !== data.rootPath && !data.search.active">\n        <td colspan="5">\n          <i class="fa fa-folder"></i>\n          <span><a href style="text-decoration: none" class="no-text-decoration" ng-click="navigateBack()"> ..</a></span>\n        </td>\n      </tr>\n      <tr ng-class="{\'selected-row\': $index === pagination.selected}" dir-paginate="document in data.document.children | itemsPerPage: pagination.itemsPerPage" ng-init="fileDocument = isFile(document)" current-page="pagination.currentPage">\n\n        <td ng-click="showDetails(document, $index);">\n          <span>\n            <span ng-if="fileDocument">\n              <i class="fa {{getDocumentIcon(document)}}"></i>\n              <a ng-if="fileDocument" target="{{downloadTarget}}" test-ref="file-name" style="text-decoration: none" ng-click="$event.stopPropagation();" ng-href="{{getDownloadUrl(document.path, data.document.keyToken)}}" title="{{document.name}}">\n                {{document.name}}\n              </a>\n            </span>\n            <span ng-if="!fileDocument">\n              <i class="fa {{getDocumentIcon(document)}}"></i>\n              <a href style="text-decoration: none" ng-click="navigateTo($event, document, data.document.keyToken)">\n                {{document.name}}\n              </a>\n            </span>\n          </span>\n        </td>\n\n        <td class="fit-content">\n          <span class="btn-group pull-right" uib-dropdown is-open="status.isopen">\n            <a title="{{\'file.show-details\' | translate}}" id="single-button" class="dropdown-anchor" uib-dropdown-toggle ng-disabled="disabled">\n              <i class="glyphicon glyphicon-option-horizontal btn-large"></i>\n            </a>\n            <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n              <li role="menuitem">\n                <a href ng-click="showDetails(document, $index)">\n                  <span><i class="fa fa-info"></i><span class="hoffset2">{{\'details\' | translate}}</span></span>\n                </a>\n              </li>\n              <li role="menuitem">\n                <a target="{{downloadTarget}}" ng-href="{{getDownloadUrl(document.path, data.document.keyToken)}}" download>\n                  <span><i class="fa fa-download"></i><span class="hoffset2">{{\'download\' | translate}}</span></span>\n                </a>\n              </li>\n            </ul>\n          </span>\n        </td>\n\n        <td>\n          <span ng-repeat="t in getTypeParts(document) track by $index" class="label label-info" test-ref="file-type" ng-class="{\'hoffset1\' : !$first}">{{t}}</span>\n        </td>\n        <td class="no-wrap" ng-if="fileDocument" test-ref="file-size">\n          {{document.size | bytes}}\n        </td>\n        <td class="no-wrap" ng-if="!fileDocument">\n          {{document.size}} {{document.size === 1 ? \'item\' : \'items\' | translate}}\n        </td>\n        <td>\n          <span title="{{document.timestamps.lastUpdate | amDateFormat: \'lll\'}}" test-ref="file-lastModification">\n            {{document.timestamps.lastUpdate | amTimeAgo}}\n          </span>\n        </td>\n        <td ng-if="data.search.active">\n          <a href class="no-text-decoration" ng-click="navigateToParent($event, document, data.document.keyToken)" test-ref="file-parent">\n'+"            {{document.attachment.path === data.rootPath ? '/' : document.attachment.path.replace(data.rootPath, '')}}\n          </a>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>"),e.put("file-browser/views/file-browser-template.html",'<div ng-cloak>\n  <div ng-if="!noDocument">\n    <h4 ng-show="showTitle">{{documentsTitle | translate}}</h4>\n  <div ng-if="!data.document" class="loading"></div>\n\n  <div ng-if="data.document">\n    <obiba-alert id="FileSystemController"></obiba-alert>\n\n    <div>\n      \x3c!-- Document details --\x3e\n      <div class="row">\n        <div class="col-md-12">\n          <div ng-include="\'file-browser/views/toolbar-template.html\'"></div>\n        </div>\n      </div>\n\n      <div class="row voffset2">\n        <div ng-class="{\'col-md-8\': data.details.show, \'col-md-12\': !data.details.show}">\n          <div ng-include="\'file-browser/views/documents-table-template.html\'"></div>\n          <div ng-if="!data.isFile && data.document.children.length < 1 && !data.search.active" class="text-muted">\n            <em>{{\'empty-folder\' | translate}}</em>\n          </div>\n          <div class="pull-right no-margin">\n            <dir-pagination-controls></dir-pagination-controls>\n          </div>\n        </div>\n        <div ng-if="data.details.show" class="col-md-4">\n          <div ng-include="\'file-browser/views/document-detail-template.html\'"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  </div>\n\n</div>'),e.put("file-browser/views/toolbar-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n<div>\n    <div class="pull-left voffset3">\n        <ol ng-show="data.document.path !== data.rootPath" class="breadcrumb mica-breadcrumb no-margin no-padding">\n            <li>\n                <a href ng-click="navigateToPath(data.rootPath, data.document.keyToken)">\n                    <span><i class="fa {{getDocumentIcon(data.document)}}"></i></span>\n                </a>\n            </li>\n\n            <li ng-repeat="part in data.breadcrumbs" ng-class="{\'active\': $first === $last && $last}">\n                <a ng-show="!$last && part.name !== \'/\'" href ng-click="navigateToPath(part.path, data.document.keyToken)">\n                    <span ng-show="part.name !== \'/\'">{{part.name}}</span>\n                </a>\n                <span class="no-padding" ng-if="part.name !== \'/\' && $last">{{data.document.name || \'empty\'}}</span>\n            </li>\n        </ol>\n    </div>\n    <div ng-if="!data.document.keyToken" class="pull-right">\n\n      <table style="border:none">\n        <tbody>\n        <tr>\n          <td>\n            <a href>\n              <span class="input-group input-group-sm no-padding-top no-padding-right">\n               <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>\n               <input ng-keyup="searchKeyUp($event)" ng-model="data.search.text" type="text" class="form-control ng-pristine ng-untouched ng-valid" aria-describedby="study-search" style="max-width: 200px;" test-ref="file-search-input">\n               <span ng-show="data.search.text" title="{{\'search-tooltip.clear\' | translate}}" ng-click="clearSearch()" class="input-group-addon">\n                <i class="fa fa-times"></i>\n               </span>\n              </span>\n            </a>\n          </td>\n          <td>\n            <a href ng-model="data.search.recursively" class="btn btn-sm hoffset1" ng-class="{\'btn-info\': data.search.recursively, \'btn-default\': !data.search.recursively}" data-toggle="button" ng-click="toggleRecursively()" title="{{\'search-tooltip.recursively\' | translate}}">\n              <i class="fa i-obiba-hierarchy"></i>\n            </a>\n            <a href ng-click="searchDocuments(\'RECENT\')" class="btn btn-info btn-sm" title="{{\'search-tooltip.most-recent\' | translate}}">\n              <span><i class="fa fa-clock-o fa-lg"></i></span>\n            </a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n</div>'),e.put("graphics/views/charts-directive.html",'<div>\n  <div ng-if="chartObject.type === \'GeoChart\'">\n    <obiba-geo config="chartObject.d3Config"></obiba-geo>\n  </div>\n  <div ng-if="chartObject.type !== \'GeoChart\'">\n    <obiba-nv-chart chart-config="chartObject.d3Config"></obiba-nv-chart>\n  </div>\n</div>'),e.put("graphics/views/tables-directive.html",'<div>\n    <table ng-if="chartObject.entries && chartObject.entries.length" style="max-height: 400px;" class="table table-bordered table-striped" fixed-header="chartObject.getTable().data">\n        <thead>\n        <tr>\n        <th ng-repeat="header in chartObject.header track by $index">{{header}}</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-repeat="row in chartObject.entries track by $index">\n            <td>{{row.title}}</td>\n            <td><a href ng-click="updateCriteria(row.key, chartObject.vocabulary)">{{row.value}}</a></td>\n            <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n        </tr>\n        </tbody>\n    </table>\n</div>'),e.put("lists/views/input-search-widget/input-search-widget-template.html",'<form class="list-search-widget">\n    <div class="form-group pull-left">\n        <entity-search-typeahead placeholder-text="global.list-search-placeholder" target="target" rql-query="rqlQuery" entity-type="type">\n        </entity-search-typeahead>\n    </div>\n    <div class="pull-left voffset2 hoffset2">\n        <small><a href ng-href="{{navigateToSearchPage()}}">\n            {{\'search.advanced-button\' | translate}}\n        </a></small>\n    </div>\n</form>'),e.put("lists/views/list/datasets-search-result-table-template.html",'<div>\n    <div class="col-md-12"><div ng-if="loading" class="loading"></div></div>\n    <div ng-show="!loading" class="col-md-12">\n        <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.dataset.noResults</p>\n        <div ng-repeat="summary in summaries" class="row sm-bottom-margin document-item-list flex-row" test-ref="dataset">\n            <div class="col-md-12 col-sm-12 col-xs-12">\n                <h4>\n                    <a ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n                        <localized value="summary.name" lang="lang"></localized>\n                    </a>\n                </h4>\n                <p>\n                    <localized value="summary.description" ellipsis-size="250" markdown-it="true" lang="lang"></localized>\n                </p>\n                <a ng-if="summary.description" href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">{{"global.read-more" | translate}}</a>\n                <div class="clear-fix"></div>\n                <div class="sm-top-margin countDetail voffset3">\n                    {{counts=summary[\'obiba.mica.CountStatsDto.datasetCountStats\'];""}}\n                    <a ng-if="counts.networks && options.obibaListOptions.showNetworkBadge!==false" href="{{\'networks\' | doSearchQuery : \'dataset(in(Mica_dataset.id,\' + summary.id +  \'))\' }}" class="btn btn-default btn-xxs" test-ref="studyCount">\n                        <localized-number value="counts.networks"></localized-number>\n                        {{counts.networks > 1 ? "networks" : "network.label"\n                        | translate}}\n                    </a>\n                    <a ng-if="counts.studies && options.obibaListOptions.showStudyBadge!==false" href="{{\'studies\' | doSearchQuery : \'dataset(in(Mica_dataset.id,\' + summary.id +  \'))\' }}" class="btn btn-default btn-xxs" test-ref="studyCount">\n                        <localized-number value="counts.studies"></localized-number>\n                        {{counts.studies > 1 ? "studies" : "study.label"\n                        | translate}}\n                    </a>\n\n                    <a ng-if="counts.variables && options.obibaListOptions.showVariableBadge!==false" href="{{\'variables\' | doSearchQuery : \'dataset(in(Mica_dataset.id,\' + summary.id +  \'))\' }}" class="btn btn-default btn-xxs" test-ref="variableCount">\n                        <localized-number value="counts.variables"></localized-number>\n                        {{counts.variables > 1 ? "variables" : "search.variable.facet-label"\n                        | translate}}\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),e.put("lists/views/list/networks-search-result-table-template.html",'<div>\n    <div class="col-md-12"><div ng-if="loading" class="loading"></div></div>\n    <div ng-show="!loading" class="col-md-12">\n        <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.network.noResults</p>\n        <div ng-if="summaries && summaries.length" ng-init="lang = $parent.$parent.lang">\n            <div ng-repeat="summary in summaries" ng-init="lang = $parent.$parent.lang;" class="row lg-bottom-margin document-item-list flex-row" test-ref="network">\n                <div class="col-md-2 hidden-xs hidden-sm text-center">\n                    <img ng-if="summary.logo" ng-src="{{summary.logoUrl}}" class="img-responsive">\n\n                    <h1 ng-if="!summary.logo" src="" alt="" class="big-character">\n                        <span class="t_badge color_light i-obiba-N"></span>\n                    </h1>\n                </div>\n                <div class="col-md-10 col-sm-12 col-xs-12">\n                    <h4>\n                        <a href="{{PageUrlService.networkPage(summary.id)}}">\n                            <localized value="summary.name" lang="lang"></localized>\n                        </a>\n                    </h4>\n                    <p>\n                        <localized value="summary.description" lang="lang" ellipsis-size="250" markdown-it="true"></localized>\n                    </p>\n                    <a ng-if="summary.description" href="{{PageUrlService.networkPage(summary.id)}}">{{"global.read-more" | translate}}</a>\n                    <div class="clear-fix"></div>\n                    <div class="sm-top-margin countDetail voffset3">\n                        {{counts=summary[\'obiba.mica.CountStatsDto.networkCountStats\'];""}}\n                        <a ng-if="counts.individualStudies && options.obibaListOptions.showStudyBadge!==false" href="{{\'studies\' | doSearchQuery:\'network(in(Mica_network.id,\' + summary.id +  \')),study(in(Mica_study.className,Study))\' }}" class="btn btn-default btn-xxs" test-ref="individualStudyCount">\n                            <localized-number value="counts.individualStudies"></localized-number>\n                            {{counts.individualStudies > 1 ?\n                            "global.individual-studies":"global.individual-study"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.studiesWithVariables && options.obibaListOptions.showStudyBadge!==false" href="{{\'studies\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),variable(in(Mica_variable.variableType,Collected))\' }}" class="btn btn-default btn-xxs" test-ref="studyWithVariablesCount">\n                            <localized-number value="counts.studiesWithVariables"></localized-number>\n                            {{counts.studiesWithVariables > 1 ?\n                            "metrics.mica.studies-with-variables" :\n                            "metrics.mica.study-with-variables"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.studyVariables && options.obibaListOptions.showVariableBadge!==false" href="{{\'variables\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),variable(in(Mica_variable.variableType,Collected))\' }}" class="btn btn-default btn-xxs" test-ref="studyVariableCount">\n                            <localized-number value="counts.studyVariables"></localized-number>\n                            {{counts.studyVariables > 1 ?\n                            "metrics.mica.study-variables" :\n                            "metrics.mica.study-variable"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.harmonizationStudies && options.obibaListOptions.showStudyBadge!==false" href="{{\'studies\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),study(in(Mica_study.className,HarmonizationStudy))\' }}" class="btn btn-default btn-xxs" test-ref="harmonizationStudyCount">\n                            <localized-number value="counts.harmonizationStudies"></localized-number>\n                            {{counts.harmonizationStudies > 1 ?\n                            "global.harmonization-studies" :\n                            "global.harmonization-study"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.dataschemaVariables && options.obibaListOptions.showVariableBadge!==false" href="{{\'variables\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),variable(in(Mica_variable.variableType,Dataschema))\' }}" class="btn btn-default btn-xxs" test-ref="harmonizationStudyWithVariablesCount">\n                            <localized-number value="counts.dataschemaVariables"></localized-number>\n                            {{counts.dataschemaVariables > 1 ?\n                            "metrics.mica.harmonization-study-variables" :\n                            "metrics.mica.harmonization-study-variable"\n                            | translate}}\n                        </a>\n                        {{datasetsCount = counts.studyDatasets +\n                        counts.harmonizationDatasets; ""}}\n                        <a ng-if="datasetsCount && options.obibaListOptions.showDatasetBadge!==false" href="{{\'datasets\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \'))\' }}" class="btn btn-default btn-xxs" test-ref="datasetCount">\n                            <localized-number value="datasetsCount"></localized-number>\n                            {{datasetsCount > 1 ? "datasets" :\n                            "dataset.details"\n                            | translate}}\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),e.put("lists/views/list/studies-search-result-table-template.html",'<div>\n    <div class="col-md-12"><div ng-if="loading" class="loading"></div></div>\n    <div ng-show="!loading" class="col-md-12">\n        <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.study.noResults</p>\n        <div ng-if="summaries && summaries.length" ng-init="lang = $parent.$parent.lang">\n            <div ng-repeat="summary in summaries" ng-init="lang = $parent.$parent.lang; studyPath= summary.studyResourcePath==\'individual-study\'?\'individual-study\':\'harmonization-study\'" class="row lg-bottom-margin document-item-list flex-row" test-ref="study">\n\n                <div class="col-md-2 hidden-xs hidden-sm text-center">\n\n                    <img ng-if="summary.logo" ng-src="{{summary.logoUrl}}" class="img-responsive">\n\n                    <h1 ng-if="!summary.logo" src="" alt="" class="big-character">\n                        <span class="t_badge color_light i-obiba-S"></span>\n                    </h1>\n                </div>\n\n                <div class="col-md-10 col-sm-12 col-xs-12">\n                    <h4>\n                        <a href="{{PageUrlService.studyPage( summary.id, studyPath)}}">\n                            <localized value="summary.name" lang="lang"></localized>\n                        </a>\n                    </h4>\n                    <p ng-if="options.obibaListOptions.studiesTrimmedDescription">\n                        <localized value="summary.objectives" lang="lang" ellipsis-size="250" markdown-it="true"></localized>\n                    </p>\n                    <p ng-if="!options.obibaListOptions.studiesTrimmedDescription">\n                        <localized value="summary.objectives" lang="lang" markdown-it="true"></localized>\n                    </p>\n                    <a ng-if="summary.objectives" href="{{PageUrlService.studyPage( summary.id, studyPath)}}">{{"global.read-more" | translate}}</a>\n                    <div class="clear-fix"></div>\n                    <div ng-if="options.obibaListOptions.studiesSupplInfoDetails" class="voffset3">\n                        <blockquote-small ng-if="summary.design || summary.targetNumber.noLimit" class="help-block">\n                                <span ng-if="summary.design">\n                                {{"search.study.design" | translate}} : {{ summary.design === undefined ? \'-\' : \'study_taxonomy.vocabulary.methods-design.term.\' + summary.design + \'.title\' | translate}}\n                                </span> -\n                            <span ng-if="summary.targetNumber.number">\n                                 {{"numberOfParticipants.participants" | translate}} : <localized-number value="summary.targetNumber.number"></localized-number>\n                                </span>\n                            <span ng-if="summary.targetNumber.noLimit">\n                                    <span ng-if="summary.design">; </span>\n                                    {{"numberOfParticipants.no-limit" | translate}}\n                                </span>\n                        </blockquote-small>\n                        <div class="sm-top-margin">\n                            {{counts=summary[\'obiba.mica.CountStatsDto.studyCountStats\'];""}}\n                            <a ng-if="counts.networks && options.obibaListOptions.showNetworkBadge!==false" href="{{\'networks\' | doSearchQuery:\'network(in(Mica_network.studyIds,\' + summary.id +  \'))\' }}" class="btn btn-default btn-xxs" test-ref="networkCount">\n                                <localized-number value="counts.networks"></localized-number>\n                                {{counts.networks>1?"networks":"network.label"\n                                | translate}}\n                            </a>\n                            {{datasetsCount=counts.studyDatasets +\n                            counts.harmonizationDatasets;""}}\n                            <a ng-if="datasetsCount && options.obibaListOptions.showDatasetBadge!==false" href="{{\'datasets\' | doSearchQuery:\'study(in(Mica_study.id,\' + summary.id + \'))\'}}" class="btn btn-default btn-xxs" test-ref="datasetCount">\n                                <localized-number value="datasetsCount"></localized-number>\n                                {{datasetsCount>1?"datasets":"dataset.details"\n                                | translate}}\n                            </a>\n                            <a ng-if="counts.studyVariables && options.obibaListOptions.showVariableBadge!==false" href="{{\'variables\' | doSearchQuery:\'study(in(Mica_study.id,\' + summary.id + \')),variable(in(Mica_variable.variableType,Collected))\'}}" class="btn btn-default btn-xxs" test-ref="studyVariableCount">\n                                <localized-number value="counts.studyVariables"></localized-number>\n                                {{counts.studyVariables>1?"client.label.study-variables":"client.label.study-variable"\n                                | translate}}\n                            </a>\n                            <a ng-if="counts.dataschemaVariables && options.obibaListOptions.showVariableBadge!==false" href="{{\'variables\' | doSearchQuery:\'study(in(Mica_study.id,\' + summary.id + \')),variable(in(Mica_variable.variableType,Dataschema))\'}}" class="btn btn-default btn-xxs" test-ref="dataSchemaVariableCount">\n                                <localized-number value="counts.dataschemaVariables"></localized-number>\n                                {{counts.dataschemaVariables>1?"client.label.dataschema-variables":"client.label.dataschema-variable"\n                                | translate}}\n                            </a>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n\n    </div>\n</div>'),e.put("lists/views/region-criteria/criterion-dropdown-template.html",'<div id="{{criterion.id.replace(\'.\',\'-\')}}-dropdown-{{timestamp}}" class="{{\'btn-group voffset1 btn-\' + criterion.target}}" ng-class="{open: state.open}" ng-keyup="onKeyup($event)">\n\n  <span ng-if="VocabularyService.isFacettedVocabulary(criterion.vocabulary)" ng-class="{open: state.open}">\n  <button class="{{\'btn btn-xs dropdown btn-\' + criterion.target}}" ng-click="openDropdown()">\n    <span uib-popover="{{localize(criterion.vocabulary.description ? criterion.vocabulary.description : criterion.vocabulary.title)}}" popover-title="{{criterion.vocabulary.description ? localize(criterion.vocabulary.title) : null}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">\n    <i class="fa fa-info-circle"> </i>\n  </span>\n    <span title="{{localizeCriterion()}}" test-ref="search-criterion">\n    {{truncate(localizeCriterion())}}\n    </span>\n    <span class="fa fa-caret-down"></span>\n  </button>\n  <button class="btn btn-xs btn-default" ng-click="remove(criterion.id)">\n    <span class="fa fa-times"></span>\n  </button>\n\n  <match-criterion ng-if="VocabularyService.isMatchVocabulary(criterion.vocabulary)" criterion="criterion" query="query" state="state"></match-criterion>\n\n  <string-criterion-terms ng-if="VocabularyService.isTermsVocabulary(criterion.vocabulary) || VocabularyService.isRangeVocabulary(criterion.vocabulary)" criterion="criterion" query="query" state="state"></string-criterion-terms>\n\n  <numeric-criterion ng-if="VocabularyService.isNumericVocabulary(criterion.vocabulary)" criterion="criterion" query="query" state="state"></numeric-criterion>\n</span>\n</div>'),e.put("lists/views/region-criteria/search-criteria-region-template.html",'<div id="search-criteria-region" ng-class="options.showSearchBox || options.showSearchBrowser ? \'voffset2\' : \'\'" class="panel panel-default" ng-if="search.criteria.children && search.criteria.children.length>0 && canShowCriteriaRegion()">\n    <div class="panel-body">\n        <table style="border:none">\n            <tbody>\n            <tr>\n                <td style="padding-left: 10px">\n                    <div criteria-root item="search.criteria" on-remove="removeCriteriaItem" on-refresh="refreshQuery" query="search.query" class="inline"></div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n</div>'),e.put("lists/views/search-result-list-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n\n<div ng-show="display === \'list\'">\n  \x3c!--ToDo using the entity-counts component to diusplay some counts int lists page--\x3e\n  \x3c!--<entity-counts taxonomy-type-map="targetTypeMap" result-tabs-order="[\'study\', \'variable\', \'network\']" target="target" result="result"></entity-counts>--\x3e\n  <div class="row voffset3">\n    <div class="col-md-2">\n      <span ng-show="options.obibaListOptions.countCaption" role="presentation" ng-repeat="res in resultTabsOrder" ng-class="{active: activeTarget[targetTypeMap[res]].active && resultTabsOrder.length > 1, disabled: resultTabsOrder.length === 1}" ng-if="options[targetTypeMap[res]].showSearchTab">\n        <h4 ng-if="resultTabsOrder.length === 1" class="pull-left">\n          {{totalHits = getTotalHits(res);""}} {{singleLabel = "search." + res + ".label";""}} {{totalHits | localizedNumber }} {{totalHits>1?targetTypeMap[res]:singleLabel\n          | translate}}\n        </h4>\n      </span>\n    </div>\n    <div class="col-md-10">\n      <div ng-show="options.obibaListOptions.searchForm">\n        <list-search-widget type="type"></list-search-widget>\n      </div>\n      <div class="pull-right hoffset1">\n        <div ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active" class="inline" test-ref="pager">\n          <search-result-pagination show-total="false" target="activeTarget[targetTypeMap[res]].name" on-change="onPaginate(target, from, size, replace)">\n          </search-result-pagination>\n        </div>\n      </div>\n      <span ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active && activeTarget[targetTypeMap[res]].totalHits > 0 && options.obibaListOptions.searchForm">\n        <list-sort-widget target="type" class="pull-right"></list-sort-widget>\n      </span>\n    </div>\n  </div>\n  <div class="row">\n    <ng-include include-replace ng-repeat="res in resultTabsOrder" src="\'search/views/search-result-list-\' + res + \'-template.html\'"></ng-include>\n  </div>\n</div>'),e.put("lists/views/sort-widget/sort-widget-template.html",'<div class="btn-group dropdown">\n    <button id="SortOrder" type="button" class="btn-sm btn btn-primary dropdown-toggle" data-toggle="dropdown">\n           {{selected.label | translate}}\n        <i ng-if="selected.value.startsWith(\'-\') && selected.label !== \'relevance\'" class="fa fa-long-arrow-down"></i>\n        <i ng-if="!selected.value.startsWith(\'-\') && selected.label !== \'relevance\'" class="fa fa-long-arrow-up"></i>\n    </button>\n    <ul class="dropdown-menu" role="menu" uib-dropdown-menu aria-labelledby="SortOrder">\n        <li ng-repeat="option in selectSortOrder.options" role="menuitem">\n            <a ng-click="selectSortOrderOption(option)" href><span translate>{{option.label}}</span>\n               <i ng-if="option.value.startsWith(\'-\') && option.label !== \'relevance\'" class="fa fa-long-arrow-down"></i>\n               <i ng-if="!option.value.startsWith(\'-\') && option.label !== \'relevance\'" class="fa fa-long-arrow-up"></i>\n            </a>\n        </li>\n    </ul>\n</div>'),e.put("localized/localized-input-group-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <div class="input-group">\n    <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <span class="input-group-btn" ng-show="remove">\n    <button class="btn btn-default" type="button" ng-click="remove(model)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n  </span>\n  </div>\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>'),e.put("localized/localized-input-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>'),e.put("localized/localized-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n<span ng-bind-html="LocalizedValues.for(value,lang,keyLang,keyValue)  | markdown:markdownIt | ellipsis:ellipsisSize"></span>'),e.put("localized/localized-textarea-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n\n  <textarea ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" rows="{{rows ? rows : 5}}" class="form-control" id="{{fieldName}}" name="{{fieldName}}" form-server-error ng-disabled="disabled" ng-required="required"></textarea>\n\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n\n</div>'),e.put("search/components/criteria/criteria-root/component.html",'<div class="form-inline">\n  <div ng-repeat="child in item.children | renderableTargets" class="inline">\n    <div class="inline hoffset2" ng-if="$index>0">+</div>\n    <criteria-target item="child" query="$parent.query" advanced="$parent.advanced" class="inline"></criteria-target>\n  </div>\n</div>'),e.put("search/components/criteria/criteria-target/component.html",'<div>\n  <div class="hidden-xs form-group" title="{{\'search.\' + item.target + \'-where\' | translate}}">\n    <i class="{{\'i-obiba-x-large i-obiba-\' + item.target + \' color-\' + item.target}}">&nbsp;</i>\n  </div>\n  <criteria-node ng-repeat="child in item.children" item="child" query="$parent.query" advanced="$parent.advanced"></criteria-node>\n</div>'),e.put("search/components/criteria/item-region/dropdown/component.html",'<div id="{{criterion.id.replace(\'.\',\'-\')}}-dropdown-{{timestamp}}" class="{{\'btn-group voffset1 btn-\' + criterion.target}}" ng-class="{open: state.open}" ng-keyup="onKeyup($event)">\n\n  <button class="{{\'btn btn-xs dropdown btn-\' + criterion.target}}" ng-click="openDropdown()">\n    <span uib-popover="{{localize(criterion.vocabulary.description ? criterion.vocabulary.description : criterion.vocabulary.title)}}" popover-title="{{criterion.vocabulary.description ? localize(criterion.vocabulary.title) : null}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">\n      <i class="fa fa-info-circle"> </i>\n    </span>\n    <span title="{{localizeCriterion()}}" test-ref="search-criterion">\n      {{truncate(localizeCriterion())}}\n    </span>\n    <span class="fa fa-caret-down"></span>\n  </button>\n  <button class="btn btn-xs btn-default" ng-click="remove(criterion.id)">\n    <span class="fa fa-times"></span>\n  </button>\n\n  <match-criterion ng-if="VocabularyService.isMatchVocabulary(criterion.vocabulary)" criterion="criterion" query="query" state="state"></match-criterion>\n\n  <string-criterion-terms ng-if="VocabularyService.isTermsVocabulary(criterion.vocabulary) || VocabularyService.isRangeVocabulary(criterion.vocabulary)" criterion="criterion" query="query" state="state"></string-criterion-terms>\n\n  <numeric-criterion ng-if="VocabularyService.isNumericVocabulary(criterion.vocabulary)" criterion="criterion" query="query" state="state"></numeric-criterion>\n\n</div>'),e.put("search/components/criteria/item-region/item-node/component.html",'<span>\n  <span ng-if="item.children.length > 0">\n    <criteria-leaf item="item.children[0]" parent-type="$parent.item.type" query="query" advanced="advanced"></criteria-leaf>\n\n    <div class="btn-group voffset1" ng-show="$parent.advanced" uib-dropdown>\n      <button type="button" class="btn btn-default btn-xs" uib-dropdown-toggle>\n        {{item.type | translate}}\n        <span class="caret"></span>\n      </button>\n      <ul uib-dropdown-menu role="menu">\n        <li role="menuitem">\n          <a href ng-click="updateLogical(\'or\')" translate>or</a>\n        </li>\n        <li role="menuitem">\n          <a href ng-click="updateLogical(\'and\')" translate>and</a>\n        </li>\n      </ul>\n    </div>\n    <criteria-leaf item="item.children[1]" parent-type="$parent.item.type" query="query" advanced="advanced"></criteria-leaf>\n\n  </span>\n  <span ng-if="item.children.length === 0">\n    <criteria-leaf item="item" parent-type="item.parent.type" query="query" advanced="advanced"></criteria-leaf>\n  </span>\n</span>'),e.put("search/components/criteria/item-region/match/component.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="criteria-list-item">\n    <form novalidate>\n      <div>\n        <input class="form-control" id="{{criterion.vocabulary.name}}-match" ng-model="match" ng-change="update()" placeholder="{{\'search.match.placeholder\' | translate}}">\n      </div>\n    </form>\n  </li>\n</ul>'),e.put("search/components/criteria/item-region/numeric/component.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="btn-group">\n    <ul class="criteria-list-item">\n      <li>\n        <label title="{{\'search.any-help\' | translate}}">\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="false"> {{\'search.any\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label title="{{\'search.none-help\' | translate}}">\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="true"> {{\'search.none\' | translate}}\n        </label>\n      </li>\n    </ul>\n  </li>\n  <li ng-show="!selectMissing" class="divider"></li>\n  <li ng-show="!selectMissing" class="btn-group criteria-list-item">\n    <form novalidate>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-from" translate>from</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-from" placeholder="{{min}}" ng-model="from" style="width:150px">\n      </div>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-to" translate>to</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-to" placeholder="{{max}}" ng-model="to" style="width:150px">\n      </div>\n    </form>\n  </li>\n</ul>'),e.put("search/components/criteria/item-region/region/component.html",'<div id="search-criteria-region" ng-class="options.showSearchBox || options.showSearchBrowser ? \'voffset2\' : \'\'" class="panel panel-default" ng-if="renderableTargets && renderableTargets.length > 0">\n  <div class="panel-body">\n    <table style="border:none">\n      <tbody>\n        <tr>\n          <td>\n            <a href class="btn btn-sm btn-default" ng-click="clearSearchQuery()" translate>clear</a>\n          </td>\n          <td style="padding-left: 10px">\n            <div criteria-root item="search.criteria" query="search.query" advanced="search.advanced" on-remove="removeCriteriaItem" on-refresh="refreshQuery" class="inline"></div>\n\n            <small class="hoffset2" ng-if="showAdvanced()">\n              <a href ng-click="toggleSearchQuery()" title="{{search.advanced ? \'search.basic-help\' : \'search.advanced-help\' | translate}}" translate>\n                {{search.advanced ? \'search.basic\' : \'search.advanced\' | translate}}\n              </a>\n            </small>\n\n            <div class="btn-group voffset1 hoffset2" uib-dropdown auto-close="outsideClick" is-open="status.isopen">\n              <button id="single-button" type="button" class="btn btn-xs btn-success" uib-dropdown-toggle ng-disabled="disabled">\n                Copy query\n                <span class="caret"></span>\n              </button>\n              <ul class="dropdown-menu query-dropdown-menu criteria-list-item" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n                <li role="menuitem">\n                  <div class="form-group">\n                    <label class="control-label" translate>search.query</label>\n                    <div class="input-group">\n                      <input id="copyQuery" type="text" class="form-control" value="{{$parent.query}}" tooltip-is-open="$parent.showCopiedQueryTooltipStatus" uib-tooltip="{{\'global.copied\' | translate}}" tooltip-trigger="\'none\'">\n                      <span class="input-group-btn">\n                        <button class="btn" ng-click="$parent.showCopiedQueryTooltip()" ngclipboard data-clipboard-target="#copyQuery" uib-tooltip="{{\'global.copy-to-clipboard\' | translate}}">\n                          <span class="fa fa-copy" alt="Copy to clipboard">\n                        </button>\n                      </span>\n                    </div>\n                    <small>\n                      <span class="help-block" translate>search.query-copy-help</span>\n                    </small>\n                  </div>\n                </li>\n              </ul>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</div>'),e.put("search/components/criteria/item-region/string-terms/component.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n    <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n    <li class="btn-group">\n      <ul class="criteria-list-item">\n        <li>\n          <label title="{{\'search.any-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.EXISTS}}">\n            {{\'search.any\' | translate}}\n          </label>\n        </li>\n        <li>\n          <label title="{{\'search.none-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.MISSING}}">\n            {{\'search.none\' | translate}}\n          </label>\n        </li>\n        <li>\n          <label title="{{\'search.in-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.IN}}">\n            {{\'search.in\' | translate}}\n          </label>\n        </li>\n        <li>\n          <label title="{{\'search.out-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.OUT}}">\n            {{\'search.out\' | translate}}\n          </label>\n        </li>\n        <li ng-show="criterion.vocabulary.repeatable">\n          <label title="{{\'search.contains-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.CONTAINS}}">\n            {{\'search.contains\' | translate}}\n          </label>\n        </li>\n      </ul>\n    </li>\n    <li ng-show="isInOutFilter() || isContainsFilter()" class="divider"></li>\n    <li class="criteria-list-item" ng-show="state.loading">\n      <p class="voffset2 loading">\n      </p>\n    </li>\n    <li ng-show="isInOutFilter() || isContainsFilter()">\n      <ul ng-show="!state.loading" class="no-padding criteria-list-terms">\n        <li class="criteria-list-item" ng-show="terms && terms.length>10">\n          <span class="input-group input-group-sm no-padding-top">\n            <input ng-model="searchText" type="text" class="form-control" aria-describedby="term-search">\n            <span class="input-group-addon" id="term-search"><i class="fa fa-search"></i></span>\n          </span>\n        </li>\n        <li ng-show="terms && terms.length>10"></li>\n        <li class="criteria-list-item" ng-show="isInOutFilter() || isContainsFilter()" ng-repeat="term in terms | regex:searchText:[\'key\',\'title\',\'description\']" uib-popover="{{term.description ? term.description : (truncate(term.title) === term.title ? null : term.title)}}" popover-title="{{term.description ? term.title : null}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">\n            <span>\n              <label class="control-label">\n                <input ng-model="checkboxTerms[term.key]" type="checkbox" ng-click="updateSelection()">\n                <span>{{truncate(term.title ? term.title : term.key)}}</span>\n              </label>\n            </span>\n            <span class="pull-right">\n              <span class="agg-term-count" ng-show="isSelectedTerm(term)">{{term.count}}</span>\n              <span class="agg-term-count-default" ng-show="!isSelectedTerm(term)">{{term.count}}</span>\n            </span>\n        </li>\n      </ul>\n    </li>\n  </ul>'),e.put("search/components/criteria/match-vocabulary-filter-detail/component.html",'<input type="text" class="form-control" placeholder="{{\'search.match.placeholder\' | translate}}" ng-model="$ctrl.vocabulary.matchString" ng-keyup="$ctrl.enterText($event)">'),e.put("search/components/criteria/numeric-vocabulary-filter-detail/component.html",'<form ng-submit="$ctrl.setRangeValue($event)">\n  <label>{{\'global.from\' | translate}}\n    <input type="number" ng-model="$ctrl.vocabulary.rangeTerms.from">\n  </label>\n\n  <label> {{\'global.to\' | translate}}\n    <input type="number" ng-model="$ctrl.vocabulary.rangeTerms.to">\n  </label>\n  <button type="submit" class="btn btn-default btn-xs"><i class="fa fa-chevron-right"></i></button>\n</form>'),e.put("search/components/criteria/terms-vocabulary-filter-detail/component.html",'<div ng-class="{\'row\': ($index + 1) % 4 === 0}" ng-repeat="term in $ctrl.vocabulary.filteredTerms | sortTerms:$ctrl.vocabulary | limitTo:$ctrl.limitNumber">\n  <div class="col-xs-3 col-md-3">\n    <div class="checkbox">\n      <label uib-popover="{{term.description ? term.description : term.title | localizedString}}" popover-title="{{term.description ? term.title : null | localizedString}}" popover-placement="bottom" popover-trigger="\'mouseenter\'" popover-popup-delay="250" popover-class="right-panel-popover" for="term-{{$ctrl.vocabulary.name + \'-\' + $index + \'-\' + term.name}}" class="word-break">\n        <input id="term-{{$ctrl.vocabulary.name + \'-\' + $index + \'-\' + term.name}}" type="checkbox" ng-model="term.selected" ng-click="$ctrl.clickCheckbox(term)"> {{term.title | localizedString}}\n      </label>\n    </div>\n  </div>\n</div>\n<span class="clearfix"></span>\n<div class="row">\n  <div class="col-md-12">\n    <div class="btn-group pull-right">\n      <button type="button" ng-if="$ctrl.limitNumber > $ctrl.constantLimitNumber" class="btn btn-xs btn-primary" ng-click="$ctrl.limitNumber = $ctrl.constantLimitNumber">\n        {{\'search.facet.less\' | translate}}\n      </button>\n      <button type="button" ng-if="$ctrl.vocabulary.filteredTerms.length > $ctrl.limitNumber" class="btn btn-xs btn-primary" ng-click="$ctrl.limitNumber = $ctrl.vocabulary.filteredTerms.length">\n        {{\'search.facet.more\' | translate}}\n      </button>\n    </div>\n  </div>\n</div>'),e.put("search/components/entity-counts/component.html",'<ul class="list-no-style list-inline">\n  <li ng-repeat="entity in $ctrl.resultTabsOrder">\n    <a href ng-click="$ctrl.selectType(entity)" class="btn btn-xs" ng-class="{\'btn-default\': (entity !== $ctrl.target), \'btn-primary\': (entity === $ctrl.target)}">\n        {{$ctrl.taxonomyTypeMap[entity] | translate}} <span>{{$ctrl.getTotalHits(entity) | localizedNumber}}</span>\n    </a>\n  </li>\n</ul>'),e.put("search/components/entity-search-typeahead/component.html",'<div class="input-group">\n  <div class="form-group has-feedback">\n    <input type="search" ng-model="$ctrl.model" ng-attr-placeholder="{{$ctrl.placeholderText | translate}}" uib-typeahead="suggestion for suggestion in $ctrl.suggest($viewValue)" typeahead-focus-first="false" typeahead-on-select="$ctrl.select($item)" ng-keyup="$ctrl.onKeyUp($event)" class="form-control">\n    <span ng-if="$ctrl.model" ng-click="$ctrl.clear()" class="form-control-feedback form-control-clear width-initial height-initial padding-right-10">\n        <i class="fa fa-times"></i>\n    </span>\n  </div>\n  <span ng-show="$ctrl.showButton" class="input-group-btn">\n    <button type="submit" class="btn btn-default" ng-click="$ctrl.select($ctrl.model)">\n      <i class="fa fa-search"></i>\n    </button>\n  </span>\n</div>'),e.put("search/components/facets/taxonomy/component.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n  <ul class="nav nav-tabs" role="tablist" ng-if="targets.length > 1">\n      <li ng-repeat="tab in targets" role="presentation" ng-class="{ active: tab === target }">\n        <a href role="tab" ng-click="setTarget(tab)">{{\'search.\' + tab + \'.facet-label\' | translate}}</a></li>\n    </ul>\n    \n    <uib-accordion close-others="false">\n        <div uib-accordion-group ng-repeat="taxonomy in taxonomies[target]" is-open="taxonomy.isOpen" is-disabled="false" template-url="search/views/classifications/taxonomy-accordion-group.html">\n          <uib-accordion-heading>\n              <i class="fa" ng-class="{\'fa-chevron-down\': taxonomy.isOpen, \'fa-chevron-right\': !taxonomy.isOpen}"></i>\n              <span uib-popover="{{localize(taxonomy.description ? taxonomy.description : taxonomy.title)}}" popover-title="{{taxonomy.description ? localize(taxonomy.title) : null}}" popover-placement="bottom" popover-trigger="\'mouseenter\'" popover-popup-delay="1000">\n                {{localize(taxonomy.title)}}\n              </span>\n          </uib-accordion-heading>\n          <uib-accordion close-others="false">\n            <div uib-accordion-group ng-repeat="vocabulary in taxonomy.vocabularies" is-open="vocabulary.isOpen" is-disabled="false" template-url="search/views/classifications/vocabulary-accordion-group.html">\n              <uib-accordion-heading>\n                <span uib-popover="{{localize(vocabulary.description ? vocabulary.description : vocabulary.title)}}" popover-title="{{vocabulary.description ? localize(vocabulary.title) : null}}" popover-placement="bottom" popover-trigger="\'mouseenter\'" popover-popup-delay="1000" ng-click="loadVocabulary(taxonomy, vocabulary)">\n                  <i class="fa" ng-class="{\'fa-caret-down\': vocabulary.isOpen, \'fa-caret-right\': !vocabulary.isOpen}"></i>\n                  <span>\n                    {{localize(vocabulary.title)}}\n                  </span>\n                  <span ng-if="!vocabulary.title">\n                    {{vocabulary.name}}\n                  </span>\n                </span>\n              </uib-accordion-heading>\n              <div>\n                <div ng-if="vocabulary.isMatch" ng-controller="MatchVocabularyFacetController" class="form-group">\n                  <form novalidate class="form-inline" ng-keypress="onKeypress($event)">\n                    <div class="form-group form-group-sm">\n                      <input type="text" class="form-control" ng-model="text" placeholder="{{\'search.match.placeholder\' | translate}}">\n                      <button class="btn btn-sm btn-default" ng-click="onKeypress($event)"><i class="fa fa-chevron-right"></i></button>\n                    </div>\n                  </form>\n                </div>\n                <div ng-if="vocabulary.isNumeric" ng-controller="NumericVocabularyFacetController" class="form-group">\n                  <form novalidate class="form-inline" ng-keypress="onKeypress($event)">\n                    <div class="form-group form-group-sm">\n                      <label for="nav-{{vocabulary.name}}-from" translate>global.from</label>\n                      <input type="number" class="form-control" id="nav-{{vocabulary.name}}-from" ng-model="from" placeholder="{{min}}" style="width:75px;">\n                      <label for="nav-{{vocabulary.name}}-to" translate>global.to</label>\n                      <input type="number" class="form-control" id="nav-{{vocabulary.name}}-to" ng-model="to" placeholder="{{max}}" style="width:75px;">\n                      <button class="btn btn-sm btn-default" ng-click="onKeypress($event)"><i class="fa fa-chevron-right"></i></button>\n                    </div>\n                  </form>\n                </div>\n                <div ng-if="!vocabulary.isNumeric && !vocabulary.isMatch" ng-controller="TermsVocabularyFacetController">\n                  <div ng-if="loading" class="loading"></div>\n                  <ul class="nav nav-pills nav-stacked" ng-if="vocabulary.visibleTerms > 0">\n                    <li ng-repeat="term in vocabulary.terms | orderBy:[\'-selected\', \'-count\', \'+name\']  | limitTo:vocabulary.limit:begin" class="checkbox" ng-class="{active: term.name === term.name}" ng-if="term.isVisible">\n                      <label style="max-width: 80%;">\n                        <input type="checkbox" ng-model="term.selected" ng-change="selectTerm(target, taxonomy, vocabulary, {term: term})">\n                        <span uib-popover="{{localize(term.description ? term.description : term.title)}}" popover-title="{{term.description ? localize(term.title) : null}}" popover-placement="bottom" popover-trigger="\'mouseenter\'" popover-popup-delay="1000">\n                          <span>\n                            {{localize(term.title)}}\n                          </span>\n                          <span ng-if="!term.title">\n                            {{term.name}}\n                          </span>\n                        </span>\n                      </label>\n                        <span class="pull-right" ng-class="{\'text-muted\': !term.selected}">\n                          {{term.count}}\n                        </span>\n                    </li>\n                  </ul>\n                  <span ng-if="vocabulary.visibleTerms === 0">\n                    <em translate>search.facet.no-data</em>\n                  </span>\n                  <div ng-if="!vocabulary.isNumeric && !vocabulary.isMatch && vocabulary.visibleTerms > 10" class="voffset1 pull-right form-group">\n                    <button class="btn btn-xs btn-primary" ng-if="vocabulary.limit" ng-click="vocabulary.limit = undefined" translate>search.facet.more</button>\n                    <button class="btn btn-xs btn-default" ng-if="!vocabulary.limit" ng-click="vocabulary.limit = 10" translate>search.facet.less</button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </uib-accordion>\n        </div>\n    </uib-accordion>'),e.put("search/components/input-search-filter/component.html",'<div class="pull-right">\n    <div class="input-group has-feedback">\n       <span class="input-group-addon">\n           <i class="fa fa-filter"></i>\n       </span>\n        <input type="text" ng-model="$ctrl.queryString" ng-attr-placeholder="{{\'search.placeholder.vocabulary-filter\'  | translate}}" class="input-search-filter form-control" ng-change="$ctrl.change()">\n        <span ng-if="$ctrl.queryString" ng-click="$ctrl.clear()" class="form-control-feedback form-control-clear width-initial height-initial padding-right-5">\n          <i class="fa fa-times"></i>\n        </span>\n    </div>\n</div>'),e.put("search/components/meta-taxonomy/meta-taxonomy-filter-list/component.html",'<div uib-accordion-group class="panel-default" is-open="$ctrl.status.isFirstOpen">\n  <div uib-accordion-heading>\n    <span>\n      <i class="fa" ng-class="{\'fa-caret-down\': $ctrl.status.isFirstOpen, \'fa-caret-right\':!$ctrl.status.isFirstOpen}"></i>\n    </span>\n    {{$ctrl.metaTaxonomy.title | localizedString}}\n  </div>\n\n  <ul class="nav nav-pills nav-stacked">\n    <li role="presentation" ng-repeat="taxonomy in $ctrl.metaTaxonomy.taxonomies" ng-class="{\'active\': taxonomy.state.isActive() && $ctrl.showTaxonomyPanel}">\n      <a href ng-click="$ctrl.selectTaxonomy(taxonomy)">\n        <span uib-popover="{{taxonomy.info.description | localizedString}}" popover-title="{{taxonomy.info.trKey ? (taxonomy.info.trKey | translate) : (taxonomy.info.title | localizedString)}}" popover-placement="bottom" popover-trigger="\'mouseenter\'" popover-popup-delay="250">\n          {{taxonomy.info.trKey ? (taxonomy.info.trKey | translate) : (taxonomy.info.title | localizedString)}}\n        </span>\n        <span ng-if="taxonomy.state.isLoading()" class="loading"></span>\n        <span class="pull-right"><i class="fa fa-chevron-right"></i></span>\n      </a>\n    </li>\n  </ul>\n\n</div>'),e.put("search/components/meta-taxonomy/meta-taxonomy-filter-panel/component.html",'<div ng-class="{\'overlay-front-on-box-shodow\' : $ctrl.showTaxonomyPanel}">\n  <uib-accordion close-others="false" is-disabled="false">\n    <meta-taxonomy-filter-list ng-repeat="metaTaxonomy in $ctrl.metaTaxonomies" meta-taxonomy="metaTaxonomy" show-taxonomy-panel="$ctrl.showTaxonomyPanel" rql-query="$ctrl.rqlQuery" on-select-taxonomy="$ctrl.onSelectTaxonomy(target, taxonomy)">\n    </meta-taxonomy-filter-list>\n  </uib-accordion>\n</div>'),e.put("search/components/panel/classification/component.html",'<div ng-show="!inSearchMode()" class="voffset2">\n    <div>\n      <ol class="breadcrumb">\n        <li ng-if="!taxonomies.taxonomy">\n          {{\'all-\' + taxonomies.target + \'-classifications\' | translate}}\n        </li>\n        <li ng-if="taxonomies.taxonomy">\n          <a href ng-click="navigateTaxonomy()">{{\'all-\' + taxonomies.target + \'-classifications\' |\n            translate}}</a>\n        </li>\n        <li ng-if="taxonomies.taxonomy">\n          <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="!taxonomies.vocabulary && label.locale === lang">\n            {{label.text}}\n          </span>\n          <a href ng-click="navigateTaxonomy(taxonomies.taxonomy)" ng-if="taxonomies.vocabulary">\n            <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n              {{label.text}}\n            </span>\n          </a>\n        </li>\n        <li ng-if="taxonomies.vocabulary">\n          <span ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n            {{label.text}}\n          </span>\n        </li>\n        <a ng-if="options.showSearchRefreshButton" title="{{\'search.refresh-taxonomies\' | translate}}" href class="hoffset1" ng-click="refreshTaxonomyCache()">\n          <span class="fa fa-refresh"></span>\n        </a>\n      </ol>\n  \n    </div>\n  \n    <div ng-if="taxonomies.search.active" class="loading"></div>\n  \n    <div ng-if="!taxonomies.search.active">\n      <div ng-if="!taxonomies.taxonomy">\n        <div ng-repeat="group in taxonomyGroups">\n          <h3 ng-if="group.title">{{group.title}}</h3>\n          <p class="help-block" ng-if="group.description">{{group.description}}</p>\n          <div ng-if="!taxonomies.taxonomy">\n            <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n              <div class="col-md-4">\n                <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang" on-navigate="navigateTaxonomy"></div>\n              </div>\n              <div class="col-md-4">\n                <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang" on-navigate="navigateTaxonomy"></div>\n              </div>\n              <div class="col-md-4">\n                <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang" on-navigate="navigateTaxonomy"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n  \n      <div ng-if="taxonomies.taxonomy && !taxonomies.vocabulary">\n        <h3 ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </h3>\n  \n        <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n          {{label.text}}\n        </p>\n  \n        <div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n          <div class="col-md-4">\n            <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index]" lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 1]" lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 2]" lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n        </div>\n      </div>\n  \n      <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && !taxonomies.term">\n        <h3 ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </h3>\n  \n        <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description" ng-if="label.locale === lang">\n          {{label.text}}\n        </p>\n  \n        <div ng-repeat="term in taxonomies.vocabulary.terms" ng-if="$index % 3 == 0" class="row">\n          <div class="col-md-4">\n            <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index]" lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 1]" lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 2]" lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n        </div>\n      </div>\n  \n      <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && taxonomies.term">\n        <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </h5>\n        <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n          <span class="help-block" ng-bind-html="label.text | dceDescription" ng-if="taxonomies.vocabulary.name === \'dceId\'"></span>\n          <span class="help-block" ng-bind-html="label.text" ng-if="taxonomies.vocabulary.name !== \'dceId\'"></span>\n        </p>\n        <div>\n          <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {term: taxonomies.term})">\n            <i class="fa fa-plus-circle"></i>\n            <span translate>add-query</span>\n          </a>\n        </div>\n      </div>\n    </div>\n  \n  </div>'),e.put("search/components/panel/taxonomies-panel/component.html",'<div class="collapse">\n  <div class="voffset2">\n    <div class="search-browser panel panel-default">\n      <div class="panel-heading no-padding-top no-padding-bottom">\n        <div class="row no-padding">\n          <div class="col-md-8">\n            <ol class="breadcrumb no-margin no-padding pull-left">\n              <li ng-if="taxonomies.taxonomy">\n                <h4 ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang" class="pull-left">\n                  <strong>{{label.text}}</strong>\n                </h4>\n                <a ng-if="options.showSearchRefreshButton" title="{{\'search.refresh-taxonomies\' | translate}}" href class="hoffset1 voffset2 pull-right" ng-click="refreshTaxonomyCache(target, taxonomies.taxonomy.name)">\n                  <span class="fa fa-refresh"></span>\n                </a>\n              </li>\n            </ol>\n          </div>\n          <div class="col-md-4">\n            <h4 ng-click="closeTaxonomies()" title="{{\'close\' | translate}}" class="pull-right" style="cursor: pointer">\n              <i class="fa fa-close"></i>\n            </h4>\n          </div>\n        </div>\n      </div>\n      <div class="panel-body">\n        <div ng-if="taxonomies.search.active" class="loading"></div>\n\n        <div ng-if="!taxonomies.search.active">\n          <div ng-if="!taxonomies.taxonomy">\n            <div ng-repeat="group in taxonomyGroups">\n              <h4 ng-if="group.title">{{group.title}}</h4>\n              <p class="help-block" ng-if="group.description">{{group.description}}</p>\n              <div ng-if="!taxonomies.taxonomy">\n                <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang" on-navigate="navigateTaxonomy"></div>\n                  </div>\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang" on-navigate="navigateTaxonomy"></div>\n                  </div>\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang" on-navigate="navigateTaxonomy"></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div ng-if="taxonomies.taxonomy">\n            <div class="row">\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.taxonomy">\n                <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n                  {{label.text}}\n                </p>\n                <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.taxonomy.vocabularies">\n                  <li ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies | visibleVocabularies | filter:canNavigate " class="{{taxonomies.vocabulary.name === vocabulary.name ? \'active\' : \'\'}}">\n                    <a class="clearfix" id="search-navigate-taxonomy" href ng-click="navigateTaxonomy(taxonomies.taxonomy, vocabulary)">\n                      <i class="pull-right {{taxonomies.vocabulary.name !== vocabulary.name ? \'hidden\' : \'\'}} hidden-sm hidden-xs fa fa-chevron-circle-right"></i>\n                      <span ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n                        {{label.text}}\n                      </span>\n                      <span ng-if="!vocabulary.title">\n                        {{vocabulary.name}}\n                      </span>\n\n\n                    </a>\n                  </li>\n                </ul>\n              </div>\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.vocabulary">\n                <div ng-if="taxonomies.vocabulary">\n                  <h5 ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </h5>\n                  <div class="form-group" ng-if="!taxonomies.isNumericVocabulary && !taxonomies.isMatchVocabulary">\n                    <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary)">\n                      <i class="fa fa-plus-circle"></i>\n                      <span translate>add-query</span>\n                    </a>\n                  </div>\n                  <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </p>\n                  <div ng-if="taxonomies.isMatchVocabulary" ng-controller="MatchVocabularyPanelController">\n                    <div class="form-group">\n                      <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {text: text})">\n                        <i class="fa fa-plus-circle"></i>\n                        <span translate>add-query</span>\n                      </a>\n                    </div>\n                    <form novalidate class="form-inline" ui-keypress="{13: \'selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {text: text})\'}">\n                      <div class="form-group">\n                        <input type="text" class="form-control" ng-model="text" placeholder="{{\'search.match.placeholder\' | translate}}">\n                      </div>\n                    </form>\n                  </div>\n                  <div ng-if="taxonomies.isNumericVocabulary" ng-controller="NumericVocabularyPanelController">\n                    <div class="form-group">\n                      <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {from: from, to: to})">\n                        <i class="fa fa-plus-circle"></i>\n                        <span translate>add-query</span>\n                      </a>\n                    </div>\n                    <form novalidate class="form-inline" ui-keypress="{13:\'selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {from: from, to: to})\'}">\n                      <div class="form-group">\n                        <label for="nav-{{taxonomies.vocabulary.name}}-from" translate>from</label>\n                        <input type="number" class="form-control" id="nav-{{taxonomies.vocabulary.name}}-from" ng-model="from" style="width:150px">\n                      </div>\n                      <div class="form-group">\n                        <label for="nav-{{taxonomies.vocabulary.name}}-to" translate>to</label>\n                        <input type="number" class="form-control" id="nav-{{taxonomies.vocabulary.name}}-to" ng-model="to" style="width:150px">\n                      </div>\n                    </form>\n                  </div>\n                  <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.vocabulary.terms">\n                    <li ng-repeat="term in taxonomies.vocabulary.terms" class="{{taxonomies.term.name === term.name ? \'active\' : \'\'}}">\n                      <a class="clearfix" id="search-navigate-vocabulary" href ng-click="navigateTaxonomy(taxonomies.taxonomy, taxonomies.vocabulary, term)">\n                        <i class="pull-right {{taxonomies.term.name !== term.name ? \'hidden\' : \'\'}} hidden-sm hidden-xs fa fa-chevron-circle-right"></i>\n                        <span ng-repeat="label in term.title" ng-if="label.locale === lang">\n                          {{label.text}}\n                        </span>\n                        <span ng-if="!term.title">\n                          {{term.name}}\n                        </span>\n                      </a>\n                    </li>\n                  </ul>\n                </div>\n                <div ng-if="!taxonomies.vocabulary" translate>search.taxonomy-nav-help</div>\n              </div>\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.term">\n                <div ng-if="taxonomies.term">\n                  <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </h5>\n                  <div>\n                    <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {term: taxonomies.term})">\n                      <i class="fa fa-plus-circle"></i>\n                      <span translate>add-query</span>\n                    </a>\n                  </div>\n                  <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n                    <span class="help-block" ng-bind-html="label.text | dceDescription" ng-if="taxonomies.vocabulary.name === \'dceId\'"></span>\n                    <span class="help-block" ng-bind-html="label.text" ng-if="taxonomies.vocabulary.name !== \'dceId\'"></span>\n                  </p>\n                </div>\n                <div ng-if="!taxonomies.term && taxonomies.vocabulary" translate>search.vocabulary-nav-help</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("search/components/panel/taxonomy-panel/component.html",'<div>\n  <div class="panel panel-default" ng-if="taxonomy">\n    <div class="panel-heading">\n      <div ng-repeat="label in taxonomy.title" ng-if="label.locale === lang">\n        <a href ng-click="onNavigate(taxonomy)">{{label.text}}</a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div ng-repeat="label in taxonomy.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </div>\n    </div>\n  </div>\n</div>'),e.put("search/components/panel/term-panel/component.html",'<div>\n  <div class="panel panel-default" ng-if="term">\n    <div class="panel-heading">\n      <div>\n        <localized value="term.title" lang="lang" key-lang="locale" key-value="text"></localized>\n        {{label.text}}\n        <small>\n          <a href ng-click="onSelect(target, taxonomy, vocabulary, {term: term})">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </a>\n        </small>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div>\n        <localized value="term.description" lang="lang" key-lang="locale" key-value="text"></localized>\n      </div>\n      <div ng-if="!term.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>'),e.put("search/components/panel/vocabulary-panel/component.html",'<div>\n  <div class="panel panel-default" ng-if="vocabulary">\n    <div class="panel-heading">\n      <div ng-repeat="label in vocabulary.title" ng-if="label.locale === lang" class="clearfix">\n        <a href ng-click="onNavigate(taxonomy, vocabulary)" ng-if="vocabulary.terms">{{label.text}}</a>\n        <span ng-if="!vocabulary.terms">{{label.text}}</span>\n        <a href ng-click="onSelect(target, taxonomy, vocabulary)">\n          <small ng-if="vocabulary.terms">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </small>\n          <small ng-if="!vocabulary.terms">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </small>\n        </a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div>\n        <localized value="vocabulary.description" lang="lang" key-lang="locale" key-value="text"></localized>\n      </div>\n      <div ng-if="!vocabulary.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>'),e.put("search/components/result/cell-stat-value/component.html",'<div>\n  <span ng-if="$ctrl.disable"><localized-number value="$ctrl.entityCount"></localized-number></span>\n  <a href ng-click="$ctrl.clickCriteria()" ng-if="!$ctrl.disable">\n    <localized-number value="$ctrl.entityCount"></localized-number>\n  </a>\n</div>'),e.put("search/components/result/coverage-result/component.html",'<div class="coverage">\n\n  <div ng-if="hasVariableTarget()">\n    <ul class="nav nav-pills pull-left">\n      <li ng-if="groupByOptions.canShowStudy() && groupByOptions.canShowDataset()" ng-class="{\'active\': bucket.startsWith(\'study\') || bucketStartsWithDce}" class="studies">\n        <a href ng-click="selectTab(\'study\')" translate>{{groupByOptions.studyTitle()}}</a>\n      </li>\n      <li ng-if="groupByOptions.canShowStudy() && groupByOptions.canShowDataset()" ng-class="{\'active\': bucket.startsWith(\'dataset\')}" class="datasets">\n        <a href ng-click="selectTab(\'dataset\')" translate>{{groupByOptions.datasetTitle()}}</a>\n      </li>\n    </ul>\n\n    <div ng-class="{\'pull-right\': groupByOptions.canShowStudy() && groupByOptions.canShowDataset()}">\n      <a ng-if="hasSelected()" href class="btn btn-default" ng-click="updateFilterCriteria()">\n        <i class="fa fa-filter"></i> {{\'search.filter\' | translate}}\n      </a>\n\n      <span ng-if="table.taxonomyHeaders.length > 0">\n        <a href class="btn btn-info btn-responsive" ng-click="selectFullAndFilter()" ng-hide="isFullCoverageImpossibleOrCoverageAlreadyFull()">\n          {{\'search.coverage-select.full\' | translate}}\n        </a>\n        <a obiba-file-download url="downloadUrl()" target="_self" download class="btn btn-info btn-responsive" href>\n          <i class="fa fa-download"></i> {{\'download\' | translate}}\n        </a>\n      </span>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <div class="voffset2" ng-class="{\'pull-right\': groupByOptions.canShowVariableTypeFilter(bucket) && groupByOptions.canShowStudyType()}" ng-if="!singleStudy && groupByOptions.canShowDce(bucket)">\n      <label class="checkbox-inline">\n        <input type="checkbox" ng-model="bucketSelection.dceBucketSelected">\n        <span translate>search.coverage-buckets.dce</span>\n      </label>\n    </div>\n\n    <div class="voffset2" ng-if="!singleStudy && groupByOptions.canShowStudyType()">\n      <div class="btn btn-group" style="padding: 0">\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'all\'" translate>all</label>\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'individual\'" translate>search.coverage-buckets.individual</label>\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'harmonization\'" translate>search.coverage-buckets.harmonization</label>\n      </div>\n    </div>\n  </div>\n\n  <p class="help-block" ng-if="!loading && !table.taxonomyHeaders">\n    <span ng-if="!hasVariableTarget()" translate>search.no-coverage</span>\n    <span ng-if="hasVariableTarget()" translate>search.no-results</span>\n  </p>\n\n  <div ng-if="loading" class="loading"></div>\n\n  <div class="table-responsive" ng-if="!loading && table.taxonomyHeaders.length > 0">\n    <table class="table table-bordered table-striped">\n      <thead>\n        <tr>\n          <th rowspan="2" width="50" style="text-align: center">\n            <div class="btn-group voffset1" uib-dropdown>\n              <div uib-dropdown-toggle>\n                <span class="fa fa-square-o"></span>\n                <span class="fa fa-caret-down"></span>\n              </div>\n              <ul uib-dropdown-menu role="menu">\n                <li role="menuitem">\n                  <a href ng-click="selectAll()" translate>search.coverage-select.all</a>\n                </li>\n                <li role="menuitem">\n                  <a href ng-click="selectNone()" translate>search.coverage-select.none</a>\n                </li>\n                <li role="menuitem">\n                  <a href ng-click="selectFull()" translate>search.coverage-select.full</a>\n                </li>\n              </ul>\n            </div>\n          </th>\n          <th rowspan="{{bucketStartsWithDce ? 1 : 2}}" colspan="{{table.cols.colSpan}}" translate>\n            {{\'search.coverage-buckets.\' + bucket}}\n          </th>\n          <th ng-repeat="header in ::table.vocabularyHeaders" colspan="{{::header.termsCount}}">\n            <span uib-popover="{{header.entity.descriptions[0].value}}" popover-title="{{header.entity.titles[0].value}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">\n              {{header.entity.titles[0].value}}\n            </span>\n            <small>\n              <a href ng-click="removeVocabulary(header)">\n                <i class="fa fa-times"></i>\n              </a>\n            </small>\n          </th>\n        </tr>\n        <tr>\n          <th ng-if="bucketStartsWithDce && !singleStudy" translate>search.coverage-dce-cols.study</th>\n          <th ng-if="bucketStartsWithDce" colspan="{{choseHarmonization && !choseAll ? 2 : 1}}" translate>search.coverage-dce-cols.population</th>\n          <th ng-if="bucketStartsWithDce" ng-hide="choseHarmonization && !choseAll" translate>search.coverage-dce-cols.dce</th>\n          <th ng-repeat="header in ::table.termHeaders">\n            <span uib-popover="{{header.entity.descriptions[0].value}}" popover-title="{{header.entity.titles[0].value}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">\n              {{header.entity.titles[0].value}}\n            </span>\n            <small>\n              <a ng-if="header.canRemove" href ng-click="removeTerm(header)">\n                <i class="fa fa-times"></i>\n              </a>\n            </small>\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat="row in ::table.rows track by row.value" ng-show="showMissing || table.termHeaders.length == row.hits.length">\n          <td style="text-align: center">\n            <input type="checkbox" ng-model="row.selected">\n          </td>\n          <td ng-repeat="col in ::table.cols.ids[row.value] track by col.index" colspan="{{$middle && (choseHarmonization && !choseAll) ? 2 : 1}}" ng-hide="col.id === \'-\' && (singleStudy || choseHarmonization && !choseAll)">\n            <span ng-if="col.id === \'-\'">-</span>\n            <a ng-hide="col.rowSpan === 0  || col.id === \'-\'" href="{{col.url}}" uib-popover-html="col.description === col.title ? null : col.description" popover-title="{{col.title}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">{{col.title}}</a>\n            <div style="text-align: center" ng-if="col.start && bucketStartsWithDce">\n              <div>\n                <small class="help-block no-margin" ng-if="::col.end">\n                  {{::col.start}} {{\'to\' | translate}} {{::col.end}}\n                </small>\n                <small class="help-block no-margin" ng-if="!col.end">\n                  {{::col.start}}, {{\'search.coverage-end-date-ongoing\' | translate | lowercase}}\n                </small>\n              </div>\n              <div class="progress no-margin">\n                <div class="progress-bar progress-bar-transparent" role="progressbar" aria-valuenow="{{::col.start}}" aria-valuemin="{{::col.min}}" aria-valuemax="{{::col.start}}" ng-style="{\'width\': col.progressStart + \'%\'}">\n                </div>\n                <div class="{{\'progress-bar progress-bar-\' + col.progressClass}}" role="progressbar" aria-valuenow="{{col.current}}" aria-valuemin="{{::col.start}}" aria-valuemax="{{::col.end ? col.end : col.current}}" ng-style="{\'width\': col.progress + \'%\'}">\n                </div>\n              </div>\n            </div>\n          </td>\n          <td ng-repeat="h in ::table.termHeaders" title="{{h.entity.titles[0].value}}">\n            <a href ng-click="updateCriteria(row.value, h, $index, \'variables\')">\n              <span class="label label-info" ng-show="row.hitsTitles[$index]">{{row.hitsTitles[$index]}}</span>\n            </a>\n            <span ng-show="!row.hitsTitles[$index]">0</span>\n          </td>\n        </tr>\n      </tbody>\n      <tfoot>\n        <tr>\n          <th></th>\n          <th colspan="{{table.cols.colSpan}}" translate>all</th>\n          <th ng-repeat="header in ::table.termHeaders" title="{{header.entity.descriptions[0].value}}">\n            <a href ng-click="updateCriteria(null, header, $index, \'variables\')">\n              <localized-number value="header.hits"></localized-number>\n            </a>\n          </th>\n        </tr>\n      </tfoot>\n    </table>\n  </div>\n</div>'),e.put("search/components/result/datasets-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.dataset.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n          <tr>\n            <th translate ng-if="optionsCols.showDatasetsAcronymColumn">acronym</th>\n            <th translate>name</th>\n            <th translate ng-if="optionsCols.showDatasetsTypeColumn">type</th>\n            <th translate ng-if="optionsCols.showDatasetsNetworkColumn">networks</th>\n            <th translate ng-if="optionsCols.showDatasetsStudiesColumn">studies</th>\n            <th translate ng-if="optionsCols.showDatasetsVariablesColumn">variables</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-if="!summaries || !summaries.length">\n            <td colspan="6" translate>search.dataset.noResults</td>\n          </tr>\n          <tr ng-repeat="summary in summaries">\n            <td ng-if="optionsCols.showDatasetsAcronymColumn">\n              <a ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n                <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n              </a>\n            </td>\n            <td>\n              <a ng-if="!optionsCols.showDatasetsAcronymColumn" ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n                <localized value="summary.name" lang="lang"></localized>\n              </a>\n              <localized ng-if="optionsCols.showDatasetsAcronymColumn" value="summary.name" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showDatasetsTypeColumn">\n              <localized value="classNames[(summary.variableType === \'Collected\' ? \'Study\' : \'Harmonization\') + \'Dataset\']" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showDatasetsNetworkColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks" result-tab-order="resultTabOrder" destination-tab="network" entity-count="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks" update-criteria="updateCriteria(summary.id, \'networks\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks">-</span>\n            </td>\n            <td ng-if="optionsCols.showDatasetsStudiesColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies" result-tab-order="resultTabOrder" destination-tab="study" entity-count="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies" update-criteria="updateCriteria(summary.id, \'studies\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies">-</span>\n            </td>\n            <td ng-if="optionsCols.showDatasetsVariablesColumn">\n              <cell-stat-value result-tab-order="resultTabOrder" destination-tab="variable" entity-count="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].variables" update-criteria="updateCriteria(summary.id, \'variables\')"></cell-stat-value>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>'),e.put("search/components/result/graphics-result/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n\n  <p class="help-block" ng-if="!loading && !noResults && !hasChartObjects()" translate>search.no-graphic-result</p>\n  <p class="help-block" ng-if="!loading && noResults" translate>search.no-results</p>\n\n  <div ng-repeat="chart in chartObjects" class="panel panel-default">\n    <div class="panel-heading">\n      {{chart.headerTitle}}\n    </div>\n    <div class="panel-body">\n      <div class="row">\n        <div class="col-xs-12 col-lg-6">\n          <div ng-if="chart.chartObject.type === \'GeoChart\'">\n            <obiba-geo config="chart.chartObject.d3Config"></obiba-geo>\n          </div>\n          <div ng-if="chart.chartObject.type !== \'GeoChart\'">\n            <obiba-nv-chart chart-config="chart.chartObject.d3Config"></obiba-nv-chart>\n          </div>\n        </div>\n        <div class="col-xs-12 col-lg-6">\n          <div class="table-responsive" ng-if="chart.getTable().data  &&  chart.getTable().data.length>1">\n            <table style="max-height: 400px;" class="table table-bordered table-striped" fixed-header="chart.getTable().data">\n              <thead>\n                <tr>\n                  <th>{{chart.getTable().data[0][0]}}</th>\n                  <th>{{chart.getTable().data[0][1]}}</th>\n                  <th ng-if="chart.getTable().data[0][2]">{{chart.getTable().data[0][2]}}</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr ng-repeat="row in chart.getTable().entries">\n                  <td>{{row.title}}</td>\n                  <td>\n                    <a href ng-click="updateCriteria(row.key, chart.getTable().vocabulary)">\n                      <localized-number value="row.value"></localized-number>\n                    </a>\n                  </td>\n                  <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("search/components/result/networks-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.network.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n          <tr>\n            <th rowspan="2" translate>acronym</th>\n            <th rowspan="2" translate>name</th>\n            <th rowspan="2" translate ng-if="optionsCols.showNetworksStudiesColumn">studies</th>\n            <th translate ng-attr-colspan="{{colSpans.datasets}}" ng-if="(optionsCols.showNetworksStudyDatasetColumn && choseIndividual) || (optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization)">\n              datasets\n            </th>\n            <th rowspan="2" translate ng-if="optionsCols.showNetworksVariablesColumn">variables</th>\n            <th translate ng-attr-colspan="{{colSpans.variables}}" ng-if="(optionsCols.showNetworksStudyVariablesColumn && choseIndividual) || (optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization)">variables</th>\n          </tr>\n          \n          <tr>\n            <th translate ng-if="optionsCols.showNetworksStudyDatasetColumn && choseIndividual">search.dataset.collected</th>\n            <th translate ng-if="optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization">search.dataset.harmonized</th>\n            <th translate ng-if="optionsCols.showNetworksStudyVariablesColumn && choseIndividual">search.variable.collected</th>\n            <th translate ng-if="optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization">search.variable.dataschema</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-if="!summaries || !summaries.length">\n            <td colspan="6" translate>search.network.noResults</td>\n          </tr>\n          <tr ng-repeat="summary in summaries">\n            <td>\n              <a ng-href="{{PageUrlService.networkPage(summary.id)}}">\n                <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n              </a>\n            </td>\n            <td>\n              <localized value="summary.name" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showNetworksStudiesColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies" result-tab-order="resultTabOrder" destination-tab="study" entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies" update-criteria="updateCriteria(summary.id, \'studies\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksStudyDatasetColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets" result-tab-order="resultTabOrder" destination-tab="dataset" entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets" update-criteria="updateCriteria(summary.id, \'Study\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets" result-tab-order="resultTabOrder" destination-tab="dataset" entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets" update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksVariablesColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].variables" result-tab-order="resultTabOrder" destination-tab="variable" entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].variables" update-criteria="updateCriteria(summary.id, \'variables\')"></cell-stat-value>\n            </td>\n            <td ng-if="optionsCols.showNetworksStudyVariablesColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets" result-tab-order="resultTabOrder" destination-tab="variable" entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyVariables" update-criteria="updateCriteria(summary.id, \'Study\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets" result-tab-order="resultTabOrder" destination-tab="variable" entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].dataschemaVariables" update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">-</span>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>'),e.put("search/components/result/pagination/component.html",'<div ng-show="$ctrl.pagination.totalHits > 10">\n  <div class="pull-left">\n    <select class="form-control input-sm form-select" ng-model="$ctrl.pagination.selected" ng-options="size.label for size in $ctrl.pagination.pageSizes" ng-change="$ctrl.pageSizeChanged()"></select>\n  </div>\n  <div class="pull-right" style="margin-left: 5px">\n\n    <span ng-show="$ctrl.pagination.maxSize > 1" uib-pagination total-items="$ctrl.pagination.totalHits" max-size="$ctrl.pagination.maxSize" ng-model="$ctrl.pagination.currentPage" boundary-links="true" force-ellipses="true" items-per-page="$ctrl.pagination.selected.value" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" template-url="search/views/list/pagination-template.html" ng-change="$ctrl.pageChanged()"></span>\n    <ul class="pagination pagination-sm" ng-show="$ctrl.showPaginationTotal">\n      <li>\n        <a href class="pagination-total">{{$ctrl.pagination.from}} - {{$ctrl.pagination.to}} {{\'of\' | translate}} {{$ctrl.pagination.totalHits}}</a>\n      </li>\n    </ul>\n  </div>\n</div>'),e.put("search/components/result/search-result/component.html",'<div class="search-result-tabs">\n  <ng-include include-replace ng-repeat="tab in searchTabsOrder" src="getUrlTemplate(tab)"></ng-include>\n</div>'),e.put("search/components/result/search-result/coverage.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'coverage\'">\n  <coverage-result-table result="result.coverage" loading="loading" bucket="bucket" query="query" criteria="criteria" class="voffset2" on-update-criteria="onUpdateCriteria" on-remove-criteria="onRemoveCriteria"></coverage-result-table>\n</div>'),e.put("search/components/result/search-result/graphics.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'graphics\'">\n  <graphics-result on-update-criteria="onUpdateCriteria" result="result.graphics" loading="loading" class="voffset2 graphics-tab"></graphics-result>\n</div>'),e.put("search/components/result/search-result/list.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'list\'" class="list-table">\n  <result-tabs-order-count options="options" result-tabs-order="resultTabsOrder" active-target="activeTarget" target-type-map="targetTypeMap">\n  </result-tabs-order-count>\n\n  <div class="voffset2" ng-class="{\'pull-right\': options.studies.showSearchTab, \'pull-left\': !options.studies.showSearchTab, \'hoffset2\': !options.studies.showSearchTab}">\n    <a ng-if="type==\'variables\' && options.variables.showCart" ng-click="addToCart()" class="btn btn-success" href>\n      <i class="fa fa-cart-plus"></i>\n    </a>\n    <a obiba-file-download url="getStudySpecificReportUrl()" target="_self" ng-if="type==\'studies\'" download class="btn btn-info" href>\n      <i class="fa fa-download"></i> {{\'report-group.study.button-name\' | translate}}\n    </a>\n    <a obiba-file-download url="getReportUrl()" target="_self" download class="btn btn-info" href>\n      <i class="fa fa-download"></i> {{\'download\' | translate}}\n    </a>\n  </div>\n\n  <div class="clearfix" ng-if="options.studies.showSearchTab"></div>\n\n  <div class="tab-content">\n    <div class="pull-left" study-filter-shortcut ng-if="options.studies.showSearchTab && options.studies.studiesColumn.showStudiesTypeColumn"></div>\n    <div ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active" class="pull-right voffset2" test-ref="pager">\n      <search-result-pagination show-total="true" target="activeTarget[targetTypeMap[res]].name" on-change="onPaginate(target, from, size, replace)"></search-result-pagination>\n    </div>\n    <div class="clearfix"></div>\n    <ng-include include-replace ng-repeat="res in resultTabsOrder" src="\'search/views/search-result-list-\' + res + \'-template.html\'"></ng-include>\n  </div>\n</div>'),e.put("search/components/result/studies-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.study.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped">\n        <thead>\n          <tr>\n            <th rowspan="2" translate>acronym</th>\n            <th rowspan="2" translate>name</th>\n            <th rowspan="2" translate ng-if="choseAll && optionsCols.showStudiesTypeColumn">type</th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesDesignColumn && choseIndividual">search.study.design</th>\n            <th translate ng-attr-colspan="{{optionsCols.showStudiesQuestionnaireColumn + optionsCols.showStudiesPmColumn + optionsCols.showStudiesBioColumn + optionsCols.showStudiesOtherColumn}}" ng-if="(optionsCols.showStudiesQuestionnaireColumn || optionsCols.showStudiesPmColumn || optionsCols.showStudiesBioColumn || optionsCols.showStudiesOtherColumn) && choseIndividual">\n              search.study.dataSources\n            </th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesParticipantsColumn && choseIndividual">search.study.participants</th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesNetworksColumn">networks</th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesVariablesColumn">variables</th>\n            <th translate ng-attr-colspan="{{optionsCols.showStudiesStudyDatasetsColumn + optionsCols.showStudiesStudyVariablesColumn}}" ng-if="choseIndividual && (optionsCols.showStudiesStudyDatasetsColumn || optionsCols.showStudiesStudyVariablesColumn)">search.coverage-buckets.collection\n            </th>\n            <th translate ng-attr-colspan="{{optionsCols.showStudiesHarmonizationDatasetsColumn + optionsCols.showStudiesDataschemaVariablesColumn}}" ng-if="choseHarmonization && (optionsCols.showStudiesHarmonizationDatasetsColumn || optionsCols.showStudiesDataschemaVariablesColumn)">search.coverage-buckets.harmonization</th>\n          </tr>\n          <tr>\n            <th class="text-nowrap" title="{{datasourceTitles.questionnaires.title}}" ng-if="optionsCols.showStudiesQuestionnaireColumn && choseIndividual">\n              <i class="fa fa-file-text-o"></i>\n            </th>\n            <th class="text-nowrap" title="{{datasourceTitles.physical_measures.title}}" ng-if="optionsCols.showStudiesPmColumn && choseIndividual">\n              <i class="fa fa-stethoscope"></i>\n            </th>\n            <th class="text-nowrap" title="{{datasourceTitles.biological_samples.title}}" ng-if="optionsCols.showStudiesBioColumn && choseIndividual">\n              <i class="fa fa-flask"></i>\n            </th>\n            <th class="text-nowrap" title="{{datasourceTitles.others.title}}" ng-if="optionsCols.showStudiesOtherColumn && choseIndividual">\n              <i class="fa fa-plus-square-o"></i>\n            </th>\n            <th translate ng-if="optionsCols.showStudiesStudyDatasetsColumn && choseIndividual">datasets</th>\n            <th translate ng-if="optionsCols.showStudiesStudyVariablesColumn && choseIndividual">variables</th>\n            <th translate ng-if="optionsCols.showStudiesHarmonizationDatasetsColumn && choseHarmonization">datasets</th>\n            <th translate ng-if="optionsCols.showStudiesDataschemaVariablesColumn && choseHarmonization">variables</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-repeat="summary in summaries" ng-init="lang = $parent.$parent.lang">\n            <td>\n              <a ng-href="{{PageUrlService.studyPage(summary.id, summary.studyResourcePath === \'harmonization-study\' ? \'harmonization\' : \'individual\')}}">\n                <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n              </a>\n            </td>\n            <td>\n              <localized value="summary.name" lang="lang"></localized>\n            </td>\n            <td ng-if="choseAll && optionsCols.showStudiesTypeColumn">{{(summary.studyResourcePath === \'individual-study\' ? \'search.study.individual\' : \'search.study.harmonization\')\n              | translate}}</td>\n            <td ng-if="optionsCols.showStudiesDesignColumn && choseIndividual">\n              {{ summary.design === undefined ? \'-\' : \'study_taxonomy.vocabulary.methods-design.term.\' + summary.design + \'.title\' | translate}}\n            </td>\n            <td ng-if="optionsCols.showStudiesQuestionnaireColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'questionnaires\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'questionnaires\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesPmColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'physical_measures\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'physical_measures\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesBioColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'biological_samples\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'biological_samples\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesOtherColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'others\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'others\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesParticipantsColumn && choseIndividual">\n              <span ng-if="summary.targetNumber.number">\n                <localized-number value="summary.targetNumber.number"></localized-number>\n              </span>\n              <span translate ng-if="summary.targetNumber.noLimit">\n                numberOfParticipants.no-limit\n              </span>\n              <span ng-if="!summary.targetNumber.number && !summary.targetNumber.noLimit">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesNetworksColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks" result-tab-order="resultTabOrder" destination-tab="network" entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks" update-criteria="updateCriteria(summary.id, \'networks\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesVariablesColumn">\n              <cell-stat-value result-tab-order="resultTabOrder" destination-tab="variable" entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].variables" update-criteria="updateCriteria(summary.id, \'variables\')"></cell-stat-value>\n            </td>\n            <td ng-if="optionsCols.showStudiesStudyDatasetsColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets" result-tab-order="resultTabOrder" destination-tab="dataset" entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets" update-criteria="updateCriteria(summary.id, \'Study\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesStudyVariablesColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets" result-tab-order="resultTabOrder" destination-tab="variable" entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyVariables" update-criteria="updateCriteria(summary.id, \'Study\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesHarmonizationDatasetsColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets" result-tab-order="resultTabOrder" destination-tab="dataset" entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets" update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesDataschemaVariablesColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets" result-tab-order="resultTabOrder" destination-tab="variable" entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].dataschemaVariables" update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">-</span>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>'),e.put("search/components/result/tabs-order-count/component.html",'<div>\n  <ul class="nav nav-pills pull-left voffset2" test-ref="search-counts">\n    <li role="presentation" ng-repeat="res in resultTabsOrder" ng-class="{active: activeTarget[targetTypeMap[res]].active && resultTabsOrder.length >= 1}" ng-if="options[targetTypeMap[res]].showSearchTab" class="{{targetTypeMap[res]}}">\n      <a href ng-click="selectType(targetTypeMap[res])" ng-if="resultTabsOrder.length > 1">\n        {{targetTypeMap[res] | translate}}\n        <span class="badge hoffset1" test-ref="{{targetTypeMap[res]}}">\n          <small>{{getTotalHits(res) | localizedNumber}}</small>\n        </span>\n      </a>\n      <a href style="cursor: default;" ng-if="resultTabsOrder.length === 1">\n        {{targetTypeMap[res] | translate}}\n        <span class="badge hoffset1" test-ref="{{targetTypeMap[res]}}">\n          <small>{{getTotalHits(res) | localizedNumber}}</small>\n        </span>\n      </a>\n    </li>\n  </ul>\n</div>'),e.put("search/components/result/variables-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.variable.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n          <tr>\n            <th translate>name</th>\n            <th translate>search.variable.label</th>\n            <th translate ng-if="optionsCols.showVariablesTypeColumn">type</th>\n            <th translate ng-if="optionsCols.showVariablesStudiesColumn">search.study.label</th>\n            <th translate ng-if="optionsCols.showVariablesDatasetsColumn">search.dataset.label</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-repeat="summary in summaries">\n            <td>\n              <a test-ref="name" href="{{PageUrlService.variablePage(summary.id) ? PageUrlService.variablePage(summary.id) : PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n                {{summary.name}}\n              </a>\n            </td>\n            <td>\n              <localized value="summary.variableLabel" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showVariablesTypeColumn">\n              {{\'search.variable.\' + summary.variableType.toLowerCase() | translate}}\n            </td>\n            <td ng-if="optionsCols.showVariablesStudiesColumn">\n              <a ng-if="summary.studyId" ng-href="{{PageUrlService.studyPage(summary.studyId, summary.variableType == \'Dataschema\' ? \'harmonization\' : \'individual\')}}">\n                <localized value="summary.studyAcronym" lang="lang"></localized>\n              </a>\n              <a ng-if="summary.networkId" ng-href="{{PageUrlService.networkPage(summary.networkId)}}">\n                <localized value="summary.networkAcronym" lang="lang"></localized>\n              </a>\n            </td>\n            <td ng-if="optionsCols.showVariablesDatasetsColumn">\n              <a ng-href="{{PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n                <localized value="summary.datasetAcronym" lang="lang"></localized>\n              </a>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>'),e.put("search/components/search-box-region/component.html",'<div id="search-region" class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n  <div ng-if="$ctrl.options.showSearchBox" id="search-box-region" class="{{hasFacetedTaxonomies ? \'\' : \'row\'}}">\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-3\'}}"></div>\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-6\'}}">\n      <script type="text/ng-template" id="customTemplate.html">\n        <a ng-if="match.model.id">\n          <table style="border:none;">\n            <tbody>\n            <tr>\n              <td style="min-width: 30px;">\n                <span title="{{match.model.target + \'-classifications\' | translate}}">\n                  <i class="{{\'i-obiba-large i-obiba-\' + match.model.target}}"></i>\n                </span>\n              </td>\n              <td>\n            <span\n              uib-popover-html="match.model.itemDescription | uibTypeaheadHighlight:query"\n              popover-title="{{match.model.itemTitle}}"\n              popover-placement="bottom"\n              popover-trigger="\'mouseenter\'"\n              ng-bind-html="match.model.itemTitle | uibTypeaheadHighlight:query">\n            </span>\n                <small class="help-block no-margin" title="{{match.model.itemParentDescription}}">\n                  {{match.model.itemParentTitle}}\n                </small>\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </a>\n        <a ng-if="!match.model.id" class="{{match.model.status}}">\n          <small class="help-block no-margin">\n            {{match.model.message}}\n          </small>\n        </a>\n      <\/script>\n      <span class="input-group input-group-sm">\n        <span class="input-group-btn" uib-dropdown>\n          <button type="button" class="btn btn-primary" uib-dropdown-toggle>\n            {{\'taxonomy.target.\' + ($ctrl.documents.search.target ? $ctrl.documents.search.target : \'all\')| translate}}\n            <span class="caret"></span>\n          </button>\n          <ul uib-dropdown-menu role="menu">\n            <li>\n              <a href ng-click="$ctrl.selectSearchTarget()" translate>taxonomy.target.all</a>\n            </li>\n            <li ng-repeat="target in $ctrl.targets" role="menuitem">\n              <a href ng-click="$ctrl.selectSearchTarget(target)">{{\'taxonomy.target.\' + target | translate}}</a>\n            </li>\n          </ul>\n        </span>\n        <input type="text" ng-model="$ctrl.selectedCriteria" placeholder="{{\'search.placeholder.\' + ($ctrl.documents.search.target ? $ctrl.documents.search.target : \'all\') | translate}}" uib-typeahead="criteria for criteria in $ctrl.searchCriteria($viewValue)" typeahead-min-length="2" typeahead-loading="$ctrl.documents.search.active" typeahead-template-url="customTemplate.html" typeahead-on-select="$ctrl.selectCriteria($item)" class="form-control">\n        <span class="input-group-addon">\n          <i class="fa fa-search"></i>\n        </span>\n        <span ng-if="$ctrl.options.SearchHelpLinkUrl" class="input-group-btn">\n          <a type="button" target="_blank" class="btn btn-default" href="{{$ctrl.options.SearchHelpLinkUrl}}">\n            <span class="fa fa-question-circle"></span> {{$ctrl.options.SearchHelpLinkLabel}}</a>\n        </span>\n      </span>\n\n    </div>\n  </div>\n  <div ng-if="$ctrl.options.showSearchBrowser" id="search-selector-region" class="{{hasFacetedTaxonomies ? \'\' : \'row\'}}">\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-3\'}}"></div>\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-6\'}}">\n      <small>\n        <ul class="nav nav-pills taxo-element">\n          <li ng-if="hasClassificationsTitle">\n            <label class="nav-label" translate>search.classifications-title</label>\n          </li>\n          <li ng-repeat="t in $ctrl.taxonomyNav track by $index" title="{{$ctrl.translateTaxonomyNav(t, \'description\')}}">\n            <a href ng-click="$ctrl.showTaxonomy(t.target, t.name)" ng-if="!t.terms">{{$ctrl.translateTaxonomyNav(t, \'title\')}}</a>\n            <span uib-dropdown ng-if="t.terms">\n              <ul class="nav nav-pills">\n                <li>\n                  <a href uib-dropdown-toggle>{{$ctrl.translateTaxonomyNav(t, \'title\')}}\n                    <span class="caret"></span>\n                  </a>\n                </li>\n              </ul>\n              <ul uib-dropdown-menu class="innerul">\n                <li ng-repeat="st in t.terms">\n                  <a href ng-click="$ctrl.showTaxonomy(t.target, st.name)" title="{{$ctrl.translateTaxonomyNav(st, \'description\')}}">{{$ctrl.translateTaxonomyNav(st, \'title\')}}</a>\n                </li>\n              </ul>\n            </span>\n          </li>\n          <li>\n            <a href ng-click="$ctrl.goToClassifications()" title="{{\'search.classifications-show\' | translate}}">\n              <span ng-if="hasClassificationsLinkLabel" translate>search.classifications-link</span>\n              <i class="fa fa-ellipsis-h" ng-if="!hasClassificationsLinkLabel"></i>\n            </a>\n          </li>\n        </ul>\n      </small>\n    </div>\n  </div>\n  <taxonomies-panel ng-if="$ctrl.options.showSearchBrowser" taxonomy-name="$ctrl.taxonomyName" target="$ctrl.target" on-select-term="$ctrl.selectTerm" on-close="$ctrl.clearTaxonomy" lang="$ctrl.lang" taxonomies-shown="$ctrl.taxonomiesShown"></taxonomies-panel>\n</div>'),e.put("search/components/study-filter-shortcut/component.html",'<div class="voffset2">\n  <div class="btn btn-group" style="padding: 0">\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'all\'" translate>all</label>\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'individual\'" translate>search.coverage-buckets.individual</label>\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'harmonization\'" translate>search.coverage-buckets.harmonization</label>\n  </div>\n</div>'),e.put("search/components/taxonomy/taxonomy-filter-detail/component.html",'<div class="panel-primary">\n  <div class="panel-heading">\n    <div><strong>{{$ctrl.taxonomy.title | localizedString}}</strong></div>\n  </div>\n\n  <vocabulary-filter-detail ng-repeat="vocabulary in $ctrl.vocabularies" vocabulary="vocabulary" on-select-vocabulary-args="$ctrl.selectVocabularyArgs(vocabulary, args)" on-remove-criterion="$ctrl.removeCriterion(item)">\n  </vocabulary-filter-detail>\n</div>'),e.put("search/components/taxonomy/taxonomy-filter-panel/component.html",'<div class="vocabulary-filter-detail" ng-class="{\'close_right\':$ctrl.classClose, \'overlay-front-on-box-shodow\' : $ctrl.showTaxonomyPanel}">\n  \n  <div class="ng-clearfix"></div>\n\n  <vocabulary-filter-detail-heading show-taxonomy-panel="$ctrl.showTaxonomyPanel" taxonomy-name="$ctrl.taxonomyName" taxonomies-query="$ctrl.taxonomiesQuery" clear-query="$ctrl.clearQuery" on-filter-change="$ctrl.onFilterChange(queryString)" taxonomy-type-map="$ctrl.taxonomyTypeMap" result-tabs-order="$ctrl.resultTabsOrder" target="$ctrl.target" on-select-type="$ctrl.selectType(type)" result="$ctrl.result" toggle-pannel="$ctrl.togglePannel()">\n  </vocabulary-filter-detail-heading>\n\n  <div class="vocabulary-filter-detail-container">\n    <vocabulary-filter-detail ng-if="!$ctrl.taxonomyIsArray" on-select-vocabulary-args="$ctrl.selectTaxonomyVocabularyArgs($ctrl.taxonomy, vocabulary, args)" ng-repeat="vocabulary in $ctrl.filteredVocabularies track by $index" on-remove-criterion="$ctrl.removeCriterion(item)" vocabulary="vocabulary">\n    </vocabulary-filter-detail>\n\n    <div ng-if="$ctrl.taxonomyIsArray" ng-repeat="subTaxonomy in $ctrl.taxonomy">\n      <taxonomy-filter-detail taxonomy="subTaxonomy" ng-if="$ctrl.filteredVocabularies[subTaxonomy.name]" vocabularies="$ctrl.filteredVocabularies[subTaxonomy.name]" on-select-taxonomy-term="$ctrl.selectTaxonomyVocabularyArgs(taxonomy, vocabulary, args)" on-remove-criterion="$ctrl.removeCriterion(item)">\n      </taxonomy-filter-detail>\n    </div>\n  </div>\n</div>'),e.put("search/components/vocabulary-filter-detail-heading/component.html",'<div class="panel-body vocabulary-filter-detail-heading">\n    <div class="row">\n        <div class="col-xs-12 col-sm-12 col-lg-4">\n            <input-search-filter taxonomy-name="$ctrl.taxonomyName" taxonomies-query="$ctrl.taxonomiesQuery" class="input-search-filter" clear-query="$ctrl.clearQuery" on-filter-change="$ctrl.filterChange(queryString)">\n            </input-search-filter>\n        </div>\n        <div class="col-xs-12 col-sm-11 col-lg-7 voffset1">\n            <entity-counts taxonomy-type-map="$ctrl.taxonomyTypeMap" result-tabs-order="$ctrl.resultTabsOrder" target="$ctrl.target" on-select-type="$ctrl.selectType(type)" result="$ctrl.result">\n            </entity-counts>\n        </div>\n        <div class="col-xs-12 col-sm-1 col-lg-1">\n            <button type="button" class="voffset1 pull-right close" data-dismiss="alert" aria-label="Close" ng-click="$ctrl.togglePannel()" title="{{\'global.close-panel\'|translate}}"><span aria-hidden="true">×</span>\n            </button>\n        </div>\n    </div>\n</div>'),e.put("search/components/vocabulary/vocabulary-filter-detail/component.html",'<div class="panel-heading">\n  <label uib-popover="{{$ctrl.vocabulary.description ? $ctrl.vocabulary.description : $ctrl.vocabulary.title | localizedString}}" popover-title="{{$ctrl.vocabulary.description ? $ctrl.vocabulary.title : null | localizedString}}" popover-placement="bottom" popover-trigger="\'mouseenter\'" popover-popup-delay="250" popover-class="right-panel-popover">\n    {{$ctrl.vocabulary.title | localizedString}}\n  </label>\n\n  <div class="pull-right">\n    <a href="" ng-click="$ctrl.removeCriterion()" ng-if="$ctrl.vocabulary.existingItem">{{\'clear\' | translate}}</a>\n    <a href="" class="hoffset2" ng-click="$ctrl.selectAllFilteredVocabularyTerms($ctrl.vocabulary.filteredTerms)" ng-if="$ctrl.criterionType === \'string-terms\' && $ctrl.canStillSelectMore($ctrl.vocabulary.filteredTerms)">\n      {{\'select-items\' | translate}}\n    </a>\n  </div>\n\n</div>\n<div class="panel-body">\n  <div ng-switch on="$ctrl.criterionType">\n    <div ng-switch-when="string-terms">\n      <terms-vocabulary-filter-detail vocabulary="$ctrl.vocabulary" on-select-args="$ctrl.selectVocabularyArgs(args)"></terms-vocabulary-filter-detail>\n    </div>\n\n    <div ng-switch-when="numeric">\n      <numeric-vocabulary-filter-detail vocabulary="$ctrl.vocabulary" on-select-args="$ctrl.selectVocabularyArgs(args)"></numeric-vocabulary-filter-detail>\n    </div>\n\n    <div ng-switch-default>\n      <match-vocabulary-filter-detail vocabulary="$ctrl.vocabulary" on-select-args="$ctrl.selectVocabularyArgs(args)"></match-vocabulary-filter-detail>\n    </div>\n  </div>\n</div>'),e.put("search/views/classifications.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div id="classification-browser-region">\n  <div ng-if="classificationsHeaderTemplateUrl" ng-include="classificationsHeaderTemplateUrl"></div>\n\n  <div class="container alert-fixed-position">\n    <obiba-alert id="SearchController"></obiba-alert>\n  </div>\n\n  <div class="alert-growl-container">\n    <obiba-alert id="SearchControllerGrowl"></obiba-alert>\n  </div>\n\n  <a href class="btn btn-sm btn-success" ng-click="goToSearch()">\n    <i class="fa fa-chevron-left"></i>\n    <span translate>search.back</span>\n  </a>\n\n  \x3c!-- Lang tabs --\x3e\n  <ul class="nav nav-tabs voffset2" role="tablist" ng-if="tabs && tabs.length>1">\n    <li ng-repeat="tab in tabs" role="presentation" ng-class="{ active: tab === lang }"><a href role="tab" ng-click="setLocale(tab)">{{\'language.\' + tab | translate}}</a></li>\n  </ul>\n\n  \x3c!-- Search criteria region --\x3e\n  <search-criteria-region class="voffset2" options="options" search="search"> </search-criteria-region>\n\n  \x3c!-- Classifications region --\x3e\n  <div class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n    <ul class="nav nav-pills voffset2" role="tablist" ng-if="targetTabsOrder.length > 1">\n      <li ng-repeat="target in targetTabsOrder" role="presentation" ng-class="{ active: target === $parent.target }" class="{{target}}"><a href role="tab" ng-click="navigateToTarget(target)">{{\'taxonomy.target.\' + target | translate}}</a></li>\n    </ul>\n\n    <classifications-panel target="target" is-history-enabled="true" on-select-term="onSelectTerm" lang="lang"></classifications-panel>\n  </div>\n\n</div>'),e.put("search/views/classifications/taxonomy-accordion-group.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-taxonomy" ng-class="panelClass || \'panel-default\'">\n  <div role="tab" id="{{::headingId}}" aria-selected="{{isOpen}}" class="panel-heading" ng-keypress="toggleOpen($event)">\n    <h4 class="panel-title">\n      <a role="button" data-toggle="collapse" href aria-expanded="{{isOpen}}" aria-controls="{{::panelId}}" tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading"><small><span uib-accordion-header ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></small></a>\n    </h4>\n  </div>\n  <div id="{{::panelId}}" aria-labelledby="{{::headingId}}" aria-hidden="{{!isOpen}}" role="tabpanel" class="panel-collapse collapse" uib-collapse="!isOpen">\n    <div class="panel-body no-padding small" ng-transclude></div>\n  </div>\n</div>'),e.put("search/views/classifications/taxonomy-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n  <div class="col-md-4">\n    <div vocabulary-panel taxonomy="taxonomies.taxonomy.vocabularies[$index]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 1]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 2]"></div>\n  </div>\n</div>'),e.put("search/views/classifications/vocabulary-accordion-group.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-vocabulary" ng-class="panelClass || \'panel-default\'">\n  <div role="tab" id="{{::headingId}}" aria-selected="{{isOpen}}" class="panel-heading" ng-keypress="toggleOpen($event)">\n    <h4 class="panel-title">\n      <a role="button" data-toggle="collapse" href aria-expanded="{{isOpen}}" aria-controls="{{::panelId}}" tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading"><small><span uib-accordion-header ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></small></a>\n    </h4>\n  </div>\n  <div id="{{::panelId}}" aria-labelledby="{{::headingId}}" aria-hidden="{{!isOpen}}" role="tabpanel" class="panel-collapse collapse" uib-collapse="!isOpen">\n    <div class="panel-body" ng-transclude></div>\n  </div>\n</div>'),e.put("search/views/criteria/criterion-header-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<li class="criteria-list-item">\n  <label uib-popover="{{localize(criterion.vocabulary.description)}}" popover-title="{{localize(criterion.vocabulary.title)}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">\n    {{localize(criterion.vocabulary.title)}}\n  </label>\n  <span class="pull-right" title="{{\'search.close-and-search\' | translate}}" ng-click="$parent.$parent.closeDropdown()"><i class="fa fa-check"></i></span>\n</li>\n<li class="divider"></li>'),e.put("search/views/criteria/target-template.html","\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<span></span>"),e.put("search/views/list/pagination-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<span>\n  <ul class="pagination pagination-sm">\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first">\n      <a href ng-click="selectPage(1, $event)">{{::getText(\'first\')}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-prev">\n      <a href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a>\n    </li>\n    <li ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}" class="pagination-page">\n      <a href ng-click="selectPage(page.number, $event)">{{page.text}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-next">\n      <a href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a>\n    </li>\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last">\n      <a href ng-click="selectPage(totalPages, $event)">{{::getText(\'last\')}}</a>\n    </li>\n  </ul>\n</span>'),e.put("search/views/search-layout.html",'<div>\n  <div class="alert alert-warning" ng-if="!isSearchAvailable">\n    <span translate>search.search-not-available</span>\n  </div>\n  <div ng-if="isSearchAvailable">\n    <div class="container alert-fixed-position">\n      <obiba-alert id="SearchController"></obiba-alert>\n    </div>\n\n    <div class="alert-growl-container">\n      <obiba-alert id="SearchControllerGrowl"></obiba-alert>\n    </div>\n\n    <div ng-if="searchHeaderTemplateUrl" ng-include="searchHeaderTemplateUrl"></div>\n\n    <div ng-switch on="search.layout">\n      <div ng-switch-when="layout1">\n        <ng-include src="\'search/views/search.html\'"></ng-include>\n      </div>\n      <div ng-switch-default>\n        <ng-include src="\'search/views/search2.html\'"></ng-include>\n      </div>\n    </div>\n  </div>\n</div>'),e.put("search/views/search-result-graphics-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'graphics\'">\n  <graphics-result on-update-criteria="onUpdateCriteria" result="result.graphics" loading="loading" class="voffset2 graphics-tab"></graphics-result>\n</div>'),e.put("search/views/search-result-list-dataset-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.datasets.showSearchTab" ng-class="{\'active\': activeTarget.datasets.active}">\n  <datasets-result-table lang="lang" loading="loading" on-update-criteria="onUpdateCriteria" summaries="result.list.datasetResultDto[\'obiba.mica.DatasetResultDto.result\'].datasets"></datasets-result-table>\n</div>'),e.put("search/views/search-result-list-network-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.networks.showSearchTab" ng-class="{\'active\': activeTarget.networks.active}">\n  <networks-result-table lang="lang" loading="loading" on-update-criteria="onUpdateCriteria" summaries="result.list.networkResultDto[\'obiba.mica.NetworkResultDto.result\'].networks"></networks-result-table>\n</div>'),e.put("search/views/search-result-list-study-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.studies.showSearchTab" ng-class="{\'active\': activeTarget.studies.active}">\n  <studies-result-table lang="lang" loading="loading" on-update-criteria="onUpdateCriteria" summaries="result.list.studyResultDto[\'obiba.mica.StudyResultDto.result\'].summaries"></studies-result-table>\n</div>'),e.put("search/views/search-result-list-variable-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.variables.showSearchTab" ng-class="{\'active\': activeTarget.variables.active}">\n  <variables-result-table lang="lang" loading="loading" summaries="result.list.variableResultDto[\'obiba.mica.DatasetVariableResultDto.result\'].summaries"></variables-result-table>\n</div>'),e.put("search/views/search.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="inSearchMode()">\n  <div class="row voffset2">\n    <div class="col-md-3" ng-if="hasFacetedTaxonomies">\n      \x3c!-- Search Facets region --\x3e\n      <taxonomies-facets-panel id="search-facets-region" faceted-taxonomies="facetedTaxonomies" criteria="search.criteria" on-select-term="onSelectTerm" on-refresh="refreshQuery" lang="lang"></taxonomies-facets-panel>\n    </div>\n    <div class="{{hasFacetedTaxonomies ? \'col-md-9\' : \'col-md-12\'}}">\n      <search-box-region targets="targets" options="options" alert-id="\'SearchController\'" lang="lang" taxonomy-nav="taxonomyNav" on-select-criteria="selectCriteria(item)" on-goto-classifications="goToClassifications()" , on-select-term="onSelectTerm(target, taxonomy, vocabulary, args)">\n      </search-box-region>\n\n      <div ng-if="hasFacetedTaxonomies && hasFacetedNavigationHelp && !(search.criteria.children && search.criteria.children.length > 0)">\n        <p class="help-block" translate>search.faceted-navigation-help</p>\n      </div>\n\n      \x3c!-- Search criteria region --\x3e\n      <search-criteria-region options="options" search="search"> </search-criteria-region>\n\n      \x3c!-- Search Results region --\x3e\n      <div id="search-result-region" class="voffset3 can-full-screen" ng-if="canExecuteWithEmptyQuery()" fullscreen="isFullscreen">\n        <div ng-if="searchTabsOrder.length > 1">\n          <a href class="btn btn-sm btn-default pull-right" ng-click="toggleFullscreen()">\n            <i class="glyphicon" ng-class="{\'glyphicon-resize-full\': !isFullscreen, \'glyphicon-resize-small\': isFullscreen}"></i>\n          </a>\n          <ul class="nav nav-tabs voffset2">\n            <li role="presentation" ng-repeat="tab in searchTabsOrder" ng-class="{active: search.display === tab}">\n              <a href ng-click="selectDisplay(tab)">{{ \'search.\' + tab | translate}}</a>\n            </li>\n          </ul>\n        </div>\n        <div translate>{{\'search.\' + search.display + \'-help\'}}</div>\n        <result-panel display="search.display" type="search.type" bucket="search.bucket" criteria="search.criteria" query="search.executedQuery" result="search.result" loading="search.loading" pagination="search.pagination" on-update-criteria="onUpdateCriteria" on-remove-criteria="onRemoveCriteria" on-type-changed="onTypeChanged" on-bucket-changed="onBucketChanged" on-paginate="onPaginate" search-tabs-order="searchTabsOrder" result-tabs-order="resultTabsOrder" lang="lang"></result-panel>\n      </div>\n\n    </div>\n  </div>\n\n</div>'),e.put("search/views/search2.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="inSearchMode()">\n\n  \x3c!-- Search criteria region --\x3e\n  <search-criteria-region options="options" search="search"></search-criteria-region>\n  <div ng-class="{\'overlay-back-on\': search.showTaxonomyPanel}">\n  </div>\n  <div ng-class="{\'overlay-front-on\': search.showTaxonomyPanel}">\n    <div class="row voffset2">\n      <div class="col-md-3" ng-if="hasFacetedTaxonomies">\n        \x3c!-- Search Facets region --\x3e\n        <taxonomies-facets-panel id="search-facets-region" faceted-taxonomies="facetedTaxonomies" criteria="search.criteria" on-select-term="onSelectTerm" on-refresh="refreshQuery" lang="lang"></taxonomies-facets-panel>\n      </div>\n      <div class="col-md-3" ng-if="!hasFacetedTaxonomies">\n        \x3c!-- Search Facets region --\x3e\n        <meta-taxonomy-filter-panel show-taxonomy-panel="search.showTaxonomyPanel" tabs="targetTabsOrder" rql-query="search.rqlQuery" on-toggle="onTaxonomyFilterPanelToggleVisibility(target, taxonomy)"></meta-taxonomy-filter-panel>\n      </div>\n      <div class="col-md-9">\n        \x3c!-- Search Results region --\x3e\n        <div class="panel panel-default" ng-if="search.showTaxonomyPanel">\n          <taxonomy-filter-panel show-taxonomy-panel="search.showTaxonomyPanel" result-tabs-order="resultTabsOrder" taxonomy-type-map="taxonomyTypeMap" result="search.countResult" target="search.selectedTarget" taxonomy="search.selectedTaxonomy" on-select-type="onTypeChanged(type)" on-select-term="onSelectTerm(target, taxonomy, vocabulary, args)" on-remove-criterion="removeCriteriaItem(item)" on-toggle="onTaxonomyFilterPanelToggleVisibility"></taxonomy-filter-panel>\n        </div>\n        <div class="clearfix"></div>\n        <div id="search-result-region" class="can-full-screen" ng-if="!search.showTaxonomyPanel && canExecuteWithEmptyQuery()" fullscreen="isFullscreen">\n          <div ng-if="searchTabsOrder.length > 1">\n            <a href class="btn btn-sm btn-default pull-right" ng-click="toggleFullscreen()">\n              <i class="glyphicon" ng-class="{\'glyphicon-resize-full\': !isFullscreen, \'glyphicon-resize-small\': isFullscreen}"></i>\n            </a>\n            <ul class="nav nav-tabs">\n              <li role="presentation" ng-repeat="tab in searchTabsOrder" ng-class="{active: search.display === tab}">\n                <a href ng-click="selectDisplay(tab)">{{ \'search.\' + tab | translate}}</a>\n              </li>\n            </ul>\n          </div>\n          <div translate>{{\'search.\' + search.display + \'-help\'}}</div>\n          <result-panel display="search.display" type="search.type" bucket="search.bucket" criteria="search.criteria" query="search.executedQuery" result="search.result" loading="search.loading" pagination="search.pagination" on-update-criteria="onUpdateCriteria" on-remove-criteria="onRemoveCriteria" on-type-changed="onTypeChanged" on-bucket-changed="onBucketChanged" on-paginate="onPaginate" search-tabs-order="searchTabsOrder" result-tabs-order="resultTabsOrder" lang="lang"></result-panel>\n        </div>\n\n\n      </div>\n    </div>\n  </div>\n</div>'),e.put("sets/components/cart-documents-table/component.html",'<div>\n  <div class="pull-left" ng-show="$ctrl.documents.total>0">\n    <div ng-if="$ctrl.showAnalysis()" class="btn-group" uib-dropdown is-open="$ctrl.analysis.isopen">\n      <button id="single-button" type="button" class="btn btn-primary" uib-dropdown-toggle ng-disabled="disabled">\n        <i class="fa fa-cog"></i> {{\'analysis.action\' | translate}} <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n        <li role="menuitem">\n          <a href="" ng-click="$ctrl.entitiesCount()">\n            {{\'analysis.entities-count.action\' | translate}}</a>\n        </li>\n      </ul>\n    </div>\n    <a obiba-file-download url="$ctrl.download()" target="_self" download class="action btn btn-info btn-responsive">\n      <i class="fa fa-download"></i></a>\n    <a href="" ng-click="$ctrl.search()" class="action btn btn-info btn-responsive">\n      <i class="fa fa-search"></i></a>\n    <a href="" ng-click="$ctrl.clearSet()" ng-disabled="!$ctrl.hasSelections()" class="action btn btn-danger btn-responsive">\n      <i class="fa fa-trash-o"></i></a>\n  </div>\n  <div ng-show="$ctrl.pagination.totalHits > 0" class="pull-right">\n    <span uib-pagination total-items="$ctrl.pagination.totalHits" max-size="$ctrl.pagination.maxSize" ng-model="$ctrl.pagination.currentPage" boundary-links="true" force-ellipses="true" items-per-page="$ctrl.pagination.itemsPerPage" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" template-url="search/views/list/pagination-template.html" ng-change="$ctrl.pageChanged()"></span>\n    <ul class="pagination pagination-sm">\n      <li>\n        <a href class="pagination-total">{{$ctrl.pagination.from}} - {{$ctrl.pagination.to}} {{\'of\' | translate}} {{$ctrl.pagination.totalHits}}</a>\n      </li>\n    </ul>\n  </div>\n  <div class="clearfix"></div>\n  <div class="table-responsive">\n    <div class="alert alert-warning actions-select" ng-show="$ctrl.allPageSelected[$ctrl.pagination.currentPage]">\n      <span ng-hide="$ctrl.allSelected">\n        <span translate>sets.cart.all-cart-page-selected</span> \n        <a href ng-click="$ctrl.updateAllSelected()" class="hoffset2">\n          <i class="fa fa-square-o"></i>\n          <b><span translate>sets.cart.select-all-cart</span></b>\n        </a>\n      </span>\n      <span ng-show="$ctrl.allSelected">\n        <span translate>sets.cart.all-cart-selected</span>\n        <a href ng-click="$ctrl.updateAllSelected()" class="hoffset2">\n          <i class="fa fa-check-square-o"></i>\n          <b><span translate>sets.cart.unselect-all-cart</span></b>\n        </a>\n      </span>\n    </div>\n    <table class="table table-bordered table-striped" ng-if="$ctrl.documents.total>0">\n      <thead>\n        <th style="width: 50px">\n            <input ng-model="$ctrl.allPageSelected[$ctrl.pagination.currentPage]" type="checkbox" ng-click="$ctrl.updateAllCurrentPageSelected()">\n        </th>\n        <th translate>taxonomy.target.variable</th>\n        <th translate>search.variable.label</th>\n        <th ng-if="$ctrl.showVariableType()" translate>type</th>\n        <th ng-if="$ctrl.showStudies()" translate>taxonomy.target.study</th>\n        <th translate>taxonomy.target.dataset</th>\n      </thead>\n      <tbody>\n        <tr ng-repeat="row in $ctrl.table.rows">\n          <td>\n              <input ng-model="$ctrl.selections[row[0].value]" type="checkbox" ng-click="$ctrl.updateSelection(row[0].value)">\n          </td>\n          <td><a href="{{row[1].link}}">{{row[1].value}}</a></td>\n          <td>{{row[2].value}}</td>\n          <td ng-if="$ctrl.showVariableType()">{{\'search.variable.\' + row[3].value.toLowerCase() | translate}}</td>\n          <td ng-if="$ctrl.showStudies()"><a href="{{row[3].link}}">{{row[4].value}}</a></td>\n          <td><a href="{{row[5].link}}">{{row[5].value}}</a></td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</div>'),e.put("sets/views/cart.html",'<div>\n  <div ng-if="cartHeaderTemplateUrl" ng-include="cartHeaderTemplateUrl"></div>\n  <h3>\n    <span translate>variables</span>\n    <span ng-if="loading" class="voffset2 loading"></span>\n  </h3>\n  <cart-documents-table type="\'variables\'" documents="variables" on-page-change="onPaginate"></cart-documents-table>\n  <p ng-hide="loading || variables && variables.total>0" translate>sets.cart.no-variables</p>\n</div>'),e.put("utils/components/entity-schema-form/component.html",'<div sf-model="$ctrl.model" sf-form="$ctrl.form.definition" sf-schema="$ctrl.form.schema" sf-options="$ctrl.sfOptions"></div>'),e.put("utils/services/user-profile-modal/service.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      {{\'data-access-request.profile.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n\n    <table class="table table-bordered table-striped">\n      <tbody>\n      <tr>\n        <th>{{\'data-access-request.profile.name\' | translate}}</th>\n        <td>{{applicant.fullName}}</td>\n      </tr>\n      <tr>\n        <th>{{\'data-access-request.profile.email\' | translate}}</th>\n        <td>{{applicant.email}}</td>\n      </tr>\n      <tr ng-repeat="attribute in applicant.profile.attributes | filterProfileAttributes">\n          <th>{{\n              (\'userProfile.\' + attribute.key | translate) !== (\'userProfile.\' + attribute.key) ?\n              (\'userProfile.\' + attribute.key | translate) :\n              (attribute.key)\n              }}\n          </th>\n          <td>{{attribute.value}}</td>\n      </tr>\n      </tbody>\n    </table>\n\n    <a class="btn btn-default" ng-if="applicant.email" href="mailto:{{applicant.email}}" target="_blank">\n      {{\'data-access-request.profile.send-email\' | translate}}</a>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.close" translate>close</span>\n      {{confirm.close}}\n    </button>\n  </div>\n</div>'),e.put("utils/views/unsaved-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n    <div class="modal-header">\n        <h4 class="modal-title" translate>unsaved-title</h4>\n    </div>\n    <div class="modal-body" translate>\n        unsaved-prompt\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-default" type="button" ng-click="cancel()" translate>cancel</button>\n        <button class="btn btn-primary" type="button" ng-click="ok()" translate>ok</button>\n    </div>\n</div>'),e.put("views/pagination-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<ul class="pagination no-margin pagination-sm" ng-if="1 < pages.length">\n  <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == 1 }">\n    <a href="" ng-click="setCurrent(1)">&laquo;</a>\n  </li>\n  <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == 1 }">\n    <a href="" ng-click="setCurrent(pagination.current - 1)">&lsaquo;</a>\n  </li>\n  <li ng-repeat="pageNumber in pages track by $index" ng-class="{ active : pagination.current == pageNumber, disabled : pageNumber == \'...\' }">\n    <a href="" ng-click="setCurrent(pageNumber)">{{ pageNumber }}</a>\n  </li>\n  <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == pagination.last }">\n    <a href="" ng-click="setCurrent(pagination.current + 1)">&rsaquo;</a>\n  </li>\n  <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == pagination.last }">\n    <a ng-class="round-border" href="" ng-click="setCurrent(pagination.last)">&raquo;</a>\n  </li>\n</ul>\n\n\n<ul class="pagination no-margin pagination-sm" ng-if="1 < pages.length">\n  <li>\n    <a href="" class="pagination-total" ng-if="1 < pages.length" class="pagination-total"><span>{{ range.lower }} - {{ range.upper }} </span><span translate>pagination.of</span><span> {{ range.total }}</span></a>\n  </li>\n</ul>')}]),ngObibaMica.utils=angular.module("obiba.mica.utils",["schemaForm","LocalStorageModule"]),ngObibaMica.utils.factory("urlEncode",function(){return function(e){return window.encodeURIComponent(e)}}).service("GraphicChartsConfigurations",function(){this.getClientConfig=function(){return!0},this.setClientConfig=function(){return!0}}).directive("fixedHeader",["$timeout","$window",function(a,n){return{restrict:"A",scope:{tableMaxHeight:"@",trigger:"=fixedHeader"},link:function(r,e){var s=e[0];function t(){r.redraw||(angular.element(s.querySelectorAll("thead, tbody, tfoot")).css("display",""),a(function(){r.redraw=!0;var i=0;if(angular.forEach(s.querySelectorAll("tr:first-child th"),function(e,t){var a=s.querySelector("tbody tr:first-child td:nth-child("+(t+1)+")"),n=s.querySelector("tfoot tr:first-child td:nth-child("+(t+1)+")"),r=a?a.offsetWidth:e.offsetWidth;a&&(a.style.width=r+"px"),e&&(e.style.width=r+"px"),n&&(n.style.width=r+"px"),i+=r}),angular.element(s.querySelectorAll("thead, tfoot")).css("display","block"),angular.element(s.querySelectorAll("tbody")).css({display:"block","max-height":r.tableMaxHeight||"inherit",overflow:"auto"}),i<s.offsetWidth){var e=s.querySelector("tbody tr:first-child td:last-child");e&&(e.style.width=e.offsetWidth+s.offsetWidth-i+"px",(e=s.querySelector("thead tr:first-child th:last-child")).style.width=e.offsetWidth+s.offsetWidth-i+"px")}var t=s.querySelector("tbody"),a=t.offsetWidth-t.clientWidth;if(0<a){var n=s.querySelector("tbody tr:first-child td:last-child");n.style.width=parseInt(n.style.width.replace("px",""))-a+"px"}r.redraw=!1}))}r.redraw=!1,r.$watchGroup(["trigger",function(){return e=s.querySelector("tbody"),"none"!==n.getComputedStyle(e).display&&0!==e.offsetWidth&&null!==s.querySelector("tbody tr:first-child");var e}],function(e){!0===e[1]&&t()}),r.$watch(function(){return s.offsetWidth},function(){t()})}}}]).directive("routeChecker",["$route",function(r){return{restrict:"A",scope:{routeCheckerHidesParent:"="},link:function(e,t,a){var n=a.ngHref.substr(1,a.ngHref.length-1);Object.keys(r.routes).filter(function(e){var t=r.routes[e].regexp;return!!t&&t.test(n)}).pop()||(e.routeCheckerHidesParent?t.parent().hide():t.hide())}}}]).factory("FormDirtyStateObserver",["$uibModal","$location",function(n,r){var i;return{observe:function(a){i&&i(),i=a.$on("$locationChangeStart",function(e,t){if(a.form&&a.form.$dirty)return n.open({backdrop:"static",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close(!0)},e.cancel=function(){t.dismiss("cancel")}}],templateUrl:"utils/views/unsaved-modal.html"}).result.then(function(e){!0===e&&(i(),r.path(angular.copy(r).url(t).hash()))}),void e.preventDefault();i()})},unobserve:function(){i&&i()}}}]).service("SfOptionsService",["$translate","$q",function(e,a){var n=["required","errors.does-not-validate","errors.localized.completed"];this.transform=function(){var t=a.defer();return e(n).then(function(e){t.resolve({validationMessage:{302:e.required,default:e["errors.does-not-validate"],completed:e["errors.localized.completed"]}})}),t.promise}}]).config(["schemaFormProvider",function(e){e.postProcess(function(e){return e.filter(function(e){return e.hasOwnProperty("wordLimit")}).forEach(function(t){t.$validators={wordLimitError:function(e){return!(angular.isDefined(e)&&null!==e&&(e.match(/\S+/g)||[]).length>parseInt(t.wordLimit))}}}),e})}]).config(["localStorageServiceProvider",function(e){e.setPrefix("mica").setStorageType("localStorage")}]);var CustomWatchDomElementService=function(){function e(){this.attributes=[]}return e.prototype.configWatch=function(e,t){return this.node=e,this.attributes=t,this.config={attributeFilter:this.attributes},this},e.prototype.customWatch=function(n){new MutationObserver(function(e){for(var t=0,a=e;t<a.length;t++)"attributes"===a[t].type&&n()}).observe(this.node,this.config)},e}();ngObibaMica.utils.service("CustomWatchDomElementService",[CustomWatchDomElementService]);var UserProfileService=function(){function e(){}return e.prototype.getAttribute=function(e,t){return this.getAttibuteValue(e,t)},e.prototype.getFullName=function(e){var t=this.getProfileAttributeValue(e,"firstName"),a=this.getProfileAttributeValue(e,"lastName");return t&&a?t+" "+a:null},e.prototype.getEmail=function(e){return this.getProfileAttributeValue(e,"email")},e.prototype.getProfileAttributeValue=function(e,t){return e?this.getAttibuteValue(e.attributes,t):null},e.prototype.getAttibuteValue=function(e,t){if(e){var a=e.filter(function(e){return e.key===t});return a&&0<a.length?a[0].value:null}return null},e}();ngObibaMica.utils.service("UserProfileService",UserProfileService),angular.module("obiba.mica.utils").component("obibaSchemaFormRenderer",{bindings:{schemaForm:"<",model:"<",readOnly:"<",parsingErrorCallbacks:"<",onRedraw:"<"},templateUrl:"utils/components/entity-schema-form/component.html",controller:["$rootScope","$timeout","LocalizedSchemaFormService","SfOptionsService","JsonUtils",function(e,s,o,t,l){var c=this,u=e.$new();function d(e){return"object"!=typeof c.parsingErrorCallbacks?function(){console.error("Error parsing ",e,c.schemaForm)}:c.parsingErrorCallbacks[e]}function m(e){"function"==typeof c.onRedraw&&c.onRedraw(e)}c.form={},c.sfOptions={},t.transform().then(function(e){c.sfOptions=e,c.sfOptions.pristine={errors:!0,success:!1}}),c.$onChanges=function(e){if(e&&e.schemaForm&&e.schemaForm.currentValue){m(!1);var t=e.schemaForm.currentValue;c.form.definition=(r=o.translate(l.parseJsonSafely(t.definition,[])),i=d("definition"),0===r.length&&(r=[],"function"==typeof i&&i()),r),c.form.schema=(a=o.translate(l.parseJsonSafely(t.schema,{})),n=d("schema"),0===Object.getOwnPropertyNames(a).length&&(a={},"function"==typeof n&&n()),a),c.form.downloadTemplate="Template"===t.pdfDownloadType,c.form.schema.readonly=c.readOnly}var a,n,r,i;s(function(){c.form=angular.copy(c.form),u.$broadcast("schemaFormRedraw"),m(!0)},250)}}]});var UserProfileModalService=function(){function e(e,t){this.$uibModal=e,this.UserProfileService=t}return e.prototype.show=function(e){var t={email:this.UserProfileService.getEmail(e),fullName:this.UserProfileService.getFullName(e),profile:e};this.$uibModal.open({controller:["$scope",function(e){return e.applicant=t}],templateUrl:"utils/services/user-profile-modal/service.html"})},e.$inject=["$uibModal","UserProfileService"],e}();function GraphicChartsDataProvider(){function o(e){var t=e;this.getData=function(e){e&&t.$promise.then(e)}}this.$get=["$log","JoinQuerySearchResource","ServerErrorUtils","AlertService","GraphicChartsConfig","GraphicChartsQuery",function(t,e,a,n,r,i){var s=i.queryDtoBuilder(r.getOptions().entityIds,r.getOptions().entityType);return new o(e.studies({query:s},function(e){return e},function(e){t.error("Server error",e)}))}]}function NgObibaMicaFileBrowserOptionsProvider(){var a={locale:"en",downloadInline:!0,downloadKey:!1,folders:{excludes:["population"]},documentsTitle:"file.documents"};this.addExcludeFolder=function(e){e&&a.folders.excludes.push(e)},this.setOptions=function(t){"object"==typeof t&&Object.keys(t).forEach(function(e){e in a&&(a[e]=t[e])})},this.$get=function(){return a}}ngObibaMica.utils.service("UserProfileModalService",UserProfileModalService),ngObibaMica.localized=angular.module("obiba.mica.localized",["obiba.notification","pascalprecht.translate","templates-ngObibaMica"]),ngObibaMica.localized.directive("localized",["LocalizedValues",function(t){return{restrict:"AE",scope:{value:"=",lang:"=",ellipsisSize:"=",markdownIt:"=",keyLang:"@",keyValue:"@"},templateUrl:"localized/localized-template.html",link:function(e){e.keyLang=e.keyLang||"lang",e.keyValue=e.keyValue||"value",e.LocalizedValues=t}}}]).directive("localizedNumber",["LocalizedValues",function(t){return{restrict:"E",scope:{number:"=value"},template:"{{::localizedNumber}}",controller:["$scope",function(e){e.localizedNumber=t.formatNumber(e.number)}]}}]).directive("localizedInput",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",customValidator:"="},templateUrl:"localized/localized-input-template.html",link:function(t,e,a,n){(angular.isUndefined(t.model)||null===t.model)&&(t.model=[{lang:t.lang,value:""}]),t.$watch("model",function(e){(angular.isUndefined(e)||null===e)&&(t.model=[{lang:t.lang,value:""}]),0===t.model.filter(function(e){if(e.lang===t.lang)return e}).length&&t.model.push({lang:t.lang,value:""})},!0),t.fieldName=t.name+"-"+t.lang,t.form=n}}}]).directive("localizedInputGroup",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",remove:"=",customValidator:"="},templateUrl:"localized/localized-input-group-template.html",link:function(t,e,a,n){(angular.isUndefined(t.model)||null===t.model)&&(t.model=[{lang:t.lang,value:""}]),t.$watch("model",function(e){(angular.isUndefined(e)||null===e)&&(t.model=[{lang:t.lang,value:""}]),0===t.model.filter(function(e){if(e.lang===t.lang)return e}).length&&t.model.push({lang:t.lang,value:""})},!0),t.fieldName=t.name+"-"+t.lang,t.form=n}}}]).directive("localizedTextarea",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",rows:"@",customValidator:"="},templateUrl:"localized/localized-textarea-template.html",link:function(t,e,a,n){(angular.isUndefined(t.model)||null===t.model)&&(t.model=[{lang:t.lang,value:""}]),t.$watch("model",function(e){(angular.isUndefined(e)||null===e)&&(t.model=[{lang:t.lang,value:""}]),0===t.model.filter(function(e){if(e.lang===t.lang)return e}).length&&t.model.push({lang:t.lang,value:""})},!0),t.fieldName=t.name+"-"+t.lang,t.form=n}}}]),ngObibaMica.localized.filter("localizedNumber",["LocalizedValues",function(t){return function(e){return 0===e?0:e?t.formatNumber(e):""}}]).filter("localizedString",["$translate","LocalizedValues",function(t,a){return function(e){return a.forLocale(e,t.use())}}]),ngObibaMica.localized.service("LocalizedValues",["$translate",function(t){var s=this;this.for=function(t,a,n,e){if(angular.isArray(t)){var r=t.filter(function(e){return e[n]===a});if(r&&0<r.length)return r[0][e];var i=t.map(function(e){return e[n]});if(0<i.length)return s.for(t,1===i.length?i[0]:"en",n,e)}else if(angular.isObject(t))return s.for(Object.keys(t).map(function(e){return{lang:e,value:t[e]}}),a,n,e);return t||""},this.forLocale=function(e,t){var a=this.for(e,t,"locale","text");return a&&""!==a||(a=this.for(e,"und","locale","text")),a&&""!==a||(a=this.for(e,"en","locale","text")),a},this.forLang=function(e,t){var a=this.for(e,t,"lang","value");return a&&""!==a||(a=this.for(e,"und","lang","value")),a&&""!==a||(a=this.for(e,"en","lang","value")),a},this.formatNumber=function(e){return null==e||"number"!=typeof e?e:e.toLocaleString(t.use())},this.arrayToObject=function(e){var t={};return e&&e.forEach(function(e){t[e.lang]=e.value}),t},this.objectToArray=function(t,e){var a=[];if(t){var n=e||Object.keys(t);n&&n.forEach(function(e){a.push({lang:e,value:t[e]})})}return 0===a.length?void 0:a}}]).service("LocalizedSchemaFormService",["$filter",function(a){this.translate=function(e){return e?"string"==typeof e?this.translateString(e):"object"==typeof e?Array.isArray(e)?this.translateArray(e):this.translateObject(e):e:e},this.translateObject=function(e){if(!e)return e;for(var t in e)e.hasOwnProperty(t)&&("string"==typeof e[t]?e[t]=this.translateString(e[t]):"object"==typeof e[t]&&(Array.isArray(e[t])?e[t]=this.translateArray(e[t]):e[t]=this.translateObject(e[t])));return e},this.translateArray=function(e){if(!e)return e;var t=this;return e.map(function(e){return t.translate(e)}),e},this.translateString=function(e){return e?e.replace(/t\(([^\)]+)\)/g,function(e,t){return a("translate")(t)}):e}}]),ngObibaMica.graphics=angular.module("obiba.mica.graphics",["obiba.graphics","obiba.utils","templates-ngObibaMica"]),ngObibaMica.graphics.config(["$provide",function(e){e.provider("GraphicChartsData",GraphicChartsDataProvider)}]).run(["GraphicChartsConfigurations",function(e){e.setClientConfig()}]),ngObibaMica.graphics.controller("GraphicChartsController",["$rootScope","$scope","$filter","$window","GraphicChartsConfig","GraphicChartsUtils","GraphicChartsData","RqlQueryService","ngObibaMicaUrl","D3GeoConfig","D3ChartConfig",function(e,n,r,i,s,t,a,o,l,c,u){n.ready=!0,n.$watch("chartAggregationName",function(){n.chartAggregationName&&(n.chartObject={},a.getData(function(a){a&&t.getArrayByAggregation(n.chartAggregationName,a[n.chartEntityDto]).then(function(e){var t=e.map(function(e){return e.participantsNbr?[e.title,e.value,e.participantsNbr]:[e.title,e.value]});n.updateCriteria=function(e,t){o.createCriteriaItem("study","Mica_study",t,e).then(function(e){var t=s.getOptions().entityType,a=s.getOptions().entityIds,n=e.id.split("."),r=l.getUrl("SearchBaseUrl")+"?type=studies&query="+t+"(in(Mica_"+t+".id,"+a+")),study(in("+n[0]+"."+n[1]+","+n[2].replace(":","%253A")+"))";i.location.href=l.getUrl("BaseUrl")+r})},t&&(null!==/^Table-/.exec(n.chartType)?(n.chartObject.ordered=n.chartOrdered,n.chartObject.notOrdered=n.chartNotOrdered,n.chartHeader.length<3?n.chartObject.header=[r("translate")(n.chartHeader[0]),r("translate")(n.chartHeader[1])]:n.chartObject.header=[r("translate")(n.chartHeader[0]),r("translate")(n.chartHeader[1]),r("translate")(n.chartHeader[2])],n.chartObject.type=n.chartType,n.chartObject.data=t,n.chartObject.vocabulary=n.chartAggregationName,n.chartObject.entries=e,n.chartObject.getTable=function(){return n.chartObject}):(n.chartHeader.length<3||t.map(function(e){return e.pop(),e}),t.unshift([r("translate")(n.chartHeader[0]),r("translate")(n.chartHeader[1])]),n.chartObject.term=!0,n.chartObject.type=n.chartType,n.chartObject.data=t,n.chartObject.options={backgroundColor:{fill:"transparent"}},angular.extend(n.chartObject.options,n.chartOptions),n.chartObject.options.title=r("translate")(n.chartTitleGraph)+" (N="+a.studyResultDto.totalHits+")",n.$parent.directive={title:n.chartObject.options.title})),"GeoChart"===n.chartType?(n.chartObject.d3Config=(new c).withData(e).withTitle(n.chartObject.options.title),n.chartObject.options&&n.chartObject.d3Config.withColor(n.chartOptions.colors)):(n.chartObject.d3Config=new u(n.chartAggregationName).withType("PieChart"===n.chartType?"pieChart":"multiBarHorizontalChart").withData(e,"PieChart"===n.chartType,r("translate")("graphics.nbr-studies")).withTitle(r("translate")(n.chartTitleGraph)+" (N="+a.studyResultDto.totalHits+")"),"PieChart"!==n.chartType&&(n.chartObject.d3Config.options.chart.showLegend=!1),n.chartObject.options&&n.chartObject.options.colors&&(n.chartObject.d3Config.options.chart.color=n.chartOptions.colors),n.chartObject.d3Config.options.chart.legendPosition="right",n.chartObject.d3Config.options.chart.legend={margin:{top:0,right:10,bottom:0,left:0}})})}))})}]),ngObibaMica.graphics.directive("obibaChart",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"=",chartType:"=",chartAggregationName:"=",chartEntityDto:"=",chartOptionsName:"=",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTitleGraph:"=",chartSelectGraphic:"="},templateUrl:"graphics/views/charts-directive.html",controller:"GraphicChartsController"}}]).directive("obibaTable",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"=",chartType:"@",chartAggregationName:"=",chartEntityDto:"=",chartOptionsName:"=",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTitleGraph:"=",chartSelectGraphic:"=",chartOrdered:"=",chartNotOrdered:"="},templateUrl:"graphics/views/tables-directive.html",controller:"GraphicChartsController"}}]),ngObibaMica.graphics.factory("GraphicChartsDataResource",["$resource","ngObibaMicaUrl",function(e,t){var a=t.getUrl("JoinQuerySearchResource"),n=-1===a.indexOf(":query")?"POST":"GET";return e(a,{},{studies:{method:n,headers:{"Content-Type":"POST"===n?"application/x-www-form-urlencoded":"application/json"},errorHandler:!0,params:{type:"studies"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}}})}]).service("GraphicChartsConfig",function(){var a={options:{entityIds:"NaN",entityType:null,ChartsOptions:{geoChartOptions:{header:["graphics.country","graphics.nbr-studies"],title:"graphics.geo-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#e5edfb","#cfddf5","#b8cbed","#a0b8e2","#88a4d4"]}},studiesDesigns:{header:["graphics.study-design","graphics.nbr-studies","graphics.number-participants"],title:"graphics.study-design-chart-title",options:{bars:"horizontal",series:{0:{axis:"nbrStudies"},1:{axis:"nbrParticipants"}},axes:{x:{nbrStudies:{side:"top",label:"Number of Studies"},nbrParticipants:{label:"Number of Participants"}}},backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"]}},numberParticipants:{header:["graphics.number-participants","graphics.nbr-studies"],title:"graphics.number-participants-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"],pieSliceTextStyle:{color:"#000000"}}},biologicalSamples:{header:["graphics.bio-samples","graphics.nbr-studies"],title:"graphics.bio-samples-chart-title",options:{bars:"horizontal",series:{0:{axis:"nbrStudies"}},axes:{x:{nbrStudies:{side:"top",label:"Number of Studies"}}},backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"]}}}},setOptions:function(t){"object"==typeof t&&Object.keys(t).forEach(function(e){e in a.options&&(a.options[e]=t[e])})},getOptions:function(){return angular.copy(a.options)}};return a}).service("GraphicChartsUtils",["LocalizedValues","TaxonomyResource","VocabularyService","$q","$translate",function(l,n,r,i,c){var u={getTerms:function(a){var e=i.defer();function t(){var t=null;u.vocabularies&&angular.forEach(u.vocabularies,function(e){r.vocabularyAlias(e)===a&&(t=e.terms)}),e.resolve(t)}return u.vocabularies?t():n.get({target:"study",taxonomy:"Mica_study"}).$promise.then(function(e){u.vocabularies=angular.copy(e.vocabularies),t()}),e.promise}};this.getArrayByAggregation=function(s,a){var n=i.defer();s&&a||n.resolve([]);var o=[];return u.getTerms(s).then(function(e){var t=e,i=0;angular.forEach(a.aggs,function(a){if(a.aggregation===s)if(a["obiba.mica.RangeAggregationResultDto.ranges"])i=0,angular.forEach(t,function(t){angular.forEach(a["obiba.mica.RangeAggregationResultDto.ranges"],function(e){t.name===e.key&&e.count&&(o[i]={title:l.forLocale(t.title,c.use()),value:e.count,key:e.key},i++)})});else{if("populations-model-selectionCriteria-countriesIso"===a.aggregation){var r=c.use();t.sort(function(e,t){var a=l.forLocale(e.title,r),n=l.forLocale(t.title,r);return a<n?-1:n<a?1:0})}var n=0;i=0,angular.forEach(t,function(t){angular.forEach(a["obiba.mica.TermsAggregationResultDto.terms"],function(e){t.name===e.key&&e.count&&("model-methods-design"===a.aggregation?(angular.forEach(e.aggs,function(e){if("model-numberOfParticipants-participant-number"===e.aggregation){var t=e["obiba.mica.StatsAggregationResultDto.stats"];n=l.formatNumber(t?t.data.sum:0)}}),o[i]={title:l.forLocale(t.title,c.use()),value:e.count,participantsNbr:n,key:e.key}):o[i]={title:l.forLocale(t.title,c.use()),value:e.count,key:e.key},i++)})})}}),n.resolve(o)}),n.promise}}]).service("GraphicChartsQuery",["RqlQueryService","RqlQueryUtils","$translate",function(i,s,o){this.queryDtoBuilder=function(e,t){var a;e&&"NaN"!==e||(a="study(exists(Mica_study.id))"),t&&"NaN"!==e&&(a=t+"(in(Mica_"+t+".id,("+e+")))");var n=angular.copy(i.parseQuery(a));s.addLocaleQuery(n,o.use());var r=(new RqlQuery).serializeArgs(n.args);return i.prepareGraphicsQuery(r,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-design"])}}]),ngObibaMica.fileBrowser=angular.module("obiba.mica.fileBrowser",["pascalprecht.translate","ui.bootstrap","templates-ngObibaMica"]).config(["$provide",function(e){e.provider("ngObibaMicaFileBrowserOptions",new NgObibaMicaFileBrowserOptionsProvider)}]),ngObibaMica.fileBrowser.controller("FileBrowserController",["$rootScope","$scope","$log","$filter","StringUtils","FileBrowserService","BrowserBreadcrumbHelper","AlertService","ServerErrorUtils","FileBrowserFileResource","FileBrowserSearchResource","ngObibaMicaFileBrowserOptions","FileBrowserDownloadService","CustomWatchDomElementService",function(e,s,o,t,a,n,r,i,l,c,u,d,m,p){var g=function(e,t){b(),y(e,t)},h=function(e,t,a){e.stopPropagation(),t&&g(t.path,a)},f=function(e){i.alert({id:"FileSystemController",type:"danger",msg:l.buildMessage(e)}),403!==e.status&&s.data.document&&h(s.data.document)};function b(){s.data.search.text=null,s.data.search.active=!1}function y(t,a){var e;s.data.search.active=!1,e=a?{path:t,keyToken:a}:{path:t},c.get(e,function(e){404!==e.code?(s.pagination.selected=-1,s.data.document=s.data.details.document=e,s.data.document.children||(s.data.document.children=[]),a&&(s.data.document.keyToken=a),s.data.document.path===s.data.rootPath&&(s.data.document.children=s.data.document.children.filter(function(e){return d.folders.excludes.indexOf(e.name)<0}),s.data.document.size=s.data.document.children.length),s.data.breadcrumbs=r.toArray(t,s.data.rootPath),s.data.isFile=n.isFile(e),s.data.isRoot=n.isRoot(e),s.noDocument=!1,"FOLDER"===e.type&&e.size<1&&(s.noDocument=!0)):s.noDocument=!0},f)}function v(){s.pagination.selected=-1,s.data.details.show=!1}var T=function(e){s.data.search.active=!0,v();var t=s.data.search.recursively,a=null,n=null,r=999;switch(s.data.search.query=e){case"RECENT":e="",a="desc",n="lastModifiedDate",r=10}var i={query:e,recursively:t,sort:n,order:a,limit:r};!function(n,e){e.query=function(e){var t="";try{var a=[];d.folders.excludes.forEach(function(e){var t=n.replace(/\//g,"\\/")+"\\/"+e.replace(/\s/,"\\ ");a.push(t),a.push(t+"\\/*")}),t=0<a.length?"NOT path:("+a.join(" OR ")+")":""}catch(e){}return e?e+" AND "+t:t}(e.query);var t=angular.extend({},{path:n},e);u.search(t,function(e){var t=s.data.document?angular.copy(s.data.document):{};t.children=e,s.data.document=t},function(e){o.debug("ERROR:",e)})}(s.data.document.path,i)},S=function(){b(),y(s.data.document.path)},w=function(e,t){e&&t&&(s.docPath=e,s.docId=t),s.docPath&&"/"!==s.docPath&&s.docId&&(s.data.docRootIcon=r.rootIcon(s.docPath),s.data.rootPath=s.docPath+("null"!==s.docId?"/"+s.docId:""),s.tokenKey?y(s.data.rootPath,s.tokenKey):y(s.data.rootPath,null))};s.downloadTarget=d.downloadInline?"_blank":"_self",s.getDownloadUrl=m.getUrl,s.screen=e.screen,s.truncate=a.truncate,s.getDocumentIcon=n.getDocumentIcon,s.navigateToPath=g,s.navigateTo=h,s.navigateBack=function(){if(!s.data.isRoot&&s.data.document){var e=s.data.document.path.replace(/\\/g,"/").replace(/\/[^\/]*$/,"");y(e||"/")}},s.navigateToParent=function(e,t,a){e.stopPropagation();var n=t.path;n=0===n.lastIndexOf("/")?"/":n.substring(0,n.lastIndexOf("/")),g(n,a)},s.clearSearch=S,s.searchDocuments=T,s.toggleRecursively=function(){s.data.search.recursively=!s.data.search.recursively,s.data.search.text?T(s.data.search.text):s.data.search.query&&T(s.data.search.query)},s.searchKeyUp=function(e){switch(e.keyCode){case 13:s.data.search.text?T(s.data.search.text):S();break;case 27:s.data.search.active&&S()}},s.isFile=n.isFile,s.isRoot=n.isRoot,s.getLocalizedValue=function(e){return n.getLocalizedValue(e,d.locale)},s.hasLocalizedValue=function(e){return n.hasLocalizedValue(e,d.locale)},s.hideDetails=v,s.showDetails=function(e,t){s.pagination.selected=t,s.data.details.document=e,s.data.details.show=!0},s.getTypeParts=function(e){return n.isFile(e)&&e.attachment.type?e.attachment.type.split(/,|\s+/):[]},s.documentsTitle=d.documentsTitle,s.pagination={selected:-1,currentPage:1,itemsPerPage:20},s.data={keyToken:null,details:{document:null,show:!1},docRootIcon:null,rootPath:null,document:null,accesses:[],search:{text:null,active:!1,recursively:!0},breadcrumbs:null,isFile:!1,isRoot:!1,editDescField:!1},s.$watchGroup(["docPath","docId"],function(){w()}),s.__defineSetter__("selfNode",function(e){e&&p.configWatch(e,["refresh","show-title"]).customWatch(function(){"true"===e.attributes[4].value&&(w(e.attributes[1].value,e.attributes[2].value),s.showTitle=e.attributes[6].value)})})}]),ngObibaMica.fileBrowser.directive("fileBrowser",[function(){return{restrict:"EA",replace:!0,controller:"FileBrowserController",scope:{docPath:"@",docId:"@",tokenKey:"@",subject:"=",refresh:"=",showTitle:"@"},templateUrl:"file-browser/views/file-browser-template.html",link:function(e,t){e.selfNode=t[0]}}}]),ngObibaMica.fileBrowser.factory("FileBrowserFileResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("FileBrowserFileResource"),{path:"@path",keyToken:"@keyToken"},{get:{method:"GET",errorHandler:!0}})}]).factory("FileBrowserSearchResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("FileBrowserSearchResource"),{path:"@path"},{search:{method:"GET",isArray:!0,errorHandler:!0}})}]).service("FileBrowserDownloadService",["ngObibaMicaUrl","ngObibaMicaFileBrowserOptions",function(n,r){return this.getUrl=function(e,t){var a=n.getUrl("FileBrowserDownloadUrl").replace(/:path/,e).replace(/:inline/,r.downloadInline);return a=t?a.replace(/:key/,t):a.replace(/:key/,"")},this}]).service("FileBrowserService",[function(){this.isFile=function(e){return e&&"FILE"===e.type},this.isRoot=function(e){return e&&"/"===e.path},this.getLocalizedValue=function(e,t){if(!e)return null;var a=e.filter(function(e){return e.lang===t});return a&&0<a.length?a[0].value:null},this.hasLocalizedValue=function(e,t){var a=this.getLocalizedValue(e,t);return null!==a&&0<a.trim().length},this.getDocumentIcon=function(e){if(!e)return"";if("FOLDER"===e.type)return"fa-folder";var t=e.path.match(/\.(\w+)$/);if(t&&1<t.length)switch(t[1].toLowerCase()){case"doc":case"docx":case"odm":case"gdoc":return"fa-file-word-o";case"xls":case"xlsx":return"fa-file-excel-o";case"pdf":return"fa-file-pdf-o";case"ppt":case"odt":return"fa-file-powerpoint-o";case"xt":return"fa-file-text-o"}return"fa-file"}}]).service("BrowserBreadcrumbHelper",[function(){this.toArray=function(e,t){if(e){var a=(e=e.replace(t,"")).replace(/\/$/,"").split("/").slice(1),n=[],r=null;return a.forEach(function(e){r=(null===r?t:r)+"/"+e,n.push({name:e,path:r})}),n}return[{name:"",path:""}]},this.rootIcon=function(e){var t=/^\/([^\/]*)/.exec(e);switch(t?t[1]:""){case"study":return"i-obiba-study";case"network":return"i-obiba-network";case"study-dataset":return"i-obiba-study-dataset";case"harmonization-dataset":return"i-obiba-harmo-dataset";default:return"fa fa-hdd-o"}}}]),ngObibaMica.file=angular.module("obiba.mica.file",["ngResource"]),ngObibaMica.file.filter("bytes",function(){return function(e){return null==e?"":filesize(e)}}),ngObibaMica.file.factory("TempFileResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("TempFileResource"),{},{get:{method:"GET"},delete:{method:"DELETE"}})}]),ngObibaMica.attachment=angular.module("obiba.mica.attachment",["obiba.mica.file","ui.bootstrap","ngFileUpload","templates-ngObibaMica"]),ngObibaMica.attachment.directive("attachmentList",[function(){return{restrict:"E",scope:{hrefBuilder:"=",files:"=",emptyMessage:"="},templateUrl:"attachment/attachment-list-template.html",link:function(a){a.attachments=[],a.hrefBuilder=a.hrefBuilder||function(e){return e.id},a.hasAttachments=!1,a.$watch("files",function(e){e&&(a.hasAttachments=0<e.length,a.attachments=e.map(function(e){var t=angular.copy(e);return t.href=a.hrefBuilder(e),t}))},!0)}}}]).directive("attachmentInput",[function(){return{restrict:"E",require:"^form",scope:{multiple:"=",accept:"@",files:"=",disabled:"=",onError:"=",deleteAttachments:"<"},templateUrl:"attachment/attachment-input-template.html",controller:"AttachmentCtrl"}}]).controller("AttachmentCtrl",["$scope","$timeout","$log","Upload","TempFileResource","ngObibaMicaUrl",function(n,s,o,t,l,a){void 0!==n.deleteAttachments&&null!==n.deleteAttachments||(n.deleteAttachments=!0);n.onFileSelect=function(e){n.uploadedFiles=e,n.uploadedFiles.forEach(function(e){!function(e){n.files=n.files||[];var i={showProgressBar:!0,lang:"en",progress:0,fileName:e.name,size:e.size};n.multiple||n.files.splice(0,n.files.length),n.files.push(i),n.upload=t.upload({url:a.getUrl("TempFileUploadResource"),method:"POST",file:e}).progress(function(e){i.progress=parseInt(100*e.loaded/e.total)}).success(function(e,t,a){var n=a().location.split("/"),r=n[n.length-1];l.get({id:r},function(e){o.debug("tempFile",e),i.id=e.id,i.md5=e.md5,i.justUploaded=!0,i.timestamps={created:new Date},s(function(){i.showProgressBar=!1},1e3)})}).error(function(e){o.error("File upload failed: ",JSON.stringify(e,null,2));var t=n.files.indexOf(i);-1!==t&&n.files.splice(t,1),n.onError&&n.onError(i)})}(e)})},n.deleteTempFile=function(a){l.delete({id:a},function(){for(var e=n.files.length;e--;){var t=n.files[e];t.justUploaded&&t.id===a&&n.files.splice(e,1)}})},n.deleteFile=function(e){for(var t=n.files.length;t--;)n.files[t].id===e&&n.files.splice(t,1)}}]),ngObibaMica.access=angular.module("obiba.mica.access",["pascalprecht.translate","ui.bootstrap","obiba.alert","obiba.comments","obiba.mica.attachment","obiba.utils","angularMoment","templates-ngObibaMica"]),ngObibaMica.access.config(["$provide",function(e){e.provider("ngObibaMicaAccessTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({list:{header:null,footer:null},view:{header:null,footer:null},form:{header:null,footer:null},amendmentView:{header:null,footer:null},amendmentForm:{header:null,footer:null}}))}]),ngObibaMica.access.controller("DataAccessRequestListController",["$scope","ngObibaMicaAccessTemplateUrl",function(e,t){e.headerTemplateUrl=t.getHeaderUrl("list"),e.footerTemplateUrl=t.getFooterUrl("list")}]).controller("DataAccessRequestViewController",["$rootScope","$scope","$q","$location","$uibModal","$routeParams","$filter","$translate","DataAccessRequestResource","DataAccessAmendmentsResource","DataAccessEntityService","DataAccessRequestStatusResource","DataAccessFormConfigResource","DataAccessRequestAttachmentsUpdateResource","DataAccessRequestCommentsResource","DataAccessRequestCommentResource","ngObibaMicaUrl","ngObibaMicaAccessTemplateUrl","AlertService","ServerErrorUtils","NOTIFICATION_EVENTS","DataAccessRequestConfig","SfOptionsService","moment","UserProfileService",function(n,r,e,a,t,i,s,o,l,c,u,d,m,p,g,h,f,b,y,v,T,S,w,C,x){var E=Object.freeze({form:0,amendments:1,documents:2,comments:3,privateComments:4,history:5});function O(e){y.alert({id:"DataAccessRequestViewController",type:"danger",msg:v.buildMessage(e)})}function R(){g.query({id:i.id,admin:!0===r.privateComments||""},function(e){r.form.comments=e||[]})}function D(e){e&&(r.attachments=angular.copy(r.dataAccessRequest.attachments)||[]),r.showAttachmentsForm=e}function A(){e.all([l.get({id:i.id}).$promise,c.getLogHistory({id:i.id}).$promise]).then(function(e){var t=e[0],a=e[1];try{r.dataAccessRequest=t,r.form.model=t.content?JSON.parse(t.content):{};var n=f.getUrl("DataAccessRequestDownloadPdfResource").replace(":id",r.dataAccessRequest.id);r.requestDownloadUrl=n+(-1!==n.indexOf("?q=")?"&":"?")+"lang="+o.use(),r.attachments=t.attachments||[],r.lastSubmittedDate=(r.dataAccessRequest.logsHistory||[]).filter(function(e){return e.to===u.status.SUBMITTED}).sort(function(e,t){return C(e).isBefore(t)?-1:C(e).isSame(t)?0:C(e).isAfter(t)?1:void 0}).pop(),r.logsHistory=u.processLogsHistory([].concat(t.statusChangeHistory,t.actionLogHistory||[],a||[]).sort(function(e,t){return e.changedOn.localeCompare(t.changedOn)}))}catch(e){r.validForm=!1,r.form.model={},y.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.parse-error"})}r.loading=!1},O)}function N(){w.transform().then(function(e){r.sfOptions=e,r.sfOptions.pristine={errors:!0,success:!1}}),m.get(function(e){r.dataAccessForm=e},O)}function $(){setTimeout(function(){A()})}function U(e,t,a){n.$broadcast(T.showConfirmDialog,{titleKey:"data-access-request.status-change-confirmation.title",messageKey:null!==t?t:"data-access-request.status-change-confirmation.message",messageArgs:null!==a?[s("translate")(a).toLowerCase()]:[]},e)}function q(e,t){e===t&&d.update({id:r.dataAccessRequest.id,status:e},$,O)}r.logsHistory=[],r.parentId=void 0,r.loading=!1,r.validForm=!0,r.config=S.getOptions(),r.actions=u.actions,r.nextStatus=u.nextStatus,r.showAttachmentsForm=!1,r.selectTab=function(e){switch(e){case E.form:case E.history:case E.documents:break;case E.comments:r.privateComments=!1,void 0===r.parentId&&R();break;case E.privateComments:void 0===r.parentId&&(r.privateComments=!0,R());break;case E.amendments:r.parentId=i.id}},r.delete=function(){r.requestToDelete=r.dataAccessRequest.id,n.$broadcast(T.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[r.dataAccessRequest.title,r.dataAccessRequest.applicant]},r.requestToDelete)},r.submitComment=function(e){g.save({id:i.id,admin:!0===r.privateComments},e.message,R,O)},r.updateComment=function(e){h.update({id:i.id,commentId:e.id},e.message,R,O)},r.deleteComment=function(e){r.commentToDelete=e.id,n.$broadcast(T.showConfirmDialog,{titleKey:"comment.delete-dialog.title",messageKey:"comment.delete-dialog.message",messageArgs:[e.createdBy]},e.id)},r.getDownloadHref=function(e){return f.getUrl("DataAccessRequestAttachmentDownloadResource").replace(":id",r.dataAccessRequest.id).replace(":attachmentId",e.id)},r.updateAttachments=function(){var e=angular.copy(r.dataAccessRequest);e.attachments=r.attachments,p.save(e,function(){D(!1),A()})},r.cancelAttachments=function(){D(!1)},r.editAttachments=function(){D(!0)},r.updateActionLogs=function(e){Array.isArray(e)&&(r.loading=!0,r.dataAccessRequest.actionLogHistory=e,l.editActionLogs(r.dataAccessRequest,function(){$()}))},r.onAttachmentError=function(e){y.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"server.error.file.upload",msgArgs:[e.fileName]})},r.headerTemplateUrl=b.getHeaderUrl("view"),r.footerTemplateUrl=b.getFooterUrl("view"),r.submit=function(){r.$broadcast("schemaFormValidate"),r.forms.requestForm.$valid?d.update({id:r.dataAccessRequest.id,status:u.status.SUBMITTED},function(){t.open({scope:r,templateUrl:"access/views/data-access-request-submitted-modal.html"}).result.then(function(){$()})},O):y.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})},r.reopen=function(){U(u.status.OPENED,null,"reopen")},r.review=function(){U(u.status.REVIEWED,"data-access-request.status-change-confirmation.message-review",null)},r.approve=function(){U(u.status.APPROVED,null,"approve")},r.reject=function(){U(u.status.REJECTED,null,"reject")},r.conditionallyApprove=function(){U(u.status.CONDITIONALLY_APPROVED,null,"conditionallyApprove")},r.UserProfileService=x,r.userProfile=function(e){r.applicant=e,t.open({scope:r,templateUrl:"access/views/data-access-request-profile-user-modal.html"})},r.dataAccessRequest={},r.getDataAccessListPageUrl=u.getListDataAccessRequestPageUrl(),r.printForm=function(){setTimeout(function(){window.print()},250)},r.getFullName=function(e){return x.getFullName(e)},r.$on(T.confirmDialogAccepted,function(e,t){r.requestToDelete===t&&(l.delete({id:r.requestToDelete},function(){a.path("/data-access-requests").replace()}),delete r.requestToDelete)}),r.$on(T.confirmDialogAccepted,function(e,t){r.commentToDelete===t&&h.delete({id:i.id,commentId:t},{},R,O)}),r.$on(T.confirmDialogAccepted,function(e,t){q(u.status.OPENED,t)}),r.$on(T.confirmDialogAccepted,function(e,t){q(u.status.REVIEWED,t)}),r.$on(T.confirmDialogAccepted,function(e,t){q(u.status.CONDITIONALLY_APPROVED,t)}),r.$on(T.confirmDialogAccepted,function(e,t){q(u.status.APPROVED,t)}),r.$on(T.confirmDialogAccepted,function(e,t){q(u.status.REJECTED,t)}),n.$on("$translateChangeSuccess",N),r.tabs={activeTab:0},r.TAB_NAMES=E,r.forms={},r.form={schema:null,definition:null,model:{},comments:null},i.id&&(N(),A())}]).controller("DataAccessRequestEditController",["$rootScope","$log","$scope","$routeParams","$location","$uibModal","LocalizedSchemaFormService","DataAccessRequestsResource","DataAccessRequestResource","DataAccessFormConfigResource","JsonUtils","AlertService","ServerErrorUtils","SessionProxy","DataAccessEntityService","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig","SfOptionsService","FormDirtyStateObserver","DataAccessRequestDirtyStateService","$timeout",function(e,t,a,n,r,i,s,o,l,c,u,d,m,p,g,h,f,b,y,v,T){var S=function(e,t){y.unobserve();var a=t().location.split("/");r.path("/data-access-request/"+a[a.length-1]).replace()},w=function(e){d.alert({id:"DataAccessRequestEditController",type:"danger",msg:m.buildMessage(e)})};function C(e){d.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"server.error.file.upload",msgArgs:[e.fileName]})}a.getDataAccessListPageUrl=g.getListDataAccessRequestPageUrl();function x(){b.transform().then(function(e){a.sfOptions=e,a.sfOptions.onError=C}),c.get(function(e){a.sfForm.definition=s.translate(u.parseJsonSafely(e.definition,[])),a.sfForm.schema=s.translate(u.parseJsonSafely(e.schema,{})),0===a.sfForm.definition.length&&(a.sfForm.definition=[],a.validForm=!1,d.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.definition"})),0===Object.getOwnPropertyNames(a.sfForm.schema).length&&(a.sfForm.schema={},a.validForm=!1,d.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-config.parse-error.schema"})),a.validForm&&(a.dataAccessRequest=n.id?l.get({id:n.id},function(e){try{a.sfForm.model=e.content?JSON.parse(e.content):{}}catch(e){a.sfForm.model={},d.alert({id:"DataAccessRequestEditController",type:"danger",msgKey:"data-access-request.parse-error"})}return a.canEdit=g.actions.canEdit(e),a.sfForm.schema.readonly=!a.canEdit,a.$broadcast("schemaFormRedraw"),e.attachments=e.attachments||[],e}):{applicant:p.login(),status:g.status.OPENED,attachments:[]}),T(function(){a.sfForm=angular.copy(a.sfForm),a.loaded=!0},250)},w)}e.$on("$translateChangeSuccess",function(){x()}),x(),a.loaded=!1,a.config=f.getOptions(),a.validForm=!0,a.requestId=n.id,a.newRequest=!n.id,a.cancel=function(){r.path("/data-access-request"+(n.id?"/"+n.id:"s")).replace()},a.save=function(){a.dataAccessRequest.content=angular.toJson(a.sfForm.model),a.newRequest?o.save(a.dataAccessRequest,S,w):l.save(a.dataAccessRequest,function(){y.unobserve(),r.path("/data-access-request"+(a.dataAccessRequest.id?"/"+a.dataAccessRequest.id:"s")).replace()},w)},a.editable=!0,a.validate=function(e){a.$broadcast("schemaFormValidate"),i.open({resolve:{isValid:e.$valid},templateUrl:"access/views/data-access-request-validation-modal.html",controller:["$scope","isValid",function(e,t){e.isValid=t}]})},a.headerTemplateUrl=h.getHeaderUrl("form"),a.footerTemplateUrl=h.getFooterUrl("form"),a.sfForm={schema:null,definition:null,model:{}},y.observe(a),v.setForm(a.form),a.$on("$destroy",function(){v.setForm(null)})}]),ngObibaMica.access.config(["$routeProvider",function(e){e.when("/data-access-requests",{templateUrl:"access/views/data-access-request-list.html",controller:"DataAccessRequestListController"}).when("/data-access-request/new",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id/edit",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id",{templateUrl:"access/views/data-access-request-view.html",controller:"DataAccessRequestViewController"}).when("/data-access-request/:parentId/amendment/new",{templateUrl:"access/views/data-access-amendment-view.html",controller:"DataAccessAmendmentEditController"}).when("/data-access-request/:parentId/amendment/:id/edit",{templateUrl:"access/views/data-access-amendment-view.html",controller:"DataAccessAmendmentEditController"}).when("/data-access-request/:parentId/amendment/:id",{templateUrl:"access/views/data-access-amendment-view.html",controller:"DataAccessAmendmentViewController"})}]),ngObibaMica.access.factory("DataAccessFormConfigResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessFormConfigResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("DataAccessAmendmentFormConfigResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessAmendmentFormConfigResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("DataAccessRequestsResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessRequestsResource"),{},{save:{method:"POST",errorHandler:!0},get:{method:"GET"}})}]).factory("DataAccessRequestsExportCsvResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessRequestsExportCsvResource"),{},{get:{method:"GET"}})}]).factory("DataAccessRequestResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessRequestResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0},editActionLogs:{method:"PUT",params:{id:"@id"},url:t.getUrl("DataAccessRequestActionLogsResource"),errorHandler:!0},get:{method:"GET"},delete:{method:"DELETE"}})}]).factory("DataAccessAmendmentsResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessAmendmentsResource"),{},{save:{method:"POST",params:{parentId:"@parentId"},errorHandler:!0},get:{method:"GET",params:{parentId:"@parentId"}},getLogHistory:{method:"GET",isArray:!0,url:t.getUrl("DataAccessAmendmentsLogHistoryResource")}})}]).factory("DataAccessAmendmentResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessAmendmentResource"),{},{save:{method:"PUT",params:{parentId:"@parentId",id:"@id"},errorHandler:!0},get:{method:"GET"},delete:{method:"DELETE"}})}]).factory("DataAccessRequestAttachmentsUpdateResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessRequestAttachmentsUpdateResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0}})}]).factory("DataAccessRequestCommentsResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessRequestCommentsResource"),{},{save:{method:"POST",params:{id:"@id",admin:"@admin"},headers:{"Content-Type":"text/plain"},errorHandler:!0},get:{method:"GET",params:{id:"@id",admin:"@admin"},errorHandler:!0}})}]).factory("DataAccessRequestCommentResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessRequestCommentResource"),{},{delete:{method:"DELETE",params:{id:"@id",commentId:"@commentId"},errorHandler:!0},update:{method:"PUT",params:{id:"@id",commentId:"@commentId"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("DataAccessRequestStatusResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessRequestStatusResource"),{},{update:{method:"PUT",params:{id:"@id",status:"@status"},errorHandler:!0}})}]).factory("DataAccessAmendmentStatusResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DataAccessAmendmentStatusResource"),{},{update:{method:"PUT",params:{id:"@id",parentId:"@parentId",status:"@status"},errorHandler:!0}})}]).service("DataAccessRequestConfig",function(){var a={newRequestButtonCaption:null,documentsSectionTitle:null,documentsSectionHelpText:null,downloadButtonCaption:null,commentsEnabled:!0,userListPageTitle:null,newRequestButtonHelpText:null};this.setOptions=function(t){"object"==typeof t&&Object.keys(t).forEach(function(e){e in a&&(a[e]=t[e])})},this.getOptions=function(){return angular.copy(a)}}).service("DataAccessRequestDirtyStateService",[function(){var t=null;this.setForm=function(e){t=e},this.isDirty=function(){return t&&t.$dirty}}]).filter("filterProfileAttributes",function(){return function(e){var t=["email","firstName","lastName","createdDate","lastLogin","username"];return e.filter(function(e){return-1===t.indexOf(e.key)})}}).filter("capitalizeFirstLetter",["StringUtils",function(t){return function(e){return t.capitaliseFirstLetter(e)}}]),angular.module("obiba.mica.access").controller("DataAccessAmendmentEditController",["$scope","$location","$q","$routeParams","$uibModal","DataAccessEntityResource","DataAccessAmendmentFormConfigResource","DataAccessEntityUrls","DataAccessEntityService","ServerErrorUtils","AlertService","DataAccessRequestDirtyStateService","FormDirtyStateObserver","SessionProxy","ngObibaMicaAccessTemplateUrl",function(n,r,e,t,a,i,s,o,l,c,u,d,m,p,g){function h(e,t){m.unobserve();var a=t().location.split("/");r.path(n.entityUrl+"/amendment/"+a[a.length-1]).replace()}function f(e){u.alert({id:"DataAccessAmendmentEditController",type:"danger",msg:c.buildMessage(e)})}function b(){m.unobserve(),d.setForm(null)}n.entityUrl=t.id?o.getDataAccessAmendmentUrl(t.parentId,t.id):o.getDataAccessRequestUrl(t.parentId),n.read=!1,n.formDrawn=!1;var y=t.id?i.get(n.entityUrl,t.id):{"obiba.mica.DataAccessAmendmentDto.amendment":{parentId:t.parentId},$promise:new Promise(function(e){setTimeout(e,0,{})}),status:l.status.OPENED},v=y.$promise.then(function(e){return e.content?JSON.parse(e.content):{}}),T=s.get();e.all([y,v,T.$promise]).then(function(e){return n.requestEntity=e[0],n.model=e[1],n.dataAccessForm=e[2],e},function(e){console.error("Failed to resolve amendment promises because",e)}),n.headerTemplateUrl=g.getHeaderUrl("amendmentForm"),n.footerTemplateUrl=g.getFooterUrl("amendmentForm"),m.observe(n),d.setForm(n.form),n.$on("$destroy",b),n.cancel=function(){b(),r.path(n.entityUrl).replace()},n.save=function(){n.requestEntity.content=angular.toJson(n.model),n.requestEntity.parentId=t.parentId,delete n.requestEntity.$promise,n.requestEntity.applicant||(n.requestEntity.applicant=p.login()),t.id?i.update(n.entityUrl,n.requestEntity).$promise.then(function(){m.unobserve(),r.path(n.entityUrl).replace()},f):i.create(n.entityUrl,n.requestEntity,h,f)},n.validate=function(e){n.$broadcast("schemaFormValidate"),a.open({resolve:{isValid:e.$valid},templateUrl:"access/views/data-access-request-validation-modal.html",controller:["$scope","isValid",function(e,t){e.isValid=t}]})},n.toggleFormDrawnStatus=function(e){n.formDrawn=e}}]),angular.module("obiba.mica.access").controller("DataAccessAmendmentViewController",["$scope","$routeParams","$q","$uibModal","DataAccessEntityResource","DataAccessEntityService","DataAccessEntityFormService","DataAccessAmendmentFormConfigResource","DataAccessEntityUrls","AlertService","ngObibaMicaAccessTemplateUrl",function(t,a,n,r,i,s,o,e,l,c,u){function d(e,t){var a=e.filter(function(e){return e.key===t});return a&&0<a.length?a[0].value:null}function m(e){return e.content?JSON.parse(e.content):{}}function p(){var e=i.get(t.entityUrl,a.id);n.all([e,e.$promise.then(m)]).then(function(e){t.requestEntity=e[0],t.model=e[1]})}t.userProfile=function(e){t.applicant=e,r.open({scope:t,templateUrl:"access/views/data-access-request-profile-user-modal.html"})},t.getFullName=function(e){return e?e.attributes?d(e.attributes,"firstName")+" "+d(e.attributes,"lastName"):e.username:null},t.getProfileEmail=function(e){return e&&e.attributes?d(e.attributes,"email"):null},t.entityUrl=l.getDataAccessAmendmentUrl(a.parentId,a.id),t.read=!0,t.formDrawn=!1;var g=i.get(t.entityUrl,a.id),h=g.$promise.then(m),f=e.get();n.all([g,h,f.$promise]).then(function(e){return t.requestEntity=e[0],t.model=e[1],t.dataAccessForm=e[2],t.actions=s.actions,t.nextStatus=s.nextStatus,Object.assign(t,o.for(t,t.requestEntity,p)),e},function(e){console.error("Failed to resolve amendment promises because",e)}),t.headerTemplateUrl=u.getHeaderUrl("amendmentView"),t.footerTemplateUrl=u.getFooterUrl("amendmentView"),t.submit=function(){t.$broadcast("schemaFormValidate"),t.forms.requestForm.$valid?i.updateStatus(t.entityUrl,a.id,s.status.SUBMITTED).$promise.then(function(){r.open({scope:t,templateUrl:"access/views/data-access-request-submitted-modal.html"}).result.then(function(){p()})}):c.alert({id:"DataAccessAmendmentViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})},t.toggleFormDrawnStatus=function(e){t.formDrawn=e}}]),angular.module("obiba.mica.access").service("DataAccessEntityFormService",["$rootScope","$filter","$location","DataAccessEntityUrls","DataAccessEntityResource","DataAccessEntityService","NOTIFICATION_EVENTS",function(u,d,m,p,g,h,f){this.for=function(e,a,n,r){var t={},i=a["obiba.mica.DataAccessAmendmentDto.amendment"].parentId,s=i?p.getDataAccessAmendmentUrl(i,a.id):p.getDataAccessRequestUrl(a.id),o=i?"data-access-amendment":"data-access-request";function l(e,t,a){u.$broadcast(f.showConfirmDialog,{titleKey:o+".status-change-confirmation.title",messageKey:null!==t?t:o+".status-change-confirmation.message",messageArgs:null!==a?[d("translate")(a).toLowerCase()]:[]},e)}function c(e,t){e===t&&g.updateStatus(s,a.id,e).$promise.then(n,r)}return t.reopen=function(){l(h.status.OPENED,null,"reopen")},t.review=function(){l(h.status.REVIEWED,o+".status-change-confirmation.message-review",null)},t.approve=function(){l(h.status.APPROVED,null,"approve")},t.reject=function(){l(h.status.REJECTED,null,"reject")},t.conditionallyApprove=function(){l(h.status.CONDITIONALLY_APPROVED,null,"conditionallyApprove")},t.delete=function(){u.$broadcast(f.showConfirmDialog,{titleKey:o+".delete-dialog.title",messageKey:o+".delete-dialog.message",messageArgs:[a.title,a.applicant]},a.id)},t.printForm=function(){setTimeout(function(){window.print()},250)},e.$on(f.confirmDialogAccepted,function(e,t){a.id===t&&g.delete(s,t).$promise.then(function(){m.path(i?"/data-access-request/"+i:"/data-access-requests").replace()})}),e.$on(f.confirmDialogAccepted,function(e,t){c(h.status.OPENED,t)}),e.$on(f.confirmDialogAccepted,function(e,t){c(h.status.REVIEWED,t)}),e.$on(f.confirmDialogAccepted,function(e,t){c(h.status.CONDITIONALLY_APPROVED,t)}),e.$on(f.confirmDialogAccepted,function(e,t){c(h.status.APPROVED,t)}),e.$on(f.confirmDialogAccepted,function(e,t){c(h.status.REJECTED,t)}),t}}]);var DataAccessEntityResource=function(){function e(e,t,a,n,r,i){this.DataAccessRequestsResource=e,this.DataAccessRequestResource=t,this.DataAccessAmendmentsResource=a,this.DataAccessAmendmentResource=n,this.DataAccessRequestStatusResource=r,this.DataAccessAmendmentStatusResource=i}return e.prototype.list=function(e){var t=this.getParentId(e);return t?this.DataAccessAmendmentsResource.query({parentId:t}):this.DataAccessRequestsResource.query()},e.prototype.create=function(e,t,a,n){return this.getParentId(e)?this.DataAccessAmendmentsResource.save(t,a,n):this.DataAccessRequestsResource.save(t,a,n)},e.prototype.update=function(e,t){return this.getParentId(e)?this.DataAccessAmendmentResource.save(t):this.DataAccessRequestResource.save(t)},e.prototype.get=function(e,t){var a=this.getParentId(e);return a?this.DataAccessAmendmentResource.get({parentId:a,id:t}):this.DataAccessRequestResource.get({id:t})},e.prototype.delete=function(e,t){var a=this.getParentId(e);return a?this.DataAccessAmendmentResource.delete({parentId:a,id:t}):this.DataAccessRequestResource.delete({id:t})},e.prototype.updateStatus=function(e,t,a){var n=this.getParentId(e);return n?this.DataAccessAmendmentStatusResource.update({parentId:n,id:t,status:a}):this.DataAccessRequestStatusResource.update({id:t,status:a})},e.prototype.getParentId=function(e){var t=/data-access-request\/(\w+)(?:\/amendment)?/.exec(e);return t&&2===t.length?t[t.index]:null},e.$inject=["DataAccessRequestsResource","DataAccessRequestResource","DataAccessAmendmentsResource","DataAccessAmendmentResource","DataAccessRequestStatusResource","DataAccessAmendmentStatusResource"],e}();ngObibaMica.access.service("DataAccessEntityResource",DataAccessEntityResource),ngObibaMica.access.service("DataAccessEntityService",["$translate","SessionProxy","USER_ROLES","ngObibaMicaUrl",function(t,n,r,e){var a={OPENED:"OPENED",SUBMITTED:"SUBMITTED",REVIEWED:"REVIEWED",CONDITIONALLY_APPROVED:"CONDITIONALLY_APPROVED",APPROVED:"APPROVED",REJECTED:"REJECTED"},i={canViewProfile:function(t){var a=!1,e=n.roles();return angular.forEach(e,function(e){e!==t&&e!==r.admin||(a=!0)}),a},canView:function(e){return o(e,"VIEW")},canEdit:function(e){return o(e,"EDIT")},canEditStatus:function(e){return o(e,"EDIT_STATUS")},canDelete:function(e){return o(e,"DELETE")},canEditAttachments:function(e){return o(e,"EDIT_ATTACHMENTS")},canDeleteAttachments:function(e){return o(e,"DELETE_ATTACHMENTS")},canAddAmendments:function(e){return!!e["obiba.mica.DataAccessAmendmentDto.amendment"]||o(e,"ADD_AMENDMENTS")},canEditActionLogs:function(e){return o(e,"EDIT_ACTION_LOGS")},canViewPrivateComments:function(e){return o(e,"VIEW_PRIVATE_COMMENTS")},canAddPrivateComments:function(e){return o(e,"ADD_PRIVATE_COMMENTS")}},s={canSubmit:function(e){return l(e,"SUBMITTED")},canReopen:function(e){return l(e,"OPENED")},canReview:function(e){return l(e,"REVIEWED")},canConditionallyApprove:function(e){return l(e,"CONDITIONALLY_APPROVED")},canApprove:function(e){return l(e,"APPROVED")},canReject:function(e){return l(e,"REJECTED")}};function o(e,t){return!!e.actions&&-1!==e.actions.indexOf(t)}function l(e,t){return e.nextStatus?-1!==e.nextStatus.indexOf(t):null}return this.status=a,this.actions=i,this.nextStatus=s,this.getStatusFilterData=function(e){e&&t(Object.keys(a)).then(function(t){e(Object.keys(t).map(function(e){return{key:e,translation:t[e]}}))})},this.processLogsHistory=function(e){return(e||[]).map(function(e){switch(function(e){var t="opened";if(e.action)t="action";else if("OPENED"!==e.from||e.from!==e.to)switch(e.to){case"OPENED":t="reopened";break;case"SUBMITTED":t="submitted";break;case"REVIEWED":t="reviewed";break;case"CONDITIONALLY_APPROVED":t="conditionallyApproved";break;case"APPROVED":t="approved";break;case"REJECTED":t="rejected"}return t}(e)){case"opened":e.msg="data-access-request.histories.opened",e.icon="glyphicon glyphicon-saved";break;case"reopened":e.msg="data-access-request.histories.reopened",e.icon="glyphicon glyphicon-saved";break;case"submitted":e.msg="data-access-request.histories.submitted",e.icon="glyphicon glyphicon-export";break;case"reviewed":e.msg="data-access-request.histories.reviewed",e.icon="glyphicon glyphicon-check";break;case"conditionallyApproved":e.msg="data-access-request.histories.conditionallyApproved",e.icon="glyphicon glyphicon-unchecked";break;case"approved":e.msg="data-access-request.histories.approved",e.icon="glyphicon glyphicon-ok";break;case"rejected":e.msg="data-access-request.histories.rejected",e.icon="glyphicon glyphicon-remove";break;case"action":e.msg=e.action,e.icon="glyphicon glyphicon-play-circle",e.changedOn=new Date(e.changedOn).toISOString()}return e})},this.getListDataAccessRequestPageUrl=function(){return e.getUrl("DataAccessClientListPath")?e.getUrl("BaseUrl")+e.getUrl("DataAccessClientListPath"):null},this}]);var DataAccessEntityUrls=function(){function e(){}return e.prototype.getDataAccessRequestsUrl=function(){return"/data-access-requests"},e.prototype.getDataAccessRequestBaseUrl=function(){return"/data-access-request"},e.prototype.getDataAccessRequestUrl=function(e){return this.getDataAccessRequestBaseUrl()+"/"+e},e.prototype.getDataAccessAmendmentsUrl=function(e){return"/data-access-request/"+e+"/amendments"},e.prototype.getDataAccessAmendmentBaseUrl=function(e){return"/data-access-request/"+e+"/amendment"},e.prototype.getDataAccessAmendmentUrl=function(e,t){return this.getDataAccessAmendmentBaseUrl(e)+"/"+t},e}();ngObibaMica.access.service("DataAccessEntityUrls",DataAccessEntityUrls),function(){function t(a,t){var n=this;n.filterOutItemFromCollection=function(t,e){return(e||[]).filter(function(e){return e.action!==t.action||e.author!==t.author||e.changedOn!==t.changedOn})},n.sourceCollectionWithout=function(e){return n.filterOutItemFromCollection(e,n.sourceCollection)},n.replaceActionNameByTranslationKey=function(e){var t=(n.predefinedActionNames||[]).indexOf(e.action);-1<t&&(e.action=n.predefinedActions[t])},n.add=function(e){if(n.showError=!1,e&&e.action&&e.changedOn){n.replaceActionNameByTranslationKey(e),e.changedOn=e.changedOn.toISOString(),e.author||(e.author=a.login());var t=n.sourceCollectionWithout(e);t.push(e),n.update&&"function"==typeof n.update?(n.update({logs:t}),n.item={},n.changedOn=null):console.error("Did not create",e)}else n.showError=!0},n.predefinedActionsChanged=function(e){e.predefinedActions&&e.predefinedActions.currentValue&&(n.predefinedActionNames=n.predefinedActions.map(function(e){return t("translate")(e)}))},n.$onChanges=function(e){n.predefinedActionsChanged(e)}}angular.module("obiba.mica.access").component("actionLogEditor",{bindings:{sourceCollection:"<",predefinedActions:"<",update:"&"},templateUrl:"access/components/action-log/component.html",controller:["SessionProxy","$filter",t]}),angular.module("obiba.mica.access").component("actionLogItemEditor",{bindings:{item:"<",sourceCollection:"<",predefinedActions:"<",update:"&"},templateUrl:"access/components/action-log/item/component.html",controller:["SessionProxy","$uibModal","$filter",function(e,n,r){var i=this;t.call(i,e,r),i.remove=function(t){n.open({templateUrl:"access/components/action-log/item/delete-modal.html",controller:["$uibModalInstance","actionLogItem",function(e,t){this.item=t}],controllerAs:"$modal",resolve:{actionLogItem:function(){return{action:r("translate")(t.action),author:t.author,changedOn:moment(t.changedOn).calendar()}}}}).result.then(function(){var e=i.sourceCollectionWithout(t);e.length<i.sourceCollection.length&&i.update&&"function"==typeof i.update?i.update({logs:e}):console.error("Did not remove",t)})},i.edit=function(a){n.open({templateUrl:"access/components/action-log/item/edit-modal.html",controller:["$uibModalInstance","actionLogItem","predefinedActionNames",function(e,t,a){this.item=t,this.predefinedActionNames=a}],controllerAs:"$modal",size:"sm",resolve:{actionLogItem:function(){return{action:r("translate")(a.action),author:a.author,changedOn:new Date(a.changedOn)}},predefinedActionNames:function(){return i.predefinedActionNames}}}).result.then(function(e){if(i.replaceActionNameByTranslationKey(e),e.changedOn=e.changedOn.toISOString(),i.update&&"function"==typeof i.update){var t=i.sourceCollectionWithout(a);(t=i.filterOutItemFromCollection(e,t)).push(e),i.update({logs:t})}else console.error("Did not update",a)})},i.$onChanges=function(e){var t;i.predefinedActionsChanged(e),i.showButtons=i.item&&(t=i.item)&&t.hasOwnProperty("action")&&t.hasOwnProperty("author")&&t.hasOwnProperty("changedOn")}}]})}(),ngObibaMica.access.component("entityList",{bindings:{parentId:"<",canAdd:"<"},templateUrl:"access/components/entity-list/component.html",controller:["$rootScope","DataAccessEntityUrls","DataAccessEntityResource","DataAccessEntityService","NOTIFICATION_EVENTS","SessionProxy","USER_ROLES","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig","ngObibaMicaUrl","$translate","UserProfileService","UserProfileModalService",function(t,a,n,r,i,s,o,l,c,e,u,d,m){var p=this;function g(e){for(var t=0;t<e.length;t++){var a=e[t];if("OPENED"!==a.status)for(var n=0;n<a.statusChangeHistory.length;n++){var r=a.statusChangeHistory[n];"OPENED"===r.from&&"SUBMITTED"===r.to&&(a.submissionDate=r.changedOn)}}p.requests=e,p.loading=!1}var h=function(){p.loading=!1};function f(e,t){p.requestToDelete===t&&(n.delete(p.entityBaseUrl,p.requestToDelete).$promise.then(function(){p.loading=!0,n.list(p.listUrl).$promise.then(g,h)},h),delete p.requestToDelete)}p.getHistoryExportHref=function(){return e.getUrl("DataAccessRequestsExportHistoryResource").replace(":lang",u.use())},p.getCsvExportHref=function(){return e.getUrl("DataAccessRequestsExportCsvResource").replace(":lang",u.use())},p.getDataAccessRequestPageUrl=function(){return e.getUrl("DataAccessClientDetailPath")?e.getUrl("BaseUrl")+e.getUrl("DataAccessClientDetailPath"):null},p.deleteRequest=function(e){p.requestToDelete=e.id,t.$broadcast(i.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[e.title,e.applicant]},e.id)},p.$onInit=function(){p.headerTemplateUrl=l.getHeaderUrl("list"),p.footerTemplateUrl=l.getFooterUrl("list"),p.config=c.getOptions(),p.searchStatus={},p.loading=!0,p.addButtonCaption=null===p.parentId?p.config.newRequestButtonCaption||"data-access-request.add":"data-access-amendment.add",p.noneCaption=null===p.parentId?"data-access-request.none":"data-access-amendment.none",p.actions=r.actions,p.showApplicant=0<s.roles().filter(function(e){return-1<[o.dao,o.admin].indexOf(e)}).length;var e=t.$new();p.$on=angular.bind(e,e.$on),p.$on(i.confirmDialogAccepted,f),r.getStatusFilterData(function(e){p.REQUEST_STATUS=e})},p.$onChanges=function(e){e.parentId&&void 0!==e.parentId.currentValue&&(null===e.parentId.currentValue?(p.listUrl=a.getDataAccessRequestsUrl(),p.entityBaseUrl=a.getDataAccessRequestBaseUrl()):(p.listUrl=a.getDataAccessAmendmentsUrl(p.parentId),p.entityBaseUrl=a.getDataAccessAmendmentBaseUrl(p.parentId)),n.list(p.listUrl).$promise.then(g,h))},p.UserProfileService=d,p.UserProfileModalService=m}]});var PrintFriendlyController=function(){},PrintFriendlyComponent=function(){this.transclude=!0,this.bindings={accessForm:"<",lastSubmittedDate:"<",model:"<",project:"<",validForm:"<"},this.controller=PrintFriendlyController,this.controllerAs="$ctrl",this.templateUrl="access/components/print-friendly-view/component.html"};ngObibaMica.access.component("printFriendlyView",new PrintFriendlyComponent),ngObibaMica.sets=angular.module("obiba.mica.sets",["obiba.alert","ui.bootstrap","pascalprecht.translate","templates-ngObibaMica","LocalStorageModule"]),ngObibaMica.sets.controller("CartController",["$scope","$location","$translate","$cookies","SetService","ngObibaMicaSetsTemplateUrl",function(a,e,t,n,r,i){var s,o,l;a.options={},s=a,o=n,l="micaHideCartHelpText",t(["sets.cart.help"]).then(function(e){s.options.CartHelpText||o.get(l)||(s.options.CartHelpText=e["sets.cart.help"])}),s.closeHelpBox=function(){o.put(l,!0),s.options.CartHelpText=null},o.get(l)&&(s.options.CartHelpText=null),a.cartHeaderTemplateUrl=i.getHeaderUrl("cart"),a.loading=!0;var c=function(e){a.loading=!1,a.variables=e},u=r.getCartDocuments("variables",0,100);u?u.then(c):a.variables={total:0},a.$on("cart-cleared",function(e,t){a.loading=!0,r.getCartDocuments(t,0,100).then(c)}),a.onPaginate=function(e,t){r.getCartDocuments(e,t,100).then(c)}}]).controller("VariableToCartController",["$scope","SetService","AlertService",function(r,t,i){r.canBeAdded=!1,r.canBeRemoved=!1,r.loading=!0,r.onInit=function(e){t.isDocumentInCart("variables",e).then(function(){r.loading=!1,r.canBeRemoved=!0}).catch(function(){r.loading=!1,r.canBeAdded=!0})},r.onAdd=function(e){r.loading=!0;var n=t.getCartSet("variables");t.addDocumentToCart("variables",e).then(function(e){r.loading=!1;var t=e.count-(n?n.count:0),a=0===t?"sets.cart.no-variable-added":"sets.cart.variable-added";r.canBeRemoved=0<t,r.canBeAdded=!r.canBeRemoved,i.growl({id:"VariableToCartControllerGrowl",type:"info",msgKey:a,msgArgs:[],delay:3e3})}).catch(function(){r.loading=!1})},r.onRemove=function(e){r.loading=!0;var n=t.getCartSet("variables");t.removeDocumentFromCart("variables",e).then(function(e){r.loading=!1;var t=(n?n.count:0)-e.count,a=0<t?"sets.cart.variable-removed":"sets.cart.no-variable-removed";r.canBeAdded=0<t,r.canBeRemoved=!r.canBeAdded,i.growl({id:"VariableToCartControllerGrowl",type:"info",msgKey:a,msgArgs:[],delay:3e3})}).catch(function(){r.loading=!1})}}]),ngObibaMica.sets.config(["$routeProvider",function(e){e.when("/cart",{templateUrl:"sets/views/cart.html",controller:"CartController",reloadOnSearch:!1})}]),ngObibaMica.sets.config(["$provide",function(e){e.provider("ngObibaMicaSetsTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({cart:{header:null,footer:null}}))}]),ngObibaMica.sets.factory("SetResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetResource"),{},{get:{method:"GET",params:{type:"@type",id:"@id"},errorHandler:!0}})}]).factory("SetDocumentsResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetDocumentsResource"),{},{get:{method:"GET",params:{type:"@type",id:"@id",from:"@from",limit:"@limit"},errorHandler:!0}})}]).factory("SetClearResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetClearResource"),{},{clear:{method:"DELETE",params:{type:"@type",id:"@id"},errorHandler:!0}})}]).factory("SetExistsResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetExistsResource"),{},{get:{method:"GET",params:{type:"@type",id:"@id",did:"@did"},errorHandler:!0}})}]).factory("SetImportResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetImportResource"),{},{save:{method:"POST",params:{type:"@type",id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("SetImportQueryResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetImportQueryResource"),{},{save:{method:"POST",params:{type:"@type",id:"@id"},headers:{"Content-Type":"application/x-www-form-urlencoded"},errorHandler:!0,transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}}})}]).factory("SetRemoveResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetRemoveResource"),{},{delete:{method:"POST",params:{type:"@type",id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]),ngObibaMica.sets.factory("SetsResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetsResource"),{},{save:{method:"POST",params:{type:"@type"},errorHandler:!0}})}]).factory("SetsImportResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("SetsImportResource"),{},{save:{method:"POST",params:{type:"@type"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]);var SetService=function(){function e(e,t,a,n,r,i,s,o,l,c,u,d,m,p,g,h){this.$location=e,this.$window=t,this.$log=a,this.$translate=n,this.localStorageService=r,this.PageUrlService=i,this.AlertService=s,this.SetsImportResource=o,this.SetResource=l,this.SetDocumentsResource=c,this.SetClearResource=u,this.SetExistsResource=d,this.SetImportResource=m,this.SetImportQueryResource=p,this.SetRemoveResource=g,this.ObibaServerConfigResource=h;var f=this;h.get(function(e){f.hasMultipleStudies=!e.isSingleStudyEnabled||e.isHarmonizedDatasetEnabled,f.hasHarmonization=e.isHarmonizedDatasetEnabled})}return e.prototype.isSingleStudy=function(){return!this.hasMultipleStudies},e.prototype.hasHarmonizedDatasets=function(){return this.hasHarmonization},e.prototype.getCartDocuments=function(t,a,n){var r=this;return this.getOrCreateCart(t).then(function(e){return r.SetDocumentsResource.get({from:a,id:e.id,limit:n,type:t}).$promise})},e.prototype.isDocumentInCart=function(t,a){var n=this;return this.getOrCreateCart(t).then(function(e){return n.SetExistsResource.get({type:t,id:e.id,did:a}).$promise})},e.prototype.addDocumentToCart=function(t,e){var a=this,n=Array.isArray(e)?e.join("\n"):e;return this.getOrCreateCart(t).then(function(e){return a.SetImportResource.save({type:t,id:e.id},n).$promise}).then(function(e){return a.saveCart(t,e)})},e.prototype.addDocumentQueryToCart=function(t,a){var n=this;return this.$log.info("query="+a),this.getOrCreateCart(t).then(function(e){return n.SetImportQueryResource.save({type:t,id:e.id,query:a}).$promise}).then(function(e){return n.saveCart(t,e)})},e.prototype.removeDocumentFromCart=function(t,e){var a=this,n=Array.isArray(e)?e.join("\n"):e;return this.getOrCreateCart(t).then(function(e){return a.SetRemoveResource.delete({type:t,id:e.id},n).$promise}).then(function(e){return a.saveCart(t,e)})},e.prototype.clearCart=function(t){var a=this;return this.getOrCreateCart(t).then(function(e){return a.SetClearResource.clear({type:t,id:e.id}).$promise}).then(function(){return a.notifyCartChanged(t),a.getOrCreateCart(t)})},e.prototype.gotoSetEntitiesCount=function(e,t){var a=this,n=e;if(!n){var r=this.getCartSet("variables");r&&(n=r.id)}if(t){var i=Array.isArray(t)?t:[t];this.gotoEntitiesCount(i.slice(0,20))}else this.SetDocumentsResource.get({type:"variables",id:n,from:0,limit:20}).$promise.then(function(e){a.gotoEntitiesCount(e.variables.map(function(e){return e.id}))})},e.prototype.gotoEntitiesCount=function(e){if(e){var t=e.map(function(e){return"all("+e+")"}).join(",");this.$window.location.href=this.PageUrlService.entitiesCountPage(t)}},e.prototype.getDownloadUrl=function(e,t){var a=t;if(!a){var n=this.getCartSet(e);n&&(a=n.id)}if(a){var r="variable(in(Mica_variable.sets,"+a+"),limit(0,20000),fields((attributes.label.*,variableType,datasetId,datasetAcronym)),sort(variableType,containerId,populationWeight,dataCollectionEventWeight,datasetId,index,name)),locale("+this.$translate.use()+")";return this.PageUrlService.downloadList(e,r)}return null},e.prototype.gotoSearch=function(e,t){var a=t;if(!a){var n=this.getCartSet(e);n&&(a=n.id)}if(a){var r="variable(in(Mica_variable.sets,"+a+"))";this.$window.location.href=this.PageUrlService.searchPage(r)}},e.prototype.getCartSet=function(e){return this.localStorageService.get(this.getCartKey(e))},e.prototype.getOrCreateCart=function(t){var a=this,e=this.localStorageService.get(this.getCartKey(t));return e?this.SetResource.get({type:t,id:e.id}).$promise.then(function(e){return a.saveCart(t,e)}).catch(function(){return a.createCart(t,"")}):this.createCart(t,"")},e.prototype.createCart=function(t,e){var a=this;return this.SetsImportResource.save({type:t},e).$promise.then(function(e){return a.saveCart(t,e)})},e.prototype.saveCart=function(e,t){if(t&&t.id)return this.localStorageService.set(this.getCartKey(e),t),this.notifyCartChanged(e),t},e.prototype.getCartKey=function(e){return"cart."+e},e.prototype.notifyCartChanged=function(t){var a;try{a=new CustomEvent("cart-updated",{detail:t})}catch(e){(a=document.createEvent("Event")).initEvent("cart-updated",!0,!0),a.detail=t}document.dispatchEvent(a)},e.$inject=["$location","$window","$log","$translate","localStorageService","PageUrlService","AlertService","SetsImportResource","SetResource","SetDocumentsResource","SetClearResource","SetExistsResource","SetImportResource","SetImportQueryResource","SetRemoveResource","ObibaServerConfigResource"],e}();ngObibaMica.sets.service("SetService",["$location","$window","$log","$translate","localStorageService","PageUrlService","AlertService","SetsImportResource","SetResource","SetDocumentsResource","SetClearResource","SetExistsResource","SetImportResource","SetImportQueryResource","SetRemoveResource","ObibaServerConfigResource",SetService]);var CartDocumentsTableController=function(){function e(e,t,a,n,r,i,s,o,l){this.PageUrlService=e,this.LocalizedValues=t,this.SetService=a,this.AnalysisConfigService=n,this.$translate=r,this.$log=i,this.$scope=s,this.$location=o,this.$window=l,this.allSelected=!1,this.allPageSelected={},this.selections={},this.documents={from:0,limit:0,total:0},this.pagination={currentPage:1,from:0,itemsPerPage:10,maxSize:10,to:0,totalHits:0}}return e.prototype.hasSelections=function(){return this.allSelected||0<this.getSelectedDocumentIds().length},e.prototype.updateAllSelected=function(){this.$log.info("ALL="+this.allSelected),this.allSelected=!this.allSelected,this.allSelected?(this.allPageSelected[this.pagination.currentPage]=!0,this.updateAllCurrentPageSelected()):(this.allPageSelected={},this.selections={})},e.prototype.updateAllCurrentPageSelected=function(){var t=this;this.$log.info("ALLPAGE="+JSON.stringify(this.allPageSelected)),this.allSelected&&!this.allPageSelected[this.pagination.currentPage]?(this.allSelected=!1,this.allPageSelected={},this.selections={}):this.documents&&this.documents[this.type]&&this.documents[this.type].forEach(function(e){t.selections[e.id]=t.allPageSelected[t.pagination.currentPage]})},e.prototype.updateSelection=function(e){this.selections[e]||(this.allPageSelected[this.pagination.currentPage]=!1,this.allSelected=!1)},e.prototype.showAnalysis=function(){return this.AnalysisConfigService.showAnalysis()},e.prototype.showStudies=function(){return!this.SetService.isSingleStudy()},e.prototype.showVariableType=function(){return this.SetService.hasHarmonizedDatasets()},e.prototype.entitiesCount=function(){if(this.pagination.totalHits){var e=this.getSelectedDocumentIds();this.SetService.gotoSetEntitiesCount(void 0,e&&0<e.length?e:void 0)}},e.prototype.download=function(){return this.SetService.getDownloadUrl(this.type)},e.prototype.search=function(){this.SetService.gotoSearch(this.type)},e.prototype.clearSet=function(){var e=this;if(this.hasSelections()){var t=this.getSelectedDocumentIds();t&&0<t.length?this.SetService.removeDocumentFromCart(this.type,t).then(function(){e.allSelected=!1,e.allPageSelected={},e.selections={},e.$scope.$emit("cart-cleared",e.type)}):this.SetService.clearCart(this.type).then(function(){e.allSelected=!1,e.allPageSelected={},e.selections={},e.$scope.$emit("cart-cleared",e.type)})}},e.prototype.pageChanged=function(){var e=(this.pagination.currentPage-1)*this.documents.limit;this.onPageChange(this.type,e)},e.prototype.$onInit=function(){this.table={rows:new Array}},e.prototype.$onChanges=function(){this.table=this.asTable(),this.localizedTotal=this.LocalizedValues.formatNumber(this.documents&&this.documents.total?this.documents.total:0)},e.prototype.getSelectedDocumentIds=function(){var t=this;return this.allSelected?[]:Object.keys(this.selections).filter(function(e){return t.selections[e]})},e.prototype.localize=function(e){return this.LocalizedValues.forLang(e,this.$translate.use())},e.prototype.asTable=function(){var u=this,d={rows:new Array};this.pagination.totalHits=this.documents?this.documents.total:0,this.pagination.currentPage=this.documents?this.documents.from/this.documents.limit+1:0,this.pagination.itemsPerPage=this.documents?this.documents.limit:0,this.pagination.from=this.documents?this.documents.from+1:0;var e=this.documents&&this.documents[this.type]?this.documents[this.type].length:0;return this.pagination.to=this.documents?this.documents.from+e:0,e&&(this.allSelected&&(this.allPageSelected[this.pagination.currentPage]=!0),this.documents[this.type].forEach(function(e){u.allSelected&&(u.selections[e.id]=!0);var t=u.localize(e.studySummary.acronym),a=(u.localize(e.studySummary.name),"Dataschema"===e.variableType?"harmonization":"individual"),n=u.PageUrlService.studyPage(e.studyId,a),r=u.localize(e.datasetName),i=u.PageUrlService.datasetPage(e.datasetId,e.variableType),s=u.PageUrlService.variablePage(e.id),o=e.attributes.filter(function(e){return"label"===e.name}),l=o&&0<o.length?u.localize(o[0].values):"",c=new Array({link:void 0,value:e.id},{link:s||i,value:e.name},{link:void 0,value:l},{link:void 0,value:e.variableType},{link:n,value:t},{link:i,value:r});d.rows.push(c)})),d},e.$inject=["PageUrlService","LocalizedValues","SetService","AnalysisConfigService","$translate","$log","$scope","$location","$window"],e}(),CartDocumentsTableComponent=function(){this.transclude=!0,this.bindings={documents:"<",onPageChange:"<",type:"<"},this.controller=CartDocumentsTableController,this.controllerAs="$ctrl",this.templateUrl="sets/components/cart-documents-table/component.html"};ngObibaMica.sets.component("cartDocumentsTable",new CartDocumentsTableComponent);var DISPLAY_TYPES={LIST:"list",COVERAGE:"coverage",GRAPHICS:"graphics"};ngObibaMica.search=angular.module("obiba.mica.search",["obiba.alert","ui.bootstrap","pascalprecht.translate","ngclipboard","templates-ngObibaMica","obiba.mica.sets"]),ngObibaMica.search.run(["GraphicChartsConfigurations",function(e){e.setClientConfig()}]),ngObibaMica.search.controller("SearchController",["$timeout","$scope","$rootScope","$location","$translate","$filter","$cookies","ngObibaMicaSearchTemplateUrl","ObibaServerConfigResource","JoinQuerySearchResource","JoinQueryCoverageResource","AlertService","ServerErrorUtils","LocalizedValues","RqlQueryService","RqlQueryUtils","SearchContext","CoverageGroupByService","VocabularyService","EntitySuggestionRqlUtilityService","SearchControllerFacetHelperService","options","PaginationService",function(r,u,e,o,a,l,t,n,i,s,c,d,m,p,g,h,f,b,y,v,T,S,w){var C,x,E,O;u.options=S,C=u,x=t,E="micaHideSearchHelpText",O="micaHideClassificationHelpBox",a(["search.help","search.coverage-help"]).then(function(e){C.options.SearchHelpText||x.get(E)||(C.options.SearchHelpText=e["search.help"]),C.options.ClassificationHelpText||x.get(O)||(C.options.ClassificationHelpText=e["classifications.help"])}),C.closeHelpBox=function(){x.put(E,!0),C.options.SearchHelpText=null},C.closeClassificationHelpBox=function(){x.put(O,!0),C.options.ClassificationHelpText=null},x.get(E)&&(C.options.SearchHelpText=null),x.get(O)&&(C.options.ClassificationHelpText=null),u.taxonomyTypeMap={variable:"variables",study:"studies",network:"networks",dataset:"datasets"},a(["search.classifications-title","search.classifications-link","search.faceted-navigation-help"]).then(function(e){u.hasClassificationsTitle=e["search.classifications-title"],u.hasClassificationsLinkLabel=e["search.classifications-link"],u.hasFacetedNavigationHelp=e["search.faceted-navigation-help"]});var R={variable:u.options.variables.showSearchTab,dataset:u.options.datasets.showSearchTab,study:u.options.studies.showSearchTab,network:u.options.networks.showSearchTab},D=Object.keys(u.taxonomyTypeMap).reduce(function(e,t){return e[u.taxonomyTypeMap[t]]=t,e},{});function A(e){u.search.result={},u.search.loading=!1,d.alert({id:"SearchController",type:"danger",msg:m.buildMessage(e),delay:5e3})}function N(){return"layout2"===u.search.layout||u.search.query}function $(e){if(!e||!QUERY_TYPES[e.toUpperCase()])throw new Error("Invalid type: "+e)}function U(e){if(e&&(!BUCKET_TYPES[e.replace("-","_").toUpperCase()]||!b.canGroupBy(e)))throw new Error("Invalid bucket "+e)}function q(e){if(!e||!DISPLAY_TYPES[e.toUpperCase()])throw new Error("Invalid display: "+e)}function k(){try{var e=o.search(),t=-1<u.resultTabsOrder.indexOf(D[e.type])?e.type:u.taxonomyTypeMap[u.resultTabsOrder[0]],a=e.bucket&&b.canGroupBy(e.bucket)?e.bucket:b.defaultBucket(),n=-1<u.searchTabsOrder.indexOf(e.display)?e.display:u.searchTabsOrder[0]||DISPLAY_TYPES.LIST,r=e.query||"";return $(t),U(a),q(n),u.search.type=t,u.search.bucket=a,u.search.display=n,u.search.query=r,u.search.rqlQuery=g.parseQuery(r),u.search.layout=(i=e.layout?e.layout:(s=u.options).listLayout?s.listLayout:s.searchLayout?s.searchLayout:"layout2")&&-1<["layout1","layout2"].indexOf(i)?i:"layout2",!0}catch(e){d.alert({id:"SearchController",type:"danger",msg:e.message,delay:5e3})}var i,s;return!1}function I(){if("/search"===o.path()){var e,t,a=g.prepareSearchQueryAndSerialize(u.search.display,u.search.type,u.search.rqlQuery,u.lang,(e=g.getTargetQuerySort(u.search.type,u.search.rqlQuery),(t=e&&e.args?e.args:null)||(t=u.search.type===QUERY_TYPES.VARIABLES?SORT_FIELDS.NAME:SORT_FIELDS.ACRONYM,u.search.type===QUERY_TYPES.VARIABLES?t=[SORT_FIELDS.VARIABLE_TYPE,SORT_FIELDS.CONTAINER_ID,SORT_FIELDS.POPULATION_WEIGHT,SORT_FIELDS.DATA_COLLECTION_EVENT_WEIGHT,SORT_FIELDS.DATASET_ID,SORT_FIELDS.INDEX,SORT_FIELDS.NAME]:u.search.type===QUERY_TYPES.DATASETS&&(t=[SORT_FIELDS.STUDY_TABLE.STUDY_ID,SORT_FIELDS.STUDY_TABLE.POPULATION_WEIGHT,SORT_FIELDS.STUDY_TABLE.DATA_COLLECTION_EVENT_WEIGHT,SORT_FIELDS.ACRONYM])),t));switch(u.search.display){case DISPLAY_TYPES.LIST:u.search.loading=!0,u.search.executedQuery=a,s[u.search.type]({query:a},function(e){u.search.result.list=e,u.search.loading=!1,u.search.countResult=n(e),r(function(){var e=g.getQueryPaginations(u.search.rqlQuery);w.update(e,u.search.countResult)})},A);break;case DISPLAY_TYPES.COVERAGE:0<Object.keys(u.search.criteriaItemMap).map(function(e){return u.search.criteriaItemMap[e]}).filter(function(e){return QUERY_TARGETS.VARIABLE===e.getTarget()&&"Mica_variable"!==e.taxonomy.name}).length?(u.search.loading=!0,u.search.executedQuery=g.prepareCoverageQuery(a,u.search.bucket),c.get({query:u.search.executedQuery},function(e){u.search.result.coverage=e,u.search.loading=!1,u.search.countResult=e.totalCounts},A)):u.search.result={};break;case DISPLAY_TYPES.GRAPHICS:u.search.loading=!0,u.search.executedQuery=g.prepareGraphicsQuery(a,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-design"]),s.studies({query:u.search.executedQuery},function(e){u.search.result.graphics=e,u.search.loading=!1,u.search.countResult=n(e)},A)}}function n(e){return{studyTotalCount:{total:e.studyResultDto.totalCount,hits:e.studyResultDto.totalHits},datasetTotalCount:{total:e.datasetResultDto.totalCount,hits:e.datasetResultDto.totalHits},variableTotalCount:{total:e.variableResultDto.totalCount,hits:e.variableResultDto.totalHits},networkTotalCount:{total:e.networkResultDto.totalCount,hits:e.networkResultDto.totalHits}}}}function P(){k()&&g.createCriteria(u.search.rqlQuery,u.lang).then(function(e){var a,t;u.search.criteria=e.root,u.search.criteria&&u.search.criteria.children&&u.search.criteria.children.sort(function(e,t){return"network"===e.target||"variable"===t.target?-1:"variable"===e.target||"network"===t.target?1:e.target<t.target?1:e.target>t.target?-1:0}),u.search.criteriaItemMap=e.map,N()&&I(),u.search.selectedTarget&&u.search.selectedTaxonomy&&(a=u.search.selectedTarget,t=u.search.selectedTaxonomy,Array.isArray(t)?t.forEach(function(t){t.vocabularies.forEach(function(e){e.existingItem=g.findCriteriaItemFromTreeById(a,CriteriaIdGenerator.generate(t,e),u.search.criteria,!0)})}):t.vocabularies.forEach(function(e){e.existingItem=g.findCriteriaItemFromTreeById(a,CriteriaIdGenerator.generate(t,e),u.search.criteria,!0)})),u.$broadcast("ngObibaMicaQueryUpdated",u.search.criteria)})}function L(e,t,a){a.__defineSetter__("existingItem",function(t){t?(y.isNumericVocabulary(a)&&(a.rangeTerms=t.getRangeTerms()),y.isMatchVocabulary(a)&&(a.matchString=t.selectedTerms.join("")),a.wholeVocabularyIsSelected=-1<["exists","match"].indexOf(t.type),(a.terms||[]).forEach(function(e){e.selected="exists"===t.type||-1<t.selectedTerms.indexOf(e.name)})):(a.rangeTerms={},a.matchString=null,a.wholeVocabularyIsSelected=!1,(a.terms||[]).forEach(function(e){e.selected=!1})),a._existingItem=t}),a.__defineGetter__("existingItem",function(){return a._existingItem}),a.existingItem=g.findCriteriaItemFromTreeById(e,CriteriaIdGenerator.generate(t,a),u.search.criteria,!0)}u.targets=[],u.lang=a.use(),e.$on("$translateChangeSuccess",function(e,t){t.language!==f.currentLocale()&&(u.lang=a.use(),f.setLocale(u.lang),P())});var Q=function(){var e=(new RqlQuery).serializeArgs(u.search.rqlQuery.args),t=o.search();""===e?delete t.query:t.query=e,o.search(t)},M=function(e){g.removeCriteriaItem(e),Q()},_=function(e,t,a,n,r){if(angular.isUndefined(n)&&(n=!0),e.id){var i,s=CriteriaIdGenerator.generate(e.taxonomy,e.vocabulary),o=g.findCriteriaItemFromTree(e,u.search.criteria);o&&-1!==s.indexOf("dceId")&&r?(M(o),i="search.criterion.updated",g.addCriteriaItem(u.search.rqlQuery,e,t)):o?(i="search.criterion.updated",g.updateCriteriaItem(o,e,a)):(i="search.criterion.created",g.addCriteriaItem(u.search.rqlQuery,e,t)),n&&d.growl({id:"SearchControllerGrowl",type:"info",msgKey:i,msgArgs:[p.forLocale(e.vocabulary.title,u.lang),l("translate")("taxonomy.target."+e.target)],delay:3e3}),Q()}},V=function(e){if(e){$(e);var t=o.search();t.type=e,t.display=DISPLAY_TYPES.LIST,o.search(t)}},F=function(e){if(e){q(e);var t=o.search();t.display=e,o.search(t)}},B="search",z="classification",G=new Map([[QUERY_TARGETS.NETWORK,["acronym","name"]],[QUERY_TARGETS.STUDY,["acronym","name"]],[QUERY_TARGETS.DATASET,["acronym","name"]],[QUERY_TARGETS.VARIABLE,["name","label"]]]);function H(e,t,a){var n,r=u.search.rqlQuery,i=g.findTargetQuery(e,r);i||(i=new RqlQuery(e),r.push(i)),a&&(n=G.get(e));var s=v.createMatchQuery(t,n);if(s){var o=v.givenTargetQueryGetFilterQuery(i);if(o){var l=v.givenFilterQueryGetMatchQuery(o);l?l.args=s.args:o.push(s)}else i.push(new RqlQuery(RQL_NODE.FILTER).push(s))}else v.removeFilteredMatchQueryFromTargetQuery(i);Q()}u.searchSuggestion=H,u.goToSearch=function(){u.viewMode=B,o.search("taxonomy",null),o.search("vocabulary",null),o.search("target",null),o.path("/search")},u.goToClassifications=function(){u.viewMode=z,o.path("/classifications"),o.search("target",u.targetTabsOrder[0])},u.navigateToTarget=function(e){o.search("target",e),o.search("taxonomy",null),o.search("vocabulary",null),u.target=e},u.QUERY_TYPES=QUERY_TYPES,u.BUCKET_TYPES=BUCKET_TYPES,u.search={layout:"layout2",query:null,advanced:!1,rqlQuery:new RqlQuery,executedQuery:null,type:null,bucket:null,result:{list:null,coverage:null,graphics:null},criteria:[],criteriaItemMap:{},loading:!1},u.viewMode=B,u.searchHeaderTemplateUrl=n.getHeaderUrl("search"),u.classificationsHeaderTemplateUrl=n.getHeaderUrl("classifications"),u.onTaxonomyFilterPanelToggleVisibility=function(a,t){a&&t&&(Array.isArray(t)?t.forEach(function(t){t.vocabularies.forEach(function(e){L(a,t,e)})}):t.vocabularies.forEach(function(e){L(a,t,e)})),u.search.selectedTarget=a,u.search.selectedTaxonomy=t,u.search.showTaxonomyPanel=null!==t,u.search.showTaxonomyPanel||I()},u.selectDisplay=F,u.selectCriteria=_,u.removeCriteriaItem=M,u.refreshQuery=Q,u.clearSearchQuery=function(){var e=o.search();delete e.query,o.search(e)},u.toggleSearchQuery=function(){u.search.advanced=!u.search.advanced},u.showAdvanced=function(){for(var e=u.search.criteria.children||[],t=e.length;t--;)for(var a=e[t].children||[],n=a.length;n--;)if(a[n].type===RQL_NODE.OR||a[n].type===RQL_NODE.AND)return!0},u.onTypeChanged=V,u.onBucketChanged=function(e){if(e){U(e);var t=o.search();t.bucket=e,o.search(t)}},u.onDisplayChanged=F,u.onUpdateCriteria=function(e,t,a,n,r,i){if(t&&V(t),n){var s=g.findCriteriaItemFromTree(e,u.search.criteria);s&&ngObibaMica.search.CriteriaReducer.reduce(s.parent,s)}F(a&&u.search.display?u.search.display:DISPLAY_TYPES.LIST),_(e,RQL_NODE.AND,!0,r,i)},u.onRemoveCriteria=function(e){var t=g.findCriterion(u.search.criteria,e.id);M(t)},u.onSelectTerm=function(e,t,a,n){if((n=n||{}).text&&(n.text=n.text.replace(/[^a-zA-Z0-9" _-]/g,"")),angular.isString(n)&&(n={term:n}),a){var r;if(y.isNumericVocabulary(a))return(r=g.createCriteriaItem(e,t,a,null,u.lang)).rqlQuery=h.buildRqlQuery(r),h.updateRangeQuery(r.rqlQuery,n.from,n.to),void _(r,null,!0);if(y.isMatchVocabulary(a))return(r=g.createCriteriaItem(e,t,a,null,u.lang)).rqlQuery=h.buildRqlQuery(r),h.updateMatchQuery(r.rqlQuery,n.text),void _(r,null,!0)}if("layout1"===S.searchLayout)_(g.createCriteriaItem(e,t,a,n&&n.term,u.lang));else{var i=a.terms.filter(function(e){return e.selected}).map(function(e){return e.name}),s=g.findCriterion(u.search.criteria,CriteriaIdGenerator.generate(t,a));if(s&&n.term){if(s.rqlQuery.name=RQL_NODE.IN,n.term.selected)s.rqlQuery=h.mergeInQueryArgValues(s.rqlQuery,[n.term.name]);else{var o=s.rqlQuery.args[1]||[];s.type===RQL_NODE.EXISTS&&(o=s.vocabulary.terms.map(function(e){return e.name}));var l=o.indexOf(n.term.name);o=Array.isArray(o)?o:[o],-1<l?(o.splice(l,1),0===o.length&&(s.rqlQuery.name=RQL_NODE.EXISTS)):o.push(n.term.name),s.rqlQuery=h.mergeInQueryArgValues(s.rqlQuery,o)}1<a.terms.length&&i.length===a.terms.length&&(s.rqlQuery.name=RQL_NODE.EXISTS,s.rqlQuery.args.pop()),u.refreshQuery()}else{var c=1<a.terms.length&&i.length===a.terms.length;_(g.createCriteriaItem(e,t,a,!c&&n&&n.term,u.lang))}}},u.QUERY_TARGETS=QUERY_TARGETS,u.onPaginate=function(e,t,a,n){var r,i;u.search.rqlQuery=u.search.rqlQuery||new h(RQL_NODE.AND),g.prepareQueryPagination(u.search.rqlQuery,e,t,a),n?(r=(new RqlQuery).serializeArgs(u.search.rqlQuery.args),i=o.search(),""===r?delete i.query:i.query=r,o.search(i).replace()):Q()},u.canExecuteWithEmptyQuery=N,u.inSearchMode=function(){return u.viewMode===B},u.toggleFullscreen=function(){u.isFullscreen=!u.isFullscreen},u.isSearchAvailable=!0,i.get(function(e){u.isSearchAvailable=!e.isSingleStudyEnabled||e.isNetworkEnabled&&!e.isSingleNetworkEnabled||e.isCollectedDatasetEnabled||e.isHarmonizedDatasetEnabled}),u.unbindLocationChange=u.$on("$locationChangeSuccess",function(e,t,a){if(t!==a)try{U(o.search().bucket),P()}catch(e){var n=b.defaultBucket();o.search("bucket",n).replace()}}),e.$on("ngObibaMicaSearch.fullscreenChange",function(e,t){u.isFullscreen=t}),e.$on("ngObibaMicaSearch.sortChange",function(e,t){u.search.rqlQuery=g.prepareSearchQueryNoFields(u.search.display,u.search.type,u.search.rqlQuery,u.lang,t),Q()}),e.$on("ngObibaMicaSearch.searchSuggestion",function(e,t,a,n){H(a,t,n)}),u.taxonomyNav=[],u.lang=a.use(),f.setLocale(u.lang),function(){function e(e){var t=o.search()[e];return t&&t.split(",").filter(function(e){return e}).map(function(e){return e.trim()})}var t=e("targetTabsOrder");u.targetTabsOrder=(t||u.options.targetTabsOrder).filter(function(e){return R[e]});var a=e("searchTabsOrder");u.searchTabsOrder=a||u.options.searchTabsOrder;var n=e("resultTabsOrder");u.resultTabsOrder=(n||u.options.resultTabsOrder).filter(function(e){return R[e]}),o.search().target?u.target=o.search().target:u.target||(u.target=u.targetTabsOrder[0])}(),T.help(u.targetTabsOrder,u.lang).then(function(e){u.facetedTaxonomies=e.getFacetedTaxonomies(),u.hasFacetedTaxonomies=e.getHasFacetedTaxonomies(),u.targetTabsOrder=e.getTabOrderTodisplay(),u.taxonomyNav=e.getTaxonomyNav()}),P()}]).controller("ResultTabsOrderCountController",[function(){}]),ngObibaMica.search.config(["$routeProvider",function(e){var t=["ngObibaMicaSearch",function(e){return e.getOptionsAsyn()}];e.when("/search",{templateUrl:"search/views/search-layout.html",controller:"SearchController",reloadOnSearch:!1,resolve:{options:t}}).when("/classifications",{templateUrl:"search/views/classifications.html",controller:"SearchController",reloadOnSearch:!1,resolve:{options:t}})}]),ngObibaMica.search.service("SearchControllerFacetHelperService",["MetaTaxonomyService","ngObibaMicaSearch",function(e,t){var i,s,a,n,o=e.getMetaTaxonomiesPromise(),r=t.getOptions();function l(){return o.then(function(e){n=!(a={}),e.vocabularies.reduce(function(e,t){var a=function a(e,t){return t.reduce(function(e,t){return Array.isArray(t.terms)?a(e,t.terms):(e.push(t),e)},e||[])}([],t.terms);return r.showAllFacetedTaxonomies?e[t.name]=a.filter(function(e){return e.attributes&&e.attributes.some(function(e){return"showFacetedNavigation"===e.key&&"true"===e.value.toString()})}):e[t.name]=(r[t.name+"TaxonomiesOrder"]||[]).map(function(t){return a.filter(function(e){return e.name===t})[0]}).filter(function(e){return null!=e}),n=n||e[t.name].length,e},a)})}function c(){return i}function u(){return a}function d(){return s}function m(){return n}this.help=function(e,t){return Promise.all([l(),(a=e,r=t,o.then(function(t){i=[],s=[],a.forEach(function(n){var e=t.vocabularies.filter(function(e){if(e.name===n)return s.push(n),!0}).pop();e&&e.terms&&e.terms.forEach(function(e){e.target=n;var t=e.title.filter(function(e){return e.locale===r})[0],a=e.description?e.description.filter(function(e){return e.locale===r})[0]:void 0;e.locale={title:t,description:a},e.terms&&e.terms.forEach(function(e){var t=e.title.filter(function(e){return e.locale===r})[0],a=e.description?e.description.filter(function(e){return e.locale===r})[0]:void 0;e.locale={title:t,description:a}}),i.push(e)})})}))]).then(function(){return{getTaxonomyNav:c,getFacetedTaxonomies:u,getTabOrderTodisplay:d,getHasFacetedTaxonomies:m}});var a,r}}]),ngObibaMica.search.filter("dceDescription",function(){return function(e){return e.split(":<p>").map(function(e){return"<p>"+e})[2]}}),ngObibaMica.search.filter("orderBySelection",function(){return function(e,t){if(!e)return[];var a=[],n=[];return e.forEach(function(e){t[e.key]?a.push(e):n.push(e)}),a.concat(n)}}),ngObibaMica.search.filter("regex",function(){return function(e,t,n,r){var a=[];try{var i=new RegExp(t,"i");a=e.filter(function(a){return n.some(function(e){var t=a[e];return angular.isArray(t)&&r?t.filter(function(e){return e.locale===r}).some(function(e){return i.test(e.text)}):i.test(t)})})}catch(e){}return a}}),ngObibaMica.search.filter("renderableTargets",["RqlQueryService",function(t){return function(e){return t.getRenderableTargetCriteria(e)}}]),ngObibaMica.search.STUDY_FILTER_CHOICES={ALL_STUDIES:"all",INDIVIDUAL_STUDIES:"individual",HARMONIZATION_STUDIES:"harmonization"},ngObibaMica.search.filter("visibleVocabularies",["VocabularyService",function(t){return function(e){return t.visibleVocabularies(e)}}]),ngObibaMica.search.SortVocabularyTerms=function(a){return function(e,t){return a.sortFilteredVocabularyTerms(t,e),e}},ngObibaMica.search.filter("sortTerms",["VocabularyService",ngObibaMica.search.SortVocabularyTerms]),function(){var n=["name","title","description","keywords"];function t(){var a={searchLayout:"layout2",taxonomyPanelOptions:{network:{taxonomies:{Mica_network:{trKey:"properties"}}},study:{taxonomies:{Mica_study:{trKey:"properties"}}},dataset:{taxonomies:{Mica_dataset:{trKey:"properties"}}},variable:{taxonomies:{Mica_variable:{trKey:"properties"}}},fieldsToFilter:n},obibaListOptions:{countCaption:!0,searchForm:!0,supplInfoDetails:!0,trimmedDescription:!0},targetTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],searchTabsOrder:[DISPLAY_TYPES.LIST,DISPLAY_TYPES.COVERAGE,DISPLAY_TYPES.GRAPHICS],resultTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],showAllFacetedTaxonomies:!0,showFacetTermsWithZeroCount:!1,showSearchBox:!0,showSearchBrowser:!0,showSearchRefreshButton:!1,variableTaxonomiesOrder:[],studyTaxonomiesOrder:[],datasetTaxonomiesOrder:[],networkTaxonomiesOrder:[],hideNavigate:[],hideSearch:["studyId","dceId","datasetId","networkId"],variables:{showSearchTab:!0,listPageSize:20,variablesColumn:{showVariablesTypeColumn:!0,showVariablesStudiesColumn:!0,showVariablesDatasetsColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0},showCart:!0},datasets:{showSearchTab:!0,listPageSize:20,showDatasetsSearchFilter:!0,datasetsColumn:{showDatasetsAcronymColumn:!0,showDatasetsTypeColumn:!0,showDatasetsNetworkColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0},fields:["acronym.*","name.*","variableType","studyTable.studyId","studyTable.project","studyTable.table","studyTable.populationId","studyTable.dataCollectionEventId","harmonizationTable.studyId","harmonizationTable.project","harmonizationTable.table","harmonizationTable.populationId"]},studies:{showSearchTab:!0,listPageSize:20,showStudiesSearchFilter:!0,studiesColumn:{showStudiesTypeColumn:!0,showStudiesDesignColumn:!0,showStudiesQuestionnaireColumn:!0,showStudiesPmColumn:!0,showStudiesBioColumn:!0,showStudiesOtherColumn:!0,showStudiesParticipantsColumn:!0,showStudiesNetworksColumn:!0,showStudiesStudyDatasetsColumn:!0,showStudiesHarmonizationDatasetsColumn:!0,showStudiesVariablesColumn:!1,showStudiesStudyVariablesColumn:!0,showStudiesDataschemaVariablesColumn:!0},fields:["acronym.*","name.*","model.methods.design","populations.dataCollectionEvents.model.dataSources","model.numberOfParticipants.participant"]},networks:{showSearchTab:!0,listPageSize:20,networksColumn:{showNetworksStudiesColumn:!0,showNetworksStudyDatasetColumn:!0,showNetworksHarmonizationDatasetColumn:!0,showNetworksVariablesColumn:!1,showNetworksStudyVariablesColumn:!0,showNetworksDataschemaVariablesColumn:!0},fields:["acronym.*","name.*","studyIds"]},coverage:{groupBy:{study:!0,dce:!0,dataset:!0}}};this.setOptions=function(e){var t;(a=angular.merge(a,e)).targetTabsOrder=e.targetTabsOrder||a.targetTabsOrder,a.searchTabsOrder=e.searchTabsOrder||a.searchTabsOrder,a.resultTabsOrder=e.resultTabsOrder||a.resultTabsOrder,a.variableTaxonomiesOrder=e.variableTaxonomiesOrder||a.variableTaxonomiesOrder,a.studyTaxonomiesOrder=e.studyTaxonomiesOrder||a.studyTaxonomiesOrder,a.datasetTaxonomiesOrder=e.datasetTaxonomiesOrder||a.datasetTaxonomiesOrder,a.networkTaxonomiesOrder=e.networkTaxonomiesOrder||a.networkTaxonomiesOrder,a.hideNavigate=e.hideNavigate||a.hideNavigate,a.hideSearch=e.hideSearch||a.hideSearch,a.studies.fields=e.studies&&e.studies.fields||a.studies.fields,a.networks.fields=e.networks&&e.networks.fields||a.networks.fields,a.datasets.fields=e.datasets&&e.datasets.fields||a.datasets.fields,e.taxonomyPanelOptions&&(a.taxonomyPanelOptions.fieldsToFilter=((t=e.taxonomyPanelOptions.fieldsToFilter)?t.filter(function(e){return-1<n.indexOf(e)}):null)||a.taxonomyPanelOptions.fieldsToFilter),e.studies&&e.studies.obibaListOptions&&(a.obibaListOptions.countCaption=0!==e.studies.obibaListOptions.studiesCountCaption||e.studies.obibaListOptions.studiesCountCaption,a.obibaListOptions.searchForm=0!==e.studies.obibaListOptions.studiesSearchForm||e.studies.obibaListOptions.studiesSearchForm,a.obibaListOptions.supplInfoDetails=0!==e.studies.obibaListOptions.studiesSupplInfoDetails||e.studies.obibaListOptions.studiesSupplInfoDetails,a.obibaListOptions.trimmedDescription=0!==e.studies.obibaListOptions.studiesTrimmedDescription||e.studies.obibaListOptions.studiesTrimmedDescription,a.searchLayout=e.searchLayout?e.searchLayout:a.searchLayout),function(){function e(e,t){var a=e.indexOf(t);return-1<a&&e.splice(a,1),e}a.coverage.groupBy.dce=a.coverage.groupBy.study&&a.coverage.groupBy.dce,0<Object.keys(a.coverage.groupBy).filter(function(e){return a.coverage.groupBy[e]}).length||e(a.searchTabsOrder,DISPLAY_TYPES.COVERAGE),a.networks.showSearchTab||(e(a.targetTabsOrder,QUERY_TARGETS.NETWORK),e(a.resultTabsOrder,QUERY_TARGETS.NETWORK)),a.studies.showSearchTab||(e(a.searchTabsOrder,DISPLAY_TYPES.GRAPHICS),e(a.targetTabsOrder,QUERY_TARGETS.STUDY),e(a.resultTabsOrder,QUERY_TARGETS.STUDY))}()},this.getOptions=function(){return angular.copy(a)}}function r(e,s,o,t){var l=e.defer(),c=!1;return{getOptionsAsyn:function(){return i=o.getOptions(),c?e.when(o.getOptions()):(t.get(function(e){var t=e.isNetworkEnabled&&!e.isSingleNetworkEnabled,a=!e.isSingleStudyEnabled||e.isHarmonizedDatasetEnabled,n=e.isCollectedDatasetEnabled||e.isHarmonizedDatasetEnabled,r={searchLayout:e.searchLayout,locale:e.languages||s.use(),showSearchRefreshButton:!0,networks:{showSearchTab:t},studies:{showSearchTab:a,studiesColumn:{showStudiesTypeColumn:e.isCollectedDatasetEnabled&&e.isHarmonizedDatasetEnabled,showStudiesNetworksColumn:t&&i.studies.studiesColumn.showStudiesNetworksColumn,showStudiesVariablesColumn:n&&i.studies.studiesColumn.showStudiesVariablesColumn,showStudiesStudyDatasetsColumn:!1!==(n&&e.isCollectedDatasetEnabled)&&i.studies.studiesColumn.showStudiesStudyDatasetsColumn,showStudiesStudyVariablesColumn:!1!==(n&&e.isCollectedDatasetEnabled)&&i.studies.studiesColumn.showStudiesStudyVariablesColumn,showStudiesHarmonizationDatasetsColumn:!1!==(n&&e.isHarmonizedDatasetEnabled)&&i.studies.studiesColumn.showStudiesHarmonizationDatasetsColumn,showStudiesDataschemaVariablesColumn:!1!==(n&&e.isHarmonizedDatasetEnabled)&&i.studies.studiesColumn.showStudiesDataschemaVariablesColumn}},datasets:{showSearchTab:n,datasetsColumn:{showDatasetsTypeColumn:e.isCollectedDatasetEnabled&&e.isHarmonizedDatasetEnabled,showDatasetsNetworkColumn:t&&i.datasets.datasetsColumn.showDatasetsNetworkColumn,showDatasetsStudiesColumn:a&&i.datasets.datasetsColumn.showDatasetsStudiesColumn,showDatasetsVariablesColumn:i.datasets.datasetsColumn.showDatasetsVariablesColumn}},variables:{showSearchTab:n,variablesColumn:{showVariablesTypeColumn:e.isCollectedDatasetEnabled&&e.isHarmonizedDatasetEnabled,showVariablesStudiesColumn:a}}};o.setOptions(r),l.resolve(o.getOptions()),c=!0}),l.promise);var i},getOptions:function(){return o.getOptions()},getDefaultListPageSize:function(e){var t=o.getOptions();switch(e){case QUERY_TARGETS.VARIABLE:return t.variables.listPageSize;case QUERY_TARGETS.DATASET:return t.datasets.listPageSize;case QUERY_TARGETS.STUDY:return t.studies.listPageSize;case QUERY_TARGETS.NETWORK:return t.networks.listPageSize}return 20}}}ngObibaMica.search.config(["$provide",function(e){e.provider("ngObibaMicaSearch",function(){var n=new t;this.initialize=function(e){n.setOptions(e)},this.$get=["$q","$translate","ObibaServerConfigResource",function(e,t,a){return new r(e,t,n,a)}]})}])}(),ngObibaMica.search.config(["$provide",function(e){e.provider("ngObibaMicaSearchTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({search:{header:null,footer:null},searchStudiesResultTable:{template:null},searchNetworksResultTable:{template:null},searchDatasetsResultTable:{template:null},searchCriteriaRegionTemplate:{template:null},vocabularyFilterDetailHeading:{template:null},CriterionDropdownTemplate:{template:null},searchResultList:{template:null},searchInputList:{template:null},searchResultCoverage:{template:null},searchResultGraphics:{template:null},classifications:{header:null,footer:null},searchCellStatValue:{template:null}}))}]),ngObibaMica.search.factory("DocumentSuggestionResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("DocumentSuggestion"),{},{query:{method:"GET",errorHandler:!0,isArray:!0}})}]);var CoverageGroupByService=function(){function e(e){this.options=e.getOptions(),this.groupByOptions=this.options.coverage.groupBy}return e.prototype.isSingleStudy=function(){return!this.options.studies.showSearchTab},e.prototype.canShowStudyType=function(){return this.options.studies.studiesColumn.showStudiesTypeColumn},e.prototype.canShowStudy=function(){return this.groupByOptions.study||this.groupByOptions.dce},e.prototype.canShowDce=function(e){return(-1<e.indexOf("study")||-1<e.indexOf("dce"))&&this.groupByOptions.study&&this.groupByOptions.dce},e.prototype.canShowDataset=function(){return this.groupByOptions.dataset},e.prototype.canShowVariableTypeFilter=function(e){var t=(-1<e.indexOf("study")||-1<e.indexOf("dce"))&&this.groupByOptions.study,a=-1<e.indexOf("dataset")&&this.groupByOptions.dataset;return t||a},e.prototype.studyTitle=function(){return"search.coverage-buckets.study"},e.prototype.studyBucket=function(){return BUCKET_TYPES.STUDY},e.prototype.dceBucket=function(){return this.groupByOptions.study&&this.groupByOptions.dce?BUCKET_TYPES.DCE:this.studyBucket()},e.prototype.datasetTitle=function(){return"search.coverage-buckets.dataset"},e.prototype.datasetBucket=function(){return BUCKET_TYPES.DATASET},e.prototype.canGroupBy=function(e){var t=!1;switch(e){case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.STUDY_HARMONIZATION:t=this.groupByOptions.study;break;case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:case BUCKET_TYPES.DCE_HARMONIZATION:t=this.groupByOptions.dce;break;case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET_HARMONIZED:t=this.groupByOptions.dataset}return t},e.prototype.defaultBucket=function(){return this.groupByOptions.study?this.options.studies.showSearchTab?this.studyBucket():this.dceBucket():this.groupByOptions.dataset?this.datasetBucket():""},e}();ngObibaMica.search.service("CoverageGroupByService",["ngObibaMicaSearch",CoverageGroupByService]),ngObibaMica.search.factory("CriteriaNodeCompileService",["$templateCache","$compile",function(r,i){return{compile:function(e,t,a){var n="";n=e.item.type===RQL_NODE.OR||e.item.type===RQL_NODE.AND||e.item.type===RQL_NODE.NAND||e.item.type===RQL_NODE.NOR?angular.element(r.get(a)):angular.element('<criterion-dropdown criterion="item" query="query"></criterion-dropdown>'),e.item.rqlQuery.args&&i(n)(e,function(e){t.replaceWith(e)})}}}]),ngObibaMica.search.service("EntitySuggestionRqlUtilityService",function(){function a(e){return e?e.args.filter(function(e){return e.name===RQL_NODE.FILTER}).pop():null}this.createMatchQuery=function(e,t){var a,n,r=null,i=e.trim();return i.length&&((r=new RqlQuery(RQL_NODE.MATCH)).args=(a=t,(n=[]).push([i]),Array.isArray(a)?n.push(a):a&&n.push([a]),n)),r},this.givenTargetQueryGetFilterQuery=a,this.givenFilterQueryGetMatchQuery=function(e){return e?e.args.filter(function(e){return e.name===RQL_NODE.MATCH}).pop():null},this.removeFilteredMatchQueryFromTargetQuery=function(e){var t=a(e);t&&(1===t.args.length&&t.args[0].name===RQL_NODE.MATCH?e.args=e.args.filter(function(e){return e.name!==RQL_NODE.FILTER}):t.args=t.args.filter(function(e){return e.name!==RQL_NODE.MATCH}))}}),ngObibaMica.search.service("EntitySuggestionService",["$rootScope","$location","$translate","DocumentSuggestionResource","RqlQueryService","EntitySuggestionRqlUtilityService","AlertService","ServerErrorUtils",function(i,s,r,o,l,c,u,d){function m(e,t){var n=new obiba.utils.NgObibaStringUtils,a=n.cleanDoubleQuotesLeftUnclosed(t);return a=n.cleanOrEscapeSpecialLuceneBrackets(a),a=n.cleanSpecialLuceneCharacters(a),e&&t&&1<a.length?o.query({locale:r.use(),documentType:e,query:a}).$promise.then(function(e){for(var t=Array.isArray(e)?e:[],a=0;a<t.length;a++)t[a]=n.quoteQuery(t[a].replace(/\/.*/,""));return t},function(e){u.alert({id:"SearchController",type:"danger",msg:d.buildMessage(e),delay:5e3})}):[]}this.getCurrentSuggestion=function(e,t){if(t){var a=l.findTargetQuery(e,t);if(a){var n=c.givenFilterQueryGetMatchQuery(c.givenTargetQueryGetFilterQuery(a));return n&&n.args?Array.isArray(n.args[0])&&1===n.args[0].length?n.args[0][0]:Array.isArray(n.args[0])&&1<n.args[0].length?n.args[0].join(","):n.args[0].length?n.args[0][0]:"":""}}return""},this.suggest=m,this.selectSuggestion=function(e,t,a){var n=new obiba.utils.NgObibaStringUtils,r=n.cleanDoubleQuotesLeftUnclosed(t);r=n.cleanOrEscapeSpecialLuceneBrackets(r),r=n.cleanSpecialLuceneCharacters(r),i.$new().$emit("ngObibaMicaSearch.searchSuggestion",r,e,a)},this.suggestForTargetQuery=function(e,t){var a=l.parseQuery(s.search().query),n=l.findTargetQuery(typeToTarget(e),a),r=l.findQueryInTargetByVocabulary(n,"className");return r&&(t="className:"+r.args[1]+" AND ("+t.replace(/\/.*/,"")+")"),m(e,t)}}]),ngObibaMica.search.factory("FullScreenService",["$document","$window","$rootScope",function(e,t,a){var n=e[0],r=void 0!==t.Element&&"ALLOW_KEYBOARD_INPUT"in t.Element&&t.Element.ALLOW_KEYBOARD_INPUT,i=a.$new(),s={$on:angular.bind(i,i.$on),enable:function(e){e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?/Version\/[\d]{1,2}(\.[\d]{1,2}){1}(\.(\d){1,2}){0,1} Safari/.test(t.navigator.userAgent)?e.webkitRequestFullscreen():e.webkitRequestFullscreen(r):e.msRequestFullscreen&&e.msRequestFullscreen()},cancel:function(){n.cancelFullScreen?n.cancelFullScreen():n.mozCancelFullScreen?n.mozCancelFullScreen():n.webkitExitFullscreen?n.webkitExitFullscreen():n.msExitFullscreen&&n.msExitFullscreen()},isEnabled:function(){return!!(n.fullscreenElement||n.mozFullScreenElement||n.webkitFullscreenElement||n.msFullscreenElement)}};return e.on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){i.$emit("ngObibaMicaSearch.fullscreenChange",s.isEnabled())}),s}]),ngObibaMica.search.service("MetaTaxonomyService",["$q","$translate","TaxonomyResource","ngObibaMicaSearch",function(e,t,a,n){var r=n.getOptions().taxonomyPanelOptions,i=new ngObibaMica.search.MetaTaxonomyParser(r);function s(){return a.get({target:QUERY_TARGETS.TAXONOMY,taxonomy:"Mica_taxonomy"}).$promise}this.getTaxonomyPanelOptions=function(){return r},this.getMetaTaxonomyForTargets=function(a){var n=e.defer();return s().then(function(e){var t=(e.vocabularies||[]).filter(function(e){return-1<a.indexOf(e.name)}).map(function(e){switch(e.name){case QUERY_TARGETS.VARIABLE:return i.parseVariableTaxonomies(e);case QUERY_TARGETS.NETWORK:case QUERY_TARGETS.STUDY:case QUERY_TARGETS.DATASET:return i.parseEntityTaxonomies(e)}});t.sort(function(e,t){return a.indexOf(e.name)-a.indexOf(t.name)}),n.resolve(t||[])}),n.promise},this.getMetaTaxonomiesPromise=s}]),ngObibaMica.search.service("ObibaSearchConfig",function(){var a={networks:{showSearchTab:1},studies:{showSearchTab:1},datasets:{showSearchTab:1},variables:{showSearchTab:1}};this.setOptions=function(t){"object"==typeof t&&Object.keys(t).forEach(function(e){e in a&&(a[e]=t[e])})},this.getOptions=function(){return angular.copy(a)}}),ngObibaMica.search.service("PageUrlService",["ngObibaMicaUrl","StringUtils","urlEncode",function(r,i,s){return this.studyPage=function(e,t){var a=(-1<t.toLowerCase().indexOf("individual")?"individual":"harmonization")+"-study";return e?i.replaceAll(r.getUrl("StudyPage"),{":type":s(a),":study":s(e)}):""},this.studyPopulationPage=function(e,t,a){var n=("individual"===t.toLowerCase()?"individual":"harmonization")+"-study";return e?i.replaceAll(r.getUrl("StudyPopulationsPage"),{":type":s(n),":study":s(e),":population":s(a)}):""},this.networkPage=function(e){return e?i.replaceAll(r.getUrl("NetworkPage"),{":network":s(e)}):""},this.datasetPage=function(e,t){var a=("collected"===t.toLowerCase()?"collected":"harmonized")+"-dataset";return e?i.replaceAll(r.getUrl("DatasetPage"),{":type":s(a),":dataset":s(e)}):""},this.variablePage=function(e){return e?i.replaceAll(r.getUrl("VariablePage"),{":variable":s(e)}):""},this.downloadList=function(e,t){return i.replaceAll(r.getUrl("JoinQuerySearchCsvResource"),{":type":e,":query":t})},this.downloadCoverage=function(e){return i.replaceAll(r.getUrl("JoinQueryCoverageDownloadResource"),{":query":e})},this.entitiesCountPage=function(e){var t=r.getUrl("BaseUrl")+r.getUrl("EntitiesCountBaseUrl");return e&&(t=t+"?query="+s(e)),t},this.searchPage=function(e){var t=r.getUrl("BaseUrl")+r.getUrl("SearchBaseUrl");return e&&(t=t+"?query="+s(e)),t},this}]),ngObibaMica.search.service("PaginationService",["ngObibaMicaSearch",function(n){var l={},c=Object.keys(QUERY_TARGETS).reduce(function(e,t){if(null===/TAXONOMY/.exec(t)){var a=QUERY_TARGETS[t];e[a]=new ngObibaMica.search.PaginationState(a,n.getDefaultListPageSize(a))}return e},{});this.registerListener=function(e,t){if(t){if(!t.onUpdate)throw new Error("PaginationService::registerListener() - listener must implement onUpdate()");l[e]=t}},this.update=function(e,t){var a,n=!1;for(a in c){var r=c[a],i=t[a+"TotalCount"].hits||0,s=e[a],o=r.totalHitsChanged(i);n=n||o,r.update(s,i)}for(a in c)l[a]&&l[a].onUpdate(c[a].data(),n)}}]);var QUERY_TYPES={NETWORKS:"networks",STUDIES:"studies",DATASETS:"datasets",VARIABLES:"variables"},QUERY_TARGETS={NETWORK:"network",STUDY:"study",DATASET:"dataset",VARIABLE:"variable",TAXONOMY:"taxonomy"},BUCKET_TYPES={NETWORK:"network",STUDY:"study",STUDY_INDIVIDUAL:"study-individual",STUDY_HARMONIZATION:"study-harmonization",DCE:"dce",DCE_INDIVIDUAL:"dce-individual",DCE_HARMONIZATION:"dce-harmonization",DATASET:"dataset",DATASET_COLLECTED:"dataset-collected",DATASET_HARMONIZED:"dataset-harmonized",DATASCHEMA:"dataschema"},RQL_NODE={VARIABLE:"variable",DATASET:"dataset",STUDY:"study",NETWORK:"network",LIMIT:"limit",SORT:"sort",AND:"and",NAND:"nand",OR:"or",NOR:"nor",NOT:"not",FACET:"facet",LOCALE:"locale",AGGREGATE:"aggregate",BUCKET:"bucket",FIELDS:"fields",FILTER:"filter",CONTAINS:"contains",IN:"in",OUT:"out",EQ:"eq",GT:"gt",GE:"ge",LT:"lt",LE:"le",BETWEEN:"between",MATCH:"match",EXISTS:"exists",MISSING:"missing"},SORT_FIELDS={ACRONYM:"acronym",NAME:"name",CONTAINER_ID:"containerId",POPULATION_WEIGHT:"populationWeight",DATA_COLLECTION_EVENT_WEIGHT:"dataCollectionEventWeight",POPULATION_ID:"populationId",DATASET_ID:"datasetId",VARIABLE_TYPE:"variableType",INDEX:"index",STUDY_TABLE:{POPULATION_WEIGHT:"studyTable.populationWeight",DATA_COLLECTION_EVENT_WEIGHT:"studyTable.dataCollectionEventWeight",STUDY_ID:"studyTable.studyId",POPULATION_ID:"studyTable.populationId"}};function targetToType(e){switch(e.toLocaleString()){case QUERY_TARGETS.NETWORK:return QUERY_TYPES.NETWORKS;case QUERY_TARGETS.STUDY:return QUERY_TYPES.STUDIES;case QUERY_TARGETS.DATASET:return QUERY_TYPES.DATASETS;case QUERY_TARGETS.VARIABLE:return QUERY_TYPES.VARIABLES}throw new Error("Invalid target: "+e)}function typeToTarget(e){switch(e.toLocaleString()){case QUERY_TYPES.NETWORKS:return QUERY_TARGETS.NETWORK;case QUERY_TYPES.STUDIES:return QUERY_TARGETS.STUDY;case QUERY_TYPES.DATASETS:return QUERY_TARGETS.DATASET;case QUERY_TYPES.VARIABLES:return QUERY_TARGETS.VARIABLE}throw new Error("Invalid type: "+e)}function CriteriaBuilder(t,a,n,r,i,s){this.newCriteriaItemBuilder=function(){return new CriteriaItemBuilder(r,i,s)},this.initialize=function(e){this.leafItemMap={},this.target=e,this.rootRql=t,this.taxonomies=n,this.LocalizedValues=r,this.lang=i,this.SetService=s,this.rootItem=this.newCriteriaItemBuilder().parent(a).type(this.target).rqlQuery(this.rootRql).target(this.target).build()},this.buildLeafItem=function(e,t,a,n,r){var i=new CriteriaItemBuilder(this.LocalizedValues,this.lang,this.SetService).type(n.name).target(this.target).taxonomy(e).vocabulary(t).rqlQuery(n).parent(r);return i.selectedTerms(a).build(),i.build()}}function CriteriaIdGenerator(){}function CriteriaItemBuilder(e,t,i){var a={type:null,rqlQuery:null,lang:t||"en",parent:null,children:[]},n=this;function r(e,t){var a=i.getCartSet(t);if(a){var n;if(e.vocabulary.terms){var r=e.vocabulary.terms.filter(function(e){return"cart"===e.name});0<r.length&&(n=r[0])}n||(n={title:[{locale:"en",text:"Cart"},{locale:"fr",text:"Panier"}]}),n.name=a.id,e.vocabulary.terms=[n]}else e.vocabulary.terms=[]}this.type=function(e){if(!RQL_NODE[e.toUpperCase()])throw new Error("Invalid node type:",e);return a.type=e,this},this.target=function(e){return a.target=e,this},this.parent=function(e){return a.parent=e,this},this.taxonomy=function(e){return a.taxonomy=e,this},this.vocabulary=function(e){if(a.vocabulary=e,"sets"===a.vocabulary.name)switch(a.taxonomy.name){case"Mica_variable":r(a,"variables");break;case"Mica_dataset":r(a,"datasets");break;case"Mica_study":r(a,"studies");break;case"Mica_network":r(a,"networks")}return this},this.term=function(e){return Array.isArray(e)?n.selectedTerms(e):(a.term=e,this)},this.rqlQuery=function(e){return a.rqlQuery=e,this},this.selectedTerm=function(e){return a.selectedTerms||(a.selectedTerms=[]),a.selectedTerms.push("string"==typeof e||"number"==typeof e?e:e.name),this},this.selectedTerms=function(e){return a.selectedTerms=e.filter(function(e){return e}).map(function(e){return"string"==typeof e||"number"==typeof e?e:e.name}),this},this.build=function(){return a.taxonomy&&a.vocabulary&&(a.term?(a.itemTitle=e.forLocale(a.term.title,a.lang),a.itemDescription=e.forLocale(a.term.description,a.lang),a.itemParentTitle=e.forLocale(a.vocabulary.title,a.lang),a.itemParentDescription=e.forLocale(a.vocabulary.description,a.lang),a.itemTitle||(a.itemTitle=a.term.name),a.itemParentTitle||(a.itemParentTitle=a.vocabulary.name)):(a.itemTitle=e.forLocale(a.vocabulary.title,a.lang),a.itemDescription=e.forLocale(a.vocabulary.description,a.lang),a.itemParentTitle=e.forLocale(a.taxonomy.title,a.lang),a.itemParentDescription=e.forLocale(a.taxonomy.description,a.lang),a.itemTitle||(a.itemTitle=a.vocabulary.name),a.itemParentTitle||(a.itemParentTitle=a.taxonomy.name)),a.id=CriteriaIdGenerator.generate(a.taxonomy,a.vocabulary,a.term)),new CriteriaItem(a)}}function CriteriaItem(t){var a=this;Object.keys(t).forEach(function(e){a[e]=t[e]})}function RepeatableCriteriaItem(){CriteriaItem.call(this,{}),this.list=[]}function BaseTaxonomiesController(e,i,t,s,a,n,r,o,l,c){i.options=r.getOptions(),i.RqlQueryUtils=o,i.metaTaxonomy=a.get({target:"taxonomy",taxonomy:"Mica_taxonomy"}),i.taxonomies={all:[],search:{text:null,active:!1},target:i.target||"variable",taxonomy:null,vocabulary:null},e.$on("$translateChangeSuccess",function(){i.taxonomies&&i.taxonomies.vocabulary&&c.sortVocabularyTerms(i.taxonomies.vocabulary,t.use())}),i.canNavigate=function(e){return!(-1<i.options.hideNavigate.indexOf(e.name))&&0===(e.attributes||[]).filter(function(e){return"showNavigate"===e.key}).length},this.navigateTaxonomy=function(e,t,a){if(i.taxonomies.term=a,i.isHistoryEnabled){var n=s.search();n.taxonomy=e?e.name:null,t&&n.vocabulary!==t.name?(c.sortVocabularyTerms(t,i.lang),n.vocabulary=t.name):n.vocabulary=null,s.search(n)}else i.taxonomies.taxonomy=e,i.taxonomies.vocabulary&&i.taxonomies.vocabulary.name===t.name||c.sortVocabularyTerms(t,i.lang),i.taxonomies.vocabulary=t},this.updateStateFromLocation=function(){var e=s.search(),t=e.taxonomy,a=e.vocabulary,n=null,r=null;i.taxonomies.all&&(i.taxonomies.all.forEach(function(e){e.name===t&&(n=e).vocabularies.forEach(function(e){e.name===a&&(r=e)})}),angular.equals(i.taxonomies.taxonomy,n)&&angular.equals(i.taxonomies.vocabulary,r)||(i.taxonomies.taxonomy=n,r&&c.sortVocabularyTerms(r,i.lang),i.taxonomies.vocabulary=r))},this.selectTerm=function(e,t,a,n){i.onSelectTerm(e,t,a,n)},this.clearCache=function(){var e=l.get("taxonomyResource");e&&e.removeAll()};var u=this;i.$on("$locationChangeSuccess",function(){i.isHistoryEnabled&&u.updateStateFromLocation()}),i.$watch("taxonomies.vocabulary",function(e){i.taxonomies.isMatchVocabulary=o&&e?(i.taxonomies.isNumericVocabulary=c.isNumericVocabulary(i.taxonomies.vocabulary),c.isMatchVocabulary(i.taxonomies.vocabulary)):i.taxonomies.isNumericVocabulary=null}),i.navigateTaxonomy=this.navigateTaxonomy,i.selectTerm=this.selectTerm,i.clearCache=this.clearCache}ngObibaMica.search.service("RqlQueryService",["$q","$log","TaxonomiesResource","TaxonomyResource","LocalizedValues","VocabularyService","RqlQueryUtils","ngObibaMicaSearch","SetService",function(l,t,n,s,u,d,m,p,o){var c={variable:null,dataset:null,study:null,network:null},g=this,h=p.getOptions();function f(t,e){return e.children.filter(function(e){return e.target===t}).pop()}function b(t,e){return e.args.filter(function(e){return e.name===t}).pop()}function a(e,t,a){if(!e)return null;var n={};return function t(a,n,r){return a.args.some(function(e){return null!==n.exec(e)?(r.parent=a,!0):e instanceof RqlQuery&&t(e,n,r)})}(e,new RegExp((t||"")+"\\."+a+"$"),n),n.parent}function r(e){switch(e){case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:return!0}return!1}function i(e){switch(e){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.MATCH:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0}return!1}function y(e){var t=e.parent,a=e.rqlQuery,n=a.args,r=e.parent.rqlQuery,i=r.args.indexOf(a),s=t.children.indexOf(e);if(-1===i||-1===s)throw new Error("Criteria node not found: "+e);t.children.splice(s,1),e.children.forEach(function(e){e.parent=t}),t.children.splice.apply(t.children,[s,0].concat(e.children)),r.args.splice(i,1),n&&(n instanceof Array?r.args.splice.apply(r.args,[i,0].concat(n)):r.args.splice(i,0,n)),null!==t.parent&&0===r.args.length&&y(t)}function v(e){var t=e.parent;if(!t)throw new Error("Cannot remove criteria when parent is NULL");var a=e.rqlQuery,n=e.parent.rqlQuery,r=n.args.indexOf(a);if(-1===r)throw new Error("Criteria node not found: "+e);n.args.splice(r,1),-1!==[RQL_NODE.OR,RQL_NODE.AND,RQL_NODE.NAND,RQL_NODE.NOR].indexOf(t.type)?function(e){var t=e.parent,a=e.rqlQuery,n=a.args,r=e.parent.rqlQuery,i=r.args.indexOf(a),s=t.children.indexOf(e);if(-1===i||-1===s)throw new Error("Criteria node not found: "+e);t.children.splice(s,1),e.children.forEach(function(e){e.parent=t}),t.children.splice.apply(t.children,[s,0].concat(e.children)),r.args.splice(i,1),n&&(n instanceof Array?r.args.splice.apply(r.args,[i,0].concat(n)):r.args.splice(i,0,n)),0===r.args.length&&y(t)}(t):0===n.args.length&&y(t)}function T(e){return(e||[]).filter(function(e){return function(e){if(e&&e.args){var t=e.args.filter(function(e){return i(e.name)||r(e.name)});return(1!==t.length||!m.isFreeTextMatch(t[0]))&&0<t.length}return!1}(e.rqlQuery)})}function S(e,t,a,n,r,i){var s=angular.copy(a),o=typeToTarget(t);m.addLocaleQuery(s,n);var l=b(o,s);if(l||(l=new RqlQuery(o),s.args.push(l)),m.getLimitQuery(l)||m.addLimit(l,m.limit(0,p.getDefaultListPageSize(o))),i){var c=function(e,t){switch(e){case DISPLAY_TYPES.LIST:switch(t){case QUERY_TARGETS.STUDY:return m.fields(h.studies.fields);case QUERY_TARGETS.VARIABLE:return m.fields(["attributes.label.*","variableType","datasetId","datasetAcronym"]);case QUERY_TARGETS.DATASET:return m.fields(h.datasets.fields);case QUERY_TARGETS.NETWORK:return m.fields(h.networks.fields)}}return null}(e,o);c&&m.addFields(l,c)}return r&&m.addSort(l,r),s}this.findItemNodeById=function(e,t,a,n){var r=t.split(".");return!!(e&&e.children&&a)&&e.children.some(function(e){return(n?t===e.id:e.id&&e.id.split(".").reduce(function(e,t){return e&&-1<r.indexOf(t)},!0))?(a.item=e,!0):g.findItemNodeById(e,t,a,n)})},this.findItemNode=function(e,t,a){return g.findItemNodeById(e,t.id,a)},this.getRenderableTargetCriteria=T,this.getRenderableTargetCriteriaFromRoot=function(e){return e?T(e.children):[]},this.parseQuery=function(e){try{return(new RqlParser).parse(e)}catch(e){t.error(e.message)}return new RqlQuery},this.removeCriteriaItem=function(e){i(e.type)?v(e):y(e)},this.createCriteriaItem=function(n,e,t,a,r){function i(e,t,a){return new CriteriaItemBuilder(u,r,o).target(n).taxonomy(e).vocabulary(t).term(a)}return angular.isString(e)?s.get({target:n,taxonomy:e}).$promise.then(function(e){return t=e.vocabularies.filter(function(e){return e.name===t||d.vocabularyAlias(e)===t})[0],a=t&&t.terms?t.terms.filter(function(e){return e.name===a})[0]:null,i(e,t,a).build()}):i(e,t,a).build()},this.addCriteriaItem=function(e,t,a){var n=e.args.filter(function(e){return t.target===e.name}).pop();n||(n=new RqlQuery(RQL_NODE[t.target.toUpperCase()]),e.args.push(n));var r=t.rqlQuery?t.rqlQuery:m.buildRqlQuery(t);return m.addQuery(n,r,a)},this.updateCriteriaItem=function(e,t,a){var n,r=e.isRepeatable(),i=!r&&e.rqlQuery.name===RQL_NODE.MATCH;function s(){(e=r?e.first():e).rqlQuery.name=RQL_NODE.EXISTS,e.rqlQuery.args.splice(1,1)}t.rqlQuery&&RQL_NODE.EXISTS===t.rqlQuery.name?s():(a&&t.rqlQuery&&(e.rqlQuery.name=t.rqlQuery.name),t.rqlQuery?n=t.rqlQuery.args[i?0:1]:t.term?n=[t.term.name]:s(),n&&(r?m.updateRepeatableQueryArgValues(e,n):m.updateQueryArgValues(e.rqlQuery,n,a)))},this.getTaxonomyByTarget=function(t){var a=l.defer(),e=c[t];return e?a.resolve(e):n.get({target:t}).$promise.then(function(e){c[t]=e,a.resolve(e)}),a.promise},this.builders=function(t,a,n,r){var i=l.defer();return g.getTaxonomyByTarget(t).then(function(){var e;(e=new CriteriaBuilder(a,n,c[t],u,r,o)).initialize(t),e.build(),i.resolve({root:e.getRootItem(),map:e.getLeafItemMap()})}),i.promise},this.createCriteria=function(e,t){var a=l.defer(),n=(new CriteriaItemBuilder).type(RQL_NODE.AND).rqlQuery(e).build(),r={};if(!m.hasTargetQuery(e))return a.resolve({root:n,map:r}),a.promise;var i=[],s=this,o=0;return e.args.forEach(function(e){QUERY_TARGETS[e.name.toUpperCase()]&&i.push(e)}),i.forEach(function(e){s.builders(e.name,e,n,t).then(function(e){n.children.push(e.root),r=angular.extend(r,e.map),++o===i.length&&a.resolve({root:n,map:r})})}),a.promise},this.prepareCriteriaTermsQuery=function(e,t,a){var n=this.parseQuery(e),r=n.args.filter(function(e){return e.name===t.target}).pop();if(r){var i=new RqlQuery(RQL_NODE.EXISTS),s=m.criteriaId(t.taxonomy,t.vocabulary);i.args.push(s),function e(t,a,n){if(!t||!t.args)return null;if((t.name===RQL_NODE.IN||t.name===RQL_NODE.MISSING||t.name===RQL_NODE.CONTAINS)&&t.args[0]===a)return t;for(var r=t.args.length;r--;)e(t.args[r],a,n)&&(t.args[r]=n)}(r,s,i),r.args.push(m.aggregate([s])),r.args.push(m.limit(0,0))}return n.args.push(new RqlQuery(RQL_NODE.FACET)),a&&m.addLocaleQuery(n,a),n.serializeArgs(n.args)},this.getTargetQuerySort=function(e,t){var a=b(typeToTarget(e),t),n=null;return a&&(n=a.args.filter(function(e){return e.name===RQL_NODE.SORT}).pop()),n},this.isOperator=r,this.isLeaf=i,this.getQueryPaginations=function(e){return e&&0!==e.args.length?e.args.reduce(function(e,t){if(function(e){switch(e){case RQL_NODE.VARIABLE:case RQL_NODE.DATASET:case RQL_NODE.NETWORK:case RQL_NODE.STUDY:return!0}return!1}(t.name)){var a=m.getLimitQuery(t);a&&(e[t.name]={from:a.args[0],size:a.args[1]})}return e},{}):{}},this.prepareQueryPagination=function(e,t,a,n){var r=b(t,e);r||(r=new RqlQuery(t),e.args.push(r)),m.addLimit(r,m.limit(a,n))},this.findCriteriaItemFromTreeById=function(e,t,a,n){var r=f(e,a),i={};return g.findItemNodeById(r,t,i,n)?i.item:null},this.findCriteriaItemFromTree=function(e,t){var a=f(e.target,t),n={};return g.findItemNode(a,e,n)?n.item:null},this.findTargetCriteria=f,this.findTargetQuery=b,this.findQueryInTargetByVocabulary=function(e,t){return a(e,null,t)},this.findQueryInTargetByTaxonomyVocabulary=a,this.prepareSearchQuery=function(e,t,a,n,r){return S(e,t,a,n,r,!0)},this.prepareSearchQueryNoFields=function(e,t,a,n,r){return S(e,t,a,n,r,!1)},this.prepareSearchQueryAndSerialize=function(e,t,a,n,r){return(new RqlQuery).serializeArgs(g.prepareSearchQuery(e,t,a,n,r).args)},this.prepareCoverageQuery=function(e,t){var a,n=this.parseQuery(e),r=new RqlQuery("aggregate"),i=t.split("-"),s=i[0],o=1<i.length?i[1]:void 0;switch(s){case BUCKET_TYPES.NETWORK:a="networkId";break;case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.STUDY_HARMONIZATION:a="studyId";break;case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:a="dceId";break;case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:case BUCKET_TYPES.DATASET_HARMONIZED:a="datasetId"}var l,c=new RqlQuery("bucket");if(c.args.push(a),r.args.push(c),n.args.forEach(function(e){l||"variable"!==e.name||(l=e)}),l||(l=new RqlQuery("variable"),n.args.push(l)),0<l.args.length&&"limit"!==l.args[0].name){var u=new RqlQuery("in");u.args.push("Mica_variable.variableType"),void 0===o?t===BUCKET_TYPES.DATASET_HARMONIZED||t===BUCKET_TYPES.DATASCHEMA?u.args.push("Dataschema"):u.args.push(["Collected","Dataschema"]):-1<["individual","collected"].indexOf(o)?u.args.push("Collected"):-1<["harmonization","harmonized"].indexOf(o)&&u.args.push("Dataschema");var d=new RqlQuery("and");d.args.push(u),d.args.push(l.args[0]),l.args[0]=d}return l.args.push(r),n.serializeArgs(n.args)},this.prepareGraphicsQuery=function(e,t,a){var n,r=this.parseQuery(e),i=new RqlQuery(RQL_NODE.AGGREGATE);if(t.forEach(function(e){i.args.push(e)}),a&&0<a.length){var s=new RqlQuery(RQL_NODE.BUCKET);a.forEach(function(e){s.args.push(e)}),i.args.push(s)}var o=!1,l=!1;return r.args.forEach(function(e){if("study"===e.name){l=!0;var a=null;o=e.args.filter(function(e,t){return"limit"===e.name&&(a=t),["limit","sort","aggregate"].indexOf(e.name)<0}).length,null!==a&&e.args.splice(a,1),n=e}}),l||(n=new RqlQuery("study"),r.args.push(n)),o||n.args.push(new RqlQuery(RQL_NODE.MATCH)),n.args.push(i),r.args.push(new RqlQuery("facet")),r.serializeArgs(r.args)},this.getTargetAggregations=function(e,t,i){function a(e,t){var a=t.terms;if(a&&0<a.length){var n=e&&e.map(function(e){return e.key})||[];if(e){var r=[];return a.forEach(function(e){0!==n.length&&-1!==n.indexOf(e.name)||r.push({count:0,default:0,description:u.forLocale(e.description,i),key:e.name,title:u.forLocale(e.title,i)})}),e.concat(r)}return a.map(function(e){return{count:0,default:0,description:u.forLocale(e.description,i),key:e.name,title:u.forLocale(e.title,i)}})}return e}function n(e,t){if(e.children){var a=e.children.filter(function(e){return e.hasOwnProperty(t)}).pop();if(a)return a[t]}return null}var r=d.vocabularyAlias(t.vocabulary),s=e[t.target+"ResultDto"];if(s&&s.aggs){var o=t.taxonomy.name.startsWith("Mica_"),l=o?r:t.taxonomy.name,c=s.aggs.filter(function(e){return e.aggregation===l}).pop();if(c){if(o)return d.isNumericVocabulary(t.vocabulary)?c["obiba.mica.StatsAggregationResultDto.stats"]:d.isRangeVocabulary(t.vocabulary)?a(c["obiba.mica.RangeAggregationResultDto.ranges"],t.vocabulary):a(c["obiba.mica.TermsAggregationResultDto.terms"],t.vocabulary);if(c.children.filter(function(e){return e.aggregation===r}).pop())return d.isRangeVocabulary(t.vocabulary)?a(n(c,"obiba.mica.RangeAggregationResultDto.ranges"),t.vocabulary):a(n(c,"obiba.mica.TermsAggregationResultDto.terms"),t.vocabulary)}}return a([],t.vocabulary)},this.findCriterion=function(e,t){return function e(t,a){var n;if(t.id===a)return t;for(var r=t.children.filter(function(e){return e instanceof CriteriaItem}),i=r.length;i--;)if(n=e(r[i],a))return n}(e,t)},this.cleanQuery=function(e){var t=angular.copy(e);if(t.args){angular.forEach(t.args,function(e){if(e.args)for(var t=e.args.length;t--;)"limit"!==e.args[t].name&&"sort"!==e.args[t].name&&"fields"!==e.args[t].name||e.args.splice(t,1)});for(var a=t.args.length;a--;)"locale"!==t.args[a].name&&t.args[a].args&&0!==t.args[a].args.length||t.args.splice(a,1)}return t}}]),ngObibaMica.search.service("RqlQueryUtils",["VocabularyService",function(a){function l(e,t){var a=new RqlQuery(RQL_NODE.OR);return a.args=[e,t],a}function c(e,t,a){var n=new RqlQuery(e);return n.args.push(t),a&&0<a.length&&n.args.push(a),n}function n(e,t){return c(t&&0<t.length?RQL_NODE.IN:RQL_NODE.EXISTS,e,t)}function r(e,t){var a=new RqlQuery(RQL_NODE.MATCH);return a.args.push(t||"*"),a.args.push(e),a}function u(e){return e.name===RQL_NODE.MATCH&&1===e.args.length}function i(e,t,a){var n=new RqlQuery(RQL_NODE.BETWEEN);return n.args.push(e),o(n,t,a),n}function s(e,t){return t&&0<t.length?e.args[1]=t:e.args.splice(1,1),e}function d(e,t,a){if(t&&0<t.length){var n=e.args[1];if(!n||a)e.args[1]=t;else{n instanceof Array||(n=[n]);var r=t.filter(function(e){return-1===n.indexOf(e)});e.args[1]=n.concat(r)}}else e.args.splice(1,1);return e}function o(e,t,a,n){n?(e.name=RQL_NODE.MISSING,e.args.splice(1,1)):angular.isDefined(t)&&null!==t&&angular.isDefined(a)&&null!==a?(e.name=RQL_NODE.BETWEEN,e.args[1]=[t,a]):angular.isDefined(t)&&null!==t?(e.name=RQL_NODE.GE,e.args[1]=t):angular.isDefined(a)&&null!==a?(e.name=RQL_NODE.LE,e.args[1]=a):(e.name=RQL_NODE.EXISTS,e.args.splice(1,1))}function m(e){return e&&e.args?e.args.filter(function(e){return e.name===RQL_NODE.LIMIT}).pop():null}function p(e,t){return e.name+"."+t.name}this.vocabularyTermNames=function(e){return e&&e.terms?e.terms.map(function(e){return e.name}):[]},this.hasTargetQuery=function(e,t){return 0<e.args.filter(function(e){switch(e.name){case RQL_NODE.VARIABLE:case RQL_NODE.DATASET:case RQL_NODE.STUDY:case RQL_NODE.NETWORK:return!t||t===e.name;default:return!1}}).length},this.variableQuery=function(){return new RqlQuery(QUERY_TARGETS.VARIABLE)},this.eqQuery=function(e,t){var a=new RqlQuery(RQL_NODE.EQ);return a.args.push(t),a},this.orQuery=l,this.aggregate=function(e){var t=new RqlQuery(RQL_NODE.AGGREGATE);return e.forEach(function(e){t.args.push(e)}),t},this.fields=function(e){var t=new RqlQuery(RQL_NODE.FIELDS);return t.args.push(e),t},this.limit=function(e,t){var a=new RqlQuery(RQL_NODE.LIMIT);return a.args.push(e),a.args.push(t),a},this.fieldQuery=c,this.inQuery=n,this.matchQuery=r,this.isFreeTextMatch=u,this.updateMatchQuery=function(e,t){return e.args[0]=t||"*",e},this.rangeQuery=i,this.updateQueryInternal=s,this.mergeInQueryArgValues=d,this.updateRangeQuery=o,this.buildRqlQuery=function(e){return a.isNumericVocabulary(e.vocabulary)?i(p(e.taxonomy,e.vocabulary),null,null):a.isMatchVocabulary(e.vocabulary)?r(p(e.taxonomy,e.vocabulary),null):(Array.isArray(e.selectedTerms)&&0<e.selectedTerms.length?t=e.selectedTerms:e.term&&(t=e.term.name),n(p(e.taxonomy,e.vocabulary),t));var t},this.addQuery=function(e,t,a){if(0===e.args.length)e.args.push(t);else{var n=(l=(o=e).args.filter(function(e){switch(e.name){case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:case RQL_NODE.NOT:case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0;case RQL_NODE.MATCH:return 1<e.args.length}return!1}).pop())?o.args.findIndex(function(e){return e.name===l.name}):-1;if(-1===n)e.args.push(t);else{var r=e.args.splice(n,1).pop();if(!a&&t.args&&0<t.args.length){var i="Mica_"+e.name;u(t)||(a=("match"===t.name?t.args[1]:t.args[0]).startsWith(i+".")?RQL_NODE.AND:RQL_NODE.OR)}var s=new RqlQuery(a||RQL_NODE.AND);s.args.push(r,t),e.args.push(s)}}var o,l;return e},this.updateRepeatableQueryArgValues=function(e,o){e.items().forEach(function(e){var t=e.rqlQuery;switch(t.name){case RQL_NODE.EXISTS:t.name=RQL_NODE.CONTAINS,d(t,o,!1);break;case RQL_NODE.CONTAINS:d(t,o,!1);break;case RQL_NODE.IN:var a=t.args[1]?[].concat(t.args[1]):[];if(1===a.length){t.name=RQL_NODE.CONTAINS,d(t,o,!1);break}var n,r=t.args[0],i=a.filter(function(e){return o.indexOf(e)<0}).map(function(e){return c(RQL_NODE.CONTAINS,r,[].concat(e,o))});if(1<i.length){var s=i.splice(0,2);n=l(s[0],s[1]),i.forEach(function(e){n=l(e,n)}),t.name=n.name,t.args=n.args}else t.name=RQL_NODE.CONTAINS,t.args=i[0].args}})},this.updateQueryArgValues=function(e,t,a){switch(e.name){case RQL_NODE.EXISTS:case RQL_NODE.MISSING:e.name=RQL_NODE.IN,d(e,t,a);break;case RQL_NODE.CONTAINS:case RQL_NODE.IN:d(e,t,a);break;case RQL_NODE.BETWEEN:case RQL_NODE.GE:case RQL_NODE.LE:e.args[1]=t;break;case RQL_NODE.MATCH:e.args[0]=t}},this.updateQuery=function(e,t){switch(e.name){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:s(e,t)}},this.addLocaleQuery=function(e,t){if(!e.args.filter(function(e){return e.name===RQL_NODE.LOCALE}).pop()){var a=new RqlQuery("locale");a.args.push(t),e.args.push(a)}},this.addFields=function(e,t){if(e&&e.args){var a=e.args.filter(function(e){return e.name===RQL_NODE.FIELDS}).pop();a?a.args=t.args:e.args.push(t)}},this.getLimitQuery=m,this.addLimit=function(e,t){if(e&&e.args){var a=m(e);a?a.args=t.args:e.args.push(t)}},this.addSort=function(e,t){var a=e.args.filter(function(e){return e.name===RQL_NODE.SORT}).pop();a||(a=new RqlQuery("sort"),e.args.push(a)),a.args=Array.isArray(t)?t:[t]},this.criteriaId=p}]),ngObibaMica.search.service("SearchContext",function(){var t=null;this.setLocale=function(e){t=e},this.currentLocale=function(){return t}}),ngObibaMica.search.service("StudyFilterShortcutService",["$location","RqlQueryService",function(l,c){function u(e){e=e||c.parseQuery(l.search().query);var t,a=c.findTargetQuery(QUERY_TARGETS.STUDY,e);return a&&(t=c.findQueryInTargetByVocabulary(a,"className")),t}function t(e,t){return!e||(Array.isArray(e.args[1])?-1<e.args[1].indexOf(t):e.args[1]===t)}function a(e){return t(e,"Study")}function n(e){return t(e,"HarmonizationStudy")}this.filter=function(e){var t,a=c.parseQuery(l.search().query),n=u(a);switch(n?(t=n).name===RQL_NODE.EXISTS&&(t.name=RQL_NODE.IN):t=new RqlQuery(RQL_NODE.IN),t.args=["Mica_study.className"],e){case ngObibaMica.search.STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:t.args.push("Study");break;case ngObibaMica.search.STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES:t.args.push("HarmonizationStudy");break;case ngObibaMica.search.STUDY_FILTER_CHOICES.ALL_STUDIES:t.args.push(["Study","HarmonizationStudy"])}if(!n){var r=c.findTargetQuery(QUERY_TARGETS.STUDY,a);if(r||(r=new RqlQuery(QUERY_TARGETS.STUDY),a.args.push(r)),0<r.args.length){var i=r.args.filter(function(e){return c.isLeaf(e.name)||c.isOperator(e.name)}).pop();if(i){var s=new RqlQuery(RQL_NODE.AND),o=r.args.indexOf(i);s.args.push(t,i),r.args[o]=s}else r.args.push(t)}else r.args=[t]}l.search("query",(new RqlQuery).serializeArgs(a.args))},this.getStudyClassNameChoices=function(){return{choseAll:(e=u(),!e||e.name===RQL_NODE.EXISTS||a(e)&&n(e)),choseIndividual:a(u()),choseHarmonization:n(u())};var e}}]),ngObibaMica.search.service("TaxonomyService",["$q","TaxonomiesResource","TaxonomyResource","VocabularyService",function(i,s,o,l){function c(e,t){return o.get({target:e,taxonomy:t}).$promise}this.findVocabularyInTaxonomy=function(e,t,a){var n=i.defer(),r=null;return o.get({target:e,taxonomy:t}).$promise.then(function(e){e.vocabularies.some(function(e){if(e.name===a||l.vocabularyAlias(e)===a)return r=e,!0}),n.resolve(r)}),n.promise},this.getTaxonomy=c,this.getTaxonomies=function(e,t){var a,n,r=i.defer();return Array.isArray(t)?(a=e,n=t,s.get({target:a,query:"taxonomyName:"+n.join(" OR taxonomyName:")}).$promise).then(function(e){var a;e.forEach(function(e){e.vocabularies=l.visibleVocabularies(e.vocabularies)}),a=t,e.sort(function(e,t){return a.indexOf(e.name)-a.indexOf(t.name)}),r.resolve(e)}):c(e,t).then(function(e){e.vocabularies=l.visibleVocabularies(e.vocabularies),r.resolve(e)}),r.promise}}]),ngObibaMica.search.service("VocabularyService",["$translate","LocalizedValues","MetaTaxonomyService",function(s,o,n){var t={STRING:"string",INTEGER:"integer",DECIMAL:"decimal"};function l(e){return e.normalize("NFD").replace(/\//g," ").replace(/[^\w|^\s|^-]/g,"")}function a(e){if(!e)return!1;var t=e.attributes?e.attributes.filter(function(e){return"hidden"===e.key}).pop():null;return!t||"false"===t.value}function r(e){if(!e||!e.attributes)return!1;var t=e.attributes.filter(function(e){return-1<["hidden","facet"].indexOf(e.key)}).reduce(function(e,t){return e[t.key]=t.value,e},{});return"true"===t.facet&&(!t.hidden||"false"===t.hidden)}function c(e,t,a){var n=a;return e.attributes&&e.attributes.some(function(e){return e.key===t&&(n=e.value,!0)}),n}function i(e){return c(e,"type",t.STRING)}function u(e,t,r){var i=c(e,"termsSortKey",null);if(i&&t&&0<t.length)switch(i){case"name":t.sort(function(e,t){return e[i].localeCompare(t[i])});break;case"title":t.sort(function(e,t){var a=o.forLocale(e[i],r),n=o.forLocale(t[i],r);return a.localeCompare(n)})}}return this.filter=function(e,t){if(t){var r=l(t).toLowerCase().split(" ").filter(function(e){return 1<e.length}),a=Array.isArray(e)?e:e.vocabularies,i=n.getTaxonomyPanelOptions().fieldsToFilter;return(a||[]).filter(function(e){return e.filteredTerms=(e.terms||[]).filter(function(n){var a=l(i.reduce(function(e,t){return e+" "+(a=n[t],o.forLocale(a,s.use()));var a},i[0])).trim().toLowerCase();return r.map(function(e){if(e.startsWith("-")){var t=e.substr(1);return t.length<=1||-1===a.indexOf(t)}return 0<=a.indexOf(e)}).reduce(function(e,t){return e&&t},!0)}),!e.terms||0<e.filteredTerms.length})}},this.isVisibleVocabulary=a,this.findVocabularyAttributes=function(e,t){return(e.attributes||[]).filter(function(e){return-1<e.key.search(t)}).reduce(function(e,t){return e[t.key]=t.value,e},{})},this.visibleVocabularies=function(e){return(e||[]).filter(a)},this.visibleFacetVocabularies=function(e){return(e||[]).filter(r)},this.isRangeVocabulary=function(e){return e.terms&&(i(e)===t.INTEGER||i(e)===t.DECIMAL)},this.isTermsVocabulary=function(e){return i(e)===t.STRING&&e.terms},this.isMatchVocabulary=function(e){return i(e)===t.STRING&&!e.terms},this.isNumericVocabulary=function(e){return!e.terms&&(i(e)===t.INTEGER||i(e)===t.DECIMAL)},this.isFacettedVocabulary=function(e){return"true"===c(e,"facet","false")},this.sortVocabularyTerms=function(e,t){u(e,e.terms,t||s.$use())},this.sortFilteredVocabularyTerms=u,this.vocabularyAlias=function(e){return c(e,"alias",e.name)},this.vocabularyField=function(e){return c(e,"field",e.name)},this}]),CriteriaBuilder.prototype.fieldToVocabulary=function(e){var t={taxonomy:null,vocabulary:null},a=e;e.indexOf(".")<0&&(a="Mica_"+this.target+"."+e);var n=a.split(".",2),r=n[0],i=n[1],s=this.taxonomies.filter(function(e){return r===e.name});if(0===s.length)throw new Error("Could not find taxonomy:",r);t.taxonomy=s[0];var o=t.taxonomy.vocabularies.filter(function(e){return i===e.name});if(0===o.length)throw new Error("Could not find vocabulary:",i);return t.vocabulary=o[0],t},CriteriaBuilder.prototype.visitLeaf=function(e,t){var a=RQL_NODE.MATCH===e.name,n=e.args[a?1:0],r=e.args[a?0:1],i=this.fieldToVocabulary(n),s=this.buildLeafItem(i.taxonomy,i.vocabulary,r instanceof Array?r:[r],e,t),o=this.leafItemMap[s.id];o?o.isRepeatable()?o.addItem(s):(console.error("Non-repeatable criteria items must be unique,",o.id,"will be overwritten."),o=s):o=s.vocabulary.repeatable?(new RepeatableCriteriaItem).addItem(s):s,this.leafItemMap[s.id]=o,t.children.push(s)},CriteriaBuilder.prototype.getRootItem=function(){return this.rootItem},CriteriaBuilder.prototype.getLeafItemMap=function(){return this.leafItemMap},CriteriaBuilder.prototype.visitCondition=function(e,t){var a=this.newCriteriaItemBuilder().parent(t).rqlQuery(e).type(e.name).build();t.children.push(a),this.visit(e.args[0],a),this.visit(e.args[1],a)},CriteriaBuilder.prototype.visitNot=function(e,t){var a=this.newCriteriaItemBuilder().parent(t).rqlQuery(e).type(e.name).build();t.children.push(a),this.visit(e.args[0],a)},CriteriaBuilder.prototype.visit=function(e,t){switch(e.name){case RQL_NODE.NOT:this.visitNot(e,t);break;case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:this.visitCondition(e,t);break;case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.LE:case RQL_NODE.LT:case RQL_NODE.GE:case RQL_NODE.GT:case RQL_NODE.BETWEEN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:case RQL_NODE.MATCH:this.visitLeaf(e,t);break;case RQL_NODE.FILTER:}},CriteriaBuilder.prototype.build=function(){var t=this;this.rootRql.args.forEach(function(e){t.visit(e,t.rootItem)})},CriteriaIdGenerator.generate=function(e,t,a){return e&&t?e.name+"."+t.name+(a?"."+a.name:""):void 0},CriteriaItem.prototype.isRepeatable=function(){return!1},CriteriaItem.prototype.getTarget=function(){return this.target||null},CriteriaItem.prototype.getRangeTerms=function(){var e={from:null,to:null};return this.type===RQL_NODE.BETWEEN?(e.from=this.selectedTerms[0],e.to=this.selectedTerms[1]):this.type===RQL_NODE.GE?(e.from=this.selectedTerms[0],e.to=null):this.type===RQL_NODE.LE&&(e.from=null,e.to=this.selectedTerms[0]),e},function(){function o(){}o.reduce=function(e,t){if(e.type===RQL_NODE.OR){var a=e.parent,n=a.children.indexOf(e);a.children[n]=t;var r=e.rqlQuery,i=a.rqlQuery,s=i.args.indexOf(r);i.args[s]=t.rqlQuery,a.type!==QUERY_TARGETS.VARIABLE&&o.reduce(a,t)}else t.type!==RQL_NODE.VARIABLE&&e.type===RQL_NODE.AND&&o.reduce(e.parent,e)},ngObibaMica.search.CriteriaReducer=o}(),RepeatableCriteriaItem.prototype=Object.create(CriteriaItem.prototype),RepeatableCriteriaItem.prototype.isRepeatable=function(){return!0},RepeatableCriteriaItem.prototype.addItem=function(e){return this.list.push(e),this},RepeatableCriteriaItem.prototype.items=function(){return this.list},RepeatableCriteriaItem.prototype.first=function(){return this.list[0]},RepeatableCriteriaItem.prototype.getTarget=function(){return 0<this.list.length?this.list[0].getTarget():null},function(){var a=[{label:"10",value:10},{label:"20",value:20},{label:"50",value:50},{label:"100",value:100}];ngObibaMica.search.PaginationState=function(e,t){this.target=e,this.initialPageSize=t,this.currentPage=1,this.from=0,this.to=0,this.selected=this.findPageSize(t),this.totalHits=null,this.pageCount=0,this.maxSize=3},ngObibaMica.search.PaginationState.prototype.updateRange=function(){var e=this.selected.value,t=this.currentPage;this.from=e*(t-1)+1,this.to=Math.min(this.totalHits,e*t)},ngObibaMica.search.PaginationState.prototype.initializeCurrentPage=function(e){e&&e.hasOwnProperty("from")?(this.selected=this.findPageSize(e.size),this.currentPage=1+e.from/this.selected.value):(this.selected=this.findPageSize(this.initialPageSize),this.currentPage=1)},ngObibaMica.search.PaginationState.prototype.update=function(e,t){this.totalHits=t||null,this.initializeCurrentPage(e),this.updateRange(),this.updatePageCount(),this.updateMaxSize()},ngObibaMica.search.PaginationState.prototype.findPageSize=function(t){var e=a.filter(function(e){return e.value===t}).pop();return e||a[0]},ngObibaMica.search.PaginationState.prototype.totalHitsChanged=function(e){return null!==this.totalHits&&this.totalHits!==e},ngObibaMica.search.PaginationState.prototype.updatePageCount=function(){this.pageCount=Math.ceil(this.totalHits/this.selected.value)},ngObibaMica.search.PaginationState.prototype.updateMaxSize=function(){this.maxSize=Math.min(3,this.pageCount)},ngObibaMica.search.PaginationState.prototype.data=function(){return{target:this.target,initialPageSize:this.initialPageSize,currentPage:this.currentPage,from:this.from,to:this.to,selected:this.selected,totalHits:this.totalHits,maxSize:this.maxSize,pageCount:this.pageCount,pageSizes:a}}}(),function(){function i(e){var t=0;if(e.attributes){var a=e.attributes.filter(function(e){return"weight"===e.key})[0];t=a&&parseInt(a.value)||0}return t}ngObibaMica.search.MetaTaxonomyParser=function(e){this.config=e,this.parseTerms=function(r,e){return e.map(function(e,t){var a={state:new ngObibaMica.search.PanelTaxonomyState(t+""),info:{name:e.name||"",title:e.title||"",description:e.description||"",weight:i(e)},taxonomies:[e]},n=r.taxonomies[e.name];return n&&n.hasOwnProperty("trKey")&&(a.info.trKey=n.trKey),a})},this.createResultObject=function(e,t){return{name:e.name,title:e.title,taxonomies:t}},this.sortTaxonomies=function(e){e.sort(function(e,t){return e.info.weight-t.info.weight})}},ngObibaMica.search.MetaTaxonomyParser.prototype.parseEntityTaxonomies=function(e){return this.createResultObject(e,this.parseTerms(this.config[e.name],e.terms||[]))},ngObibaMica.search.MetaTaxonomyParser.prototype.parseVariableTaxonomies=function(e){var t=e.terms.filter(function(e){return-1<["Variable_chars","Scales"].indexOf(e.name)}).reduce(function(e,t){return e[(new obiba.utils.NgObibaStringUtils).camelize(t.name)]=t,e},{}),a=this.parseTerms(this.config[QUERY_TARGETS.VARIABLE],t.variableChars.terms),n=t.scales;return n&&n.terms&&a.push({state:new ngObibaMica.search.PanelTaxonomyState,info:{name:n.name,names:n.terms.map(function(e){return e.name}),title:n.title,description:n.description||"",weight:i(n)},taxonomies:n.terms}),this.sortTaxonomies(a),this.createResultObject(e,a)}}(),ngObibaMica.search.PanelTaxonomyState=function(e){var t={NONE:0,ACTIVE:1,LOADING:2};this.id=e,this.STATES=t,this.state=t.NONE},ngObibaMica.search.PanelTaxonomyState.prototype.isLoading=function(){return this.STATES.LOADING===(this.state&this.STATES.LOADING)},ngObibaMica.search.PanelTaxonomyState.prototype.isActive=function(){return this.STATES.ACTIVE===(this.state&this.STATES.ACTIVE)},ngObibaMica.search.PanelTaxonomyState.prototype.active=function(){this.state=this.state|this.STATES.ACTIVE},ngObibaMica.search.PanelTaxonomyState.prototype.inactive=function(){this.state=this.state&~this.STATES.ACTIVE},ngObibaMica.search.PanelTaxonomyState.prototype.loading=function(){this.state=this.state|this.STATES.LOADING},ngObibaMica.search.PanelTaxonomyState.prototype.loaded=function(){this.state=this.state&~this.STATES.LOADING},ngObibaMica.search.PanelTaxonomyState.prototype.none=function(){this.state=this.STATES.NONE},ngObibaMica.search.component("entityCounts",{transclude:!0,bindings:{result:"<",target:"<",onSelectType:"&",resultTabsOrder:"<",taxonomyTypeMap:"<"},templateUrl:"search/components/entity-counts/component.html",controller:[function(){var t=this;t.getTotalHits=function(e){return t.result&&t.result[e+"TotalCount"]?t.result[e+"TotalCount"].hits:""},t.selectType=function(e){t.onSelectType({type:targetToType(e)})}}]}),ngObibaMica.search.component("entitySearchTypeahead",{bindings:{target:"<",entityType:"<",rqlQuery:"<",withSpecificFields:"@",placeholderText:"@",showButton:"@"},templateUrl:"search/components/entity-search-typeahead/component.html",controller:["EntitySuggestionService",function(t){var a=this;function n(e){t.selectSuggestion(a.target,e,"true"===a.withSpecificFields)}a.model="",a.suggest=function(e){return t.suggest(a.entityType,e)},a.select=n,a.clear=function(){n(a.model="")},a.onKeyUp=function(e){13===e.keyCode&&n(a.model)},a.$onChanges=function(e){e.rqlQuery.currentValue&&(a.model=t.getCurrentSuggestion(a.target,a.rqlQuery)||"")}}]}),ngObibaMica.search.directive("fullscreen",["FullScreenService",function(n){return{link:function(e,a,t){t.fullscreen&&e.$watch(t.fullscreen,function(e){var t=n.isEnabled();e&&!t?(n.enable(a[0]),a.addClass("isInFullScreen")):!e&&t&&(n.cancel(),a.removeClass("isInFullScreen"))})}}}]),ngObibaMica.search.directive("includeReplace",function(){return{require:"ngInclude",link:function(e,t){t.replaceWith(t.children())}}}),ngObibaMica.search.component("inputSearchFilter",{transclude:!0,bindings:{taxonomiesQuery:"<",taxonomyName:"<",queryString:"<",onFilterChange:"&"},templateUrl:"search/components/input-search-filter/component.html",controller:[function(){var a=this;function e(){a.onFilterChange({queryString:a.queryString})}a.$onChanges=function(e){if(e.taxonomyName){var t=!1;a.taxonomiesQuery.forEach(function(e){e.name===a.taxonomyName&&e.queryString&&(a.queryString=e.queryString,t=!0)}),t||(a.queryString="")}},a.change=e,a.clear=function(){a.queryString="",e()}}]}),ngObibaMica.search.directive("scrollToTop",function(){return{restrict:"A",scope:{trigger:"=scrollToTop"},link:function(e,t){e.$watch("trigger",function(){t[0].scrollTop=0})}}}),ngObibaMica.search.component("searchBoxRegion",{bindings:{targets:"<",options:"<",alertId:"@",lang:"<",taxonomyNav:"<",onSelectCriteria:"&",onGotoClassifications:"&",onSelectTerm:"&"},templateUrl:"search/components/search-box-region/component.html",controller:["$translate","VocabularyService","RqlQueryService","AlertService","StringUtils","LocaleStringUtils","ServerErrorUtils","TaxonomiesSearchResource",function(n,d,m,t,e,a,r,i){var p=this;function g(e,t){return!(-1<(t||[]).indexOf(e.name))&&0===(e.attributes||[]).filter(function(e){return"showSearch"===e.key}).length}function h(e,t){var a=0,n=new RegExp(e,"ig");return t.itemTitle.match(n)?a=10:t.itemDescription&&t.itemDescription.match(n)?a=8:t.itemParentTitle.match(n)?a=6:t.itemParentDescription&&t.itemParentDescription.match(n)&&(a=4),a}p.selectedCriteria=null,p.target=null,p.documents={search:{text:null,active:!1,target:null}},p.selectCriteria=function(e){p.onSelectCriteria({item:e}),p.selectedCriteria=null},p.searchCriteria=function(u){return i.get({query:e.quoteQuery(u.replace(/\/.*/g,"")),locale:p.lang,target:p.documents.search.target}).$promise.then(function(e){if(e){var l=[],c=0;if(e.forEach(function(e){var n,t,r,i,s,o,a=(n=u,r=[],i=0,s=(t=e).target,(o=t.taxonomy).vocabularies&&o.vocabularies.filter(function(e){return d.isVisibleVocabulary(e)&&g(e,p.hideSearch)}).forEach(function(a){if(a.terms)a.terms.filter(function(e){return g(e,p.hideSearch)}).forEach(function(e){var t=m.createCriteriaItem(s,o,a,e,p.lang);r.push({score:h(n,t),item:t}),i++});else{var e=m.createCriteriaItem(s,o,a,null,p.lang);r.push({score:h(n,e),item:e}),i++}}),{results:r,total:i});l.push.apply(l,a.results),c+=a.total}),l.sort(function(e,t){return t.score-e.score}),l=l.splice(0,10),c>l.length){var t={query:u,total:c,size:10,message:a.translate("search.showing",[10,c]),status:"has-warning"};l.push({score:-1,item:t})}return l.map(function(e){return e.item})}return[]},function(e){t.alert({id:p.alertId,type:"danger",msg:r.buildMessage(e),delay:5e3})})},p.selectSearchTarget=function(e){p.documents.search.target=e},p.clearTaxonomy=function(){p.target=null,p.taxonomyName=null},p.showTaxonomy=function(e,t){p.target===e&&p.taxonomyName===t&&p.taxonomiesShown?p.taxonomiesShown=!1:(p.taxonomiesShown=!0,p.target=e,p.taxonomyName=t)},p.translateTaxonomyNav=function(e,t){var a=e[t]&&e[t].filter(function(e){return e.locale===n.use()}).pop();return a?a.text:t},p.goToClassifications=function(){p.onGotoClassifications({})},p.selectTerm=function(e,t,a,n){p.onSelectTerm({target:e,taxonomy:t,vocabulary:a,args:n})}}]}),ngObibaMica.search.directive("studyFilterShortcut",["$location","$translate","RqlQueryService","StudyFilterShortcutService",function(e,a,t,n){return{restrict:"EA",replace:!0,templateUrl:"search/components/study-filter-shortcut/component.html",link:function(t){function e(){var e=n.getStudyClassNameChoices();e.choseAll?t.studyFilterSelection._selection=ngObibaMica.search.STUDY_FILTER_CHOICES.ALL_STUDIES:e.choseIndividual?t.studyFilterSelection._selection=ngObibaMica.search.STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:e.choseHarmonization&&(t.studyFilterSelection._selection=ngObibaMica.search.STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES)}t.studyFilterSelection={get selection(){return this._selection},set selection(e){var t;this._selection=e,t=e,n.filter(t,a.use())}},t.$on("$locationChangeSuccess",function(){e()}),e()}}}]),ngObibaMica.search.component("vocabularyFilterDetailHeading",{transclude:!0,bindings:{showTaxonomyPanel:"<",taxonomyName:"<",taxonomiesQuery:"<",clearQuery:"<",onFilterChange:"&",taxonomyTypeMap:"<",resultTabsOrder:"<",target:"<",onSelectType:"&",result:"<",togglePannel:"&"},templateUrl:["ngObibaMicaSearchTemplateUrl",function(e){return e.getTemplateUrl("vocabularyFilterDetailHeading")}],controller:[function(){var t=this,r=document.querySelectorAll("body")[0];function a(a,e){var n=null!==a.target.closest("#back-to-top"),t=r.querySelectorAll(".overlay-front-on-box-shodow");t.forEach(function(e){var t;n=n||(t=e.getBoundingClientRect(),a.clientX>t.x&&a.clientX<t.x+t.width&&a.clientY>t.y&&a.clientY<t.y+t.height)}),t&&!n&&(a.preventDefault(),e&&e())}function n(){r.onkeyup=null,r.onmouseup=null}t.selectType=function(e){return t.onSelectType({type:e})},t.filterChange=function(e){return t.onFilterChange({queryString:e})},t.$onDestroy=function(){n()},r.onmouseup=function(e){a(e,t.togglePannel)},r.onkeyup=function(e){27===e.keyCode&&(n(),t.togglePannel())}}]}),ngObibaMica.search.factory("JoinQueryCoverageResource",["$resource","ngObibaMicaUrl",function(e,t){var a=t.getUrl("JoinQueryCoverageResource"),n=-1===a.indexOf(":query")?"POST":"GET";return e(a,{},{get:{method:n,headers:{"Content-Type":"POST"===n?"application/x-www-form-urlencoded":"application/json"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},errorHandler:!0}})}]),ngObibaMica.search.factory("JoinQuerySearchResource",["$resource","ngObibaMicaUrl",function(e,t){var a=t.getUrl("JoinQuerySearchResource"),n=function(e){var t=-1===a.indexOf(":query")?"POST":"GET";return{method:t,headers:{"Content-Type":"POST"===t?"application/x-www-form-urlencoded":"application/json"},errorHandler:!0,params:{type:e},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}}};return e(a,{},{variables:n("variables"),studies:n("studies"),networks:n("networks"),datasets:n("datasets")})}]),ngObibaMica.search.factory("TaxonomiesResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(e,t,a){return e(t.getUrl("TaxonomiesResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0,cache:a("taxonomiesResource")}})}]),ngObibaMica.search.factory("TaxonomiesSearchResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("TaxonomiesSearchResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}]),ngObibaMica.search.factory("TaxonomyResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(e,t,a){return e(t.getUrl("TaxonomyResource"),{},{get:{method:"GET",errorHandler:!0,cache:a("taxonomyResource")}})}]),ngObibaMica.search.factory("VocabularyResource",["$resource","ngObibaMicaUrl",function(e,t){return e(t.getUrl("VocabularyResource"),{},{get:{method:"GET",errorHandler:!0}})}]);var CRITERIA_ITEM_EVENT={deleted:"event:delete-criteria-item",refresh:"event:refresh-criteria-item"};ngObibaMica.search.directive("criteriaRoot",function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"=",onRemove:"=",onRefresh:"=",isFacetted:"="},templateUrl:"search/components/criteria/criteria-root/component.html",link:function(a){a.$on(CRITERIA_ITEM_EVENT.deleted,function(e,t){a.onRemove(t)}),a.$on(CRITERIA_ITEM_EVENT.refresh,function(){a.onRefresh()})}}}),ngObibaMica.search.directive("criteriaTarget",function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},templateUrl:"search/components/criteria/criteria-target/component.html"}}),ngObibaMica.search.component("matchVocabularyFilterDetail",{transclude:!0,bindings:{vocabulary:"<",onSelectArgs:"&"},templateUrl:"search/components/criteria/match-vocabulary-filter-detail/component.html",controller:[function(){var a=this;a.enterText=function(e){var t={text:(new obiba.utils.NgObibaStringUtils).cleanDoubleQuotesLeftUnclosed(e.target.value)||"*"};13===e.keyCode&&a.onSelectArgs({vocabulary:a.vocabulary,args:t})}}]}),ngObibaMica.search.component("numericVocabularyFilterDetail",{transclude:!0,bindings:{vocabulary:"<",onSelectArgs:"&"},templateUrl:"search/components/criteria/numeric-vocabulary-filter-detail/component.html",controller:[function(){var r=this;r.setRangeValue=function(e){var t=e.target[0].value,a=e.target[1].value,n={};t&&(n.from=parseInt(t,10)),a&&(n.to=parseInt(a,10)),r.onSelectArgs({vocabulary:r.vocabulary,args:n})}}]});var TermsVocabularyFilterDetailController=function(){function e(){this.constantLimitNumber=12,this.limitNumber=this.constantLimitNumber}return e.prototype.clickCheckbox=function(e){var t={term:e};this.onSelectArgs({vocabulary:this.vocabulary,args:t})},e}(),TermsVocabularyFilterDetailComponent=function(){this.transclude=!0,this.bindings={onSelectArgs:"&",vocabulary:"<"},this.controller=TermsVocabularyFilterDetailController,this.controllerAs="$ctrl",this.templateUrl="search/components/criteria/terms-vocabulary-filter-detail/component.html"};ngObibaMica.search.component("termsVocabularyFilterDetail",new TermsVocabularyFilterDetailComponent),ngObibaMica.search.controller("MatchVocabularyFacetController",["$scope","RqlQueryService",function(n,r){function i(e,t){var a=r.findCriterion(e,CriteriaIdGenerator.generate(n.$parent.taxonomy,t));a&&a.rqlQuery&&a.rqlQuery.args[1]?n.text=a.rqlQuery.args[0]:n.text=null}n.onKeypress=function(e){13!==e.keyCode&&"click"!==e.type||n.$parent.selectTerm(n.$parent.target,n.$parent.taxonomy,n.vocabulary,{text:n.text||"*"})},n.$on("ngObibaMicaQueryUpdated",function(e,t){n.vocabulary.isMatch&&n.vocabulary.isOpen&&i(t,n.vocabulary)}),n.$on("ngObibaMicaLoadVocabulary",function(e,t,a){a.name!==n.vocabulary.name||a.isOpen||i(n.criteria,a)})}]),ngObibaMica.search.controller("NumericVocabularyFacetController",["$scope","JoinQuerySearchResource","RqlQueryService","RqlQueryUtils",function(l,c,u,d){function n(e,t){var a=u.findCriterion(e,CriteriaIdGenerator.generate(l.$parent.taxonomy,t));a||(a=u.createCriteriaItem(l.target,l.$parent.taxonomy,l.vocabulary)),a.rqlQuery&&a.rqlQuery.args[1]?angular.isArray(a.rqlQuery.args[1])?(l.from=a.rqlQuery.args[1][0],l.to=a.rqlQuery.args[1][1]):a.rqlQuery.name===RQL_NODE.GE?l.from=a.rqlQuery.args[1]:l.to=a.rqlQuery.args[1]:(l.from=null,l.to=null,l.min=null,l.max=null);var n,r,i,s=d.hasTargetQuery(e.rqlQuery,a.target)?angular.copy(e.rqlQuery):(n=e,r=a,i=angular.copy(n.rqlQuery),r.rqlQuery=d.buildRqlQuery(r),u.addCriteriaItem(i,r),i),o=u.prepareCriteriaTermsQuery(s,a);c[targetToType(l.target)]({query:o}).$promise.then(function(e){var t=u.getTargetAggregations(e,a,l.lang);t&&t.default&&(l.min=t.default.min,l.max=t.default.max)})}l.onKeypress=function(e){13!==e.keyCode&&"click"!==e.type||l.$parent.selectTerm(l.$parent.target,l.$parent.taxonomy,l.vocabulary,{from:l.from,to:l.to})},l.$on("ngObibaMicaQueryUpdated",function(e,t){l.vocabulary.isNumeric&&l.vocabulary.isOpen&&n(t,l.vocabulary)}),l.$on("ngObibaMicaLoadVocabulary",function(e,t,a){l.vocabulary.isNumeric&&a.name===l.vocabulary.name&&!a.isOpen&&n(l.criteria,a)})}]),ngObibaMica.search.controller("TaxonomiesFacetsController",["$scope","$timeout","TaxonomyResource","TaxonomiesResource","LocalizedValues","ngObibaMicaSearch","RqlQueryUtils","VocabularyService",function(r,a,e,n,t,i,s,o){function l(t){r.taxonomies[t]||n.get({target:t},function(e){r.taxonomies[t]=r.facetedTaxonomies[t].map(function(t){return e.filter(function(e){return t.name===e.name})[0]}).filter(function(e){return e}).map(function(a){return a.isOpen=!1,a.vocabularies="Maelstrom Research"===a.author?a.vocabularies:o.visibleFacetVocabularies(a.vocabularies),a.vocabularies.map(function(e){var t=o.findVocabularyAttributes(e,/^facet/i);e.isOpen="true"===t.facetExpanded,e.position=parseInt(t.facetPosition),e.limit=10,e.isMatch=o.isMatchVocabulary(e),e.isNumeric=o.isNumericVocabulary(e),a.isOpen=a.isOpen||e.isOpen}),a}),1===r.taxonomies[t].length&&(r.taxonomies[t][0].isOpen=1),r.criteria&&a(function(){r.$broadcast("ngObibaMicaQueryUpdated",r.criteria)})})}r.options=i.getOptions(),r.taxonomies={},r.targets=[],r.RqlQueryUtils=s,r.$watch("facetedTaxonomies",function(t){t&&(r.targets=r.options.targetTabsOrder.filter(function(e){if(t[e])return t[e].length}),r.target=r.targets[0],l(r.target))}),r.selectTerm=function(e,t,a,n){r.onSelectTerm(e,t,a,n)},r.setTarget=function(e){l(r.target=e)},r.loadVocabulary=function(e,t){r.$broadcast("ngObibaMicaLoadVocabulary",e,t)},r.localize=function(e){return t.forLocale(e,r.lang)},r.$on("ngObibaMicaQueryUpdated",function(e,t){r.criteria=t})}]).directive("taxonomiesFacetsPanel",[function(){return{restrict:"EA",scope:{facetedTaxonomies:"=",onRefresh:"=",onSelectTerm:"=",lang:"=",criteria:"="},controller:"TaxonomiesFacetsController",templateUrl:"search/components/facets/taxonomy/component.html"}}]),ngObibaMica.search.controller("TermsVocabularyFacetController",["$scope","$filter","JoinQuerySearchResource","RqlQueryService","RqlQueryUtils",function(u,e,d,m,p){function n(e,t){var a=null,n=!1;u.loading=!0;var r,i,s,o=m.findCriterion(e,CriteriaIdGenerator.generate(u.$parent.taxonomy,t));if(o?n=!0:o=m.createCriteriaItem(u.target,u.$parent.taxonomy,u.vocabulary),p.hasTargetQuery(e.rqlQuery,o.target)){if(a=angular.copy(e.rqlQuery),!n){var l=o.target===QUERY_TARGETS.VARIABLE&&"Mica_variable"!==o.taxonomy.name?RQL_NODE.OR:RQL_NODE.AND;m.addCriteriaItem(a,o,l)}}else r=e,i=o,s=angular.copy(r.rqlQuery),i.rqlQuery=p.buildRqlQuery(i),m.addCriteriaItem(s,i),a=s;var c=m.prepareCriteriaTermsQuery(a,o,o.lang);d[targetToType(u.target)]({query:c}).$promise.then(function(e){u.vocabulary.visibleTerms=0,m.getTargetAggregations(e,o,o.lang).forEach(function(n){u.vocabulary.terms.some(function(e){if(e.name===n.key)return e.selected=(a=n,(t=o).selectedTerms&&(t.rqlQuery.name===RQL_NODE.EXISTS||-1!==t.selectedTerms.indexOf(a.key))),e.count=n.count,e.isVisible=u.options.showFacetTermsWithZeroCount||0<n.count,u.vocabulary.visibleTerms+=e.isVisible,!0;var t,a})}),u.loading=!1})}u.loading=!1,u.selectTerm=function(e,t,a,n){var r=a.terms.filter(function(e){return e.selected}).map(function(e){return e.name}),i=m.findCriterion(u.criteria,CriteriaIdGenerator.generate(t,a));i?(0===r.length?m.removeCriteriaItem(i):(i.rqlQuery.name=RQL_NODE.IN,p.updateQuery(i.rqlQuery,r)),u.onRefresh()):u.onSelectTerm(e,t,a,n)},u.$on("ngObibaMicaQueryUpdated",function(e,t){u.vocabulary.isNumeric||u.vocabulary.isMatch||!u.vocabulary.isOpen||n(t,u.vocabulary)}),u.$on("ngObibaMicaLoadVocabulary",function(e,t,a){a.name!==u.vocabulary.name||u.vocabulary.isNumeric||u.vocabulary.isMatch||a.isOpen||n(u.criteria,a)})}]),ngObibaMica.search.component("metaTaxonomyFilterList",{transclude:!0,bindings:{metaTaxonomy:"<",showTaxonomyPanel:"<",rqlQuery:"<",onSelectTaxonomy:"&"},templateUrl:"search/components/meta-taxonomy/meta-taxonomy-filter-list/component.html",controller:function(){var t=this;t.status={isFirstOpen:!0},t.selectTaxonomy=function(e){t.onSelectTaxonomy({target:t.metaTaxonomy.name,taxonomy:e})},t.$onInit=function(){t.entityType=targetToType(t.metaTaxonomy.name)}}}),ngObibaMica.search.component("metaTaxonomyFilterPanel",{bindings:{tabs:"<",showTaxonomyPanel:"<",onToggle:"&",rqlQuery:"<"},templateUrl:"search/components/meta-taxonomy/meta-taxonomy-filter-panel/component.html",controller:["MetaTaxonomyService","TaxonomyService",function(e,a){var n=this;n.selectedTaxonomy=null,n.onSelectTaxonomy=function(t,e){n.selectedTaxonomy!==e?(n.selectedTaxonomy&&n.selectedTaxonomy.state.inactive(),n.selectedTaxonomy=e,n.selectedTaxonomy.state.active(),n.selectedTaxonomy.state.loading(),setTimeout(function(){a.getTaxonomies(t,e.info.names||e.info.name).then(function(e){n.selectedTaxonomy.state.loaded(),n.onToggle({target:t,taxonomy:e})})})):(n.selectedTaxonomy.state.none(),n.selectedTaxonomy=null,n.onToggle({target:t,taxonomy:n.selectedTaxonomy}))},n.$onChanges=function(e){n.selectedTaxonomy&&e.showTaxonomyPanel&&!0!==e.showTaxonomyPanel.currentValue&&(n.selectedTaxonomy.state.none(),n.selectedTaxonomy=null)},n.$onInit=function(){e.getMetaTaxonomyForTargets(n.tabs).then(function(e){n.metaTaxonomies=e})}}]}),ngObibaMica.search.controller("ClassificationPanelController",["$rootScope","$scope","$translate","$location","TaxonomyResource","TaxonomiesResource","ngObibaMicaSearch","RqlQueryUtils","$cacheFactory","VocabularyService",function(e,s,t,a,n,r,i,o,l,c){BaseTaxonomiesController.call(this,e,s,t,a,n,r,i,o,l,c);var u=function(e,a){var i=e.reduce(function(e,t){if(a)return t.vocabularies=c.visibleVocabularies(t.vocabularies),e[t.name]=t,e},{});return s.metaTaxonomy.$promise.then(function(e){var t=e.vocabularies.filter(function(e){return e.name===a})[0];s.taxonomyGroups=t.terms.map(function(e){if(!e.terms){var t=i[e.name];return t?(t.title=e.title,t.description=e.description,{title:null,taxonomies:[t]}):null}var a=e.terms.map(function(e){var t=i[e.name];return t?(t.title=e.title,t.description=e.description,t):null}).filter(function(e){return e}),n=e.title.filter(function(e){return e.locale===s.lang})[0],r=e.description?e.description.filter(function(e){return e.locale===s.lang})[0]:void 0;return{title:n?n.text:null,description:r?r.text:null,taxonomies:a}}).filter(function(e){return e})})},d=this;function m(){r.get({target:s.taxonomies.target},function(e){s.taxonomies.all=e,u(e,s.taxonomies.target),s.taxonomies.search.active=!1,d.updateStateFromLocation()})}s.$watch("target",function(e){e&&(s.taxonomies.target=e,s.taxonomies.search.active=!0,s.taxonomies.all=null,s.taxonomies.taxonomy=null,s.taxonomies.vocabulary=null,s.taxonomies.term=null,m())}),this.refreshTaxonomyCache=function(){s.clearCache(),m()},s.refreshTaxonomyCache=this.refreshTaxonomyCache}]).directive("classificationsPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",onSelectTerm:"=",isHistoryEnabled:"=",lang:"="},controller:"ClassificationPanelController",templateUrl:"search/components/panel/classification/component.html"}}]),ngObibaMica.search.controller("TaxonomiesPanelController",["$rootScope","$scope","$translate","$location","TaxonomyResource","TaxonomiesResource","ngObibaMicaSearch","RqlQueryUtils","$cacheFactory","AlertService","ServerErrorUtils","VocabularyService",function(e,a,t,n,r,i,s,o,l,c,u,d){function m(e,t){r.get({target:e,taxonomy:t},function(e){a.taxonomies.taxonomy=e,a.taxonomies.vocabulary=null,a.taxonomies.term=null,a.taxonomies.search.active=!1},function(e){a.taxonomies.search.active=!1,c.alert({id:"SearchController",type:"danger",msg:u.buildMessage(e),delay:5e3})})}BaseTaxonomiesController.call(this,e,a,t,n,r,i,s,o,l,d),a.$watchGroup(["taxonomyName","target"],function(e){e[0]&&e[1]&&(a.showTaxonomies&&a.showTaxonomies(),a.taxonomies.target=e[1],a.taxonomies.search.active=!0,a.taxonomies.all=null,a.taxonomies.taxonomy=null,a.taxonomies.vocabulary=null,a.taxonomies.term=null,m(e[1],e[0]))}),this.refreshTaxonomyCache=function(e,t){a.clearCache(),m(e,t)},a.refreshTaxonomyCache=this.refreshTaxonomyCache}]).controller("NumericVocabularyPanelController",["$scope",function(e){e.$watch("taxonomies",function(){e.from=null,e.to=null},!0)}]).controller("MatchVocabularyPanelController",["$scope",function(e){e.$watch("taxonomies",function(){e.text=null},!0)}]).directive("taxonomiesPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomyName:"=",target:"=",onClose:"=",onSelectTerm:"=",taxonomiesShown:"=",lang:"="},controller:"TaxonomiesPanelController",templateUrl:"search/components/panel/taxonomies-panel/component.html",link:function(e,t){e.closeTaxonomies=function(){t.collapse("hide"),e.onClose()},e.showTaxonomies=function(){t.collapse("show")},t.on("show.bs.collapse",function(){e.taxonomiesShown=!0}),t.on("hide.bs.collapse",function(){e.taxonomiesShown=!1}),e.$watch("taxonomiesShown",function(e){e?t.collapse("show"):t.collapse("hide")})}}}]),ngObibaMica.search.directive("taxonomyPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomy:"=",lang:"=",onNavigate:"="},templateUrl:"search/components/panel/taxonomy-panel/component.html"}}]),ngObibaMica.search.directive("termPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",term:"=",lang:"=",onSelect:"="},templateUrl:"search/components/panel/term-panel/component.html"}}]),ngObibaMica.search.VocabularyPanel=function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",lang:"=",onNavigate:"=",onSelect:"=",onHideSearchNavigate:"=",isInHideNavigate:"="},templateUrl:"search/components/panel/vocabulary-panel/component.html"}},ngObibaMica.search.directive("vocabularyPanel",[ngObibaMica.search.VocabularyPanel]);var CellStatValueController=function(){function e(e){this.$log=e}return e.prototype.clickCriteria=function(){this.updateCriteria()},e.prototype.$onInit=function(){this.resultTabOrder.indexOf(this.destinationTab)<0&&(this.disable=!0)},e.$inject=["$log"],e}(),CellStatValueComponent=function(){this.transclude=!0,this.bindings={destinationTab:"@",entityCount:"<",resultTabOrder:"<",updateCriteria:"&"},this.controller=CellStatValueController,this.controllerAs="$ctrl",this.templateUrl="search/components/result/cell-stat-value/component.html"};ngObibaMica.search.component("cellStatValue",new CellStatValueComponent),ngObibaMica.search.controller("CoverageResultTableController",["$scope","$location","$q","$translate","$filter","LocalizedValues","PageUrlService","RqlQueryUtils","RqlQueryService","CoverageGroupByService","StudyFilterShortcutService","TaxonomyService","AlertService",function(O,l,c,u,d,R,D,a,m,A,n,p,g){var h={},r={};function t(e,a,n){var r=0;return e.reduce(function(e,t){return e[t.entity.name]=a.slice(r,r+t.termsCount).map(function(e){return 1<t.termsCount&&"vocabularyName"===n&&(e.canRemove=!0),e[n]=t.entity.name,e}),r+=t.termsCount,e},{})}function i(e,t){e!==t&&(e?O.selectBucket(BUCKET_TYPES.DCE):O.bucket.startsWith("dce")&&O.selectBucket(BUCKET_TYPES.STUDY))}function e(){var e=l.search();e.display&&e.display===DISPLAY_TYPES.COVERAGE&&(O.bucket=e.bucket?e.bucket:A.defaultBucket(),O.bucketStartsWithDce=O.bucket.startsWith("dce"),O.singleStudy=A.isSingleStudy(),function(){var e=n.getStudyClassNameChoices();e.choseAll?O.bucketSelection._studySelection=ngObibaMica.search.STUDY_FILTER_CHOICES.ALL_STUDIES:e.choseIndividual?O.bucketSelection._studySelection=ngObibaMica.search.STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:e.choseHarmonization&&(O.bucketSelection._studySelection=ngObibaMica.search.STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES),angular.extend(O,e);var t=l.search().bucket;t!==BUCKET_TYPES.STUDY&&t!==BUCKET_TYPES.DCE||(O.bucketSelection._dceBucketSelected=t===BUCKET_TYPES.DCE)}())}function s(e){O.groupByOptions.canShowVariableTypeFilter(e)?O.selectBucket(e):BUCKET_TYPES.STUDY!==e&&O.selectBucket(BUCKET_TYPES.DCE)}function o(e){O.selectBucket(e)}function f(e){var t=O.bucket.startsWith("dce")?"dceId":"id",a="search.criterion.created",n=m.parseQuery(l.search().query),r=m.findTargetQuery(h[O.bucket],n);r||(r=new RqlQuery(h[O.bucket]),n.args.push(r));var i,s=m.findQueryInTargetByVocabulary(r,t);if(s?(a="search.criterion.updated",(i=s).name===RQL_NODE.EXISTS&&(i.name=RQL_NODE.IN)):i=new RqlQuery(RQL_NODE.IN),i.args=["Mica_"+h[O.bucket]+"."+t],i.args.push(e.map(function(e){return e.value})),!s)if(0<r.args.length){var o=new RqlQuery(RQL_NODE.AND);r.args.forEach(function(e){o.args.push(e)}),o.args.push(i),r.args=[o]}else r.args=[i];l.search("query",(new RqlQuery).serializeArgs(n.args)),p.findVocabularyInTaxonomy(h[O.bucket],"Mica_"+h[O.bucket],t).then(function(e){g.growl({id:"SearchControllerGrowl",type:"info",msgKey:a,msgArgs:[e?R.forLocale(e.title,u.use()):t,d("translate")("taxonomy.target."+h[O.bucket])],delay:3e3})})}function b(){var b={colSpan:O.bucket.startsWith("dce")?A.isSingleStudy()?2:3:1,ids:{}},l={};function y(e){var t;return l[e]?(t=0,l[e]=l[e]+1):(t=1,l[e]=1),t}var v={};function T(e,t){var a;if(e)if(0<e.indexOf("-")){var n=e.split("-");if(!t){var r=parseInt(n[1]);n[1]=r<12?r+1:(n[0]=parseInt(n[0])+1,1)}var i=n[0]+"/"+n[1]+"/01";a=Date.parse(i)}else a=t?Date.parse(e+"/01/01"):Date.parse(e+"/12/31");return a}var S=(new Date).getFullYear(),e=(new Date).getMonth()+1,w=S+"-"+e,C=T(w,!0);var x,E=!0;return O.result.rows.forEach(function(e,t){if(e.hitsTitles=e.hits.map(function(e){return R.formatNumber(e)}),b.ids[e.value]=[],O.bucket.startsWith("dce")){var a,n,r=e.value.split(":"),i=-1<e.className.indexOf("Harmonization")||"."===r[2],s=e.title.split(":"),o=e.description.split(":");n=r[0],x?n!==x&&(E=!E,x=n):x=n,a=y(n),g=n,h=e.start||w,f=e.end||w,v[g]?(h<v[g][0]&&(v[g][0]=h),f>v[g][1]&&(v[g][1]=f)):v[g]=[h,f],b.ids[e.value].push({id:A.isSingleStudy()?"-":n,url:D.studyPage(n,i?"harmonization":"individual"),title:s[0],description:o[0],rowSpan:a,index:t++}),a=y(n=r[0]+":"+r[1]),b.ids[e.value].push({id:n,url:D.studyPopulationPage(r[0],i?"harmonization":"individual",r[1]),title:s[1],description:o[1],rowSpan:a,index:t++}),b.ids[e.value].push({id:i?"-":e.value,title:s[2],description:o[2],start:e.start,current:w,end:e.end,progressClass:E?"info":"warning",url:D.studyPopulationPage(r[0],i?"harmonization":"individual",r[1]),rowSpan:1,index:t++})}else{var l=O.bucket.split("-")[0];l===BUCKET_TYPES.DATASET?l+=-1<e.className.indexOf("Harmonization")?"-harmonized":"-collected":l+=-1<e.className.indexOf("Harmonization")?"-harmonization":"-individual",b.ids[e.value].push({id:e.value,url:function(e,t){switch(e){case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:return D.studyPage(t,"individual");case BUCKET_TYPES.STUDY_HARMONIZATION:case BUCKET_TYPES.DCE_HARMONIZATION:return D.studyPage(t,"harmonization");case BUCKET_TYPES.NETWORK:return D.networkPage(t);case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET_HARMONIZED:return D.datasetPage(t,"harmonized");case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:return D.datasetPage(t,"collected")}return""}(l,e.value),title:e.title,description:e.description,min:e.start,start:e.start,current:S,end:e.end,max:e.end,progressStart:0,progress:(c=e.start?e.start+"-01":w,u=e.end?e.end+"-12":w,d=T(c,!0),m=u?T(u,!1):C,p=m<C?m:C,m===d?100:Math.round(c?100*(p-d)/(m-d):0)),progressClass:E?"info":"warning",rowSpan:1,index:t++}),E=!E}var c,u,d,m,p,g,h,f}),O.bucket.startsWith("dce")&&O.result.rows.forEach(function(e,t){e.hitsTitles=e.hits.map(function(e){return R.formatNumber(e)}),0<b.ids[e.value][0].rowSpan&&(b.ids[e.value][0].rowSpan=l[b.ids[e.value][0].id]),0<b.ids[e.value][1].rowSpan&&(b.ids[e.value][1].rowSpan=l[b.ids[e.value][1].id]);var a=e.value.split(":");if(v[a[0]]){var n=v[a[0]][0],r=v[a[0]][1],i=b.ids[e.value][2].start||w,s=b.ids[e.value][2].end||w,o=T(r,!1)-T(n,!0);b.ids[e.value][2].min=n,b.ids[e.value][2].max=r,b.ids[e.value][2].progressStart=100*(T(i,!0)-T(n,!0))/o,b.ids[e.value][2].progress=100*(T(s,!1)-T(i,!0))/o,b.ids[e.value].index=t}}),b}h[BUCKET_TYPES.NETWORK]=QUERY_TARGETS.NETWORK,h[BUCKET_TYPES.STUDY]=QUERY_TARGETS.STUDY,h[BUCKET_TYPES.STUDY_INDIVIDUAL]=QUERY_TARGETS.STUDY,h[BUCKET_TYPES.STUDY_HARMONIZATION]=QUERY_TARGETS.STUDY,h[BUCKET_TYPES.DCE]=QUERY_TARGETS.VARIABLE,h[BUCKET_TYPES.DCE_INDIVIDUAL]=QUERY_TARGETS.VARIABLE,h[BUCKET_TYPES.DCE_HARMONIZATION]=QUERY_TARGETS.VARIABLE,h[BUCKET_TYPES.DATASCHEMA]=QUERY_TARGETS.DATASET,h[BUCKET_TYPES.DATASET]=QUERY_TARGETS.DATASET,h[BUCKET_TYPES.DATASET_COLLECTED]=QUERY_TARGETS.DATASET,h[BUCKET_TYPES.DATASET_HARMONIZED]=QUERY_TARGETS.DATASET,O.showMissing=!0,O.toggleMissing=function(e){O.showMissing=e},O.groupByOptions=A,O.bucketSelection={get studySelection(){return this._studySelection},set studySelection(e){var t;this._studySelection=e,!O.bucket||O.bucket&&(-1<O.bucket.indexOf(BUCKET_TYPES.STUDY)||-1<O.bucket.indexOf(BUCKET_TYPES.DCE))?s(O.bucket.split("-")[0]):O.bucket&&-1<O.bucket.indexOf(BUCKET_TYPES.DATASET)&&o(O.bucket.split("-")[0]),t=e,n.filter(t,O.lang)},get dceBucketSelected(){return this._dceBucketSelected},set dceBucketSelected(e){var t=this._dceBucketSelected;i(this._dceBucketSelected=e,t)}},O.isStudyBucket=function(){return-1<O.bucket.indexOf("study")||-1<O.bucket.indexOf("dce")},O.isDatasetBucket=function(){return-1<O.bucket.indexOf("dataset")},O.selectTab=function(e){e===BUCKET_TYPES.STUDY?s(O.bucketSelection.dceBucketSelected||O.groupByOptions.isSingleStudy()?BUCKET_TYPES.DCE:BUCKET_TYPES.STUDY):e===BUCKET_TYPES.DATASET&&o(BUCKET_TYPES.DATASET)},O.selectBucket=function(e){O.bucket=e,O.$parent.onBucketChanged(e)},O.$on("$locationChangeSuccess",e),O.rowspans={},O.getSpan=function(t,e){var a=0;if(e){var n=t+":"+e;return a=O.result.rows.filter(function(e){return e.title.startsWith(n+":")}).length,O.rowspans[n]=a}return a=O.result.rows.filter(function(e){return e.title.startsWith(t+":")}).length,O.rowspans[t]=a},O.hasSpan=function(e,t){return t?0<O.rowspans[e+":"+t]:0<O.rowspans[e]},O.hasVariableTarget=function(){var e=l.search().query;return e&&a.hasTargetQuery(m.parseQuery(e),RQL_NODE.VARIABLE)},O.hasSelected=function(){return O.table&&O.table.rows&&O.table.rows.filter(function(e){return e.selected}).length},O.selectAll=function(){O.table&&O.table.rows&&O.table.rows.forEach(function(e){e.selected=!0})},O.selectNone=function(){O.table&&O.table.rows&&O.table.rows.forEach(function(e){e.selected=!1})},O.selectFull=function(){O.table&&O.table.rows&&O.table.rows.forEach(function(e){e.hits?e.selected=0===e.hits.filter(function(e){return 0===e}).length:e.selected=!1})},O.BUCKET_TYPES=BUCKET_TYPES,O.downloadUrl=function(){return D.downloadCoverage(O.query)},O.$watch("result",function(){if(O.table={cols:[]},r={},O.result&&O.result.rows){var e=O.result;e.cols=b(),O.table=e,r=t(O.table.vocabularyHeaders,O.table.termHeaders,"vocabularyName"),t(O.table.taxonomyHeaders,O.table.termHeaders,"taxonomyName"),function(e,t){for(var a=0,n=0,r=0;r<t.length;r++)a>=e[n].termsCount&&(n++,a=0),a+=t[r].termsCount,t[r].taxonomyName=e[n].entity.name}(O.table.taxonomyHeaders,O.table.vocabularyHeaders)}}),O.updateCriteria=function(e,t,a,n){var r=O.bucket.startsWith("dce")?"dceId":"id",i={varItem:m.createCriteriaItem(QUERY_TARGETS.VARIABLE,t.taxonomyName,t.vocabularyName,t.entity.name)};if(e){var s=O.bucket.split("-")[0];if("dce"===s&&e.endsWith(":.")){s="study";var o=e.split(":")[0];i.item=m.createCriteriaItem(h[s],"Mica_"+h[s],"id",o)}else i.item=m.createCriteriaItem(h[s],"Mica_"+h[s],r,e)}else O.bucket.endsWith("individual")?i.item=m.createCriteriaItem(QUERY_TARGETS.STUDY,"Mica_"+QUERY_TARGETS.STUDY,"className","Study"):O.bucket.endsWith("harmonization")?i.item=m.createCriteriaItem(QUERY_TARGETS.STUDY,"Mica_"+QUERY_TARGETS.STUDY,"className","HarmonizationStudy"):O.bucket.endsWith("collected")?i.item=m.createCriteriaItem(QUERY_TARGETS.DATASET,"Mica_"+QUERY_TARGETS.DATASET,"className","StudyDataset"):O.bucket.endsWith("harmonized")&&(i.item=m.createCriteriaItem(QUERY_TARGETS.DATASET,"Mica_"+QUERY_TARGETS.DATASET,"className","HarmonizationDataset"));c.all(i).then(function(e){O.onUpdateCriteria(e.varItem,n,!1,!0),e.item&&O.onUpdateCriteria(e.item,n),e.bucketItem&&O.onUpdateCriteria(e.bucketItem,n)})},O.isFullCoverageImpossibleOrCoverageAlreadyFull=function(){var e=O.table&&O.table.rows||[],t=0;return 0===e.length||(e.forEach(function(e){e.hits&&0<e.hits.filter(function(e){return 0===e}).length&&t++}),0===t||e.length===t)},O.selectFullAndFilter=function(){var t=[];O.table&&O.table.rows&&O.table.rows.forEach(function(e){e.hits&&0===e.hits.filter(function(e){return 0===e}).length&&t.push(e)}),f(t)},O.updateFilterCriteria=function(){f(O.table.rows.filter(function(e){return e.selected}))},O.removeTerm=function(t){var e=r[t.vocabularyName].filter(function(e){return e.entity.name!==t.entity.name}).map(function(e){return m.createCriteriaItem(QUERY_TARGETS.VARIABLE,e.taxonomyName,e.vocabularyName,e.entity.name)});c.all(e).then(function(e){O.onUpdateCriteria(e.reduce(function(e,t){return e?(m.updateCriteriaItem(e,t),e):(t.rqlQuery=a.buildRqlQuery(t),t)},null),null,!0,!1,!1)})},O.removeVocabulary=function(e){m.createCriteriaItem(QUERY_TARGETS.VARIABLE,e.taxonomyName,e.entity.name).then(function(e){O.onRemoveCriteria(e)})},e()}]).directive("coverageResultTable",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",bucket:"=",query:"=",criteria:"=",onUpdateCriteria:"=",onRemoveCriteria:"="},controller:"CoverageResultTableController",templateUrl:"search/components/result/coverage-result/component.html"}}]),ngObibaMica.search.directive("datasetsResultTable",["$log","PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService","ngObibaMicaSearchTemplateUrl",function(t,n,r,i,s,e){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:e.getTemplateUrl("searchDatasetsResultTable"),link:function(a){a.classNames={},i.get({target:"dataset",taxonomy:"Mica_dataset"}).$promise.then(function(e){e.vocabularies?a.classNames=e.vocabularies.filter(function(e){return"className"===e.name})[0].terms.reduce(function(e,t){return e[t.name]=t.title.map(function(e){return{lang:e.locale,value:e.text}}),e},{}):t.warn("Taxonomy has no vocabularies")}),a.updateCriteria=function(e,t){s.createCriteriaItem("dataset","Mica_dataset","id",e).then(function(e){a.onUpdateCriteria(e,t)})};var e=r.getOptions();a.options=e.datasets,a.resultTabOrder=e.resultTabsOrder,a.optionsCols=a.options.datasetsColumn,a.PageUrlService=n}}}]),ngObibaMica.search.controller("GraphicsResultController",["GraphicChartsConfig","GraphicChartsUtils","RqlQueryService","$filter","$scope","D3GeoConfig","D3ChartConfig",function(e,t,a,r,i,s,o){i.hasChartObjects=function(){return i.chartObjects&&0<Object.keys(i.chartObjects).length};var l=function(a,e,n,r,i,s){return t.getArrayByAggregation(a,e).then(function(e){var t=e.map(function(e){return e.participantsNbr&&s?[e.title,e.value,e.participantsNbr]:[e.title,e.value]});if(0<t.length)return t.unshift(n),angular.extend(i,{title:r}),{data:t,entries:e,options:i,vocabulary:a}})},c=e.getOptions().ChartsOptions;i.updateCriteria=function(e,t){a.createCriteriaItem("study","Mica_study",t,e).then(function(e){i.onUpdateCriteria(e,"studies")})},i.$watch("result",function(n){i.chartObjects={},i.noResults=!0,n&&n.studyResultDto.totalHits&&(i.noResults=!1,l("populations-model-selectionCriteria-countriesIso",n.studyResultDto,[r("translate")(c.geoChartOptions.header[0]),r("translate")(c.geoChartOptions.header[1])],r("translate")(c.geoChartOptions.title)+" (N="+n.studyResultDto.totalHits+")",c.geoChartOptions.options).then(function(e){if(e){var t=(new s).withData(e.entries).withTitle(r("translate")(c.geoChartOptions.title)+" (N="+n.studyResultDto.totalHits+")");t.withColor(c.geoChartOptions.options.colors);var a={geoChartOptions:{directiveTitle:e.options.title,headerTitle:r("translate")("graphics.geo-charts"),chartObject:{geoTitle:e.options.title,options:e.options,type:"GeoChart",vocabulary:e.vocabulary,data:e.data,entries:e.entries,d3Config:t}}};a.geoChartOptions.getTable=function(){return a.geoChartOptions.chartObject},angular.extend(i.chartObjects,a)}}),l("model-methods-design",n.studyResultDto,[r("translate")(c.studiesDesigns.header[0]),r("translate")(c.studiesDesigns.header[1])],r("translate")(c.studiesDesigns.title)+" (N="+n.studyResultDto.totalHits+")",c.studiesDesigns.options).then(function(e){if(e){var t=new o(e.vocabulary).withType("multiBarHorizontalChart").withTitle(r("translate")(c.studiesDesigns.title)+" (N="+n.studyResultDto.totalHits+")").withData(angular.copy(e.entries),!1,r("translate")("graphics.nbr-studies"));t.options.chart.showLegend=!1,t.options.chart.color=c.numberParticipants.options.colors;var a={studiesDesigns:{headerTitle:r("translate")("graphics.study-design"),chartObject:{options:e.options,type:"BarChart",data:e.data,vocabulary:e.vocabulary,entries:e.entries,d3Config:t}}};angular.extend(i.chartObjects,a)}}),l("model-methods-design",n.studyResultDto,[r("translate")(c.studiesDesigns.header[0]),r("translate")(c.studiesDesigns.header[1]),r("translate")(c.studiesDesigns.header[2])],r("translate")(c.studiesDesigns.title)+" (N="+n.studyResultDto.totalHits+")",c.studiesDesigns.options,!0).then(function(e){if(e){var t={chartObjectTable:{options:e.options,type:"BarChart",data:e.data,vocabulary:e.vocabulary,entries:e.entries},getTable:function(){return t.chartObjectTable}};angular.extend(i.chartObjects.studiesDesigns,t)}}),l("model-numberOfParticipants-participant-number-range",n.studyResultDto,[r("translate")(c.numberParticipants.header[0]),r("translate")(c.numberParticipants.header[1])],r("translate")(c.numberParticipants.title)+" (N="+n.studyResultDto.totalHits+")",c.numberParticipants.options).then(function(e){if(e){var t=new o(e.vocabulary).withType("pieChart").withTitle(r("translate")(c.numberParticipants.title)+" (N="+n.studyResultDto.totalHits+")").withData(angular.copy(e.entries),!0);t.options.chart.legendPosition="right",t.options.chart.color=c.numberParticipants.options.colors;var a={numberParticipants:{headerTitle:r("translate")("graphics.number-participants"),chartObject:{options:e.options,type:"PieChart",data:e.data,vocabulary:e.vocabulary,entries:e.entries,d3Config:t}}};a.numberParticipants.getTable=function(){return a.numberParticipants.chartObject},angular.extend(i.chartObjects,a)}}),l("populations-dataCollectionEvents-model-bioSamples",n.studyResultDto,[r("translate")(c.biologicalSamples.header[0]),r("translate")(c.biologicalSamples.header[1])],r("translate")(c.biologicalSamples.title)+" (N="+n.studyResultDto.totalHits+")",c.biologicalSamples.options).then(function(e){if(e){var t=new o(e.vocabulary).withType("multiBarHorizontalChart").withTitle(r("translate")(c.biologicalSamples.title)+" (N="+n.studyResultDto.totalHits+")").withData(angular.copy(e.entries),!1,r("translate")("graphics.nbr-studies"));t.options.chart.showLegend=!1,t.options.chart.color=c.numberParticipants.options.colors;var a={biologicalSamples:{headerTitle:r("translate")("graphics.bio-samples"),chartObject:{options:e.options,type:"BarChart",data:e.data,vocabulary:e.vocabulary,entries:e.entries,d3Config:t}}};a.biologicalSamples.getTable=function(){return a.biologicalSamples.chartObject},angular.extend(i.chartObjects,a)}}))})}]).directive("graphicsResult",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",onUpdateCriteria:"="},controller:"GraphicsResultController",templateUrl:"search/components/result/graphics-result/component.html"}}]),ngObibaMica.search.directive("networksResultTable",["PageUrlService","ngObibaMicaSearch","RqlQueryService","StudyFilterShortcutService","ngObibaMicaSearchTemplateUrl",function(a,n,o,r,e){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:e.getTemplateUrl("searchNetworksResultTable"),link:function(s){function e(){var e=r.getStudyClassNameChoices();angular.extend(s,e),s.colSpans={datasets:(s.optionsCols.showNetworksStudyDatasetColumn&e.choseIndividual)+(s.optionsCols.showNetworksHarmonizationDatasetColumn&e.choseHarmonization),variables:(s.optionsCols.showNetworksStudyVariablesColumn&e.choseIndividual)+(s.optionsCols.showNetworksDataschemaVariablesColumn&e.choseHarmonization)}}var t=n.getOptions();s.options=t.networks,s.resultTabOrder=t.resultTabsOrder,s.optionsCols=s.options.networksColumn,s.PageUrlService=a,s.$on("$locationChangeSuccess",function(){e()}),s.updateCriteria=function(e,a,t){var n,r,i;"HarmonizationDataset"!==a&&"StudyDataset"!==a||(n=a,a="datasets"),"HarmonizationStudy"!==a&&"Study"!==a||(r=a,a="studies"),"DataschemaVariable"!==a&&"CollectedVariable"!==a||(i=a.replace("Variable",""),a="variables"),a=t||a,o.createCriteriaItem("network","Mica_network","id",e).then(function(t){n?o.createCriteriaItem("dataset","Mica_dataset","className",n).then(function(e){s.onUpdateCriteria(t,a),s.onUpdateCriteria(e,a)}):r?o.createCriteriaItem("study","Mica_study","className",r).then(function(e){s.onUpdateCriteria(t,a),s.onUpdateCriteria(e,a)}):i?o.createCriteriaItem("variable","Mica_variable","variableType",i).then(function(e){s.onUpdateCriteria(t,a),s.onUpdateCriteria(e,a)}):s.onUpdateCriteria(t,a)})},e()}}}]);var SearchResultPaginationController=function(){function e(e){this.PaginationService=e,this.preventPageChangeEvent=!1}return e.prototype.onUpdate=function(e,t){this.preventPageChangeEvent=t,this.pagination=e,this.showPaginationTotal=!0===this.showTotal&&1<this.pagination.pageCount},e.prototype.pageChanged=function(){this.onChange({from:(this.pagination.currentPage-1)*this.pagination.selected.value,replace:!0===this.preventPageChangeEvent,size:this.pagination.selected.value,target:this.target})},e.prototype.pageSizeChanged=function(){this.pageChanged()},e.prototype.$onInit=function(){this.PaginationService.registerListener(this.target,this)},e.$inject=["PaginationService"],e}(),SearchResultPaginationComponent=function(){this.templateUrl="search/components/result/pagination/component.html",this.transclude=!1,this.transclude=!0,this.bindings={onChange:"&",showTotal:"<",target:"<"},this.controller=SearchResultPaginationController,this.controllerAs="$ctrl"};ngObibaMica.search.component("searchResultPagination",new SearchResultPaginationComponent),ngObibaMica.search.controller("SearchResultController",["$scope","ngObibaMicaSearch","ngObibaMicaUrl","RqlQueryService","RqlQueryUtils","ngObibaMicaSearchTemplateUrl","AlertService","SetService",function(i,e,r,s,o,t,l,a){function n(t){Object.keys(i.activeTarget).forEach(function(e){i.activeTarget[e].active=t===e})}function c(e,t){var a=s.parseQuery(i.query),n=typeToTarget(i.type),r=a.args.filter(function(e){return e.name===n}).pop();return o.addLimit(r,o.limit(0,e)),t&&o.addFields(r,o.fields(t)),(new RqlQuery).serializeArgs(a.args)}i.targetTypeMap=i.$parent.taxonomyTypeMap,i.QUERY_TARGETS=QUERY_TARGETS,i.QUERY_TYPES=QUERY_TYPES,i.options=e.getOptions(),i.activeTarget={},i.activeTarget[QUERY_TYPES.VARIABLES]={active:!1,name:QUERY_TARGETS.VARIABLE},i.activeTarget[QUERY_TYPES.DATASETS]={active:!1,name:QUERY_TARGETS.DATASET},i.activeTarget[QUERY_TYPES.STUDIES]={active:!1,name:QUERY_TARGETS.STUDY},i.activeTarget[QUERY_TYPES.NETWORKS]={active:!1,name:QUERY_TARGETS.NETWORK},i.getUrlTemplate=function(e){switch(e){case"list":return t.getTemplateUrl("searchResultList");case"coverage":return t.getTemplateUrl("searchResultCoverage");case"graphics":return t.getTemplateUrl("searchResultGraphics")}},i.selectType=function(e){n(e),i.type=e,i.$parent.onTypeChanged(e)},i.getTotalHits=function(e){return i.result.list&&i.result.list[e+"ResultDto"]?i.result.list[e+"ResultDto"].totalHits:"..."},i.getReportUrl=function(){if(null===i.query)return i.query;var e=c(1e5);return r.getUrl("JoinQuerySearchCsvResource").replace(":type",i.type).replace(":query",encodeURI(e))},i.addToCart=function(){if(null===i.query)return i.query;var r=a.getCartSet("variables"),e=c(2e4,["id"]);a.addDocumentQueryToCart("variables",e).then(function(e){var t=e.count-(r?r.count:0),a="sets.cart.variables-added",n=[t];0===t&&(a="sets.cart.no-variable-added",n=[]),l.growl({id:"SearchControllerGrowl",type:"info",msgKey:a,msgArgs:n,delay:3e3})})},i.getStudySpecificReportUrl=function(){if(null===i.query)return i.query;var e=s.parseQuery(i.query),t=typeToTarget(i.type),a=e.args.filter(function(e){return e.name===t}).pop();o.addLimit(a,o.limit(0,1e5));var n=(new RqlQuery).serializeArgs(e.args);return r.getUrl("JoinQuerySearchCsvReportResource").replace(":type",i.type).replace(":query",encodeURI(n))},i.$watchCollection("result",function(){i.result.list&&(i.activeTarget[QUERY_TYPES.VARIABLES].totalHits=i.result.list.variableResultDto.totalHits,i.activeTarget[QUERY_TYPES.DATASETS].totalHits=i.result.list.datasetResultDto.totalHits,i.activeTarget[QUERY_TYPES.STUDIES].totalHits=i.result.list.studyResultDto.totalHits,i.activeTarget[QUERY_TYPES.NETWORKS].totalHits=i.result.list.networkResultDto.totalHits)}),i.$watch("type",function(e){n(e)}),i.DISPLAY_TYPES=DISPLAY_TYPES}]).directive("resultPanel",[function(){return{restrict:"EA",replace:!0,scope:{type:"=",bucket:"=",query:"=",criteria:"=",display:"=",result:"=",lang:"=",loading:"=",pagination:"<",searchTabsOrder:"=",resultTabsOrder:"=",onTypeChanged:"=",onBucketChanged:"=",onPaginate:"=",onUpdateCriteria:"=",onRemoveCriteria:"="},controller:"SearchResultController",templateUrl:"search/components/result/search-result/component.html"}}]),ngObibaMica.search.directive("studiesResultTable",["$log","$q","$location","PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService","LocalizedValues","ngObibaMicaSearchTemplateUrl","StudyFilterShortcutService",function(r,t,e,i,o,l,c,u,a,d){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:a.getTemplateUrl("searchStudiesResultTable"),link:function(s){function a(){var e=d.getStudyClassNameChoices();angular.extend(s,e)}function n(){Object.keys(s.taxonomy).length<1||!s.taxonomy.vocabularies||0<Object.keys(s.datasourceTitles).length||s.taxonomy.vocabularies.some(function(e){return"populations-dataCollectionEvents-dataSources"===e.name&&(e.terms.forEach(function(e){s.datasourceTitles[e.name]={title:u.forLocale(e.title,s.lang)}}),!0)})}t.all([l.get({target:"study",taxonomy:"Mica_study"}).$promise]).then(function(e){var t=e[0];s.taxonomy=t,n(),t.vocabularies?s.designs=t.vocabularies.filter(function(e){return"methods-design"===e.name})[0].terms.reduce(function(e,t){return e[t.name]=t.title.map(function(e){return{lang:e.locale,value:e.text}}),e},{}):r.warn("Taxonomy has no vocabularies"),a()}),s.taxonomy={},s.designs={},s.datasourceTitles={},s.studyFilterSelection={get selection(){return this._selection},set selection(e){var t;this._selection=e,t=e,d.filter(t,s.lang)}},s.$on("$locationChangeSuccess",function(){a()}),s.$watch("lang",n),s.hasDatasource=function(e,t){return e&&-1<e.indexOf(t)};var e=o.getOptions();s.options=e.studies,s.resultTabOrder=e.resultTabsOrder,s.optionsCols=s.options.studiesColumn,s.PageUrlService=i,s.updateCriteria=function(e,a,t){var n,r,i;"HarmonizationDataset"!==a&&"StudyDataset"!==a||(n=a,a="datasets"),"HarmonizationStudy"!==a&&"Study"!==a||(r=a,a="studies"),"DataschemaVariable"!==a&&"CollectedVariable"!==a||(i=a.replace("Variable",""),a="variables"),a=t||a,c.createCriteriaItem("study","Mica_study","id",e).then(function(t){n?c.createCriteriaItem("dataset","Mica_dataset","className",n).then(function(e){s.onUpdateCriteria(t,a),s.onUpdateCriteria(e,a)}):r?c.createCriteriaItem("study","Mica_study","className",r).then(function(e){s.onUpdateCriteria(t,a),s.onUpdateCriteria(e,a)}):i?c.createCriteriaItem("variable","Mica_variable","variableType",i).then(function(e){s.onUpdateCriteria(t,a),s.onUpdateCriteria(e,a)}):s.onUpdateCriteria(t,a)})}}}}]),ngObibaMica.search.directive("resultTabsOrderCount",function(){return{restrict:"EA",replace:!0,controller:"ResultTabsOrderCountController",templateUrl:"search/components/result/tabs-order-count/component.html"}}),ngObibaMica.search.directive("variablesResultTable",["PageUrlService","ngObibaMicaSearch",function(t,a){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"="},templateUrl:"search/components/result/variables-result-table/component.html",link:function(e){e.options=a.getOptions().variables,e.optionsCols=e.options.variablesColumn,e.PageUrlService=t}}}]),ngObibaMica.search.component("taxonomyFilterDetail",{bindings:{taxonomy:"<",vocabularies:"<",onSelectTaxonomyTerm:"&",onRemoveCriterion:"&"},templateUrl:"search/components/taxonomy/taxonomy-filter-detail/component.html",controller:[function(){var a=this;a.selectVocabularyArgs=function(e,t){a.onSelectTaxonomyTerm({taxonomy:a.taxonomy,vocabulary:e,args:t})},a.removeCriterion=function(e){a.onRemoveCriterion({item:e})}}]}),ngObibaMica.search.component("taxonomyFilterPanel",{transclude:!0,bindings:{showTaxonomyPanel:"<",result:"<",resultTabsOrder:"<",taxonomyTypeMap:"<",target:"<",taxonomy:"<",onSelectType:"&",onSelectTerm:"&",onRemoveCriterion:"&",onToggle:"<"},templateUrl:"search/components/taxonomy/taxonomy-filter-panel/component.html",controller:["VocabularyService","$timeout",function(o,e){var l=this;function c(e){return e.reduce(function(e,t){return(e||"").concat(t.name)},"")}function r(e){var t,a,n,r,i,s;l.taxonomyIsArray?(t=c(l.taxonomy),a=e,l.filteredVocabularies={},a?l.taxonomy.forEach(function(e){var t=o.filter(e,a);0<t.length&&(l.filteredVocabularies[e.name]=t)}):l.taxonomy.forEach(function(e){l.filteredVocabularies[e.name]=u(e)})):(t=l.taxonomy.name,n=e,l.filteredVocabularies=n?o.filter(l.taxonomy.vocabularies,n):u(l.taxonomy)),i=e,s=!1,void 0!==(r=t)&&void 0!==i&&(l.taxonomiesQuery.forEach(function(e){e.name===r&&void 0!==e.queryString&&(e.queryString=i,s=!0)}),s||l.taxonomiesQuery.push({name:r,queryString:i})),l.taxonomiesQuery.filter(function(e){return e.queryString})}function t(){l.classClose=!0,e(function(){l.onToggle(l.target,null)},200)}function u(e){return e.vocabularies.map(function(e){return e.filteredTerms=e.terms,e})}l.taxonomiesQuery=[],l.classClose=!1,l.$onChanges=function(e){if(l.taxonomyIsArray=Array.isArray(l.taxonomy),l.taxonomyName=l.taxonomyIsArray?c(l.taxonomy):l.taxonomy.name,e.taxonomy){var t=(a=l.taxonomyName,1===(n=l.taxonomiesQuery.filter(function(e){return e.name===a})).length?n[0].queryString:null);t?r(t):r()}var a,n},l.selectTaxonomyVocabularyArgs=function(e,t,a){l.onSelectTerm({target:l.target,taxonomy:e,vocabulary:t,args:a})},l.selectType=function(e){t(),l.onSelectType({type:e})},l.onFilterChange=r,l.togglePannel=t,l.removeCriterion=function(e){l.onRemoveCriterion({item:e})}}]}),ngObibaMica.search.component("vocabularyFilterDetail",{transclude:!0,bindings:{vocabulary:"<",onSelectVocabularyArgs:"&",onRemoveCriterion:"&"},templateUrl:"search/components/vocabulary/vocabulary-filter-detail/component.html",controller:["VocabularyService",function(a){var n=this;function t(e){"string-terms"!==n.criterionType||e.term.selected?n.onSelectVocabularyArgs({vocabulary:n.vocabulary,args:e}):0===n.vocabulary.terms.filter(function(e){return e.selected}).length?n.onRemoveCriterion({item:n.vocabulary.existingItem}):n.onSelectVocabularyArgs({vocabulary:n.vocabulary,args:e})}n.$onChanges=function(e){var t;e.vocabulary&&(t=n.vocabulary,a.isTermsVocabulary(t)||a.isRangeVocabulary(t)?n.criterionType="string-terms":a.isNumericVocabulary(t)?n.criterionType="numeric":a.isMatchVocabulary(t)&&(n.criterionType="match"))},n.canStillSelectMore=function(e){return!!Array.isArray(e)&&e.filter(function(e){return e.selected}).length<e.length},n.selectAllFilteredVocabularyTerms=function(e){t({term:e.map(function(e){return e.selected=!0,e})})},n.selectVocabularyArgs=t,n.removeCriterion=function(){n.onRemoveCriterion({item:n.vocabulary.existingItem})}}]}),function(){function n(){var t=[],a=[];this.dirty=!1,this.open=!1,this.loading=!0,this.addOnOpen=function(e){t.push(e)},this.addOnClose=function(e){a.push(e)},this.onOpen=function(){t.forEach(function(e){e()})},this.onClose=function(){a.forEach(function(e){e()})}}function t(r,i,s,e,t){var a=function(){if(r.state.open){r.state.onClose();var e=r.state.dirty;r.state.open=!1,r.state.dirty=!1,e&&r.$emit(CRITERIA_ITEM_EVENT.refresh)}};r.state=new n,r.timestamp=(new Date).getTime(),r.localize=function(e){return s.forLocale(e,r.criterion.lang)},r.localizeCriterion=function(){var e=r.criterion.rqlQuery;if((e.name===RQL_NODE.IN||e.name===RQL_NODE.OUT||e.name===RQL_NODE.CONTAINS)&&r.criterion.selectedTerms&&0<r.criterion.selectedTerms.length){var t=e.name===RQL_NODE.IN?" | ":" ",a=e.name===RQL_NODE.OUT?"-":"";return r.criterion.selectedTerms.map(function(t){if(!r.criterion.vocabulary.terms)return t;var e=r.criterion.vocabulary.terms.filter(function(e){return e.name===t}).pop();return a+(e?s.forLocale(e.title,r.criterion.lang):t)}).join(t)}var n=e.name;switch(e.name){case RQL_NODE.EXISTS:n=":"+i("translate")("any");break;case RQL_NODE.MISSING:n=":"+i("translate")("none");break;case RQL_NODE.EQ:n="="+e.args[1];break;case RQL_NODE.GE:n=">"+e.args[1];break;case RQL_NODE.LE:n="<"+e.args[1];break;case RQL_NODE.BETWEEN:n=":["+e.args[1]+")";break;case RQL_NODE.IN:case RQL_NODE.CONTAINS:n="";break;case RQL_NODE.MATCH:n=":match("+e.args[0]+")"}return s.forLocale(r.criterion.vocabulary.title,r.criterion.lang)+n},r.vocabularyType=e.vocabularyType,r.onKeyup=function(e){13===e.keyCode&&a()},r.truncate=t.truncate,r.remove=function(){r.$emit(CRITERIA_ITEM_EVENT.deleted,r.criterion)},r.openDropdown=function(){r.state.open?a():(r.state.open=!0,r.state.onOpen())},r.closeDropdown=a,r.VocabularyService=e}ngObibaMica.search.directive("criterionDropdown",["$document","$timeout","ngObibaMicaSearchTemplateUrl",function(n,r,e){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"="},controller:["$scope","$filter","LocalizedValues","VocabularyService","StringUtils",t],templateUrl:e.getTemplateUrl("CriterionDropdownTemplate"),link:function(t,e){var a=function(e){document.querySelector("#"+t.criterion.id.replace(".","-")+"-dropdown-"+t.timestamp).contains(e.target)||r(function(){t.$apply("closeDropdown()")})};n.on("click",a),e.on("$destroy",function(){n.off("click",a)})}}}])}(),function(){var n="search/components/criteria/item-region/item-node/component.html";ngObibaMica.search.controller("CriterionLogicalController",["$scope",function(t){t.updateLogical=function(e){t.item.rqlQuery.name=e,t.$emit(CRITERIA_ITEM_EVENT.refresh)}}]).directive("criteriaNode",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},controller:"CriterionLogicalController",templateUrl:n}}]).directive("criteriaLeaf",["CriteriaNodeCompileService",function(a){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},controller:"CriterionLogicalController",link:function(e,t){a.compile(e,t,n)}}}])}(),ngObibaMica.search.controller("MatchCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(t,e,a,n,r,i){t.lang=i.currentLocale();var s=t.criterion.rqlQuery.args[0];t.match="*"===s?"":s,t.update=function(){t.state.dirty=!0,r.updateMatchQuery(t.criterion.rqlQuery,t.match)},t.localize=function(e){return a.forLocale(e,t.criterion.lang)}}]).directive("matchCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"MatchCriterionTermsController",templateUrl:"search/components/criteria/item-region/match/component.html"}}]),ngObibaMica.search.controller("NumericCriterionController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(a,n,t,r,e,i){a.lang=i.currentLocale();var s=a.criterion.rqlQuery.args[1];angular.isArray(s)?(a.from=a.criterion.rqlQuery.args[1][0],a.to=a.criterion.rqlQuery.args[1][1]):(a.from=a.criterion.rqlQuery.name===RQL_NODE.GE?s:null,a.to=a.criterion.rqlQuery.name===RQL_NODE.LE?s:null);a.updateSelection=function(){e.updateRangeQuery(a.criterion.rqlQuery,a.from,a.to,a.selectMissing),a.state.dirty=!0},a.selectMissing=a.criterion.rqlQuery.name===RQL_NODE.MISSING,a.state.addOnClose(function(){a.updateSelection()}),a.state.addOnOpen(function(){var e,t;e=a.criterion.target,t=n.prepareCriteriaTermsQuery(a.query,a.criterion),r[targetToType(e)]({query:t}).$promise.then(function(e){var t=n.getTargetAggregations(e,a.criterion,a.lang);t&&t.default&&(a.min=t.default.min,a.max=t.default.max)})}),a.localize=function(e){return t.forLocale(e,a.criterion.lang)}}]).directive("numericCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"NumericCriterionController",templateUrl:"search/components/criteria/item-region/numeric/component.html"}}]),ngObibaMica.search.controller("searchCriteriaRegionController",["$scope","RqlQueryService","$timeout",function(t,a,e){var n=!1;t.$watchCollection("search.criteria",function(){t.renderableTargets=a.getRenderableTargetCriteriaFromRoot(t.search.criteria)}),t.$watchCollection("search.criteriaItemMap",function(){t.search.criteriaItemMap&&(n=1<Object.keys(t.search.criteriaItemMap).length)}),t.$watchCollection("search.rqlQuery",function(){var e=a.cleanQuery(angular.copy(t.search.rqlQuery));t.query=(new RqlQuery).serializeArgs(e.args)});t.showCopiedQueryTooltipStatus=!1;t.showCopiedQueryTooltip=function(){t.showCopiedQueryTooltipStatus=!0,e(function(){t.showCopiedQueryTooltipStatus=!1},1e3)},t.canShowCriteriaRegion=function(){return(t.options.studyTaxonomiesOrder.length||t.options.datasetTaxonomiesOrder.length||t.options.networkTaxonomiesOrder.length)&&n}}]).directive("searchCriteriaRegion",["ngObibaMicaSearchTemplateUrl",function(e){return{restrict:"EA",replace:!0,scope:{options:"=",search:"="},controller:"searchCriteriaRegionController",templateUrl:e.getTemplateUrl("searchCriteriaRegionTemplate")}}]),ngObibaMica.search.controller("StringCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","StringUtils","JoinQuerySearchResource","RqlQueryUtils","SearchContext","$filter",function(n,r,t,e,a,i,s,o){n.lang=s.currentLocale();var l=function(){n.state.dirty=!0,n.criterion.rqlQuery.name=n.selectedFilter;var t=[];n.selectedFilter!==RQL_NODE.MISSING&&n.selectedFilter!==RQL_NODE.EXISTS&&Object.keys(n.checkboxTerms).forEach(function(e){n.checkboxTerms[e]&&t.push(e)}),0===t.length&&n.selectedFilter!==RQL_NODE.MISSING&&(n.criterion.rqlQuery.name=RQL_NODE.EXISTS),i.updateQuery(n.criterion.rqlQuery,t)};n.isSelectedTerm=function(e){return n.criterion.selectedTerms&&-1!==n.criterion.selectedTerms.indexOf(e.key)},n.state.addOnOpen(function(){n.state.loading=!0;var e=n.criterion.target,t=r.prepareCriteriaTermsQuery(n.query,n.criterion,n.lang);a[targetToType(e)]({query:t}).$promise.then(function(e){if(n.state.loading=!1,n.terms=r.getTargetAggregations(e,n.criterion,n.lang),n.terms){if(n.criterion.taxonomy.name.startsWith("Mica_")&&"sets"===n.criterion.vocabulary.name){var a=n.criterion.vocabulary.terms;n.terms=n.terms.filter(function(t){return 0<a.filter(function(e){return e.name===t.key&&(t.title=n.localize(e.title),!0)}).length})}n.terms.forEach(function(e){n.checkboxTerms[e.key]=n.isSelectedTerm(e)}),n.terms=o("orderBySelection")(n.terms,n.checkboxTerms)}})}),n.checkboxTerms={},n.RQL_NODE=RQL_NODE,n.selectedFilter=n.criterion.type,n.isSelected=function(e){return-1!==n.checkboxTerms.indexOf(e)},n.updateFilter=function(){l()},n.localize=function(e){return t.forLocale(e,n.criterion.lang)},n.truncate=e.truncate,n.isInOutFilter=function(){return n.selectedFilter===RQL_NODE.IN||n.selectedFilter===RQL_NODE.OUT},n.isContainsFilter=function(){return n.selectedFilter===RQL_NODE.CONTAINS},n.updateSelection=l}]).directive("stringCriterionTerms",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"StringCriterionTermsController",templateUrl:"search/components/criteria/item-region/string-terms/component.html"}}]),ngObibaMica.analysis=angular.module("obiba.mica.analysis",["obiba.alert","ui.bootstrap","pascalprecht.translate","templates-ngObibaMica"]),ngObibaMica.analysis.controller("EntitiesCountController",["$scope","$location","$translate","$cookies","LocalizedValues","AnalysisConfigService","EntitiesCountResource","AlertService","ServerErrorUtils","ngObibaMicaAnalysisTemplateUrl",function(t,e,a,n,r,i,s,o,l,c){var u,d,m;function p(){t.query?(t.loading=!0,s.get({query:t.query},function(e){t.result=e,t.loading=!1,t.localizedTotal=(t.result.belowPrivacyThreshold?"<":"")+r.formatNumber(t.result.total,a.use())},function(e){t.result={},t.loading=!1,o.alert({id:"EntitiesCountController",type:"danger",msg:l.buildMessage(e),delay:5e3})})):t.result={}}t.options=i.getOptions(),u=t,d=n,m="micaHideEntitiesCountHelpText",a(["analysis.entities-count.help"]).then(function(e){u.options.EntitiesCountHelpText||d.get(m)||(u.options.EntitiesCountHelpText=e["analysis.entities-count.help"])}),u.closeHelpBox=function(){d.put(m,!0),u.options.EntitiesCountHelpText=null},d.get(m)&&(u.options.EntitiesCountHelpText=null),t.entitiesHeaderTemplateUrl=c.getHeaderUrl("entities"),t.result={},t.query=e.search().query,t.loading=!1,p(),t.$on("$locationChangeSuccess",function(){t.query=e.search().query,p()})}]),ngObibaMica.analysis.config(["$routeProvider",function(e){e.when("/entities-count",{templateUrl:"analysis/views/analysis-entities-count.html",controller:"EntitiesCountController",reloadOnSearch:!1})}]),ngObibaMica.analysis.config(["$provide",function(e){e.provider("ngObibaMicaAnalysisTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({entities:{header:null,footer:null},variableCrosstab:{template:null},variableFrequencies:{template:null},variableFrequenciesEmpty:{template:null},variableStatistics:{template:null},variableStatisticsEmpty:{template:null}}))}]),ngObibaMica.search.factory("EntitiesCountResource",["$resource","ngObibaMicaUrl",function(e,t){var a=t.getUrl("EntitiesCountResource"),n=-1===a.indexOf(":query")?"POST":"GET";return e(a,{},{get:{method:n,headers:{"Content-Type":"POST"===n?"application/x-www-form-urlencoded":"application/json"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},errorHandler:!0}})}]),ngObibaMica.search.factory("VariableResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(e,t,a){return e(t.getUrl("VariableResource"),{},{get:{method:"GET",errorHandler:!0,cache:a("variableResource")}})}]),ngObibaMica.search.factory("VariableSummaryResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(e,t,a){return e(t.getUrl("VariableSummaryResource"),{},{get:{method:"GET",errorHandler:!0,cache:a("variableSummaryResource")}})}]);var AnalysisConfigService=function(){function e(){this.options={crosstab:{showDetailedStats:!0},showAnalysis:!0}}return e.prototype.setOptions=function(t){var a=this;"object"==typeof t&&Object.keys(t).forEach(function(e){e in a.options&&(a.options[e]=t[e])})},e.prototype.getOptions=function(){return angular.copy(this.options)},e.prototype.showAnalysis=function(){return this.options.showAnalysis},e}();ngObibaMica.analysis.service("AnalysisConfigService",[AnalysisConfigService]);var EntitiesCountService=function(){function e(e,t){this.$location=e,this.ObibaServerConfigResource=t;var a=this;t.get(function(e){a.hasMultipleStudies=!e.isSingleStudyEnabled||e.isHarmonizedDatasetEnabled})}return e.prototype.isSingleStudy=function(){return!this.hasMultipleStudies},e.prototype.update=function(e,t){if(e!==t){var a=this.$location.search();a.query=a.query.split(e).join("").replace(/,,/,",").replace(/^,/,"").replace(/,$/,""),t&&0!==t.length&&(a.query&&0<a.query.length?a.query=a.query+","+t:a.query=t),this.$location.search(a)}},e.$inject=["$location","ObibaServerConfigResource"],e}();ngObibaMica.analysis.service("EntitiesCountService",["$location","ObibaServerConfigResource",EntitiesCountService]);var Operation,EntitiesCountResultTableController=function(){function e(e,t,a,n,r){this.PageUrlService=e,this.LocalizedValues=t,this.EntitiesCountService=a,this.$translate=n,this.$log=r,this.result={}}return e.prototype.$onInit=function(){this.table={rows:new Array}},e.prototype.$onChanges=function(){this.table=this.asTable(),this.localizedTotal=this.LocalizedValues.formatNumber(this.result.total?this.result.total:0),this.result.belowPrivacyThreshold&&(this.localizedTotal="<"+this.localizedTotal)},e.prototype.showStudyColumn=function(){return!this.EntitiesCountService.isSingleStudy()},e.prototype.localize=function(e){return this.LocalizedValues.forLang(e,this.$translate.use())},e.prototype.asTable=function(){var h=this,f={rows:new Array};return this.studyCount=this.result.counts?this.result.counts.length:0,this.studyCount&&this.result.counts.forEach(function(d){var m=h.localize(d.study.acronym),p=h.localize(d.study.name);if(d.counts){var g=0;d.counts.forEach(function(l){var c=h.localize(l.dataset.acronym),u=h.localize(l.dataset.name);l.counts&&l.counts.forEach(function(e){var t=e.variable.id.split(":"),a=t[1];e.studyTableName&&(a=a+" ("+h.localize(e.studyTableName)+")");var n=t[2],r=h.PageUrlService.variablePage(e.variable.id),i=h.PageUrlService.datasetPage(l.dataset.id,n),s="Dataschema"===n?"harmonization":"individual",o=new Array({colspan:1,link:h.PageUrlService.studyPage(d.study.id,s),rowspan:0===g?1:0,title:0===g?p:"",value:0===g?m:""},{colspan:1,link:r||i,rowspan:1,title:h.localize(e.variable.name),value:a},{colspan:1,link:i,rowspan:1,title:u,value:c},{colspan:1,link:void 0,rowspan:1,title:e.query,value:e.query},{colspan:1,link:void 0,rowspan:1,title:void 0,value:h.LocalizedValues.formatNumber(e.count)});f.rows.push(o),g++})}),f.rows[f.rows.length-g][0].rowspan=g+1,f.rows.push(new Array({colspan:1,rowspan:0,title:void 0,value:void 0},{colspan:3,rowspan:1,title:d.query,value:void 0},{colspan:1,rowspan:1,title:void 0,value:(d.belowPrivacyThreshold?"<":"")+h.LocalizedValues.formatNumber(d.total)}))}}),f},e.$inject=["PageUrlService","LocalizedValues","EntitiesCountService","$translate","$log"],e}(),EntitiesCountResultTableComponent=function(){this.transclude=!0,this.bindings={result:"<"},this.controller=EntitiesCountResultTableController,this.controllerAs="$ctrl",this.templateUrl="analysis/components/entities-count-result-table/component.html"};ngObibaMica.analysis.component("entitiesCountResultTable",new EntitiesCountResultTableComponent),function(e){e.All="all",e.Exists="exists",e.Empty="empty",e.In="in",e.Out="out"}(Operation||(Operation={}));var VariableCriteriaController=function(){function e(e,t,a,n,r,i,s){this.VariableResource=e,this.VariableSummaryResource=t,this.LocalizedValues=a,this.EntitiesCountService=n,this.$log=r,this.$translate=i,this.$filter=s,this.query="",this.state={open:!1},this.categoriesData=[],this.selectedCategories={},this.selectedNumericalOperation="range",this.selectedTemporalOperation="range"}return e.prototype.$onInit=function(){this.loading=!0,this.initializeState()},e.prototype.onKeyup=function(e){13===e.keyCode?this.closeDropdown(!1):27===e.keyCode&&this.closeDropdown(!0)},e.prototype.onSearchTextKeyup=function(e){var t=this.searchText.trim();if(this.categoriesData){var a=new RegExp(t,"i");this.categoriesData.forEach(function(e){e.visible=null!==e.label.match(a)})}},e.prototype.onNumericalMinKeyup=function(e){this.selectedMin=this.ensureNumericValue(this.selectedMin+""," ")},e.prototype.onNumericalMaxKeyup=function(e){this.selectedMax=this.ensureNumericValue(this.selectedMax+""," ")},e.prototype.onNumericalValuesKeyup=function(e){this.selectedNumericalValues=this.ensureNumericValue(this.selectedNumericalValues," ")},e.prototype.closeDropdown=function(e){this.state.open=!1,e||this.update(this.makeNewQuery())},e.prototype.openDropdown=function(){this.state.open?this.closeDropdown(!1):this.state.open=!0},e.prototype.onRemove=function(){this.update("")},e.prototype.getQueryTitle=function(e){var t=this;if(!this.rqlQuery)return"?";var a=this.getOperationTitle(),n=this.getRqlQueryWithArgs();if(1<n.args.length){var r=n.args[1];"CATEGORICAL"===this.getNature()&&(r=r.map(function(e){return t.localizeCategory(e)})),a="range"===n.name?a+" ["+r.join(", ")+"]":a+" ("+r.join(", ")+")"}return e?50<a.length?a.substring(0,50)+"...":a:50<a.length?a:""},e.prototype.showInOperations=function(){return"CATEGORICAL"===this.getNature()||this.isNumerical()||this.isTemporal()},e.prototype.showCategoricalOptions=function(){return"CATEGORICAL"===this.getNature()&&this.showOptions()},e.prototype.showNumericalOptions=function(){return"CONTINUOUS"===this.getNature()&&this.isNumerical()&&this.showOptions()},e.prototype.showTemporalOptions=function(){return"TEMPORAL"===this.getNature()&&this.isTemporal()&&this.showOptions()},e.prototype.localizeNumber=function(e){return this.LocalizedValues.formatNumber(e)},e.prototype.initializeState=function(){if(this.rqlQuery=this.parseQuery(),this.rqlQuery.args){var e=this.getQueryWithArgs();this.id=e.args[0].join(":"),this.VariableResource.get({id:this.id},this.onVariable(),this.onError())}},e.prototype.getQueryWithArgs=function(){return this.isQueryNot()?this.rqlQuery.args[0]:this.rqlQuery},e.prototype.isQueryNot=function(){return"not"===this.rqlQuery.name},e.prototype.update=function(e){this.EntitiesCountService.update(this.query,e)},e.prototype.showOptions=function(){return Operation.All!==this.selectedOperation&&Operation.Exists!==this.selectedOperation&&Operation.Empty!==this.selectedOperation},e.prototype.getNature=function(){return this.variable?this.variable.nature:"?"},e.prototype.isNumerical=function(){return this.variable&&("integer"===this.variable.valueType||"decimal"===this.variable.valueType)},e.prototype.isLogical=function(){return this.variable&&"boolean"===this.variable.valueType},e.prototype.isTemporal=function(){return this.variable&&("date"===this.variable.valueType||"datetime"===this.variable.valueType)},e.prototype.getOperationTitle=function(){var e=this.getRqlQueryWithArgs();return this.isNotQuery()?"exists"===e.name?this.$filter("translate")("analysis.empty"):this.$filter("translate")("analysis.out"):this.$filter("translate")("analysis."+("range"===e.name?"in":e.name))},e.prototype.getRqlQueryWithArgs=function(){return this.isNotQuery()?this.rqlQuery.args[0]:this.rqlQuery},e.prototype.isNotQuery=function(){return this.rqlQuery&&"not"===this.rqlQuery.name},e.prototype.parseQuery=function(){try{return(new RqlParser).parse(this.normalize(this.query)).args[0]}catch(e){this.$log.error(e.message)}return new RqlQuery},e.prototype.normalize=function(e){return e.split(":").join("/")},e.prototype.localizeCategory=function(t){if(!this.variable.categories)return this.isLogical()?this.$filter("translate")("global."+t):t;var e=this.variable.categories.filter(function(e){return e.name===t+""});if(0===e.length)return t;var a=e[0];if(!a.attributes)return t;var n=a.attributes.filter(function(e){return"label"===e.name});return 0===n.length?t:this.localize(n[0].values)||t},e.prototype.localize=function(e){return this.LocalizedValues.forLang(e,this.$translate.use())},e.prototype.prepareCategories=function(){var t=this;if(this.categoriesData=[],"CATEGORICAL"===this.getNature()){var e=this.variable.categories;e?e.forEach(function(e){t.categoriesData.push({label:t.localizeCategory(e.name),name:e.name,visible:!0})}):this.isLogical()&&(this.categoriesData.push({label:this.$filter("translate")("global.true"),name:"true",visible:!0}),this.categoriesData.push({label:this.$filter("translate")("global.false"),name:"false",visible:!0}))}},e.prototype.prepareOptions=function(){var t=this;this.prepareCategories();var e=this.getRqlQueryWithArgs();if(1<e.args.length)if("in"===e.name)this.showCategoricalOptions()?e.args[1].forEach(function(e){t.selectedCategories[e]=!0}):this.showNumericalOptions()?(this.selectedNumericalOperation="in",this.selectedNumericalValues=e.args[1].filter(function(e){return!isNaN(e)}).join(" ")):this.showTemporalOptions()&&(this.selectedTemporalOperation="in",this.selectedTemporalValue=0<e.args[1].length?new Date(Date.parse(e.args[1][0])):void 0);else if("range"===e.name&&0<e.args[1].length){var a=e.args[1][0];if("*"===a?(this.selectedMin=void 0,this.selectedFrom=void 0):this.showNumericalOptions()&&!isNaN(a)?this.selectedMin=a:this.showTemporalOptions()&&(this.selectedFrom=new Date(Date.parse(a))),2<=e.args[1].length){var n=e.args[1][1];"*"===n?(this.selectedMax=void 0,this.selectedTo=void 0):this.showNumericalOptions()&&!isNaN(n)?this.selectedMax=n:this.showTemporalOptions()&&(this.selectedTo=new Date(Date.parse(n)))}}this.selectedOperation="range"===this.rqlQuery.name?"in":this.rqlQuery.name,!this.isQueryNot()||"in"!==e.name&&"range"!==e.name||(this.selectedOperation="out"),this.isQueryNot()&&"exists"===e.name&&(this.selectedOperation="empty")},e.prototype.ensureNumericValue=function(e,t){var a="";if(e)for(var n=0;n<e.length;n++){var r=e.charAt(n);(r===t||"decimal"===this.variable.valueType&&"."===r||"-"===r||!isNaN(parseInt(r,10)))&&(a+=r)}return a},e.prototype.makeNewQuery=function(){var e,t=this,a="";(this.showCategoricalOptions()&&(e=Object.keys(this.selectedCategories).filter(function(e){return t.selectedCategories[e]}).map(function(e){return e}).join(",")),this.showNumericalOptions())&&(e="range"===this.selectedNumericalOperation?[this.selectedMin&&"-"!==this.selectedMin?this.selectedMin:"*",this.selectedMax&&"-"!==this.selectedMax?this.selectedMax:"*"].join(","):this.selectedNumericalValues.split(" ").join(","));this.showTemporalOptions()&&(e="range"===this.selectedTemporalOperation?[this.selectedFrom?this.dateToString(this.selectedFrom):"*",this.selectedTo?this.dateToString(this.selectedTo):"*"].join(","):this.dateToString(this.selectedTemporalValue));switch(this.selectedOperation){case Operation.All:case Operation.Exists:a=this.selectedOperation+"({field})";break;case Operation.Empty:a="not(exists({field}))";break;case Operation.In:e&&0<e.length?this.showCategoricalOptions()||this.showNumericalOptions()&&"in"===this.selectedNumericalOperation||this.showTemporalOptions()&&"in"===this.selectedTemporalOperation?a="in({field},({args}))":(this.showNumericalOptions()&&"range"===this.selectedNumericalOperation||this.showTemporalOptions()&&"range"===this.selectedTemporalOperation)&&(a="range({field},({args}))"):(a="not(exists({field}))",this.selectedOperation="empty");break;case Operation.Out:e&&0<e.length?this.showCategoricalOptions()||this.showNumericalOptions()&&"in"===this.selectedNumericalOperation||this.showTemporalOptions()&&"in"===this.selectedTemporalOperation?a="not(in({field},({args})))":(this.showNumericalOptions()&&"range"===this.selectedNumericalOperation||this.showTemporalOptions()&&"range"===this.selectedTemporalOperation)&&(a="not(range({field},({args})))"):(a="exists({field})",this.selectedOperation="exists")}return a=(a=a.replace("{field}",this.variable.id)).replace("{args}",e)},e.prototype.dateToString=function(e){if(!e)return"";var t=e.getMonth()+1,a=e.getDate();return[e.getFullYear(),(9<t?"":"0")+t,(9<a?"":"0")+a].join("-")},e.prototype.onVariable=function(){var t=this;return function(e){t.variable=e,t.loading=!1,t.prepareOptions(),t.VariableSummaryResource.get({id:e.id},t.onVariableSummary(),t.onError())}},e.prototype.onVariableSummary=function(){var s=this;return function(e){if(s.summary=e,s.summary["Math.ContinuousSummaryDto.continuous"]){var t=s.summary["Math.ContinuousSummaryDto.continuous"].summary;s.rangeMin=t.min,s.rangeMax=t.max;var a=(i=s.summary["Math.ContinuousSummaryDto.continuous"].frequencies)?i.filter(function(e){return"NOT_NULL"===e.value}).pop():void 0;s.existsFrequency=a?a.freq:0;var n=i.filter(function(e){return"N/A"===e.value}).pop();s.emptyFrequency=n?n.freq:0,s.allFrequency=s.existsFrequency+s.emptyFrequency}if(s.summary["Math.CategoricalSummaryDto.categorical"]){var r=s.summary["Math.CategoricalSummaryDto.categorical"].frequencies;s.categoriesData.forEach(function(t){var e=r.filter(function(e){return e.value===t.name});0<e.length&&(t.frequency=e[0].freq)}),s.allFrequency=s.summary["Math.CategoricalSummaryDto.categorical"].n,s.existsFrequency=s.summary["Math.CategoricalSummaryDto.categorical"].otherFrequency+r.filter(function(e){return"N/A"!==e.value}).map(function(e){return e.freq}).reduce(function(e,t){return e+t}),s.emptyFrequency=s.allFrequency-s.existsFrequency}s.summary["Math.TextSummaryDto.textSummary"]&&(s.allFrequency=s.summary["Math.TextSummaryDto.textSummary"].n,(i=s.summary["Math.TextSummaryDto.textSummary"].frequencies)&&(s.existsFrequency=i.filter(function(e){return"N/A"!==e.value}).map(function(e){return e.freq}).reduce(function(e,t){return e+t})),s.summary["Math.TextSummaryDto.textSummary"].otherFrequency&&(s.existsFrequency=s.existsFrequency+s.summary["Math.TextSummaryDto.textSummary"].otherFrequency),s.emptyFrequency=s.allFrequency-s.existsFrequency);if(s.summary["Math.DefaultSummaryDto.defaultSummary"]){s.allFrequency=s.summary["Math.DefaultSummaryDto.defaultSummary"].n;var i;a=(i=s.summary["Math.DefaultSummaryDto.defaultSummary"].frequencies)?i.filter(function(e){return"NOT_NULL"===e.value}).pop():void 0;s.existsFrequency=a?a.freq:0,s.emptyFrequency=s.allFrequency-s.existsFrequency}}},e.prototype.onError=function(){var t=this;return function(e){t.variable=void 0,t.loading=!1}},e.$inject=["VariableResource","VariableSummaryResource","LocalizedValues","EntitiesCountService","$log","$translate","$filter"],e}(),VariableCriteriaComponent=function(){this.transclude=!0,this.bindings={query:"<"},this.controller=VariableCriteriaController,this.controllerAs="$ctrl",this.templateUrl="analysis/components/variable-criteria/component.html"};ngObibaMica.analysis.component("variableCriteria",new VariableCriteriaComponent),ngObibaMica.DatasetVariableCrosstab=angular.module("obiba.mica.DatasetVariableCrosstab",["ui.bootstrap","obiba.notification","obiba.mica.analysis","schemaForm","schemaForm-datepicker","pascalprecht.translate","angularMoment","ui.bootstrap","ui.select"]),ngObibaMica.DatasetVariableCrosstab.controller("DatasetVariableCrosstabController",["$rootScope","$scope","$routeParams","$log","$location","$route","$translate","DatasetResource","DatasetCategoricalVariablesResource","DatasetVariablesResource","DatasetVariableResource","DatasetVariablesCrosstabResource","ServerErrorAlertService","ContingencyService","LocalizedValues","ChiSquaredCalculator","PageUrlService","ngObibaMicaAnalysisTemplateUrl","AnalysisConfigService",function(i,o,a,t,s,l,c,e,n,r,u,d,m,p,g,h,f,b,y){var v=y.getOptions(),T=function(e){o.serverError=!0,m.alert("MainController",e)},S=function(e){return e&&"CONTINUOUS"===e.nature},w=function(){return o.crosstab.lhs.variable&&o.crosstab.rhs.variable&&!S(o.crosstab.rhs.variable)},C=function(){var e,t,r;o.crosstab.lhs.variable&&o.crosstab.rhs.variable&&(o.crosstab.lhs.xVariable=o.crosstab.lhs.variable,o.crosstab.rhs.xVariable=o.crosstab.rhs.variable,e=p.removeVariableFromUrl(s.path()),t=p.createVariableUrlPart(o.crosstab.lhs.xVariable.id,o.crosstab.rhs.xVariable.id),r=s.path,s.path=function(e,t){if(!1===t)var a=l.current,n=i.$on("$locationChangeSuccess",function(){l.current=a,n()});return r.apply(s,[e])},s.path(e+"/"+t,!1),s.path=r,o.loading=!0,d.get({dsType:a.type,dsId:a.ds,v1:o.crosstab.lhs.xVariable.name,v2:o.crosstab.rhs.xVariable.name},function(e){0===Object.keys(e).filter(function(e){return"$"!==e[0]}).length?T({status:"crosstab.no-data"}):(o.crosstab.contingencies=R(e.contingencies?e.contingencies:[e]),o.datasetHarmo&&(o.crosstab.all=R(e.all?[e.all]:[])[0])),o.loading=!1},T))},x=function(){o.crosstab={lhs:{variable:null,xVariable:null,variables:[]},rhs:{variable:null,xVariable:null,variables:[]},all:null,contingencies:null}};function E(t,e){function u(e,t){return 0===t?0:e/t*100}function a(a){a.frequencies||(a.frequencies=[]);var n=a.frequencies.map(function(e){return e.value});e.forEach(function(e,t){-1===n.indexOf(e)&&a.frequencies.splice(t,0,{count:a.privacyCheck?0:"-",value:e})})}function n(s,o,l,c){c?(s.percent=u(s.n,o),s.frequencies.forEach(function(e,t){var a,n,r,i;e.percent=u(e.count,l.frequencies[t].count),e.cpercent=u(e.count,s.n),c.sum+=(a=e.count,r=s.n,i=l.frequencies[t].count,0==(n=r*i/o)?0:Math.pow(a-n,2)/n)})):s.frequencies.forEach(function(e){e.percent=u(e.count,o),e.cpercent=u(e.n,o)})}t.privacyThreshold;var r,i,s=t.all.total;t.all.privacyCheck=t.all.frequencies&&0<t.all.frequencies.length,a(t.all),n(t.all,s,t.all),t.aggregations&&(t.chiSquaredInfo={pValue:0,sum:0,df:(r=o.crosstab.rhs.xVariable.categories.length,i=o.crosstab.lhs.xVariable.categories.length,(r-1)*(i-1))},t.privacyCheck=!0,t.aggregations.forEach(function(e){e.privacyCheck=!!e.frequencies&&0<e.frequencies.length,t.privacyCheck=t.privacyCheck&&e.privacyCheck,a(e),n(e,s,t.all,t.chiSquaredInfo)}),t.privacyCheck&&(t.chiSquaredInfo.pValue=1-h.compute(t.chiSquaredInfo)))}var O=function(t){var e=t.studySummary,a={},n={};if(t.studySummary){var r=t.studySummary;n=(a=r.populationSummaries?r.populationSummaries[0]:null)&&a.dataCollectionEventSummaries?a.dataCollectionEventSummaries.filter(function(e){return e.id===t.dataCollectionEventId}):null}var i=c.use();return{summary:g.forLang(e.acronym,i),population:a?g.forLang(a.name,i):"",dce:n?g.forLang(n[0].name,i):"",project:t.project,table:t.table,tableName:g.forLang(t.name,i)}};function R(e){var t=o.crosstab.rhs.xVariable.categories?o.crosstab.rhs.xVariable.categories.map(function(e){return e.name}):void 0,a=o.crosstab.lhs.xVariable.categories?o.crosstab.lhs.xVariable.categories.map(function(e){return e.name}):void 0;return e&&e.forEach(function(e){e.totalPrivacyCheck=-1!==e.all.n,(!e.totalPrivacyCheck||0<e.all.n)&&(S(o.crosstab.rhs.xVariable)?function(a,e){a.privacyCheck=a.aggregations.filter(function(e){return null!==e.statistics}).length===a.aggregations.length;var n=a.aggregations.map(function(e){return e.term});a.privacyCheck?e.forEach(function(e,t){-1===n.indexOf(e)&&a.aggregations.splice(t,0,{n:"-",statistics:{min:"-",max:"-",mean:"-",stdDeviation:"-"}})}):(a.aggregations.forEach(function(e){e.statistics={min:"-",max:"-",mean:"-",stdDeviation:"-"}}),a.all.statistics={min:"-",max:"-",mean:"-",stdDeviation:"-"})}(e,a):E(e,t)),e.studyTable&&(e.info=O(e.studyTable))}),e}function D(e,t){var a=null;return e&&e.categories&&(a=e.categories.filter(function(e){return e.name===t})),a?a[0]:t}o.crosstabTemplateUrl=b.getTemplateUrl("variableCrosstab"),o.isStatistical=S,o.getTemplatePath=function(e){if(o.crosstab.rhs.xVariable)return S(o.crosstab.rhs.xVariable)?!e.totalPrivacyCheck||0<e.all.n?b.getTemplateUrl("variableStatistics"):b.getTemplateUrl("variableStatisticsEmpty"):!e.totalPrivacyCheck||0<e.all.n?b.getTemplateUrl("variableFrequencies"):b.getTemplateUrl("variableFrequenciesEmpty");t.error("RHS variable is not initialized!")},o.getPrivacyErrorMessage=function(e){return e.totalPrivacyCheck?e.privacyCheck?"":"dataset.crosstab.privacy-check-failed":"dataset.crosstab.total-privacy-check-failed"},o.canExchangeVariables=w,o.exchangeVariables=function(){if(w()){var e=o.crosstab.lhs.variable;o.crosstab.lhs.variable=o.crosstab.rhs.variable,o.crosstab.rhs.variable=e,C()}},o.extractSummaryInfo=O,o.lhsVariableCategory=function(e){return D(o.crosstab.lhs.xVariable,e)},o.rhsVariableCategory=function(e){return D(o.crosstab.rhs.xVariable,e)},o.clear=function(){x()},o.submit=C,o.searchCategoricalVariables=function(e){!e||e.trim().length<2||n.get({dsType:a.type,dsId:a.ds,query:e.trim()+"*"},function(e){o.crosstab.lhs.variables=e.variables},T)},o.searchVariables=function(e){!e||e.trim().length<2||r.get({dsType:a.type,dsId:a.ds,query:e.trim()+"*"},function(e){o.crosstab.rhs.variables=e.variables},T)},o.PageUrlService=f,o.DocType={CSV:"csv",EXCEL:"excel"},o.StatType={CPERCENT:1,RPERCENT:2,CHI:3},o.routeParams=a,o.options={showDetailedStats:v.crosstab.showDetailedStats,showDetails:!0,statistics:o.StatType.CPERCENT},o.downloadUrl=function(e){return p.getCrossDownloadUrl({":dsType":a.type,":dsId":a.ds,":docType":e,":v1":o.crosstab.lhs.xVariable.name,":v2":o.crosstab.rhs.xVariable.name})},x(),e.get({dsType:a.type,dsId:a.ds},function(e){o.dataset=e,o.dataset.translatedAcronym=g.forLang(o.dataset.acronym,c.use()),o.datasetHarmo=o.dataset.hasOwnProperty("obiba.mica.HarmonizedDatasetDto.type")},T);var A=0;a.varId&&u.get({varId:a.varId},function(e){o.crosstab.lhs.variable=e,o.crosstab.lhs.variables=[e],1<++A&&C()},T),a.byId&&u.get({varId:a.byId},function(e){o.crosstab.rhs.variable=e,o.crosstab.rhs.variables=[e],1<++A&&C()},T)}]),ngObibaMica.DatasetVariableCrosstab.filter("variableCategory",function(){return function(e,t){var a=null;return e&&(a=e.filter(function(e){return e.name===t})),a?a[0]:null}}).filter("variableLabel",["AttributeService",function(n){return function(e){var t="";if(e){var a=n.getAttributes(e,["label"]);return a&&a.forEach(function(e){return t=n.getValue(e),!1}),t}}}]).filter("roundNumber",["$filter",function(t){return function(e){return isNaN(e)?e:t("number")(e,2)}}]),ngObibaMica.DatasetVariableCrosstab.config(["$routeProvider",function(e){e.when("/crosstab/:type/:ds",{templateUrl:"analysis/crosstab/views/crosstab-variable-crosstab.html",controller:"DatasetVariableCrosstabController"}).when("/crosstab/:type/:ds/variable/:varId",{templateUrl:"analysis/crosstab/views/crosstab-variable-crosstab.html",controller:"DatasetVariableCrosstabController"}).when("/crosstab/:type/:ds/variable/:varId/by/:byId",{templateUrl:"analysis/crosstab/views/crosstab-variable-crosstab.html",controller:"DatasetVariableCrosstabController"})}]);var CrosstabStudyTableController=function(){function e(e){this.PageUrlService=e,this.contingency={}}return e.prototype.$onChanges=function(){this.contingency.studyTable&&(this.studyLink=this.PageUrlService.studyPage(this.contingency.studyTable.studyId,"individual-study"))},e.$inject=["PageUrlService"],e}(),CrosstabStudyTableComponent=function(){this.transclude=!0,this.bindings={contingency:"<"},this.controller=CrosstabStudyTableController,this.controllerAs="$ctrl",this.templateUrl="analysis/components/crosstab-study-table/component.html"};function NgObibaMicaListsOptionsFactory(){var a={listSearchOptions:{network:{fields:["studyIds","acronym.*","name.*","description.*","logo"]},study:{fields:["logo","objectives.*","acronym.*","name.*","model.methods.design","model.numberOfParticipants.participant"]},dataset:{fields:["acronym.*","name.*","description.*","variableType","studyTable.studyId","studyTable.project","studyTable.table","studyTable.populationId","studyTable.dataCollectionEventId","harmonizationTable.studyId","harmonizationTable.project","harmonizationTable.table","harmonizationTable.populationId"]}},listOptions:{networkOptions:{showStudyBadge:!0,showDatasetBadge:!0,showVariableBadge:!0},studyOptions:{studiesCountCaption:!0,studiesSearchForm:!0,studiesSupplInfoDetails:!0,studiesTrimmedDescription:!0,showNetworkBadge:!0,showDatasetBadge:!0,showVariableBadge:!0},datasetOptions:{showNetworkBadge:!0,showStudyBadge:!0,showVariableBadge:!0}}};function e(){this.getOptions=function(){return a}}this.$get=function(){return new e},this.setOptions=function(t){Object.keys(t).forEach(function(e){e in a&&(a[e]=t[e])})}}function SortWidgetOptionsProvider(){var a={sortOrderField:{options:[{value:"-_score",label:"relevance"},{value:"name",label:"name"},{value:"-name",label:"name"},{value:"acronym",label:"acronym"},{value:"-acronym",label:"acronym"}],defaultValue:"-_score"}},e=this;function t(e){var t=e;this.getOptions=function(){return t}}this.getDefaultOptions=function(){return e.defaultOptions},this.$get=function(){return new t(a)},this.setOptions=function(t){Object.keys(t).forEach(function(e){e in a&&t[e].options&&(a[e].options=a[e].options.concat(t[e].options),a[e].default=t[e].default)})}}ngObibaMica.DatasetVariableCrosstab.component("crosstabStudyTable",new CrosstabStudyTableComponent),ngObibaMica.lists=angular.module("obiba.mica.lists",["obiba.mica.search"]),ngObibaMica.lists.run().config(["$provide",function(e){e.provider("ngObibaMicaLists",NgObibaMicaListsOptionsFactory)}]).config(["ngObibaMicaSearchTemplateUrlProvider",function(e){e.setTemplateUrl("searchStudiesResultTable","lists/views/list/studies-search-result-table-template.html"),e.setTemplateUrl("searchNetworksResultTable","lists/views/list/networks-search-result-table-template.html"),e.setTemplateUrl("searchDatasetsResultTable","lists/views/list/datasets-search-result-table-template.html"),e.setTemplateUrl("searchResultList","lists/views/search-result-list-template.html"),e.setTemplateUrl("searchInputList","lists/views/input-search-widget/input-search-widget-template.html"),e.setTemplateUrl("searchCriteriaRegionTemplate","lists/views/region-criteria/search-criteria-region-template.html"),e.setTemplateUrl("CriterionDropdownTemplate","lists/views/region-criteria/criterion-dropdown-template.html")}]).config(["$provide",function(e){e.provider("sortWidgetOptions",SortWidgetOptionsProvider)}]).filter("getBaseUrl",function(){return function(e){return"/mica/"+e}}).filter("doSearchQuery",function(){return function(e,t){return"/mica/repository#/search?type="+e+"&query="+t+"&display=list"}}),ngObibaMica.lists.controller("listSearchWidgetController",["$scope","$rootScope","$location","RqlQueryService","ngObibaMicaUrl",function(n,e,t,r,i){function a(){n.query=t.search().query,n.target=typeToTarget(n.type),n.rqlQuery=r.parseQuery(n.query)}n.navigateToSearchPage=function(){var e=r.findTargetQuery(typeToTarget(n.type),r.parseQuery(n.query));if(e){var t=r.findQueryInTargetByVocabulary(e,"className")||r.findQueryInTargetByVocabulary(e,"id");if(t){e.args=[t];var a=new RqlQuery(RQL_NODE.AND);return a.args.push(e),i.getUrl("BaseUrl")+i.getUrl("SearchBaseUrl")+"?type="+n.type+"&query="+(new RqlQuery).serializeArgs(a.args)+"&display=list"}}return""},n.$on("$locationChangeSuccess",function(){a()});var s=e.$new();n.selectSuggestion=function(e){s.$emit("ngObibaMicaSearch.searchSuggestion",e)},n.search=function(){s.$emit("ngObibaMicaSearch.searchSuggestion",n.searchFilter.replace(/\/.*/g,""))},a()}]).controller("listSortWidgetController",["$scope","$rootScope","sortWidgetService",function(t,e,a){var n=e.$new();function r(){t.selected=a.getSortOrderOption(a.getSortArg())}t.selectSortOrder=a.getSortOrderOptions(),t.getLabel=a.getLabel,t.selected=t.selectSortOrder.options.defaultValue,r(),t.$on("$locationChangeSuccess",function(){r()}),t.selectSortOrderOption=function(e){t.selected=e,n.$emit("ngObibaMicaSearch.sortChange",e.value)}}]),ngObibaMica.lists.directive("listSortWidget",[function(){return{restrict:"EA",controller:"listSortWidgetController",templateUrl:"lists/views/sort-widget/sort-widget-template.html"}}]).directive("listSearchWidget",["ngObibaMicaSearchTemplateUrl",function(e){return{restrict:"EA",require:"^^suggestionField",transclude:!0,replace:!0,scope:{type:"="},controller:"listSearchWidgetController",templateUrl:e.getTemplateUrl("searchInputList")}}]).directive("suggestionField",["$location","DocumentSuggestionResource","$translate","RqlQueryService","EntitySuggestionService",function(e,t,a,n,r){return{restrict:"EA",replace:!0,scope:{documentType:"=",model:"=",placeholderText:"=",select:"="},templateUrl:"lists/views/input-search-widget/suggestion-field.html",link:function(t){t.suggest=function(e){return r.suggestForTargetQuery(t.documentType,e)}}}}]),ngObibaMica.lists.service("sortWidgetService",["$filter","$location","RqlQueryService","sortWidgetOptions",function(t,n,r,e){var i=e.getOptions(),s=this;this.getSortOrderOptions=function(){return i.sortOrderField.options.map(function(e){return t("translate")(e.label)}),{options:i.sortOrderField.options}},this.getSortOrderOption=function(t){var a=null;return t||(t=i.sortOrderField.defaultValue),angular.forEach(s.getSortOrderOptions().options,function(e){e.value===t&&(a=e)}),a||s.getSortOrderOption(i.sortOrderField.defaultValue)},this.getSortArg=function(){var e=n.search(),t=r.parseQuery(e.query);if(t){var a=r.getTargetQuerySort(targetToType(t.args[0].name),t);if(a)return a.args[0]}return i.sortOrderField.defaultValue},this.getLabel=function(e,t){var a=null;return angular.forEach(e.options,function(e){e.value===t&&(a=e.label)}),a}}]);